<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Java枚举详解</title>
      <link href="/2026/02/05/Java%E6%9E%9A%E4%B8%BE/"/>
      <url>/2026/02/05/Java%E6%9E%9A%E4%B8%BE/</url>
      
        <content type="html"><![CDATA[<h1 id="Java枚举详解"><a href="#Java枚举详解" class="headerlink" title="Java枚举详解"></a>Java枚举详解</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>枚举（Enumeration）是Java语言中一种特殊的类，用于表示一组固定的常量集合。自Java 5引入以来，枚举类已经成为Java开发中不可或缺的一部分，为我们提供了一种类型安全、简洁明了的常量定义方式。</p><p>本文将详细介绍Java枚举类的基本概念、语法结构、应用场景、实现原理以及使用注意事项，帮助开发者更好地理解和应用枚举类。</p><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol><li><a href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">Java枚举类的基本概念和语法</a></li><li><a href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">枚举类在实际开发中的应用场景</a></li><li><a href="#%E8%A7%A3%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98">枚举类解决的问题和优势</a></li><li><a href="#%E4%B8%8E%E6%99%AE%E9%80%9A%E7%B1%BB%E7%9A%84%E5%8C%BA%E5%88%AB">枚举类与普通类的区别</a></li><li><a href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">Java枚举类的实现原理</a></li><li><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">枚举类在实际工程中的注意事项</a></li><li><a href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B">枚举类的实际代码示例</a></li></ol><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>枚举类是一种特殊的类，它继承自<code>java.lang.Enum</code>类，用于表示一组固定的常量。在Java中，枚举类使用<code>enum</code>关键字定义，其语法结构如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">EnumName</span> &#123;</span><br><span class="line">    CONSTANT1,</span><br><span class="line">    CONSTANT2,</span><br><span class="line">    CONSTANT3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>每个枚举常量都是枚举类的一个实例，它们在枚举类加载时被创建，并且是唯一的。枚举类的常量通常使用大写字母表示，多个常量之间用逗号分隔，最后一个常量后面可以跟分号。</p><h3 id="枚举类的基本特性"><a href="#枚举类的基本特性" class="headerlink" title="枚举类的基本特性"></a>枚举类的基本特性</h3><ol><li><strong>类型安全</strong>：枚举常量是类型安全的，编译器会检查类型是否匹配</li><li><strong>不可变</strong>：枚举常量一旦创建就不能修改</li><li><strong>单例</strong>：每个枚举常量都是唯一的实例</li><li><strong>可序列化</strong>：枚举类默认实现了<code>Serializable</code>接口</li><li><strong>支持switch语句</strong>：枚举类可以直接用于switch语句中</li></ol><h3 id="枚举类的基本语法"><a href="#枚举类的基本语法" class="headerlink" title="枚举类的基本语法"></a>枚举类的基本语法</h3><h4 id="简单枚举类"><a href="#简单枚举类" class="headerlink" title="简单枚举类"></a>简单枚举类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个简单的枚举类</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Season</span> &#123;</span><br><span class="line">    SPRING,</span><br><span class="line">    SUMMER,</span><br><span class="line">    AUTUMN,</span><br><span class="line">    WINTER</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用枚举类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnumDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取枚举常量</span></span><br><span class="line">        <span class="type">Season</span> <span class="variable">season</span> <span class="operator">=</span> Season.SPRING;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 打印枚举常量</span></span><br><span class="line">        System.out.println(season); <span class="comment">// 输出：SPRING</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用switch语句</span></span><br><span class="line">        <span class="keyword">switch</span> (season) &#123;</span><br><span class="line">            <span class="keyword">case</span> SPRING:</span><br><span class="line">                System.out.println(<span class="string">&quot;春暖花开&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> SUMMER:</span><br><span class="line">                System.out.println(<span class="string">&quot;夏日炎炎&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> AUTUMN:</span><br><span class="line">                System.out.println(<span class="string">&quot;秋高气爽&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> WINTER:</span><br><span class="line">                System.out.println(<span class="string">&quot;冬日严寒&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="带属性和方法的枚举类"><a href="#带属性和方法的枚举类" class="headerlink" title="带属性和方法的枚举类"></a>带属性和方法的枚举类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个带属性和方法的枚举类</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">    <span class="comment">// 枚举常量，带构造参数</span></span><br><span class="line">    RED(<span class="string">&quot;红色&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    GREEN(<span class="string">&quot;绿色&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    BLUE(<span class="string">&quot;蓝色&quot;</span>, <span class="number">3</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 成员变量</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造方法（必须是private）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Color</span><span class="params">(String name, <span class="type">int</span> code)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 成员方法</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 静态方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Color <span class="title function_">getByCode</span><span class="params">(<span class="type">int</span> code)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Color color : Color.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (color.code == code) &#123;</span><br><span class="line">                <span class="keyword">return</span> color;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用带属性和方法的枚举类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnumDemo2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取枚举常量</span></span><br><span class="line">        <span class="type">Color</span> <span class="variable">color</span> <span class="operator">=</span> Color.RED;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 访问枚举常量的属性和方法</span></span><br><span class="line">        System.out.println(color.getName()); <span class="comment">// 输出：红色</span></span><br><span class="line">        System.out.println(color.getCode()); <span class="comment">// 输出：1</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用静态方法</span></span><br><span class="line">        <span class="type">Color</span> <span class="variable">green</span> <span class="operator">=</span> Color.getByCode(<span class="number">2</span>);</span><br><span class="line">        System.out.println(green); <span class="comment">// 输出：GREEN</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="实现接口的枚举类"><a href="#实现接口的枚举类" class="headerlink" title="实现接口的枚举类"></a>实现接口的枚举类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Operation</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">apply</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现接口的枚举类</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Calculator</span> <span class="keyword">implements</span> <span class="title class_">Operation</span> &#123;</span><br><span class="line">    <span class="comment">// 枚举常量，实现接口方法</span></span><br><span class="line">    ADD &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">apply</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> a + b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    SUBTRACT &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">apply</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> a - b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    MULTIPLY &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">apply</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> a * b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    DIVIDE &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">apply</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (b == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ArithmeticException</span>(<span class="string">&quot;除数不能为0&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> a / b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用实现接口的枚举类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnumDemo3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用枚举常量的方法</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> Calculator.ADD.apply(<span class="number">10</span>, <span class="number">5</span>);</span><br><span class="line">        System.out.println(result); <span class="comment">// 输出：15</span></span><br><span class="line">        </span><br><span class="line">        result = Calculator.SUBTRACT.apply(<span class="number">10</span>, <span class="number">5</span>);</span><br><span class="line">        System.out.println(result); <span class="comment">// 输出：5</span></span><br><span class="line">        </span><br><span class="line">        result = Calculator.MULTIPLY.apply(<span class="number">10</span>, <span class="number">5</span>);</span><br><span class="line">        System.out.println(result); <span class="comment">// 输出：50</span></span><br><span class="line">        </span><br><span class="line">        result = Calculator.DIVIDE.apply(<span class="number">10</span>, <span class="number">5</span>);</span><br><span class="line">        System.out.println(result); <span class="comment">// 输出：2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><p>枚举类在实际开发中有着广泛的应用场景，以下是一些常见的应用环节：</p><h3 id="1-状态管理"><a href="#1-状态管理" class="headerlink" title="1. 状态管理"></a>1. 状态管理</h3><p>在业务系统中，常常需要管理各种状态，如订单状态、用户状态等。使用枚举类可以清晰地表示这些状态，并且提供类型安全的状态检查。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订单状态枚举</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">OrderStatus</span> &#123;</span><br><span class="line">    PENDING(<span class="string">&quot;待处理&quot;</span>),</span><br><span class="line">    PROCESSING(<span class="string">&quot;处理中&quot;</span>),</span><br><span class="line">    COMPLETED(<span class="string">&quot;已完成&quot;</span>),</span><br><span class="line">    CANCELLED(<span class="string">&quot;已取消&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    </span><br><span class="line">    OrderStatus(String description) &#123;</span><br><span class="line">        <span class="built_in">this</span>.description = description;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> description;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用订单状态枚举</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="type">OrderStatus</span> <span class="variable">status</span> <span class="operator">=</span> order.getStatus();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span> (status) &#123;</span><br><span class="line">            <span class="keyword">case</span> PENDING:</span><br><span class="line">                System.out.println(<span class="string">&quot;处理待处理订单&quot;</span>);</span><br><span class="line">                <span class="comment">// 处理逻辑</span></span><br><span class="line">                order.setStatus(OrderStatus.PROCESSING);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PROCESSING:</span><br><span class="line">                System.out.println(<span class="string">&quot;订单正在处理中&quot;</span>);</span><br><span class="line">                <span class="comment">// 处理逻辑</span></span><br><span class="line">                order.setStatus(OrderStatus.COMPLETED);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> COMPLETED:</span><br><span class="line">                System.out.println(<span class="string">&quot;订单已完成&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CANCELLED:</span><br><span class="line">                System.out.println(<span class="string">&quot;订单已取消&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-类型安全的常量定义"><a href="#2-类型安全的常量定义" class="headerlink" title="2. 类型安全的常量定义"></a>2. 类型安全的常量定义</h3><p>在Java中，使用<code>static final</code>定义常量是一种常见的做法，但这种方式缺乏类型安全性。使用枚举类可以提供类型安全的常量定义。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 传统的常量定义方式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Constants</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MONDAY</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">TUESDAY</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">WEDNESDAY</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">THURSDAY</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">FRIDAY</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SATURDAY</span> <span class="operator">=</span> <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SUNDAY</span> <span class="operator">=</span> <span class="number">7</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用枚举类定义常量</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Day</span> &#123;</span><br><span class="line">    MONDAY(<span class="number">1</span>),</span><br><span class="line">    TUESDAY(<span class="number">2</span>),</span><br><span class="line">    WEDNESDAY(<span class="number">3</span>),</span><br><span class="line">    THURSDAY(<span class="number">4</span>),</span><br><span class="line">    FRIDAY(<span class="number">5</span>),</span><br><span class="line">    SATURDAY(<span class="number">6</span>),</span><br><span class="line">    SUNDAY(<span class="number">7</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> value;</span><br><span class="line">    </span><br><span class="line">    Day(<span class="type">int</span> value) &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用枚举常量</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DayDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 类型安全的使用方式</span></span><br><span class="line">        <span class="type">Day</span> <span class="variable">day</span> <span class="operator">=</span> Day.MONDAY;</span><br><span class="line">        System.out.println(day.getValue()); <span class="comment">// 输出：1</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 编译错误，类型不匹配</span></span><br><span class="line">        <span class="comment">// Day day2 = 1;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-配置项管理"><a href="#3-配置项管理" class="headerlink" title="3. 配置项管理"></a>3. 配置项管理</h3><p>应用程序中常常需要管理各种配置项，如数据库类型、日志级别等。使用枚举类可以集中管理这些配置项，并且提供类型安全的访问方式。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据库类型枚举</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">DatabaseType</span> &#123;</span><br><span class="line">    MYSQL(<span class="string">&quot;mysql&quot;</span>, <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>),</span><br><span class="line">    POSTGRESQL(<span class="string">&quot;postgresql&quot;</span>, <span class="string">&quot;org.postgresql.Driver&quot;</span>),</span><br><span class="line">    ORACLE(<span class="string">&quot;oracle&quot;</span>, <span class="string">&quot;oracle.jdbc.driver.OracleDriver&quot;</span>),</span><br><span class="line">    SQLSERVER(<span class="string">&quot;sqlserver&quot;</span>, <span class="string">&quot;com.microsoft.sqlserver.jdbc.SQLServerDriver&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String driverClass;</span><br><span class="line">    </span><br><span class="line">    DatabaseType(String type, String driverClass) &#123;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">        <span class="built_in">this</span>.driverClass = driverClass;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDriverClass</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> driverClass;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 日志级别枚举</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">LogLevel</span> &#123;</span><br><span class="line">    DEBUG(<span class="number">1</span>, <span class="string">&quot;调试&quot;</span>),</span><br><span class="line">    INFO(<span class="number">2</span>, <span class="string">&quot;信息&quot;</span>),</span><br><span class="line">    WARN(<span class="number">3</span>, <span class="string">&quot;警告&quot;</span>),</span><br><span class="line">    ERROR(<span class="number">4</span>, <span class="string">&quot;错误&quot;</span>),</span><br><span class="line">    FATAL(<span class="number">5</span>, <span class="string">&quot;致命&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> level;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    </span><br><span class="line">    LogLevel(<span class="type">int</span> level, String description) &#123;</span><br><span class="line">        <span class="built_in">this</span>.level = level;</span><br><span class="line">        <span class="built_in">this</span>.description = description;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getLevel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> level;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> description;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-错误码管理"><a href="#4-错误码管理" class="headerlink" title="4. 错误码管理"></a>4. 错误码管理</h3><p>在系统开发中，错误码的管理是一个重要的环节。使用枚举类可以集中管理错误码，并且提供错误信息的描述。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误码枚举</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">ErrorCode</span> &#123;</span><br><span class="line">    SUCCESS(<span class="number">0</span>, <span class="string">&quot;操作成功&quot;</span>),</span><br><span class="line">    PARAM_ERROR(<span class="number">1001</span>, <span class="string">&quot;参数错误&quot;</span>),</span><br><span class="line">    USER_NOT_FOUND(<span class="number">1002</span>, <span class="string">&quot;用户不存在&quot;</span>),</span><br><span class="line">    PASSWORD_ERROR(<span class="number">1003</span>, <span class="string">&quot;密码错误&quot;</span>),</span><br><span class="line">    SYSTEM_ERROR(<span class="number">9999</span>, <span class="string">&quot;系统错误&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    </span><br><span class="line">    ErrorCode(<span class="type">int</span> code, String message) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据错误码获取错误信息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ErrorCode <span class="title function_">getByCode</span><span class="params">(<span class="type">int</span> code)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (ErrorCode errorCode : ErrorCode.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (errorCode.code == code) &#123;</span><br><span class="line">                <span class="keyword">return</span> errorCode;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> SYSTEM_ERROR;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用错误码枚举</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ErrorCodeDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 模拟操作结果</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">resultCode</span> <span class="operator">=</span> <span class="number">1002</span>;</span><br><span class="line">        <span class="type">ErrorCode</span> <span class="variable">errorCode</span> <span class="operator">=</span> ErrorCode.getByCode(resultCode);</span><br><span class="line">        System.out.println(<span class="string">&quot;错误码：&quot;</span> + errorCode.getCode()); <span class="comment">// 输出：错误码：1002</span></span><br><span class="line">        System.out.println(<span class="string">&quot;错误信息：&quot;</span> + errorCode.getMessage()); <span class="comment">// 输出：错误信息：用户不存在</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-设计模式实现"><a href="#5-设计模式实现" class="headerlink" title="5. 设计模式实现"></a>5. 设计模式实现</h3><p>枚举类可以用于实现多种设计模式，如策略模式、单例模式、命令模式等。</p><h4 id="5-1-策略模式"><a href="#5-1-策略模式" class="headerlink" title="5.1 策略模式"></a>5.1 策略模式</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 排序策略接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">SortStrategy</span> &#123;</span><br><span class="line">    &lt;T <span class="keyword">extends</span> <span class="title class_">Comparable</span>&lt;T&gt;&gt; <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(List&lt;T&gt; list)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用枚举类实现策略模式</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">SortAlgorithm</span> <span class="keyword">implements</span> <span class="title class_">SortStrategy</span> &#123;</span><br><span class="line">    <span class="comment">// 冒泡排序</span></span><br><span class="line">    BUBBLE_SORT &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> &lt;T <span class="keyword">extends</span> <span class="title class_">Comparable</span>&lt;T&gt;&gt; <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(List&lt;T&gt; list)</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> list.size();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n - <span class="number">1</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n - i - <span class="number">1</span>; j++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (list.get(j).compareTo(list.get(j + <span class="number">1</span>)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        Collections.swap(list, j, j + <span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 选择排序</span></span><br><span class="line">    SELECTION_SORT &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> &lt;T <span class="keyword">extends</span> <span class="title class_">Comparable</span>&lt;T&gt;&gt; <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(List&lt;T&gt; list)</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> list.size();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n - <span class="number">1</span>; i++) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">minIndex</span> <span class="operator">=</span> i;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i + <span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (list.get(j).compareTo(list.get(minIndex)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                        minIndex = j;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                Collections.swap(list, i, minIndex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 插入排序</span></span><br><span class="line">    INSERTION_SORT &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> &lt;T <span class="keyword">extends</span> <span class="title class_">Comparable</span>&lt;T&gt;&gt; <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(List&lt;T&gt; list)</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> list.size();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">                <span class="type">T</span> <span class="variable">key</span> <span class="operator">=</span> list.get(i);</span><br><span class="line">                <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i - <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">while</span> (j &gt;= <span class="number">0</span> &amp;&amp; list.get(j).compareTo(key) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    list.set(j + <span class="number">1</span>, list.get(j));</span><br><span class="line">                    j--;</span><br><span class="line">                &#125;</span><br><span class="line">                list.set(j + <span class="number">1</span>, key);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用排序策略</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SortDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">5</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用冒泡排序</span></span><br><span class="line">        SortAlgorithm.BUBBLE_SORT.sort(numbers);</span><br><span class="line">        System.out.println(<span class="string">&quot;冒泡排序结果：&quot;</span> + numbers);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 重置列表</span></span><br><span class="line">        numbers = Arrays.asList(<span class="number">5</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用选择排序</span></span><br><span class="line">        SortAlgorithm.SELECTION_SORT.sort(numbers);</span><br><span class="line">        System.out.println(<span class="string">&quot;选择排序结果：&quot;</span> + numbers);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 重置列表</span></span><br><span class="line">        numbers = Arrays.asList(<span class="number">5</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用插入排序</span></span><br><span class="line">        SortAlgorithm.INSERTION_SORT.sort(numbers);</span><br><span class="line">        System.out.println(<span class="string">&quot;插入排序结果：&quot;</span> + numbers);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-2-单例模式"><a href="#5-2-单例模式" class="headerlink" title="5.2 单例模式"></a>5.2 单例模式</h4><p>使用枚举类实现单例模式是一种简洁、线程安全的方式，并且可以防止反射和序列化攻击。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用枚举类实现单例模式</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String data;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setData</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Singleton is doing something: &quot;</span> + data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用单例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取单例实例</span></span><br><span class="line">        <span class="type">Singleton</span> <span class="variable">singleton</span> <span class="operator">=</span> Singleton.INSTANCE;</span><br><span class="line">        singleton.setData(<span class="string">&quot;Hello, Singleton!&quot;</span>);</span><br><span class="line">        singleton.doSomething(); <span class="comment">// 输出：Singleton is doing something: Hello, Singleton!</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证是否是同一个实例</span></span><br><span class="line">        <span class="type">Singleton</span> <span class="variable">anotherSingleton</span> <span class="operator">=</span> Singleton.INSTANCE;</span><br><span class="line">        System.out.println(singleton == anotherSingleton); <span class="comment">// 输出：true</span></span><br><span class="line">        System.out.println(anotherSingleton.getData()); <span class="comment">// 输出：Hello, Singleton!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-权限管理"><a href="#6-权限管理" class="headerlink" title="6. 权限管理"></a>6. 权限管理</h3><p>在系统中，权限管理是一个重要的功能。使用枚举类可以清晰地定义和管理权限。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 权限枚举</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Permission</span> &#123;</span><br><span class="line">    READ(<span class="string">&quot;读权限&quot;</span>),</span><br><span class="line">    WRITE(<span class="string">&quot;写权限&quot;</span>),</span><br><span class="line">    EXECUTE(<span class="string">&quot;执行权限&quot;</span>),</span><br><span class="line">    DELETE(<span class="string">&quot;删除权限&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    </span><br><span class="line">    Permission(String description) &#123;</span><br><span class="line">        <span class="built_in">this</span>.description = description;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> description;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户权限管理</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserPermission</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;Permission&gt; permissions;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserPermission</span><span class="params">()</span> &#123;</span><br><span class="line">        permissions = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPermission</span><span class="params">(Permission permission)</span> &#123;</span><br><span class="line">        permissions.add(permission);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removePermission</span><span class="params">(Permission permission)</span> &#123;</span><br><span class="line">        permissions.remove(permission);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasPermission</span><span class="params">(Permission permission)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> permissions.contains(permission);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Set&lt;Permission&gt; <span class="title function_">getPermissions</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.unmodifiableSet(permissions);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用权限管理</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PermissionDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserPermission</span> <span class="variable">userPermission</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserPermission</span>();</span><br><span class="line">        userPermission.addPermission(Permission.READ);</span><br><span class="line">        userPermission.addPermission(Permission.WRITE);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;用户是否有读权限：&quot;</span> + userPermission.hasPermission(Permission.READ)); <span class="comment">// 输出：true</span></span><br><span class="line">        System.out.println(<span class="string">&quot;用户是否有执行权限：&quot;</span> + userPermission.hasPermission(Permission.EXECUTE)); <span class="comment">// 输出：false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-业务流程状态"><a href="#7-业务流程状态" class="headerlink" title="7. 业务流程状态"></a>7. 业务流程状态</h3><p>在业务系统中，业务流程的状态管理是一个常见的需求。使用枚举类可以清晰地定义和管理业务流程的各个状态。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 请假流程状态枚举</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">LeaveStatus</span> &#123;</span><br><span class="line">    APPLYING(<span class="string">&quot;申请中&quot;</span>),</span><br><span class="line">    APPROVED(<span class="string">&quot;已批准&quot;</span>),</span><br><span class="line">    REJECTED(<span class="string">&quot;已拒绝&quot;</span>),</span><br><span class="line">    CANCELLED(<span class="string">&quot;已取消&quot;</span>),</span><br><span class="line">    COMPLETED(<span class="string">&quot;已完成&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    </span><br><span class="line">    LeaveStatus(String description) &#123;</span><br><span class="line">        <span class="built_in">this</span>.description = description;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> description;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请假流程服务</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeaveService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processLeave</span><span class="params">(LeaveApplication application, LeaveStatus status)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (status) &#123;</span><br><span class="line">            <span class="keyword">case</span> APPLYING:</span><br><span class="line">                System.out.println(<span class="string">&quot;处理请假申请&quot;</span>);</span><br><span class="line">                <span class="comment">// 处理逻辑</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> APPROVED:</span><br><span class="line">                System.out.println(<span class="string">&quot;批准请假申请&quot;</span>);</span><br><span class="line">                <span class="comment">// 处理逻辑</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> REJECTED:</span><br><span class="line">                System.out.println(<span class="string">&quot;拒绝请假申请&quot;</span>);</span><br><span class="line">                <span class="comment">// 处理逻辑</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CANCELLED:</span><br><span class="line">                System.out.println(<span class="string">&quot;取消请假申请&quot;</span>);</span><br><span class="line">                <span class="comment">// 处理逻辑</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> COMPLETED:</span><br><span class="line">                System.out.println(<span class="string">&quot;完成请假流程&quot;</span>);</span><br><span class="line">                <span class="comment">// 处理逻辑</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        application.setStatus(status);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="解决的问题"><a href="#解决的问题" class="headerlink" title="解决的问题"></a>解决的问题</h2><p>枚举类的出现解决了Java开发中传统常量定义方式的诸多问题，以下是枚举类解决的主要问题：</p><h3 id="1-类型安全问题"><a href="#1-类型安全问题" class="headerlink" title="1. 类型安全问题"></a>1. 类型安全问题</h3><p>传统的常量定义方式使用<code>static final</code>关键字，这种方式缺乏类型安全性。例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Constants</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MONDAY</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">TUESDAY</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">WEDNESDAY</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型不安全的使用</span></span><br><span class="line"><span class="type">int</span> <span class="variable">day</span> <span class="operator">=</span> <span class="number">4</span>; <span class="comment">// 可以是任何整数值，不一定是预定义的常量</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">processDay</span><span class="params">(<span class="type">int</span> day)</span> &#123; ... &#125; <span class="comment">// 可以传入任何整数值</span></span><br></pre></td></tr></table></figure><p>使用枚举类可以解决类型安全问题：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Day</span> &#123;</span><br><span class="line">    MONDAY, TUESDAY, WEDNESDAY</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型安全的使用</span></span><br><span class="line"><span class="type">Day</span> <span class="variable">day</span> <span class="operator">=</span> Day.MONDAY; <span class="comment">// 只能是枚举常量</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">processDay</span><span class="params">(Day day)</span> &#123; ... &#125; <span class="comment">// 只能传入枚举常量</span></span><br></pre></td></tr></table></figure><h3 id="2-常量值重复问题"><a href="#2-常量值重复问题" class="headerlink" title="2. 常量值重复问题"></a>2. 常量值重复问题</h3><p>传统的常量定义方式可能会导致不同常量组之间的值冲突：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Constants</span> &#123;</span><br><span class="line">    <span class="comment">// 星期常量</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MONDAY</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">TUESDAY</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 月份常量</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">JANUARY</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">// 与MONDAY的值冲突</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">FEBRUARY</span> <span class="operator">=</span> <span class="number">2</span>; <span class="comment">// 与TUESDAY的值冲突</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用枚举类可以避免常量值重复问题，因为枚举常量是类型安全的，不同枚举类之间的常量不会冲突：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Day</span> &#123;</span><br><span class="line">    MONDAY, TUESDAY, WEDNESDAY</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Month</span> &#123;</span><br><span class="line">    JANUARY, FEBRUARY, MARCH <span class="comment">// 与Day中的常量不会冲突</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-代码可读性问题"><a href="#3-代码可读性问题" class="headerlink" title="3. 代码可读性问题"></a>3. 代码可读性问题</h3><p>传统的常量定义方式在使用时缺乏可读性，特别是在switch语句中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">day</span> <span class="operator">=</span> Constants.MONDAY;</span><br><span class="line"><span class="keyword">switch</span> (day) &#123;</span><br><span class="line">    <span class="keyword">case</span> Constants.MONDAY:</span><br><span class="line">        System.out.println(<span class="string">&quot;星期一&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Constants.TUESDAY:</span><br><span class="line">        System.out.println(<span class="string">&quot;星期二&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用枚举类可以提高代码可读性：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Day</span> <span class="variable">day</span> <span class="operator">=</span> Day.MONDAY;</span><br><span class="line"><span class="keyword">switch</span> (day) &#123;</span><br><span class="line">    <span class="keyword">case</span> MONDAY:</span><br><span class="line">        System.out.println(<span class="string">&quot;星期一&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> TUESDAY:</span><br><span class="line">        System.out.println(<span class="string">&quot;星期二&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-单例模式实现问题"><a href="#4-单例模式实现问题" class="headerlink" title="4. 单例模式实现问题"></a>4. 单例模式实现问题</h3><p>传统的单例模式实现需要考虑线程安全、序列化等问题：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 防止序列化破坏单例</span></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getInstance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用枚举类可以简洁地实现单例模式，并且自动解决线程安全和序列化问题：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 单例方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-序列化问题"><a href="#5-序列化问题" class="headerlink" title="5. 序列化问题"></a>5. 序列化问题</h3><p>传统的常量类在序列化和反序列化时可能会出现问题，而枚举类默认实现了<code>Serializable</code>接口，并且在序列化和反序列化时能够保持常量的唯一性：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 枚举类的序列化是安全的</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">    RED, GREEN, BLUE</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 序列化枚举常量</span></span><br><span class="line"><span class="type">Color</span> <span class="variable">color</span> <span class="operator">=</span> Color.RED;</span><br><span class="line"><span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;color.ser&quot;</span>));</span><br><span class="line">oos.writeObject(color);</span><br><span class="line">oos.close();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 反序列化枚举常量</span></span><br><span class="line"><span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;color.ser&quot;</span>));</span><br><span class="line"><span class="type">Color</span> <span class="variable">deserializedColor</span> <span class="operator">=</span> (Color) ois.readObject();</span><br><span class="line">ois.close();</span><br><span class="line"></span><br><span class="line">System.out.println(color == deserializedColor); <span class="comment">// 输出：true</span></span><br></pre></td></tr></table></figure><h2 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h2><p>枚举类相比传统的常量定义方式和普通类，具有以下优势：</p><table><thead><tr><th>优势</th><th>描述</th></tr></thead><tbody><tr><td><strong>类型安全</strong></td><td>枚举常量是类型安全的，编译器会检查类型是否匹配，避免了类型错误</td></tr><tr><td><strong>不可变</strong></td><td>枚举常量一旦创建就不能修改，保证了常量的稳定性</td></tr><tr><td><strong>单例</strong></td><td>每个枚举常量都是唯一的实例，避免了重复创建对象的开销</td></tr><tr><td><strong>可序列化</strong></td><td>枚举类默认实现了<code>Serializable</code>接口，并且在序列化和反序列化时能够保持常量的唯一性</td></tr><tr><td><strong>支持switch语句</strong></td><td>枚举类可以直接用于switch语句中，提高了代码的可读性</td></tr><tr><td><strong>支持方法和属性</strong></td><td>枚举类可以定义方法和属性，提供了更多的灵活性</td></tr><tr><td><strong>实现接口</strong></td><td>枚举类可以实现接口，支持多态</td></tr><tr><td><strong>线程安全</strong></td><td>枚举常量在枚举类加载时被创建，是线程安全的</td></tr><tr><td><strong>防止反射攻击</strong></td><td>枚举类可以防止反射攻击，因为反射不能创建枚举常量的新实例</td></tr><tr><td><strong>简洁明了</strong></td><td>枚举类的语法简洁明了，提高了代码的可读性和可维护性</td></tr></tbody></table><h2 id="与普通类的区别"><a href="#与普通类的区别" class="headerlink" title="与普通类的区别"></a>与普通类的区别</h2><p>枚举类是一种特殊的类，它与普通类有以下区别：</p><table><thead><tr><th>区别</th><th>枚举类</th><th>普通类</th></tr></thead><tbody><tr><td><strong>继承关系</strong></td><td>默认继承自<code>java.lang.Enum</code>类，不能再继承其他类</td><td>可以继承其他类（除了final类）</td></tr><tr><td><strong>构造方法</strong></td><td>构造方法必须是private的，不能是public或protected</td><td>构造方法可以是public、protected或private</td></tr><tr><td><strong>实例创建</strong></td><td>实例（枚举常量）在枚举类加载时被创建，并且是唯一的</td><td>实例可以通过new关键字随时创建</td></tr><tr><td><strong>序列化</strong></td><td>默认实现了<code>Serializable</code>接口，序列化机制特殊，保证反序列化后的实例与原实例相同</td><td>需要显式实现<code>Serializable</code>接口，序列化机制普通</td></tr><tr><td><strong>反射</strong></td><td>不能通过反射创建新的实例</td><td>可以通过反射创建新的实例</td></tr><tr><td><strong>比较方式</strong></td><td>枚举常量可以使用&#x3D;&#x3D;运算符进行比较，因为它们是单例的</td><td>实例应该使用equals方法进行比较</td></tr><tr><td><strong>switch语句</strong></td><td>可以直接用于switch语句中</td><td>不能直接用于switch语句中，需要使用其对应的整型值</td></tr><tr><td><strong>常量定义</strong></td><td>专门用于定义常量集合</td><td>可以定义常量，也可以定义变量和方法</td></tr></tbody></table><h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h2><p>Java枚举类的实现原理涉及到编译器的处理、字节码结构、类加载过程等多个方面。下面我们将深入分析Java枚举类的实现原理。</p><h3 id="1-枚举类的编译过程"><a href="#1-枚举类的编译过程" class="headerlink" title="1. 枚举类的编译过程"></a>1. 枚举类的编译过程</h3><p>当我们定义一个枚举类时，编译器会对其进行特殊处理，生成对应的字节码。例如，我们定义一个简单的枚举类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Season</span> &#123;</span><br><span class="line">    SPRING,</span><br><span class="line">    SUMMER,</span><br><span class="line">    AUTUMN,</span><br><span class="line">    WINTER</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译器会将其编译为一个继承自<code>java.lang.Enum</code>的类，并且为每个枚举常量创建一个静态常量实例。</p><h3 id="2-枚举类的字节码结构"><a href="#2-枚举类的字节码结构" class="headerlink" title="2. 枚举类的字节码结构"></a>2. 枚举类的字节码结构</h3><p>我们可以使用<code>javap</code>命令查看枚举类的字节码结构。例如，对于上面的<code>Season</code>枚举类，执行<code>javap Season</code>命令会得到以下输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Compiled from &quot;Season.java&quot;</span><br><span class="line">enum Season extends java.lang.Enum&lt;Season&gt; &#123;</span><br><span class="line">  public static final Season SPRING;</span><br><span class="line">  public static final Season SUMMER;</span><br><span class="line">  public static final Season AUTUMN;</span><br><span class="line">  public static final Season WINTER;</span><br><span class="line">  public static Season[] values();</span><br><span class="line">  public static Season valueOf(java.lang.String);</span><br><span class="line">  static &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从输出中可以看到：</p><ol><li><code>Season</code>枚举类继承自<code>java.lang.Enum&lt;Season&gt;</code></li><li>每个枚举常量都是<code>Season</code>类型的静态常量</li><li>编译器生成了<code>values()</code>和<code>valueOf()</code>方法</li><li>有一个静态初始化块</li></ol><h3 id="3-枚举常量的创建时机"><a href="#3-枚举常量的创建时机" class="headerlink" title="3. 枚举常量的创建时机"></a>3. 枚举常量的创建时机</h3><p>枚举常量是在枚举类加载时通过静态初始化块创建的。我们可以通过反编译字节码来查看静态初始化块的内容。使用<code>javap -c Season</code>命令可以看到详细的字节码指令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">Compiled from &quot;Season.java&quot;</span><br><span class="line">enum Season extends java.lang.Enum&lt;Season&gt; &#123;</span><br><span class="line">  public static final Season SPRING;</span><br><span class="line">  public static final Season SUMMER;</span><br><span class="line">  public static final Season AUTUMN;</span><br><span class="line">  public static final Season WINTER;</span><br><span class="line">  </span><br><span class="line">  public static Season[] values();</span><br><span class="line">    Code:</span><br><span class="line">       0: getstatic     #1                  // Field $VALUES:[LSeason;</span><br><span class="line">       3: invokevirtual #2                  // Method &quot;[LSeason;&quot;.clone:()Ljava/lang/Object;</span><br><span class="line">       6: checkcast     #3                  // class &quot;[LSeason;&quot;</span><br><span class="line">       9: areturn</span><br><span class="line">  </span><br><span class="line">  public static Season valueOf(java.lang.String);</span><br><span class="line">    Code:</span><br><span class="line">       0: ldc           #4                  // class Season</span><br><span class="line">       2: aload_0</span><br><span class="line">       3: invokestatic  #5                  // Method java/lang/Enum.valueOf:(Ljava/lang/Class;Ljava/lang/String;)Ljava/lang/Enum;</span><br><span class="line">       6: checkcast     #4                  // class Season</span><br><span class="line">       9: areturn</span><br><span class="line">  </span><br><span class="line">  static &#123;&#125;;</span><br><span class="line">    Code:</span><br><span class="line">       0: new           #4                  // class Season</span><br><span class="line">       3: dup</span><br><span class="line">       4: ldc           #7                  // String SPRING</span><br><span class="line">       6: iconst_0</span><br><span class="line">       7: invokespecial #8                  // Method &quot;&lt;init&gt;&quot;:(Ljava/lang/String;I)V</span><br><span class="line">      10: putstatic     #9                  // Field SPRING:LSeason;</span><br><span class="line">      13: new           #4                  // class Season</span><br><span class="line">      16: dup</span><br><span class="line">      17: ldc           #10                 // String SUMMER</span><br><span class="line">      19: iconst_1</span><br><span class="line">      20: invokespecial #8                  // Method &quot;&lt;init&gt;&quot;:(Ljava/lang/String;I)V</span><br><span class="line">      23: putstatic     #11                 // Field SUMMER:LSeason;</span><br><span class="line">      26: new           #4                  // class Season</span><br><span class="line">      29: dup</span><br><span class="line">      30: ldc           #12                 // String AUTUMN</span><br><span class="line">      32: iconst_2</span><br><span class="line">      33: invokespecial #8                  // Method &quot;&lt;init&gt;&quot;:(Ljava/lang/String;I)V</span><br><span class="line">      36: putstatic     #13                 // Field AUTUMN:LSeason;</span><br><span class="line">      39: new           #4                  // class Season</span><br><span class="line">      42: dup</span><br><span class="line">      43: ldc           #14                 // String WINTER</span><br><span class="line">      45: iconst_3</span><br><span class="line">      46: invokespecial #8                  // Method &quot;&lt;init&gt;&quot;:(Ljava/lang/String;I)V</span><br><span class="line">      49: putstatic     #15                 // Field WINTER:LSeason;</span><br><span class="line">      52: iconst_4</span><br><span class="line">      53: anewarray     #4                  // class Season</span><br><span class="line">      56: dup</span><br><span class="line">      57: iconst_0</span><br><span class="line">      58: getstatic     #9                  // Field SPRING:LSeason;</span><br><span class="line">      61: aastore</span><br><span class="line">      62: dup</span><br><span class="line">      63: iconst_1</span><br><span class="line">      64: getstatic     #11                 // Field SUMMER:LSeason;</span><br><span class="line">      67: aastore</span><br><span class="line">      68: dup</span><br><span class="line">      69: iconst_2</span><br><span class="line">      70: getstatic     #13                 // Field AUTUMN:LSeason;</span><br><span class="line">      73: aastore</span><br><span class="line">      74: dup</span><br><span class="line">      75: iconst_3</span><br><span class="line">      76: getstatic     #15                 // Field WINTER:LSeason;</span><br><span class="line">      79: aastore</span><br><span class="line">      80: putstatic     #1                  // Field $VALUES:[LSeason;</span><br><span class="line">      83: return</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从字节码中可以看到：</p><ol><li>静态初始化块中创建了每个枚举常量实例</li><li>每个枚举常量实例调用了父类<code>Enum</code>的构造方法，传入常量名和 ordinal 值</li><li>创建了一个静态数组<code>$VALUES</code>，存储所有枚举常量</li><li><code>values()</code>方法返回<code>$VALUES</code>数组的克隆</li><li><code>valueOf()</code>方法调用了父类<code>Enum</code>的<code>valueOf</code>方法</li></ol><h3 id="4-枚举类的特殊方法"><a href="#4-枚举类的特殊方法" class="headerlink" title="4. 枚举类的特殊方法"></a>4. 枚举类的特殊方法</h3><h4 id="4-1-values-方法"><a href="#4-1-values-方法" class="headerlink" title="4.1 values()方法"></a>4.1 values()方法</h4><p><code>values()</code>方法返回枚举类的所有常量数组。这个方法是编译器自动生成的，它返回<code>$VALUES</code>数组的克隆，以防止外部修改枚举常量数组。</p><h4 id="4-2-valueOf-方法"><a href="#4-2-valueOf-方法" class="headerlink" title="4.2 valueOf()方法"></a>4.2 valueOf()方法</h4><p><code>valueOf()</code>方法根据枚举常量的名称返回对应的枚举常量。这个方法也是编译器自动生成的，它调用了父类<code>Enum</code>的<code>valueOf</code>方法。</p><h3 id="5-枚举类的序列化和反序列化"><a href="#5-枚举类的序列化和反序列化" class="headerlink" title="5. 枚举类的序列化和反序列化"></a>5. 枚举类的序列化和反序列化</h3><p>枚举类默认实现了<code>Serializable</code>接口，但是其序列化机制与普通类不同。在序列化时，枚举常量的名称会被序列化，而不是整个枚举实例。在反序列化时，会根据名称查找对应的枚举常量。</p><p>这种特殊的序列化机制保证了反序列化后的枚举实例与原实例相同，避免了序列化对单例模式的破坏。</p><h3 id="6-枚举类与反射"><a href="#6-枚举类与反射" class="headerlink" title="6. 枚举类与反射"></a>6. 枚举类与反射</h3><p>枚举类不能通过反射创建新的实例。<code>java.lang.reflect.Constructor</code>类的<code>newInstance</code>方法会检查如果要创建的实例是枚举类型，则抛出<code>IllegalArgumentException</code>异常。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 尝试通过反射创建枚举实例会抛出异常</span></span><br><span class="line">Constructor&lt;Season&gt; constructor = Season.class.getDeclaredConstructor(String.class, <span class="type">int</span>.class);</span><br><span class="line">constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="type">Season</span> <span class="variable">season</span> <span class="operator">=</span> constructor.newInstance(<span class="string">&quot;TEST&quot;</span>, <span class="number">4</span>); <span class="comment">// 抛出 IllegalArgumentException</span></span><br></pre></td></tr></table></figure><p>这种机制保证了枚举常量的唯一性，防止了反射攻击。</p><h3 id="7-枚举类的类加载过程"><a href="#7-枚举类的类加载过程" class="headerlink" title="7. 枚举类的类加载过程"></a>7. 枚举类的类加载过程</h3><p>枚举类的加载过程与普通类类似，但是有一些特殊之处：</p><ol><li>枚举类在首次被使用时加载</li><li>枚举常量在类加载时通过静态初始化块创建</li><li>枚举常量的创建是线程安全的，因为静态初始化块在类加载时执行，而类加载过程是线程安全的</li></ol><h3 id="8-枚举类的内存模型"><a href="#8-枚举类的内存模型" class="headerlink" title="8. 枚举类的内存模型"></a>8. 枚举类的内存模型</h3><p>枚举类的内存模型包括：</p><ol><li>枚举类的Class对象</li><li>枚举常量的实例对象</li><li>静态常量字段（指向枚举常量实例）</li><li>静态数组<code>$VALUES</code>（存储所有枚举常量）</li></ol><p>由于枚举常量是单例的，所以它们在内存中只存在一个实例，避免了重复创建对象的开销。</p><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>在实际工程中使用枚举类时，需要注意以下几点：</p><h3 id="1-枚举常量的顺序"><a href="#1-枚举常量的顺序" class="headerlink" title="1. 枚举常量的顺序"></a>1. 枚举常量的顺序</h3><p>枚举常量的顺序很重要，因为<code>ordinal()</code>方法返回的是枚举常量在枚举类中的位置。如果改变了枚举常量的顺序，可能会影响依赖<code>ordinal()</code>方法的代码。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Priority</span> &#123;</span><br><span class="line">    LOW,    <span class="comment">// ordinal = 0</span></span><br><span class="line">    MEDIUM, <span class="comment">// ordinal = 1</span></span><br><span class="line">    HIGH    <span class="comment">// ordinal = 2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 依赖ordinal()方法的代码</span></span><br><span class="line"><span class="type">int</span> <span class="variable">priorityLevel</span> <span class="operator">=</span> Priority.MEDIUM.ordinal(); <span class="comment">// 返回1</span></span><br></pre></td></tr></table></figure><h3 id="2-枚举类的序列化"><a href="#2-枚举类的序列化" class="headerlink" title="2. 枚举类的序列化"></a>2. 枚举类的序列化</h3><p>虽然枚举类默认实现了<code>Serializable</code>接口，但是在序列化枚举类时需要注意：</p><ul><li>枚举类的字段会被序列化，所以枚举类的字段应该是不可变的</li><li>枚举类的序列化机制特殊，只序列化枚举常量的名称</li></ul><h3 id="3-枚举类的性能"><a href="#3-枚举类的性能" class="headerlink" title="3. 枚举类的性能"></a>3. 枚举类的性能</h3><p>枚举类的性能通常很好，但是在以下情况下需要注意：</p><ul><li>枚举类加载时会创建所有枚举常量，所以如果枚举常量很多，可能会影响类加载性能</li><li><code>values()</code>方法返回的是数组的克隆，所以如果频繁调用<code>values()</code>方法，可能会产生大量的临时对象</li></ul><h3 id="4-枚举类的继承"><a href="#4-枚举类的继承" class="headerlink" title="4. 枚举类的继承"></a>4. 枚举类的继承</h3><p>枚举类不能继承其他类，但是可以实现接口。如果需要扩展枚举类的功能，可以通过实现接口的方式。</p><h3 id="5-枚举类的使用场景"><a href="#5-枚举类的使用场景" class="headerlink" title="5. 枚举类的使用场景"></a>5. 枚举类的使用场景</h3><p>枚举类适合用于表示一组固定的常量，如：</p><ul><li>状态码</li><li>错误码</li><li>配置项</li><li>类型定义</li></ul><p>不适合用于表示动态变化的集合。</p><h3 id="6-枚举类的命名规范"><a href="#6-枚举类的命名规范" class="headerlink" title="6. 枚举类的命名规范"></a>6. 枚举类的命名规范</h3><p>枚举类的命名应该使用 PascalCase 命名法，枚举常量的命名应该使用大写字母和下划线。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 正确的命名方式</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">HttpMethod</span> &#123;</span><br><span class="line">    GET,</span><br><span class="line">    POST,</span><br><span class="line">    PUT,</span><br><span class="line">    DELETE</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误的命名方式</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">httpMethod</span> &#123;</span><br><span class="line">    get,</span><br><span class="line">    post,</span><br><span class="line">    put,</span><br><span class="line">    delete</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-枚举类的复杂性"><a href="#7-枚举类的复杂性" class="headerlink" title="7. 枚举类的复杂性"></a>7. 枚举类的复杂性</h3><p>枚举类可以定义方法和属性，但是应该保持枚举类的简洁性，不要在枚举类中定义过于复杂的逻辑。</p><h3 id="8-枚举类与switch语句"><a href="#8-枚举类与switch语句" class="headerlink" title="8. 枚举类与switch语句"></a>8. 枚举类与switch语句</h3><p>在switch语句中使用枚举类时，不需要使用枚举类的名称限定枚举常量，这样可以提高代码的可读性。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 正确的使用方式</span></span><br><span class="line"><span class="type">Day</span> <span class="variable">day</span> <span class="operator">=</span> Day.MONDAY;</span><br><span class="line"><span class="keyword">switch</span> (day) &#123;</span><br><span class="line">    <span class="keyword">case</span> MONDAY: <span class="comment">// 不需要Day.MONDAY</span></span><br><span class="line">        System.out.println(<span class="string">&quot;星期一&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误的使用方式</span></span><br><span class="line"><span class="keyword">switch</span> (day) &#123;</span><br><span class="line">    <span class="keyword">case</span> Day.MONDAY: <span class="comment">// 不需要Day限定</span></span><br><span class="line">        System.out.println(<span class="string">&quot;星期一&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><p>以下是一些枚举类的实际代码示例，展示了枚举类在不同场景中的应用。</p><h3 id="1-状态管理示例"><a href="#1-状态管理示例" class="headerlink" title="1. 状态管理示例"></a>1. 状态管理示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订单状态枚举</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">OrderStatus</span> &#123;</span><br><span class="line">    PENDING(<span class="string">&quot;待处理&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    PROCESSING(<span class="string">&quot;处理中&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    COMPLETED(<span class="string">&quot;已完成&quot;</span>, <span class="number">3</span>),</span><br><span class="line">    CANCELLED(<span class="string">&quot;已取消&quot;</span>, <span class="number">4</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    </span><br><span class="line">    OrderStatus(String description, <span class="type">int</span> code) &#123;</span><br><span class="line">        <span class="built_in">this</span>.description = description;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> description;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据编码获取状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> OrderStatus <span class="title function_">getByCode</span><span class="params">(<span class="type">int</span> code)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (OrderStatus status : values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (status.code == code) &#123;</span><br><span class="line">                <span class="keyword">return</span> status;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid order status code: &quot;</span> + code);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据描述获取状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> OrderStatus <span class="title function_">getByDescription</span><span class="params">(String description)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (OrderStatus status : values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (status.description.equals(description)) &#123;</span><br><span class="line">                <span class="keyword">return</span> status;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid order status description: &quot;</span> + description);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用订单状态枚举</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="type">OrderStatus</span> <span class="variable">status</span> <span class="operator">=</span> order.getStatus();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span> (status) &#123;</span><br><span class="line">            <span class="keyword">case</span> PENDING:</span><br><span class="line">                System.out.println(<span class="string">&quot;处理待处理订单&quot;</span>);</span><br><span class="line">                <span class="comment">// 处理逻辑</span></span><br><span class="line">                order.setStatus(OrderStatus.PROCESSING);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PROCESSING:</span><br><span class="line">                System.out.println(<span class="string">&quot;订单正在处理中&quot;</span>);</span><br><span class="line">                <span class="comment">// 处理逻辑</span></span><br><span class="line">                order.setStatus(OrderStatus.COMPLETED);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> COMPLETED:</span><br><span class="line">                System.out.println(<span class="string">&quot;订单已完成&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CANCELLED:</span><br><span class="line">                System.out.println(<span class="string">&quot;订单已取消&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateOrderStatus</span><span class="params">(Order order, <span class="type">int</span> statusCode)</span> &#123;</span><br><span class="line">        <span class="type">OrderStatus</span> <span class="variable">status</span> <span class="operator">=</span> OrderStatus.getByCode(statusCode);</span><br><span class="line">        order.setStatus(status);</span><br><span class="line">        System.out.println(<span class="string">&quot;订单状态更新为：&quot;</span> + status.getDescription());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-配置项管理示例"><a href="#2-配置项管理示例" class="headerlink" title="2. 配置项管理示例"></a>2. 配置项管理示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据库类型枚举</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">DatabaseType</span> &#123;</span><br><span class="line">    MYSQL(<span class="string">&quot;MySQL&quot;</span>, <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>, <span class="string">&quot;jdbc:mysql://&#123;host&#125;:&#123;port&#125;/&#123;database&#125;&quot;</span>),</span><br><span class="line">    POSTGRESQL(<span class="string">&quot;PostgreSQL&quot;</span>, <span class="string">&quot;org.postgresql.Driver&quot;</span>, <span class="string">&quot;jdbc:postgresql://&#123;host&#125;:&#123;port&#125;/&#123;database&#125;&quot;</span>),</span><br><span class="line">    ORACLE(<span class="string">&quot;Oracle&quot;</span>, <span class="string">&quot;oracle.jdbc.driver.OracleDriver&quot;</span>, <span class="string">&quot;jdbc:oracle:thin:@//&#123;host&#125;:&#123;port&#125;/&#123;service_name&#125;&quot;</span>),</span><br><span class="line">    SQLSERVER(<span class="string">&quot;SQL Server&quot;</span>, <span class="string">&quot;com.microsoft.sqlserver.jdbc.SQLServerDriver&quot;</span>, <span class="string">&quot;jdbc:sqlserver://&#123;host&#125;:&#123;port&#125;;databaseName=&#123;database&#125;&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String driverClass;</span><br><span class="line">    <span class="keyword">private</span> String urlPattern;</span><br><span class="line">    </span><br><span class="line">    DatabaseType(String name, String driverClass, String urlPattern) &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.driverClass = driverClass;</span><br><span class="line">        <span class="built_in">this</span>.urlPattern = urlPattern;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDriverClass</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> driverClass;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUrlPattern</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> urlPattern;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 生成数据库连接URL</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generateUrl</span><span class="params">(String host, <span class="type">int</span> port, String database)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> urlPattern</span><br><span class="line">            .replace(<span class="string">&quot;&#123;host&#125;&quot;</span>, host)</span><br><span class="line">            .replace(<span class="string">&quot;&#123;port&#125;&quot;</span>, String.valueOf(port))</span><br><span class="line">            .replace(<span class="string">&quot;&#123;database&#125;&quot;</span>, database);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用数据库类型枚举</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatabaseConfig</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">(DatabaseType type, String host, <span class="type">int</span> port, String database, String username, String password)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 加载驱动</span></span><br><span class="line">        Class.forName(type.getDriverClass());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 生成连接URL</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> type.generateUrl(host, port, database);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建连接</span></span><br><span class="line">        <span class="keyword">return</span> DriverManager.getConnection(url, username, password);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 获取MySQL连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">mysqlConnection</span> <span class="operator">=</span> getConnection(</span><br><span class="line">            DatabaseType.MYSQL,</span><br><span class="line">            <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">            <span class="number">3306</span>,</span><br><span class="line">            <span class="string">&quot;test&quot;</span>,</span><br><span class="line">            <span class="string">&quot;root&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span></span><br><span class="line">        );</span><br><span class="line">        System.out.println(<span class="string">&quot;MySQL连接成功：&quot;</span> + mysqlConnection);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取PostgreSQL连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">postgresConnection</span> <span class="operator">=</span> getConnection(</span><br><span class="line">            DatabaseType.POSTGRESQL,</span><br><span class="line">            <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">            <span class="number">5432</span>,</span><br><span class="line">            <span class="string">&quot;test&quot;</span>,</span><br><span class="line">            <span class="string">&quot;postgres&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span></span><br><span class="line">        );</span><br><span class="line">        System.out.println(<span class="string">&quot;PostgreSQL连接成功：&quot;</span> + postgresConnection);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-策略模式实现示例"><a href="#3-策略模式实现示例" class="headerlink" title="3. 策略模式实现示例"></a>3. 策略模式实现示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 支付策略接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span>;</span><br><span class="line">    String <span class="title function_">getPaymentType</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 支付方式枚举，实现支付策略接口</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">PaymentMethod</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    ALIPAY &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;使用支付宝支付：&quot;</span> + amount + <span class="string">&quot;元&quot;</span>);</span><br><span class="line">            <span class="comment">// 支付宝支付逻辑</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getPaymentType</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;支付宝&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    WECHAT_PAY &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;使用微信支付：&quot;</span> + amount + <span class="string">&quot;元&quot;</span>);</span><br><span class="line">            <span class="comment">// 微信支付逻辑</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getPaymentType</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;微信支付&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    CREDIT_CARD &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;使用信用卡支付：&quot;</span> + amount + <span class="string">&quot;元&quot;</span>);</span><br><span class="line">            <span class="comment">// 信用卡支付逻辑</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getPaymentType</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;信用卡&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 静态方法：根据支付方式名称获取支付方式</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PaymentMethod <span class="title function_">getByType</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (PaymentMethod method : values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (method.getPaymentType().equals(type)) &#123;</span><br><span class="line">                <span class="keyword">return</span> method;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid payment type: &quot;</span> + type);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用支付方式枚举</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">processPayment</span><span class="params">(<span class="type">double</span> amount, PaymentMethod paymentMethod)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;开始处理支付...&quot;</span>);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> paymentMethod.pay(amount);</span><br><span class="line">        <span class="keyword">if</span> (result) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;支付成功！&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;支付失败！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">PaymentService</span> <span class="variable">paymentService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaymentService</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用支付宝支付</span></span><br><span class="line">        paymentService.processPayment(<span class="number">100.0</span>, PaymentMethod.ALIPAY);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用微信支付</span></span><br><span class="line">        paymentService.processPayment(<span class="number">200.0</span>, PaymentMethod.WECHAT_PAY);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用信用卡支付</span></span><br><span class="line">        paymentService.processPayment(<span class="number">300.0</span>, PaymentMethod.CREDIT_CARD);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 根据支付方式名称获取支付方式</span></span><br><span class="line">        <span class="type">PaymentMethod</span> <span class="variable">method</span> <span class="operator">=</span> PaymentMethod.getByType(<span class="string">&quot;支付宝&quot;</span>);</span><br><span class="line">        paymentService.processPayment(<span class="number">400.0</span>, method);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-错误码管理示例"><a href="#4-错误码管理示例" class="headerlink" title="4. 错误码管理示例"></a>4. 错误码管理示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误码枚举</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">ErrorCode</span> &#123;</span><br><span class="line">    SUCCESS(<span class="number">0</span>, <span class="string">&quot;操作成功&quot;</span>),</span><br><span class="line">    PARAM_ERROR(<span class="number">1001</span>, <span class="string">&quot;参数错误&quot;</span>),</span><br><span class="line">    USER_NOT_FOUND(<span class="number">1002</span>, <span class="string">&quot;用户不存在&quot;</span>),</span><br><span class="line">    PASSWORD_ERROR(<span class="number">1003</span>, <span class="string">&quot;密码错误&quot;</span>),</span><br><span class="line">    SYSTEM_ERROR(<span class="number">9999</span>, <span class="string">&quot;系统错误&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    </span><br><span class="line">    ErrorCode(<span class="type">int</span> code, String message) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据错误码获取错误信息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ErrorCode <span class="title function_">getByCode</span><span class="params">(<span class="type">int</span> code)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (ErrorCode errorCode : values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (errorCode.code == code) &#123;</span><br><span class="line">                <span class="keyword">return</span> errorCode;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> SYSTEM_ERROR;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 生成错误响应</span></span><br><span class="line">    <span class="keyword">public</span> ErrorResponse <span class="title function_">toResponse</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(code, message);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 错误响应类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ErrorResponse</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">        <span class="keyword">private</span> String message;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">ErrorResponse</span><span class="params">(<span class="type">int</span> code, String message)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.code = code;</span><br><span class="line">            <span class="built_in">this</span>.message = message;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> code;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> message;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用错误码枚举</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ErrorCode.ErrorResponse <span class="title function_">login</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (username == <span class="literal">null</span> || password == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ErrorCode.PARAM_ERROR.toResponse();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 模拟用户验证</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="string">&quot;admin&quot;</span>.equals(username)) &#123;</span><br><span class="line">            <span class="keyword">return</span> ErrorCode.USER_NOT_FOUND.toResponse();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="string">&quot;123456&quot;</span>.equals(password)) &#123;</span><br><span class="line">            <span class="keyword">return</span> ErrorCode.PASSWORD_ERROR.toResponse();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ErrorCode.SUCCESS.toResponse();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 测试登录</span></span><br><span class="line">        ErrorCode.<span class="type">ErrorResponse</span> <span class="variable">response1</span> <span class="operator">=</span> userService.login(<span class="literal">null</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;登录结果1：&quot;</span> + response1.getCode() + <span class="string">&quot; - &quot;</span> + response1.getMessage());</span><br><span class="line">        </span><br><span class="line">        ErrorCode.<span class="type">ErrorResponse</span> <span class="variable">response2</span> <span class="operator">=</span> userService.login(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;登录结果2：&quot;</span> + response2.getCode() + <span class="string">&quot; - &quot;</span> + response2.getMessage());</span><br><span class="line">        </span><br><span class="line">        ErrorCode.<span class="type">ErrorResponse</span> <span class="variable">response3</span> <span class="operator">=</span> userService.login(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;password&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;登录结果3：&quot;</span> + response3.getCode() + <span class="string">&quot; - &quot;</span> + response3.getMessage());</span><br><span class="line">        </span><br><span class="line">        ErrorCode.<span class="type">ErrorResponse</span> <span class="variable">response4</span> <span class="operator">=</span> userService.login(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;登录结果4：&quot;</span> + response4.getCode() + <span class="string">&quot; - &quot;</span> + response4.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Java枚举类是一种特殊的类，它继承自<code>java.lang.Enum</code>类，用于表示一组固定的常量。枚举类的出现解决了传统常量定义方式的诸多问题，如类型安全问题、常量值重复问题、代码可读性问题等。</p><p>枚举类具有以下优势：</p><ul><li>类型安全</li><li>不可变</li><li>单例</li><li>可序列化</li><li>支持switch语句</li><li>支持方法和属性</li><li>实现接口</li><li>线程安全</li><li>防止反射攻击</li><li>简洁明了</li></ul><p>枚举类在实际开发中有广泛的应用场景，如状态管理、类型安全的常量定义、配置项管理、错误码管理、设计模式实现等。</p><p>在使用枚举类时，需要注意枚举常量的顺序、序列化、性能、继承、使用场景和命名规范等问题。</p><p>通过深入理解Java枚举类的实现原理，我们可以更好地应用枚举类，充分发挥其优势，提高代码的可读性、可维护性和安全性。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 枚举 </tag>
            
            <tag> 核心技术 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++、Java、Python、C#的对象初始化</title>
      <link href="/2026/02/04/C-%E3%80%81Java%E3%80%81Python%E7%9A%84%E5%AF%B9%E8%B1%A1%E5%88%9D%E5%A7%8B%E5%8C%96/"/>
      <url>/2026/02/04/C-%E3%80%81Java%E3%80%81Python%E7%9A%84%E5%AF%B9%E8%B1%A1%E5%88%9D%E5%A7%8B%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="C-、Java、Python、C-的对象初始化详解"><a href="#C-、Java、Python、C-的对象初始化详解" class="headerlink" title="C++、Java、Python、C# 的对象初始化详解"></a>C++、Java、Python、C# 的对象初始化详解</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>对象初始化是面向对象编程中的基础概念，不同编程语言在对象初始化的语法和机制上有很大差异。本文将详细介绍 C++、Java、Python 和 C# 四种主流编程语言的对象初始化方式，并对比它们之间的区别。</p><h2 id="C-的对象初始化"><a href="#C-的对象初始化" class="headerlink" title="C++ 的对象初始化"></a>C++ 的对象初始化</h2><p>C++ 提供了多种对象初始化方式，每种方式都有其特定的用途和语法。</p><h3 id="1-默认初始化"><a href="#1-默认初始化" class="headerlink" title="1. 默认初始化"></a>1. 默认初始化</h3><p>当创建对象时不提供初始值，会执行默认初始化。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyClass</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认初始化</span></span><br><span class="line">MyClass obj; <span class="comment">// 调用默认构造函数</span></span><br></pre></td></tr></table></figure><h3 id="2-值初始化"><a href="#2-值初始化" class="headerlink" title="2. 值初始化"></a>2. 值初始化</h3><p>使用空括号 <code>()</code> 进行值初始化，会调用默认构造函数。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 值初始化</span></span><br><span class="line"><span class="function">MyClass <span class="title">obj</span><span class="params">()</span></span>; <span class="comment">// 函数声明，不是对象初始化！</span></span><br><span class="line">MyClass obj&#123;&#125;; <span class="comment">// C++11 列表初始化，正确的值初始化</span></span><br></pre></td></tr></table></figure><h3 id="3-直接初始化"><a href="#3-直接初始化" class="headerlink" title="3. 直接初始化"></a>3. 直接初始化</h3><p>使用括号 <code>()</code> 提供初始值进行直接初始化。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyClass</span>(<span class="type">int</span> v) : <span class="built_in">value</span>(v) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接初始化</span></span><br><span class="line"><span class="function">MyClass <span class="title">obj</span><span class="params">(<span class="number">42</span>)</span></span>; <span class="comment">// 调用带参数的构造函数</span></span><br></pre></td></tr></table></figure><h3 id="4-拷贝初始化"><a href="#4-拷贝初始化" class="headerlink" title="4. 拷贝初始化"></a>4. 拷贝初始化</h3><p>使用等号 <code>=</code> 进行拷贝初始化。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 拷贝初始化</span></span><br><span class="line">MyClass obj = <span class="built_in">MyClass</span>(<span class="number">42</span>); <span class="comment">// 创建临时对象，然后拷贝</span></span><br><span class="line">MyClass obj2 = obj; <span class="comment">// 使用拷贝构造函数</span></span><br></pre></td></tr></table></figure><h3 id="5-列表初始化"><a href="#5-列表初始化" class="headerlink" title="5. 列表初始化"></a>5. 列表初始化</h3><p>C++11 引入的列表初始化方式，使用花括号 <code>&#123;&#125;</code>。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 列表初始化</span></span><br><span class="line">MyClass obj&#123;<span class="number">42</span>&#125;; <span class="comment">// C++11 列表初始化</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化聚合类型</span></span><br><span class="line"><span class="type">int</span> arr[] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;; <span class="comment">// 数组初始化</span></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; vec&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;; <span class="comment">// 容器初始化</span></span><br></pre></td></tr></table></figure><h3 id="6-移动初始化"><a href="#6-移动初始化" class="headerlink" title="6. 移动初始化"></a>6. 移动初始化</h3><p>C++11 引入的移动语义，使用 <code>std::move</code> 进行移动初始化。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 移动初始化</span></span><br><span class="line"><span class="function">MyClass <span class="title">obj1</span><span class="params">(<span class="number">42</span>)</span></span>;</span><br><span class="line">MyClass obj2 = std::<span class="built_in">move</span>(obj1); <span class="comment">// 调用移动构造函数</span></span><br></pre></td></tr></table></figure><h3 id="7-定位new初始化"><a href="#7-定位new初始化" class="headerlink" title="7. 定位new初始化"></a>7. 定位new初始化</h3><p>在已分配的内存上初始化对象。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定位new初始化</span></span><br><span class="line"><span class="type">void</span>* memory = <span class="keyword">operator</span> <span class="built_in">new</span>(<span class="built_in">sizeof</span>(MyClass));</span><br><span class="line">MyClass* obj = <span class="built_in">new</span>(memory) <span class="built_in">MyClass</span>(<span class="number">42</span>); <span class="comment">// 在指定内存上构造对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 手动销毁</span></span><br><span class="line">obj-&gt;~<span class="built_in">MyClass</span>();</span><br><span class="line"><span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(memory)</span></span>;</span><br></pre></td></tr></table></figure><h3 id="8-委托构造函数初始化"><a href="#8-委托构造函数初始化" class="headerlink" title="8. 委托构造函数初始化"></a>8. 委托构造函数初始化</h3><p>C++11 引入的委托构造函数，允许一个构造函数调用同一个类的另一个构造函数。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">    std::string name;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyClass</span>(<span class="type">int</span> v) : <span class="built_in">value</span>(v), <span class="built_in">name</span>(<span class="string">&quot;default&quot;</span>) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 委托构造函数</span></span><br><span class="line">    <span class="built_in">MyClass</span>() : <span class="built_in">MyClass</span>(<span class="number">0</span>) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用委托构造函数</span></span><br><span class="line">MyClass obj; <span class="comment">// 调用默认构造函数，委托给 MyClass(0)</span></span><br></pre></td></tr></table></figure><h2 id="Java-的对象初始化"><a href="#Java-的对象初始化" class="headerlink" title="Java 的对象初始化"></a>Java 的对象初始化</h2><p>Java 是一种纯面向对象的语言，对象初始化主要通过构造函数和其他特殊机制实现。</p><h3 id="1-构造函数初始化"><a href="#1-构造函数初始化" class="headerlink" title="1. 构造函数初始化"></a>1. 构造函数初始化</h3><p>使用 <code>new</code> 关键字和构造函数创建对象。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> value;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyClass</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyClass</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造函数初始化</span></span><br><span class="line"><span class="type">MyClass</span> <span class="variable">obj1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>(); <span class="comment">// 调用默认构造函数</span></span><br><span class="line"><span class="type">MyClass</span> <span class="variable">obj2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>(<span class="number">42</span>); <span class="comment">// 调用带参数的构造函数</span></span><br></pre></td></tr></table></figure><h3 id="2-静态工厂方法"><a href="#2-静态工厂方法" class="headerlink" title="2. 静态工厂方法"></a>2. 静态工厂方法</h3><p>使用静态方法创建对象，提供更灵活的初始化方式。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> value;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">MyClass</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 静态工厂方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> MyClass <span class="title function_">createInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> MyClass <span class="title function_">createInstance</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用静态工厂方法</span></span><br><span class="line"><span class="type">MyClass</span> <span class="variable">obj1</span> <span class="operator">=</span> MyClass.createInstance();</span><br><span class="line"><span class="type">MyClass</span> <span class="variable">obj2</span> <span class="operator">=</span> MyClass.createInstance(<span class="number">42</span>);</span><br></pre></td></tr></table></figure><h3 id="3-反射初始化"><a href="#3-反射初始化" class="headerlink" title="3. 反射初始化"></a>3. 反射初始化</h3><p>使用 Java 反射机制创建对象。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 反射初始化</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 通过类名获取Class对象</span></span><br><span class="line">    Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;MyClass&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 调用默认构造函数</span></span><br><span class="line">    <span class="type">MyClass</span> <span class="variable">obj1</span> <span class="operator">=</span> (MyClass) clazz.newInstance();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 调用带参数的构造函数</span></span><br><span class="line">    Constructor&lt;?&gt; constructor = clazz.getConstructor(<span class="type">int</span>.class);</span><br><span class="line">    <span class="type">MyClass</span> <span class="variable">obj2</span> <span class="operator">=</span> (MyClass) constructor.newInstance(<span class="number">42</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-克隆初始化"><a href="#4-克隆初始化" class="headerlink" title="4. 克隆初始化"></a>4. 克隆初始化</h3><p>实现 <code>Cloneable</code> 接口，通过 <code>clone()</code> 方法创建对象的拷贝。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> value;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyClass</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.clone();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 克隆初始化</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">MyClass</span> <span class="variable">obj1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>(<span class="number">42</span>);</span><br><span class="line">    <span class="type">MyClass</span> <span class="variable">obj2</span> <span class="operator">=</span> (MyClass) obj1.clone(); <span class="comment">// 创建拷贝</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-序列化和反序列化"><a href="#5-序列化和反序列化" class="headerlink" title="5. 序列化和反序列化"></a>5. 序列化和反序列化</h3><p>通过序列化和反序列化创建对象。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> value;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyClass</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 序列化和反序列化</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 序列化</span></span><br><span class="line">    <span class="type">MyClass</span> <span class="variable">obj1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>(<span class="number">42</span>);</span><br><span class="line">    <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">    <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">    oos.writeObject(obj1);</span><br><span class="line">    oos.close();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 反序列化</span></span><br><span class="line">    <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(baos.toByteArray());</span><br><span class="line">    <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bais);</span><br><span class="line">    <span class="type">MyClass</span> <span class="variable">obj2</span> <span class="operator">=</span> (MyClass) ois.readObject();</span><br><span class="line">    ois.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-枚举类型初始化"><a href="#6-枚举类型初始化" class="headerlink" title="6. 枚举类型初始化"></a>6. 枚举类型初始化</h3><p>Java 枚举类型的实例化方式。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Day</span> &#123;</span><br><span class="line">    MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 枚举类型初始化</span></span><br><span class="line"><span class="type">Day</span> <span class="variable">day</span> <span class="operator">=</span> Day.MONDAY; <span class="comment">// 直接引用枚举常量</span></span><br></pre></td></tr></table></figure><h2 id="Python-的对象初始化"><a href="#Python-的对象初始化" class="headerlink" title="Python 的对象初始化"></a>Python 的对象初始化</h2><p>Python 是一种动态类型语言，对象初始化机制与静态语言有很大不同。</p><h3 id="1-init-方法初始化"><a href="#1-init-方法初始化" class="headerlink" title="1. __init__ 方法初始化"></a>1. <code>__init__</code> 方法初始化</h3><p>使用 <code>__init__</code> 方法进行对象初始化。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value=<span class="number">0</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.value = value</span><br><span class="line"></span><br><span class="line"><span class="comment"># __init__ 方法初始化</span></span><br><span class="line">obj1 = MyClass() <span class="comment"># 调用默认构造函数</span></span><br><span class="line">obj2 = MyClass(<span class="number">42</span>) <span class="comment"># 调用带参数的构造函数</span></span><br></pre></td></tr></table></figure><h3 id="2-new-方法初始化"><a href="#2-new-方法初始化" class="headerlink" title="2. __new__ 方法初始化"></a>2. <code>__new__</code> 方法初始化</h3><p>使用 <code>__new__</code> 方法创建对象实例。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>:</span><br><span class="line">    _instance = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> cls._instance:</span><br><span class="line">            cls._instance = <span class="built_in">super</span>().__new__(cls)</span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="variable language_">self</span>.value = value</span><br><span class="line"></span><br><span class="line"><span class="comment"># __new__ 方法初始化（单例模式）</span></span><br><span class="line">s1 = Singleton(<span class="number">42</span>)</span><br><span class="line">s2 = Singleton(<span class="number">100</span>)</span><br><span class="line"><span class="built_in">print</span>(s1 <span class="keyword">is</span> s2) <span class="comment"># True，两个变量引用同一个实例</span></span><br></pre></td></tr></table></figure><h3 id="3-工厂函数初始化"><a href="#3-工厂函数初始化" class="headerlink" title="3. 工厂函数初始化"></a>3. 工厂函数初始化</h3><p>使用工厂函数创建对象。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="variable language_">self</span>.value = value</span><br><span class="line"></span><br><span class="line"><span class="comment"># 工厂函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_my_class</span>(<span class="params">value</span>):</span><br><span class="line">    <span class="keyword">return</span> MyClass(value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 工厂函数初始化</span></span><br><span class="line">obj = create_my_class(<span class="number">42</span>)</span><br></pre></td></tr></table></figure><h3 id="4-类方法初始化"><a href="#4-类方法初始化" class="headerlink" title="4. 类方法初始化"></a>4. 类方法初始化</h3><p>使用类方法创建对象。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="variable language_">self</span>.value = value</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">from_string</span>(<span class="params">cls, string</span>):</span><br><span class="line">        value = <span class="built_in">int</span>(string)</span><br><span class="line">        <span class="keyword">return</span> cls(value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 类方法初始化</span></span><br><span class="line">obj = MyClass.from_string(<span class="string">&quot;42&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="5-静态方法初始化"><a href="#5-静态方法初始化" class="headerlink" title="5. 静态方法初始化"></a>5. 静态方法初始化</h3><p>使用静态方法创建对象。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="variable language_">self</span>.value = value</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_instance</span>(<span class="params">value</span>):</span><br><span class="line">        <span class="keyword">return</span> MyClass(value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 静态方法初始化</span></span><br><span class="line">obj = MyClass.create_instance(<span class="number">42</span>)</span><br></pre></td></tr></table></figure><h3 id="6-拷贝初始化"><a href="#6-拷贝初始化" class="headerlink" title="6. 拷贝初始化"></a>6. 拷贝初始化</h3><p>使用 <code>copy</code> 模块进行对象拷贝。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="variable language_">self</span>.value = value</span><br><span class="line"></span><br><span class="line"><span class="comment"># 浅拷贝</span></span><br><span class="line">obj1 = MyClass(<span class="number">42</span>)</span><br><span class="line">obj2 = copy.copy(obj1) <span class="comment"># 浅拷贝</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 深拷贝</span></span><br><span class="line">obj3 = copy.deepcopy(obj1) <span class="comment"># 深拷贝</span></span><br></pre></td></tr></table></figure><h3 id="7-字典初始化"><a href="#7-字典初始化" class="headerlink" title="7. 字典初始化"></a>7. 字典初始化</h3><p>使用字典解包进行初始化。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.value = value</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字典初始化</span></span><br><span class="line">params = &#123;<span class="string">&quot;value&quot;</span>: <span class="number">42</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;test&quot;</span>&#125;</span><br><span class="line">obj = MyClass(**params) <span class="comment"># 字典解包初始化</span></span><br></pre></td></tr></table></figure><h3 id="8-call-方法初始化"><a href="#8-call-方法初始化" class="headerlink" title="8. __call__ 方法初始化"></a>8. <code>__call__</code> 方法初始化</h3><p>使类的实例可以像函数一样被调用。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, initial_value</span>):</span><br><span class="line">        <span class="variable language_">self</span>.initial_value = initial_value</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="comment"># 创建并返回新实例</span></span><br><span class="line">        <span class="keyword">return</span> MyClass(value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># __call__ 方法初始化</span></span><br><span class="line">factory = MyClass(<span class="number">0</span>) <span class="comment"># 创建工厂实例</span></span><br><span class="line">obj = factory(<span class="number">42</span>) <span class="comment"># 调用实例，创建新对象</span></span><br></pre></td></tr></table></figure><h2 id="C-的对象初始化-1"><a href="#C-的对象初始化-1" class="headerlink" title="C# 的对象初始化"></a>C# 的对象初始化</h2><p>C# 是一种面向对象的静态类型语言，提供了多种对象初始化方式。</p><h3 id="1-构造函数初始化-1"><a href="#1-构造函数初始化-1" class="headerlink" title="1. 构造函数初始化"></a>1. 构造函数初始化</h3><p>使用 <code>new</code> 关键字和构造函数创建对象。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> <span class="keyword">value</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyClass</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.<span class="keyword">value</span> = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyClass</span>(<span class="params"><span class="built_in">int</span> <span class="keyword">value</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.<span class="keyword">value</span> = <span class="keyword">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造函数初始化</span></span><br><span class="line">MyClass obj1 = <span class="keyword">new</span> MyClass(); <span class="comment">// 调用默认构造函数</span></span><br><span class="line">MyClass obj2 = <span class="keyword">new</span> MyClass(<span class="number">42</span>); <span class="comment">// 调用带参数的构造函数</span></span><br></pre></td></tr></table></figure><h3 id="2-对象初始化器"><a href="#2-对象初始化器" class="headerlink" title="2. 对象初始化器"></a>2. 对象初始化器</h3><p>C# 3.0 引入的对象初始化器，使用花括号 <code>&#123;&#125;</code> 进行初始化。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Value &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象初始化器</span></span><br><span class="line">MyClass obj = <span class="keyword">new</span> MyClass &#123; Value = <span class="number">42</span>, Name = <span class="string">&quot;test&quot;</span> &#125;; <span class="comment">// 不调用构造函数，直接设置属性</span></span><br></pre></td></tr></table></figure><h3 id="3-静态工厂方法"><a href="#3-静态工厂方法" class="headerlink" title="3. 静态工厂方法"></a>3. 静态工厂方法</h3><p>使用静态方法创建对象。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> <span class="keyword">value</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MyClass</span>(<span class="params"><span class="built_in">int</span> <span class="keyword">value</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.<span class="keyword">value</span> = <span class="keyword">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 静态工厂方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MyClass <span class="title">CreateInstance</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyClass(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MyClass <span class="title">CreateInstance</span>(<span class="params"><span class="built_in">int</span> <span class="keyword">value</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyClass(<span class="keyword">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用静态工厂方法</span></span><br><span class="line">MyClass obj1 = MyClass.CreateInstance();</span><br><span class="line">MyClass obj2 = MyClass.CreateInstance(<span class="number">42</span>);</span><br></pre></td></tr></table></figure><h3 id="4-反射初始化"><a href="#4-反射初始化" class="headerlink" title="4. 反射初始化"></a>4. 反射初始化</h3><p>使用 C# 反射机制创建对象。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Reflection;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 反射初始化</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 通过类名获取Type对象</span></span><br><span class="line">    Type type = Type.GetType(<span class="string">&quot;MyClass&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 调用默认构造函数</span></span><br><span class="line">    MyClass obj1 = (MyClass)Activator.CreateInstance(type);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 调用带参数的构造函数</span></span><br><span class="line">    MyClass obj2 = (MyClass)Activator.CreateInstance(type, <span class="number">42</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    Console.WriteLine(e.Message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-克隆初始化"><a href="#5-克隆初始化" class="headerlink" title="5. 克隆初始化"></a>5. 克隆初始化</h3><p>实现 <code>ICloneable</code> 接口，通过 <code>Clone()</code> 方法创建对象的拷贝。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">MyClass</span> : <span class="title">ICloneable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Value &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyClass</span>(<span class="params"><span class="built_in">int</span> <span class="keyword">value</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.Value = <span class="keyword">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">Clone</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyClass(<span class="keyword">this</span>.Value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 克隆初始化</span></span><br><span class="line">MyClass obj1 = <span class="keyword">new</span> MyClass(<span class="number">42</span>);</span><br><span class="line">MyClass obj2 = (MyClass)obj1.Clone(); <span class="comment">// 创建拷贝</span></span><br></pre></td></tr></table></figure><h3 id="6-序列化和反序列化"><a href="#6-序列化和反序列化" class="headerlink" title="6. 序列化和反序列化"></a>6. 序列化和反序列化</h3><p>通过序列化和反序列化创建对象。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.Serialization.Formatters.Binary;</span><br><span class="line"></span><br><span class="line">[<span class="meta">Serializable</span>]</span><br><span class="line"><span class="keyword">class</span> <span class="title">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Value &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyClass</span>(<span class="params"><span class="built_in">int</span> <span class="keyword">value</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.Value = <span class="keyword">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 序列化和反序列化</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 序列化</span></span><br><span class="line">    MyClass obj1 = <span class="keyword">new</span> MyClass(<span class="number">42</span>);</span><br><span class="line">    BinaryFormatter formatter = <span class="keyword">new</span> BinaryFormatter();</span><br><span class="line">    MemoryStream stream = <span class="keyword">new</span> MemoryStream();</span><br><span class="line">    formatter.Serialize(stream, obj1);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 反序列化</span></span><br><span class="line">    stream.Position = <span class="number">0</span>;</span><br><span class="line">    MyClass obj2 = (MyClass)formatter.Deserialize(stream);</span><br><span class="line">    stream.Close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    Console.WriteLine(e.Message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-泛型工厂方法"><a href="#7-泛型工厂方法" class="headerlink" title="7. 泛型工厂方法"></a>7. 泛型工厂方法</h3><p>使用泛型方法创建对象。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Factory</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> T <span class="title">CreateInstance</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="keyword">params</span> <span class="built_in">object</span>[] <span class="keyword">args</span></span>) <span class="keyword">where</span> T : <span class="keyword">class</span></span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (T)Activator.CreateInstance(<span class="keyword">typeof</span>(T), <span class="keyword">args</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 泛型工厂方法初始化</span></span><br><span class="line">MyClass obj = Factory.CreateInstance&lt;MyClass&gt;(<span class="number">42</span>);</span><br></pre></td></tr></table></figure><h3 id="8-依赖注入初始化"><a href="#8-依赖注入初始化" class="headerlink" title="8. 依赖注入初始化"></a>8. 依赖注入初始化</h3><p>使用依赖注入容器创建对象。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 Microsoft.Extensions.DependencyInjection</span></span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.DependencyInjection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 配置依赖注入容器</span></span><br><span class="line">        <span class="keyword">var</span> services = <span class="keyword">new</span> ServiceCollection();</span><br><span class="line">        services.AddTransient&lt;MyClass&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 构建服务提供器</span></span><br><span class="line">        <span class="keyword">var</span> serviceProvider = services.BuildServiceProvider();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 解析服务（创建对象）</span></span><br><span class="line">        MyClass obj = serviceProvider.GetService&lt;MyClass&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">MyClass</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyClass</span>()</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;MyClass initialized&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="四种语言对象初始化的对比"><a href="#四种语言对象初始化的对比" class="headerlink" title="四种语言对象初始化的对比"></a>四种语言对象初始化的对比</h2><h3 id="语法对比"><a href="#语法对比" class="headerlink" title="语法对比"></a>语法对比</h3><table><thead><tr><th>特性</th><th>C++</th><th>Java</th><th>Python</th><th>C#</th></tr></thead><tbody><tr><td>初始化关键字</td><td><code>new</code>（动态分配）、直接声明（栈分配）</td><td><code>new</code></td><td>直接调用类名</td><td><code>new</code></td></tr><tr><td>默认构造函数</td><td>可选，不定义时编译器生成</td><td>可选，不定义时编译器生成</td><td>必须定义 <code>__init__</code> 方法</td><td>可选，不定义时编译器生成</td></tr><tr><td>构造函数重载</td><td>支持多个构造函数</td><td>支持多个构造函数</td><td>通过默认参数实现类似功能</td><td>支持多个构造函数</td></tr><tr><td>拷贝初始化</td><td>支持，使用拷贝构造函数</td><td>支持，通过 <code>clone()</code> 方法</td><td>支持，使用 <code>copy</code> 模块</td><td>支持，通过 <code>ICloneable</code> 接口</td></tr><tr><td>移动初始化</td><td>支持（C++11+）</td><td>不直接支持</td><td>不直接支持，通过引用传递</td><td>支持，通过 <code>ref</code> 和 <code>out</code> 关键字</td></tr><tr><td>列表初始化</td><td>支持（C++11+）</td><td>不直接支持，通过数组或集合初始化</td><td>支持，通过 <code>__init__</code> 方法</td><td>支持，通过对象初始化器</td></tr><tr><td>反射初始化</td><td>复杂，通过 <code>typeid</code> 和 <code>dynamic_cast</code></td><td>支持，通过 <code>Class</code> 和反射 API</td><td>支持，通过 <code>type</code> 和 <code>getattr</code></td><td>支持，通过 <code>Type</code> 和反射 API</td></tr><tr><td>工厂方法</td><td>支持，静态成员函数</td><td>支持，静态方法</td><td>支持，函数、类方法、静态方法</td><td>支持，静态方法、泛型工厂方法</td></tr><tr><td>对象初始化器</td><td>不支持</td><td>不支持</td><td>不支持</td><td>支持（C# 3.0+）</td></tr><tr><td>依赖注入</td><td>不直接支持</td><td>不直接支持</td><td>不直接支持</td><td>支持，通过依赖注入容器</td></tr></tbody></table><h3 id="机制对比"><a href="#机制对比" class="headerlink" title="机制对比"></a>机制对比</h3><ol><li><p><strong>内存管理</strong>：</p><ul><li>C++：手动管理内存，栈分配和堆分配</li><li>Java：自动内存管理，垃圾回收</li><li>Python：自动内存管理，垃圾回收</li><li>C#：自动内存管理，垃圾回收</li></ul></li><li><p><strong>构造函数机制</strong>：</p><ul><li>C++：构造函数可以重载，支持初始化列表</li><li>Java：构造函数可以重载，支持 <code>this()</code> 调用其他构造函数</li><li>Python：只有一个 <code>__init__</code> 方法，通过默认参数实现重载效果</li><li>C#：构造函数可以重载，支持初始化列表（C# 6.0+）</li></ul></li><li><p><strong>对象创建过程</strong>：</p><ul><li>C++：分配内存 → 调用构造函数</li><li>Java：分配内存 → 零初始化 → 调用构造函数</li><li>Python：创建实例 → 调用 <code>__init__</code> 方法</li><li>C#：分配内存 → 零初始化 → 调用构造函数 → 应用对象初始化器</li></ul></li><li><p><strong>拷贝语义</strong>：</p><ul><li>C++：默认是深拷贝，需要手动实现移动语义</li><li>Java：默认是引用拷贝，需要手动实现深拷贝</li><li>Python：默认是引用拷贝，通过 <code>copy</code> 模块实现深浅拷贝</li><li>C#：默认是引用拷贝，值类型是值拷贝，通过 <code>ICloneable</code> 接口实现深拷贝</li></ul></li><li><p><strong>灵活性</strong>：</p><ul><li>C++：最灵活，提供多种初始化方式</li><li>Java：中等灵活性，反射机制强大</li><li>Python：最灵活，动态类型和元编程支持</li><li>C#：高灵活性，结合了静态类型的安全性和动态初始化的便捷性</li></ul></li></ol><h3 id="示例对比"><a href="#示例对比" class="headerlink" title="示例对比"></a>示例对比</h3><h4 id="基本初始化对比"><a href="#基本初始化对比" class="headerlink" title="基本初始化对比"></a>基本初始化对比</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++ 基本初始化</span></span><br><span class="line"><span class="function">MyClass <span class="title">obj</span><span class="params">(<span class="number">42</span>)</span></span>; <span class="comment">// 直接初始化</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 基本初始化</span></span><br><span class="line"><span class="type">MyClass</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>(<span class="number">42</span>); <span class="comment">// 使用 new 关键字</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 基本初始化</span></span><br><span class="line">obj = MyClass(<span class="number">42</span>) <span class="comment"># 直接调用类名</span></span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C# 基本初始化</span></span><br><span class="line">MyClass obj = <span class="keyword">new</span> MyClass(<span class="number">42</span>); <span class="comment">// 使用 new 关键字</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// C# 对象初始化器</span></span><br><span class="line">MyClass obj2 = <span class="keyword">new</span> MyClass &#123; Value = <span class="number">42</span>, Name = <span class="string">&quot;test&quot;</span> &#125;; <span class="comment">// 使用对象初始化器</span></span><br></pre></td></tr></table></figure><h4 id="工厂方法对比"><a href="#工厂方法对比" class="headerlink" title="工厂方法对比"></a>工厂方法对比</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++ 工厂方法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">MyClass</span>(<span class="type">int</span> v) &#123;&#125; <span class="comment">// 私有构造函数</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> MyClass <span class="title">create</span><span class="params">(<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">MyClass</span>(v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">MyClass obj = MyClass::<span class="built_in">create</span>(<span class="number">42</span>);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 工厂方法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    MyClass(<span class="type">int</span> v) &#123;&#125; <span class="comment">// 私有构造函数</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">static</span> MyClass <span class="title function_">create</span><span class="params">(<span class="type">int</span> v)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>(v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">MyClass</span> <span class="variable">obj</span> <span class="operator">=</span> MyClass.create(<span class="number">42</span>);</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 工厂方法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, v</span>):</span><br><span class="line">        <span class="variable language_">self</span>.value = v</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">cls, v</span>):</span><br><span class="line">        <span class="keyword">return</span> cls(v)</span><br><span class="line"></span><br><span class="line">obj = MyClass.create(<span class="number">42</span>)</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C# 工厂方法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    MyClass(<span class="built_in">int</span> v) &#123;&#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> MyClass <span class="title">Create</span>(<span class="params"><span class="built_in">int</span> v</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyClass(v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">MyClass obj = MyClass.Create(<span class="number">42</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// C# 泛型工厂方法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Factory</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> T <span class="title">CreateInstance</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="keyword">params</span> <span class="built_in">object</span>[] <span class="keyword">args</span></span>) <span class="keyword">where</span> T : <span class="keyword">class</span></span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (T)Activator.CreateInstance(<span class="keyword">typeof</span>(T), <span class="keyword">args</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyClass obj2 = Factory.CreateInstance&lt;MyClass&gt;(<span class="number">42</span>);</span><br></pre></td></tr></table></figure><h4 id="单例模式对比"><a href="#单例模式对比" class="headerlink" title="单例模式对比"></a>单例模式对比</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++ 单例模式</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">static</span> Singleton* instance;</span><br><span class="line">    <span class="built_in">Singleton</span>() &#123;&#125; <span class="comment">// 私有构造函数</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> Singleton* <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!instance) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="built_in">Singleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Singleton* obj = Singleton::<span class="built_in">getInstance</span>();</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 单例模式</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125; <span class="comment">// 私有构造函数</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">Singleton</span> <span class="variable">obj</span> <span class="operator">=</span> Singleton.getInstance();</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 单例模式</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>:</span><br><span class="line">    _instance = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> cls._instance:</span><br><span class="line">            cls._instance = <span class="built_in">super</span>().__new__(cls)</span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line"></span><br><span class="line">obj = Singleton()</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C# 单例模式（懒汉式）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">object</span> lockObj = <span class="keyword">new</span> <span class="built_in">object</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span>()</span> &#123;&#125; <span class="comment">// 私有构造函数</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">GetInstance</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">lock</span> (lockObj) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Singleton obj = Singleton.GetInstance();</span><br><span class="line"></span><br><span class="line"><span class="comment">// C# 单例模式（饿汉式）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">SingletonEager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> SingletonEager instance = <span class="keyword">new</span> SingletonEager();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonEager</span>()</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonEager <span class="title">GetInstance</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SingletonEager obj2 = SingletonEager.GetInstance();</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol><li><p><strong>C++</strong>：</p><ul><li>提供最丰富的初始化方式</li><li>支持栈分配和堆分配</li><li>需要手动管理内存</li><li>构造函数重载和初始化列表功能强大</li></ul></li><li><p><strong>Java</strong>：</p><ul><li>语法简洁，使用 <code>new</code> 关键字</li><li>自动内存管理，垃圾回收</li><li>反射机制强大，支持动态创建对象</li><li>构造函数重载和工厂方法模式常用</li></ul></li><li><p><strong>Python</strong>：</p><ul><li>语法最简洁，直接调用类名</li><li>动态类型，灵活性最高</li><li>自动内存管理，垃圾回收</li><li>通过 <code>__init__</code> 和 <code>__new__</code> 方法实现初始化逻辑</li></ul></li><li><p><strong>C#</strong>：</p><ul><li>语法简洁，使用 <code>new</code> 关键字</li><li>自动内存管理，垃圾回收</li><li>对象初始化器提供了便捷的初始化方式</li><li>泛型工厂方法和依赖注入容器增强了灵活性</li><li>结合了静态类型的安全性和动态初始化的便捷性</li></ul></li><li><p><strong>选择建议</strong>：</p><ul><li>性能要求高、资源受限场景：C++</li><li>企业级应用、安全性要求高：Java</li><li>快速开发、灵活性要求高：Python</li><li>Windows 平台应用、.NET 生态系统：C#</li></ul></li></ol><p>对象初始化是面向对象编程的基础，理解不同语言的初始化机制有助于我们编写更高效、更可靠的代码。每种语言都有其独特的初始化方式，选择适合具体场景的初始化方法是优秀程序员的必备技能。</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> Python </tag>
            
            <tag> Java </tag>
            
            <tag> C# </tag>
            
            <tag> 对象初始化 </tag>
            
            <tag> 实例化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++的auto与decltype</title>
      <link href="/2026/02/04/C-%E7%9A%84auto%E4%B8%8Edecltype/"/>
      <url>/2026/02/04/C-%E7%9A%84auto%E4%B8%8Edecltype/</url>
      
        <content type="html"><![CDATA[<h1 id="C-的-auto-与-decltype-详解"><a href="#C-的-auto-与-decltype-详解" class="headerlink" title="C++ 的 auto 与 decltype 详解"></a>C++ 的 auto 与 decltype 详解</h1><h2 id="auto-关键字"><a href="#auto-关键字" class="headerlink" title="auto 关键字"></a>auto 关键字</h2><h3 id="什么是-auto"><a href="#什么是-auto" class="headerlink" title="什么是 auto"></a>什么是 auto</h3><p><code>auto</code> 是 C++11 引入的关键字，用于自动类型推导，让编译器根据初始化表达式的类型来推断变量的类型。使用 <code>auto</code> 可以简化代码，减少类型名称的重复，提高代码的可维护性。</p><h3 id="auto-的原理"><a href="#auto-的原理" class="headerlink" title="auto 的原理"></a>auto 的原理</h3><p><code>auto</code> 的类型推导是在编译时进行的，编译器会根据初始化表达式的类型来推断 <code>auto</code> 声明的变量的类型。这意味着：</p><ol><li><code>auto</code> 变量必须在声明时初始化</li><li>编译器会在编译时确定 <code>auto</code> 变量的实际类型</li><li>运行时没有任何性能开销</li></ol><h3 id="auto-的用法"><a href="#auto-的用法" class="headerlink" title="auto 的用法"></a>auto 的用法</h3><h4 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基本类型推导</span></span><br><span class="line"><span class="keyword">auto</span> i = <span class="number">42</span>;          <span class="comment">// i 的类型是 int</span></span><br><span class="line"><span class="keyword">auto</span> d = <span class="number">3.14</span>;        <span class="comment">// d 的类型是 double</span></span><br><span class="line"><span class="keyword">auto</span> s = <span class="string">&quot;hello&quot;</span>;      <span class="comment">// s 的类型是 const char*</span></span><br><span class="line"><span class="keyword">auto</span> b = <span class="literal">true</span>;         <span class="comment">// b 的类型是 bool</span></span><br></pre></td></tr></table></figure><h4 id="与复合类型结合"><a href="#与复合类型结合" class="headerlink" title="与复合类型结合"></a>与复合类型结合</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 与指针结合</span></span><br><span class="line"><span class="keyword">auto</span>* p = &amp;i;          <span class="comment">// p 的类型是 int*</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 与引用结合</span></span><br><span class="line"><span class="keyword">auto</span>&amp; r = i;           <span class="comment">// r 的类型是 int&amp;</span></span><br><span class="line"><span class="type">const</span> <span class="keyword">auto</span>&amp; cr = i;    <span class="comment">// cr 的类型是 const int&amp;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 与 const 结合</span></span><br><span class="line"><span class="type">const</span> <span class="keyword">auto</span> ci = <span class="number">42</span>;     <span class="comment">// ci 的类型是 const int</span></span><br></pre></td></tr></table></figure><h4 id="与容器和迭代器结合"><a href="#与容器和迭代器结合" class="headerlink" title="与容器和迭代器结合"></a>与容器和迭代器结合</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; vec = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简化迭代器声明</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> it = vec.<span class="built_in">begin</span>(); it != vec.<span class="built_in">end</span>(); ++it) &#123;</span><br><span class="line">    <span class="comment">// 处理元素</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// C++11 范围 for 循环</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; element : vec) &#123;</span><br><span class="line">    <span class="comment">// 处理元素</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 与复杂类型结合</span></span><br><span class="line">std::map&lt;std::string, <span class="type">int</span>&gt; map = &#123; &#123;<span class="string">&quot;a&quot;</span>, <span class="number">1</span>&#125;, &#123;<span class="string">&quot;b&quot;</span>, <span class="number">2</span>&#125; &#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; pair : map) &#123;</span><br><span class="line">    <span class="comment">// 处理键值对</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="与函数返回类型结合"><a href="#与函数返回类型结合" class="headerlink" title="与函数返回类型结合"></a>与函数返回类型结合</h4><p>C++14 开始，<code>auto</code> 可以用于函数返回类型推导：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数返回类型推导</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b; <span class="comment">// 返回类型是 int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 与尾置返回类型结合（C++11）</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">multiply</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> -&gt; <span class="type">int</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="与-Lambda-表达式结合"><a href="#与-Lambda-表达式结合" class="headerlink" title="与 Lambda 表达式结合"></a>与 Lambda 表达式结合</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Lambda 表达式的类型是匿名的，必须使用 auto 或函数对象</span></span><br><span class="line"><span class="keyword">auto</span> lambda = [](<span class="type">int</span> a, <span class="type">int</span> b) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> result = <span class="built_in">lambda</span>(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">// result = 3</span></span><br></pre></td></tr></table></figure><h3 id="auto-的注意事项"><a href="#auto-的注意事项" class="headerlink" title="auto 的注意事项"></a>auto 的注意事项</h3><ol><li><strong>必须初始化</strong>：<code>auto</code> 变量必须在声明时初始化</li><li><strong>不能用于函数参数</strong>：<code>void func(auto x) &#123;&#125;</code> 在 C++17 前是不允许的（C++17 引入了模板参数推导）</li><li><strong>不能用于非静态成员变量</strong>：类的非静态成员变量不能用 <code>auto</code> 声明</li><li><strong>数组会退化为指针</strong>：<code>auto</code> 推导数组时会得到指针类型</li><li><strong>cv 限定符</strong>：<code>auto</code> 会忽略顶层 const 和 volatile 限定符</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意事项示例</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> ci = <span class="number">42</span>;</span><br><span class="line"><span class="keyword">auto</span> a = ci;         <span class="comment">// a 的类型是 int，不是 const int</span></span><br><span class="line"><span class="type">const</span> <span class="keyword">auto</span> ca = ci;  <span class="comment">// ca 的类型是 const int</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> arr[<span class="number">5</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> a1 = arr;       <span class="comment">// a1 的类型是 int*</span></span><br><span class="line"><span class="keyword">auto</span>&amp; a2 = arr;      <span class="comment">// a2 的类型是 int (&amp;)[5]</span></span><br></pre></td></tr></table></figure><h2 id="decltype-关键字"><a href="#decltype-关键字" class="headerlink" title="decltype 关键字"></a>decltype 关键字</h2><h3 id="什么是-decltype"><a href="#什么是-decltype" class="headerlink" title="什么是 decltype"></a>什么是 decltype</h3><p><code>decltype</code> 是 C++11 引入的关键字，用于获取表达式的类型，而不需要计算表达式的值。<code>decltype</code> 的名称来源于 “declared type”（声明类型）。</p><h3 id="decltype-的原理"><a href="#decltype-的原理" class="headerlink" title="decltype 的原理"></a>decltype 的原理</h3><p><code>decltype</code> 会分析表达式的类型，并返回该类型，而不会执行表达式。这意味着：</p><ol><li><code>decltype</code> 可以用于获取任何表达式的类型</li><li>表达式不会被执行，只是进行类型分析</li><li>编译时确定类型，运行时无开销</li></ol><h3 id="decltype-的用法"><a href="#decltype-的用法" class="headerlink" title="decltype 的用法"></a>decltype 的用法</h3><h4 id="基本用法-1"><a href="#基本用法-1" class="headerlink" title="基本用法"></a>基本用法</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> i = <span class="number">42</span>;</span><br><span class="line"><span class="keyword">decltype</span>(i) j = <span class="number">100</span>;  <span class="comment">// j 的类型是 int</span></span><br><span class="line"></span><br><span class="line"><span class="type">double</span> d = <span class="number">3.14</span>;</span><br><span class="line"><span class="keyword">decltype</span>(d) e = <span class="number">2.718</span>; <span class="comment">// e 的类型是 double</span></span><br></pre></td></tr></table></figure><h4 id="与表达式结合"><a href="#与表达式结合" class="headerlink" title="与表达式结合"></a>与表达式结合</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> i = <span class="number">42</span>;</span><br><span class="line"><span class="type">int</span>&amp; r = i;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span>&amp; cr = i;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取变量的类型</span></span><br><span class="line"><span class="keyword">decltype</span>(i) a = i;     <span class="comment">// a 的类型是 int</span></span><br><span class="line"><span class="keyword">decltype</span>(r) b = i;     <span class="comment">// b 的类型是 int&amp;</span></span><br><span class="line"><span class="keyword">decltype</span>(cr) c = i;    <span class="comment">// c 的类型是 const int&amp;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取表达式的类型</span></span><br><span class="line"><span class="keyword">decltype</span>(i + i) d = <span class="number">0</span>;  <span class="comment">// d 的类型是 int</span></span><br><span class="line"><span class="keyword">decltype</span>(r + r) e = <span class="number">0</span>;  <span class="comment">// e 的类型是 int（引用相加结果是值）</span></span><br></pre></td></tr></table></figure><h4 id="与函数返回类型结合-1"><a href="#与函数返回类型结合-1" class="headerlink" title="与函数返回类型结合"></a>与函数返回类型结合</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="function"><span class="keyword">decltype</span>(<span class="keyword">auto</span>) <span class="title">func</span><span class="params">()</span></span>; <span class="comment">// C++14 开始支持</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 尾置返回类型（C++11）</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">add</span><span class="params">(T t, U u)</span> -&gt; <span class="title">decltype</span><span class="params">(t + u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> t + u;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="与模板结合"><a href="#与模板结合" class="headerlink" title="与模板结合"></a>与模板结合</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printType</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 使用 decltype 获取 t 的类型</span></span><br><span class="line">    <span class="comment">// 这里可以进行类型相关的操作</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型别名</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">using</span> VectorIterator = <span class="keyword">typename</span> std::vector&lt;T&gt;::iterator;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 decltype 简化</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">using</span> VectorIterator = <span class="keyword">decltype</span>(std::declval&lt;std::vector&lt;T&gt;&gt;().<span class="built_in">begin</span>());</span><br></pre></td></tr></table></figure><h4 id="与-auto-结合"><a href="#与-auto-结合" class="headerlink" title="与 auto 结合"></a>与 auto 结合</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// decltype(auto) 用于保留引用和 cv 限定符</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">decltype</span>(<span class="keyword">auto</span>) <span class="title">returnValue</span><span class="params">(T&amp;&amp; t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> t; <span class="comment">// 保持 t 的值类别（值、左值引用或右值引用）</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 与 auto 结合进行类型推导</span></span><br><span class="line"><span class="keyword">auto</span> i = <span class="number">42</span>;</span><br><span class="line"><span class="keyword">decltype</span>(<span class="keyword">auto</span>) j = i;  <span class="comment">// j 的类型是 int</span></span><br><span class="line"><span class="keyword">decltype</span>(<span class="keyword">auto</span>) k = (i); <span class="comment">// k 的类型是 int&amp;（因为括号表达式是左值）</span></span><br></pre></td></tr></table></figure><h3 id="decltype-的注意事项"><a href="#decltype-的注意事项" class="headerlink" title="decltype 的注意事项"></a>decltype 的注意事项</h3><ol><li><strong>表达式分析</strong>：<code>decltype</code> 会分析表达式的类型，包括引用和 cv 限定符</li><li><strong>括号的影响</strong>：<code>decltype((expr))</code> 总是返回引用类型</li><li><strong>函数调用</strong>：<code>decltype(func())</code> 会分析函数的返回类型，不会执行函数</li><li><strong>重载解析</strong>：如果表达式是函数调用，会进行重载解析</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意事项示例</span></span><br><span class="line"><span class="type">int</span> i = <span class="number">42</span>;</span><br><span class="line"><span class="keyword">decltype</span>(i) a = i;     <span class="comment">// a 的类型是 int</span></span><br><span class="line"><span class="keyword">decltype</span>((i)) b = i;   <span class="comment">// b 的类型是 int&amp;（括号表达式是左值）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数调用类型分析</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">func</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">decltype</span>(<span class="built_in">func</span>()) c = <span class="number">0</span>; <span class="comment">// c 的类型是 int</span></span><br></pre></td></tr></table></figure><h2 id="auto-与-decltype-的区别"><a href="#auto-与-decltype-的区别" class="headerlink" title="auto 与 decltype 的区别"></a>auto 与 decltype 的区别</h2><table><thead><tr><th>特性</th><th>auto</th><th>decltype</th></tr></thead><tbody><tr><td>用途</td><td>声明变量，自动推导类型</td><td>获取表达式的类型，不声明变量</td></tr><tr><td>初始化要求</td><td>必须在声明时初始化</td><td>不需要初始化，只分析表达式类型</td></tr><tr><td>类型推导规则</td><td>忽略顶层 cv 限定符，数组退化为指针</td><td>保留所有类型信息，包括引用和 cv 限定符</td></tr><tr><td>表达式处理</td><td>只使用初始化表达式的类型</td><td>分析整个表达式的类型，包括值类别</td></tr><tr><td>使用场景</td><td>简化变量声明，尤其是复杂类型</td><td>类型别名、模板元编程、函数返回类型推导</td></tr><tr><td>与括号的关系</td><td>括号不影响推导结果</td><td><code>decltype((expr))</code> 总是返回引用类型</td></tr></tbody></table><h3 id="关键区别示例"><a href="#关键区别示例" class="headerlink" title="关键区别示例"></a>关键区别示例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> i = <span class="number">42</span>;</span><br><span class="line"><span class="type">int</span>&amp; r = i;</span><br><span class="line"></span><br><span class="line"><span class="comment">// auto 推导</span></span><br><span class="line"><span class="keyword">auto</span> a = i;     <span class="comment">// a 的类型是 int</span></span><br><span class="line"><span class="keyword">auto</span> b = r;     <span class="comment">// b 的类型是 int（引用被解引用）</span></span><br><span class="line"><span class="keyword">auto</span> c = (i);   <span class="comment">// c 的类型是 int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// decltype 推导</span></span><br><span class="line"><span class="keyword">decltype</span>(i) d = i;     <span class="comment">// d 的类型是 int</span></span><br><span class="line"><span class="keyword">decltype</span>(r) e = i;     <span class="comment">// e 的类型是 int&amp;</span></span><br><span class="line"><span class="keyword">decltype</span>((i)) f = i;   <span class="comment">// f 的类型是 int&amp;（括号表达式是左值）</span></span><br></pre></td></tr></table></figure><h2 id="C-auto、decltype-与-Java-var-的比较"><a href="#C-auto、decltype-与-Java-var-的比较" class="headerlink" title="C++ auto、decltype 与 Java var 的比较"></a>C++ auto、decltype 与 Java var 的比较</h2><h3 id="Java-var-关键字"><a href="#Java-var-关键字" class="headerlink" title="Java var 关键字"></a>Java var 关键字</h3><p>Java 10 引入了 <code>var</code> 关键字，用于局部变量类型推断，与 C++ 的 <code>auto</code> 类似，但有一些重要区别。</p><h4 id="Java-var-的基本用法"><a href="#Java-var-的基本用法" class="headerlink" title="Java var 的基本用法"></a>Java var 的基本用法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java var 示例</span></span><br><span class="line"><span class="type">var</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">42</span>;          <span class="comment">// i 的类型是 int</span></span><br><span class="line"><span class="type">var</span> <span class="variable">d</span> <span class="operator">=</span> <span class="number">3.14</span>;        <span class="comment">// d 的类型是 double</span></span><br><span class="line"><span class="type">var</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;      <span class="comment">// s 的类型是 String</span></span><br><span class="line"><span class="type">var</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;(); <span class="comment">// list 的类型是 ArrayList&lt;String&gt;</span></span><br></pre></td></tr></table></figure><h3 id="三者的区别"><a href="#三者的区别" class="headerlink" title="三者的区别"></a>三者的区别</h3><table><thead><tr><th>特性</th><th>C++ auto</th><th>C++ decltype</th><th>Java var</th></tr></thead><tbody><tr><td>引入版本</td><td>C++11</td><td>C++11</td><td>Java 10</td></tr><tr><td>用途</td><td>变量声明，类型推导</td><td>获取表达式类型</td><td>局部变量声明，类型推导</td></tr><tr><td>初始化要求</td><td>必须初始化</td><td>不需要初始化</td><td>必须初始化</td></tr><tr><td>作用域</td><td>全局、局部、函数返回类型</td><td>类型表达式中</td><td>仅局部变量</td></tr><tr><td>类型推导时机</td><td>编译时</td><td>编译时</td><td>编译时</td></tr><tr><td>泛型支持</td><td>完全支持，可推导模板参数</td><td>完全支持</td><td>支持，可推导泛型类型</td></tr><tr><td>类型信息保留</td><td>忽略顶层 cv 限定符</td><td>保留所有类型信息</td><td>保留所有类型信息</td></tr><tr><td>引用处理</td><td>需显式声明引用</td><td>自动保留引用类型</td><td>自动推断引用类型</td></tr><tr><td>数组处理</td><td>数组退化为指针</td><td>保留数组类型</td><td>保留数组类型</td></tr><tr><td>函数参数</td><td>C++17 前不支持</td><td>不适用</td><td>不支持</td></tr><tr><td>成员变量</td><td>不支持</td><td>不适用</td><td>不支持</td></tr></tbody></table><h3 id="具体区别示例"><a href="#具体区别示例" class="headerlink" title="具体区别示例"></a>具体区别示例</h3><h4 id="C-auto-vs-Java-var"><a href="#C-auto-vs-Java-var" class="headerlink" title="C++ auto vs Java var"></a>C++ auto vs Java var</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++ auto</span></span><br><span class="line"><span class="keyword">auto</span> i = <span class="number">42</span>;          <span class="comment">// int</span></span><br><span class="line"><span class="keyword">auto</span>&amp; r = i;          <span class="comment">// int&amp;</span></span><br><span class="line"><span class="type">const</span> <span class="keyword">auto</span> ci = <span class="number">42</span>;   <span class="comment">// const int</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> arr[<span class="number">5</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> a = arr;         <span class="comment">// int*</span></span><br><span class="line"><span class="keyword">auto</span>&amp; b = arr;        <span class="comment">// int (&amp;)[5]</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java var</span></span><br><span class="line"><span class="type">var</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">42</span>;          <span class="comment">// int</span></span><br><span class="line"><span class="type">var</span> <span class="variable">list</span> <span class="operator">=</span> List.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>); <span class="comment">// List&lt;Integer&gt;</span></span><br><span class="line"><span class="type">var</span> <span class="variable">arr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;; <span class="comment">// int[]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Java var 不能用于：</span></span><br><span class="line"><span class="comment">// var x; // 错误：必须初始化</span></span><br><span class="line"><span class="comment">// public var field; // 错误：不能用于成员变量</span></span><br><span class="line"><span class="comment">// void method(var param) &#123;&#125; // 错误：不能用于方法参数</span></span><br></pre></td></tr></table></figure><h4 id="C-decltype-的独特用法"><a href="#C-decltype-的独特用法" class="headerlink" title="C++ decltype 的独特用法"></a>C++ decltype 的独特用法</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++ decltype 独特用法</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">add</span><span class="params">(T t, U u)</span> -&gt; <span class="title">decltype</span><span class="params">(t + u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> t + u;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型别名</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">using</span> IteratorType = <span class="keyword">decltype</span>(std::<span class="built_in">declval</span>&lt;T&gt;().<span class="built_in">begin</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 与 auto 结合</span></span><br><span class="line"><span class="function"><span class="keyword">decltype</span>(<span class="keyword">auto</span>) <span class="title">func</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">42</span>;</span><br><span class="line">    <span class="keyword">return</span> (i); <span class="comment">// 返回 int&amp;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="应用场景对比"><a href="#应用场景对比" class="headerlink" title="应用场景对比"></a>应用场景对比</h2><h3 id="auto-的最佳应用场景"><a href="#auto-的最佳应用场景" class="headerlink" title="auto 的最佳应用场景"></a>auto 的最佳应用场景</h3><ol><li><strong>简化复杂类型声明</strong>：当类型名称很长或复杂时，使用 <code>auto</code> 可以简化代码</li><li><strong>范围 for 循环</strong>：与范围 for 循环结合，简化迭代器声明</li><li><strong>Lambda 表达式</strong>：Lambda 表达式的类型是匿名的，必须使用 <code>auto</code></li><li><strong>函数返回类型推导</strong>：当返回类型依赖于模板参数时</li><li><strong>泛型编程</strong>：与模板结合，简化类型声明</li></ol><h3 id="decltype-的最佳应用场景"><a href="#decltype-的最佳应用场景" class="headerlink" title="decltype 的最佳应用场景"></a>decltype 的最佳应用场景</h3><ol><li><strong>模板元编程</strong>：在模板中获取表达式类型</li><li><strong>函数返回类型推导</strong>：特别是当返回类型依赖于参数类型时</li><li><strong>类型别名</strong>：创建依赖于模板参数的类型别名</li><li><strong>保留引用类型</strong>：当需要保留表达式的引用类型时</li><li><strong>复杂表达式类型分析</strong>：分析复杂表达式的类型</li></ol><h3 id="Java-var-的最佳应用场景"><a href="#Java-var-的最佳应用场景" class="headerlink" title="Java var 的最佳应用场景"></a>Java var 的最佳应用场景</h3><ol><li><strong>局部变量声明</strong>：简化局部变量的类型声明</li><li><strong>链式调用</strong>：当链式调用返回类型复杂时</li><li><strong>Lambda 表达式</strong>：简化 Lambda 表达式的变量声明</li><li><strong>泛型集合</strong>：简化泛型集合的声明</li><li><strong>提高代码可读性</strong>：当变量类型从初始化表达式中可以清晰推断时</li></ol><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol><li><p><strong>auto</strong>：</p><ul><li>用于变量声明，自动推导类型</li><li>必须在声明时初始化</li><li>编译时推导类型，运行时无开销</li><li>简化代码，减少类型名称重复</li><li>忽略顶层 cv 限定符，数组退化为指针</li></ul></li><li><p><strong>decltype</strong>：</p><ul><li>用于获取表达式的类型，不执行表达式</li><li>不需要初始化，只分析类型</li><li>保留所有类型信息，包括引用和 cv 限定符</li><li>用于模板元编程、类型别名、函数返回类型推导</li><li><code>decltype((expr))</code> 总是返回引用类型</li></ul></li><li><p><strong>Java var</strong>：</p><ul><li>用于局部变量声明，自动推导类型</li><li>必须在声明时初始化</li><li>仅适用于局部变量，不能用于成员变量、方法参数</li><li>保留所有类型信息</li><li>简化代码，提高可读性</li></ul></li><li><p><strong>选择建议</strong>：</p><ul><li>当声明变量且类型从初始化表达式中清晰可见时，使用 <code>auto</code> 或 <code>var</code></li><li>当需要获取表达式类型而不声明变量时，使用 <code>decltype</code></li><li>当需要保留表达式的引用类型时，使用 <code>decltype</code> 或 <code>decltype(auto)</code></li><li>当类型名称很长或复杂时，使用 <code>auto</code> 或 <code>var</code> 简化代码</li><li>在模板编程中，<code>decltype</code> 是获取类型信息的强大工具</li></ul></li></ol><p><code>auto</code> 和 <code>decltype</code> 是 C++11 引入的重要特性，它们大大简化了代码，提高了可读性和可维护性。理解它们的原理和用法，以及它们之间的区别，对于编写现代 C++ 代码非常重要。同时，与 Java var 的比较也有助于我们理解不同语言在类型推导方面的设计思路。</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> auto </tag>
            
            <tag> decltype </tag>
            
            <tag> 类型推导 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++虚函数与纯虚函数</title>
      <link href="/2026/02/04/C-%E8%99%9A%E5%87%BD%E6%95%B0%E4%B8%8E%E7%BA%AF%E8%99%9A%E5%87%BD%E6%95%B0/"/>
      <url>/2026/02/04/C-%E8%99%9A%E5%87%BD%E6%95%B0%E4%B8%8E%E7%BA%AF%E8%99%9A%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="什么是虚函数"><a href="#什么是虚函数" class="headerlink" title="什么是虚函数"></a>什么是虚函数</h2><p>虚函数是 C++ 中实现多态的核心机制，它允许在基类中声明一个函数，然后在派生类中重写（override）这个函数，使得通过基类指针或引用调用该函数时，会根据实际指向的对象类型来调用相应的派生类实现。</p><h3 id="虚函数的定义"><a href="#虚函数的定义" class="headerlink" title="虚函数的定义"></a>虚函数的定义</h3><p>在 C++ 中，通过在函数声明前添加 <code>virtual</code> 关键字来定义虚函数：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 虚函数</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Base::show()&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="什么是纯虚函数"><a href="#什么是纯虚函数" class="headerlink" title="什么是纯虚函数"></a>什么是纯虚函数</h2><p>纯虚函数是一种特殊的虚函数，它在基类中只声明函数签名，不提供实现，而是要求派生类必须提供实现。包含纯虚函数的类被称为抽象类，不能直接实例化。</p><h3 id="纯虚函数的定义"><a href="#纯虚函数的定义" class="headerlink" title="纯虚函数的定义"></a>纯虚函数的定义</h3><p>在 C++ 中，通过在虚函数声明的末尾添加 <code>= 0</code> 来定义纯虚函数：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 纯虚函数</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">show</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="虚函数与纯虚函数的区别"><a href="#虚函数与纯虚函数的区别" class="headerlink" title="虚函数与纯虚函数的区别"></a>虚函数与纯虚函数的区别</h2><table><thead><tr><th>特性</th><th>虚函数</th><th>纯虚函数</th></tr></thead><tbody><tr><td>实现</td><td>基类可以提供默认实现</td><td>基类不提供实现，派生类必须实现</td></tr><tr><td>类类型</td><td>包含虚函数的类可以实例化</td><td>包含纯虚函数的类是抽象类，不能实例化</td></tr><tr><td>继承要求</td><td>派生类可以选择是否重写</td><td>派生类必须重写，否则派生类也是抽象类</td></tr><tr><td>用途</td><td>实现多态，提供默认行为</td><td>定义接口，强制派生类实现特定行为</td></tr></tbody></table><h2 id="非虚函数的重写"><a href="#非虚函数的重写" class="headerlink" title="非虚函数的重写"></a>非虚函数的重写</h2><p>如果一个函数不是虚函数，那么在派生类中重写（实际上是隐藏）这个函数时，通过基类指针或引用调用该函数时，会调用基类的实现，而不是派生类的实现。这种行为被称为静态绑定（编译时绑定），而虚函数的调用是动态绑定（运行时绑定）。</p><h3 id="非虚函数重写示例"><a href="#非虚函数重写示例" class="headerlink" title="非虚函数重写示例"></a>非虚函数重写示例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 非虚函数</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Base::show()&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span> : <span class="keyword">public</span> Base &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 隐藏基类的show()方法</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Derived::show()&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Base base;</span><br><span class="line">    Derived derived;</span><br><span class="line">    Base* ptr = &amp;derived;</span><br><span class="line">    </span><br><span class="line">    base.<span class="built_in">show</span>();    <span class="comment">// 输出: Base::show()</span></span><br><span class="line">    derived.<span class="built_in">show</span>(); <span class="comment">// 输出: Derived::show()</span></span><br><span class="line">    ptr-&gt;<span class="built_in">show</span>();    <span class="comment">// 输出: Base::show() - 静态绑定，调用基类的方法</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="虚函数重写示例"><a href="#虚函数重写示例" class="headerlink" title="虚函数重写示例"></a>虚函数重写示例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 虚函数</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Base::show()&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span> : <span class="keyword">public</span> Base &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 重写基类的虚函数</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">show</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Derived::show()&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Base base;</span><br><span class="line">    Derived derived;</span><br><span class="line">    Base* ptr = &amp;derived;</span><br><span class="line">    </span><br><span class="line">    base.<span class="built_in">show</span>();    <span class="comment">// 输出: Base::show()</span></span><br><span class="line">    derived.<span class="built_in">show</span>(); <span class="comment">// 输出: Derived::show()</span></span><br><span class="line">    ptr-&gt;<span class="built_in">show</span>();    <span class="comment">// 输出: Derived::show() - 动态绑定，调用派生类的方法</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="纯虚函数示例"><a href="#纯虚函数示例" class="headerlink" title="纯虚函数示例"></a>纯虚函数示例</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 纯虚函数</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">draw</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 虚析构函数</span></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Shape</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> : <span class="keyword">public</span> Shape &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 必须实现draw()方法</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Drawing a circle&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> : <span class="keyword">public</span> Shape &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 必须实现draw()方法</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Drawing a rectangle&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Shape shape; // 错误：抽象类不能实例化</span></span><br><span class="line">    </span><br><span class="line">    Shape* circle = <span class="keyword">new</span> <span class="built_in">Circle</span>();</span><br><span class="line">    Shape* rectangle = <span class="keyword">new</span> <span class="built_in">Rectangle</span>();</span><br><span class="line">    </span><br><span class="line">    circle-&gt;<span class="built_in">draw</span>();    <span class="comment">// 输出: Drawing a circle</span></span><br><span class="line">    rectangle-&gt;<span class="built_in">draw</span>(); <span class="comment">// 输出: Drawing a rectangle</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">delete</span> circle;</span><br><span class="line">    <span class="keyword">delete</span> rectangle;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C-虚函数、纯虚函数与-Java-抽象函数的比较"><a href="#C-虚函数、纯虚函数与-Java-抽象函数的比较" class="headerlink" title="C++ 虚函数、纯虚函数与 Java 抽象函数的比较"></a>C++ 虚函数、纯虚函数与 Java 抽象函数的比较</h2><h3 id="Java-中的抽象函数"><a href="#Java-中的抽象函数" class="headerlink" title="Java 中的抽象函数"></a>Java 中的抽象函数</h3><p>在 Java 中，抽象函数是通过 <code>abstract</code> 关键字定义的，它与 C++ 的纯虚函数类似，只声明函数签名，不提供实现。包含抽象函数的类必须声明为抽象类，不能直接实例化。</p><h3 id="区别与联系"><a href="#区别与联系" class="headerlink" title="区别与联系"></a>区别与联系</h3><table><thead><tr><th>特性</th><th>C++ 虚函数</th><th>C++ 纯虚函数</th><th>Java 抽象函数</th></tr></thead><tbody><tr><td>关键字</td><td><code>virtual</code></td><td><code>virtual</code> + <code>= 0</code></td><td><code>abstract</code></td></tr><tr><td>实现</td><td>基类可以提供实现</td><td>基类不提供实现</td><td>基类不提供实现</td></tr><tr><td>类类型</td><td>普通类</td><td>抽象类</td><td>抽象类</td></tr><tr><td>继承要求</td><td>派生类可选择重写</td><td>派生类必须重写</td><td>派生类必须重写</td></tr><tr><td>多态实现</td><td>动态绑定</td><td>动态绑定</td><td>动态绑定</td></tr><tr><td>接口定义</td><td>不适合定义接口</td><td>适合定义接口</td><td>适合定义接口</td></tr></tbody></table><h3 id="Java-抽象函数示例"><a href="#Java-抽象函数示例" class="headerlink" title="Java 抽象函数示例"></a>Java 抽象函数示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="comment">// 抽象函数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="comment">// 必须实现draw()方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Drawing a circle&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="comment">// 必须实现draw()方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Drawing a rectangle&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// Shape shape = new Shape(); // 错误：抽象类不能实例化</span></span><br><span class="line">        </span><br><span class="line">        <span class="type">Shape</span> <span class="variable">circle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Circle</span>();</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">rectangle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>();</span><br><span class="line">        </span><br><span class="line">        circle.draw();    <span class="comment">// 输出: Drawing a circle</span></span><br><span class="line">        rectangle.draw(); <span class="comment">// 输出: Drawing a rectangle</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="C-与-Java-的接口对比"><a href="#C-与-Java-的接口对比" class="headerlink" title="C++ 与 Java 的接口对比"></a>C++ 与 Java 的接口对比</h3><ul><li><strong>C++</strong>：使用包含纯虚函数的抽象类来定义接口</li><li><strong>Java</strong>：使用 <code>interface</code> 关键字定义接口，所有方法默认是抽象的</li></ul><h4 id="Java-接口示例"><a href="#Java-接口示例" class="headerlink" title="Java 接口示例"></a>Java 接口示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>; <span class="comment">// 默认是抽象方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Drawing a circle&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Drawing a rectangle&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="虚函数的工作原理"><a href="#虚函数的工作原理" class="headerlink" title="虚函数的工作原理"></a>虚函数的工作原理</h2><p>虚函数的实现依赖于虚函数表（vtable）和虚指针（vptr）：</p><ol><li><strong>虚函数表（vtable）</strong>：每个包含虚函数的类都有一个虚函数表，存储该类所有虚函数的地址</li><li><strong>虚指针（vptr）</strong>：每个对象都有一个虚指针，指向所属类的虚函数表</li><li><strong>动态绑定</strong>：当通过基类指针或引用调用虚函数时，会通过虚指针找到相应的虚函数表，然后调用对应的函数</li></ol><h3 id="虚函数表示例"><a href="#虚函数表示例" class="headerlink" title="虚函数表示例"></a>虚函数表示例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Base::show()&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Base::print()&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span> : <span class="keyword">public</span> Base &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">show</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Derived::show()&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 重写print()方法</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Derived::print()&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Base* base = <span class="keyword">new</span> <span class="built_in">Base</span>();</span><br><span class="line">    Base* derived = <span class="keyword">new</span> <span class="built_in">Derived</span>();</span><br><span class="line">    </span><br><span class="line">    base-&gt;<span class="built_in">show</span>();    <span class="comment">// 调用Base::show()</span></span><br><span class="line">    base-&gt;<span class="built_in">print</span>();   <span class="comment">// 调用Base::print()</span></span><br><span class="line">    </span><br><span class="line">    derived-&gt;<span class="built_in">show</span>(); <span class="comment">// 调用Derived::show()</span></span><br><span class="line">    derived-&gt;<span class="built_in">print</span>();<span class="comment">// 调用Derived::print()</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">delete</span> base;</span><br><span class="line">    <span class="keyword">delete</span> derived;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="虚析构函数"><a href="#虚析构函数" class="headerlink" title="虚析构函数"></a>虚析构函数</h2><p>当使用多态时，基类的析构函数应该声明为虚函数，以确保在删除基类指针指向的派生类对象时，能够正确调用派生类的析构函数，避免内存泄漏。</p><h3 id="虚析构函数示例"><a href="#虚析构函数示例" class="headerlink" title="虚析构函数示例"></a>虚析构函数示例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 虚析构函数</span></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Base</span>() &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Base::~Base()&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span> : <span class="keyword">public</span> Base &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span>* data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Derived</span>() &#123;</span><br><span class="line">        data = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">10</span>];</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Derived::Derived()&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">Derived</span>() <span class="keyword">override</span> &#123;</span><br><span class="line">        <span class="keyword">delete</span>[] data;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Derived::~Derived()&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Base* base = <span class="keyword">new</span> <span class="built_in">Derived</span>();</span><br><span class="line">    <span class="keyword">delete</span> base; <span class="comment">// 正确调用Derived::~Derived()和Base::~Base()</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol><li><p><strong>虚函数</strong>：</p><ul><li>允许在派生类中重写基类的方法</li><li>实现动态绑定（运行时多态）</li><li>基类可以提供默认实现</li><li>包含虚函数的类可以实例化</li></ul></li><li><p><strong>纯虚函数</strong>：</p><ul><li>是一种特殊的虚函数，不提供实现</li><li>强制派生类必须实现</li><li>包含纯虚函数的类是抽象类，不能实例化</li><li>用于定义接口</li></ul></li><li><p><strong>非虚函数重写</strong>：</p><ul><li>实际上是隐藏基类的方法</li><li>实现静态绑定（编译时绑定）</li><li>通过基类指针或引用调用时，调用基类的实现</li></ul></li><li><p><strong>与 Java 抽象函数的比较</strong>：</p><ul><li>C++ 的纯虚函数类似于 Java 的抽象函数</li><li>Java 使用 <code>abstract</code> 关键字定义抽象函数</li><li>Java 有专门的 <code>interface</code> 关键字定义接口，而 C++ 使用抽象类定义接口</li></ul></li></ol><p>虚函数和纯虚函数是 C++ 实现面向对象编程中多态的重要机制，它们使得代码更加灵活、可扩展，同时也促进了良好的代码设计。理解它们的工作原理和使用场景，对于编写高质量的 C++ 代码非常重要。</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> 面向对象 </tag>
            
            <tag> 虚函数 </tag>
            
            <tag> 纯虚函数 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot内置工具类</title>
      <link href="/2026/01/31/SpringBoot%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7%E7%B1%BB/"/>
      <url>/2026/01/31/SpringBoot%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring-Boot-3-内置工具类详解"><a href="#Spring-Boot-3-内置工具类详解" class="headerlink" title="Spring Boot 3 内置工具类详解"></a>Spring Boot 3 内置工具类详解</h1><h2 id="什么是-Spring-Boot-内置工具类"><a href="#什么是-Spring-Boot-内置工具类" class="headerlink" title="什么是 Spring Boot 内置工具类"></a>什么是 Spring Boot 内置工具类</h2><p>Spring Boot 3 提供了许多内置的工具类，这些工具类封装了常见的操作，简化了开发过程，提高了代码的可读性和可维护性。这些工具类涵盖了字符串处理、集合操作、时间日期处理、反射、Web 操作等多个方面。</p><h2 id="字符串工具类"><a href="#字符串工具类" class="headerlink" title="字符串工具类"></a>字符串工具类</h2><h3 id="1-StringUtils"><a href="#1-StringUtils" class="headerlink" title="1. StringUtils"></a>1. StringUtils</h3><p><strong>应用场景</strong>：字符串的判空、修剪、分割、替换等操作</p><p><strong>示例代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringUtilsDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 判空操作</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str3</span> <span class="operator">=</span> <span class="string">&quot;  &quot;</span>;</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;str1 是否为空: &quot;</span> + StringUtils.isEmpty(str1)); <span class="comment">// true</span></span><br><span class="line">        System.out.println(<span class="string">&quot;str2 是否为空: &quot;</span> + StringUtils.isEmpty(str2)); <span class="comment">// true</span></span><br><span class="line">        System.out.println(<span class="string">&quot;str3 是否为空: &quot;</span> + StringUtils.isEmpty(str3)); <span class="comment">// false</span></span><br><span class="line">        System.out.println(<span class="string">&quot;str3 是否为空白: &quot;</span> + StringUtils.isBlank(str3)); <span class="comment">// true</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 修剪操作</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str4</span> <span class="operator">=</span> <span class="string">&quot;  Hello World  &quot;</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;修剪后: &quot;</span> + StringUtils.trimWhitespace(str4)); <span class="comment">// &quot;Hello World&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 分割操作</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str5</span> <span class="operator">=</span> <span class="string">&quot;a,b,c,d&quot;</span>;</span><br><span class="line">        String[] parts = StringUtils.split(str5, <span class="string">&quot;,&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;分割结果: &quot;</span> + Arrays.toString(parts)); <span class="comment">// [a, b, c, d]</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 替换操作</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str6</span> <span class="operator">=</span> <span class="string">&quot;Hello &#123;name&#125;&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">replaced</span> <span class="operator">=</span> StringUtils.replace(str6, <span class="string">&quot;&#123;name&#125;&quot;</span>, <span class="string">&quot;Spring Boot&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;替换结果: &quot;</span> + replaced); <span class="comment">// &quot;Hello Spring Boot&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查字符串是否以指定前缀开始</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str7</span> <span class="operator">=</span> <span class="string">&quot;SpringBootApplication&quot;</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;是否以Spring开头: &quot;</span> + StringUtils.startsWith(str7, <span class="string">&quot;Spring&quot;</span>)); <span class="comment">// true</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查字符串是否以指定后缀结束</span></span><br><span class="line">        System.out.println(<span class="string">&quot;是否以Application结尾: &quot;</span> + StringUtils.endsWith(str7, <span class="string">&quot;Application&quot;</span>)); <span class="comment">// true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-ObjectUtils"><a href="#2-ObjectUtils" class="headerlink" title="2. ObjectUtils"></a>2. ObjectUtils</h3><p><strong>应用场景</strong>：对象的判空、比较、转换等操作</p><p><strong>示例代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.ObjectUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ObjectUtilsDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 判空操作</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj1</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;obj1 是否为空: &quot;</span> + ObjectUtils.isEmpty(obj1)); <span class="comment">// true</span></span><br><span class="line">        System.out.println(<span class="string">&quot;obj2 是否为空: &quot;</span> + ObjectUtils.isEmpty(obj2)); <span class="comment">// false</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 比较操作</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">num1</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">num2</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">num3</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;num1 和 num2 是否相等: &quot;</span> + ObjectUtils.nullSafeEquals(num1, num2)); <span class="comment">// true</span></span><br><span class="line">        System.out.println(<span class="string">&quot;num1 和 num3 是否相等: &quot;</span> + ObjectUtils.nullSafeEquals(num1, num3)); <span class="comment">// false</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 转换为字符串</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj3</span> <span class="operator">=</span> <span class="number">123</span>;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj4</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;obj3 转换为字符串: &quot;</span> + ObjectUtils.nullSafeToString(obj3)); <span class="comment">// &quot;123&quot;</span></span><br><span class="line">        System.out.println(<span class="string">&quot;obj4 转换为字符串: &quot;</span> + ObjectUtils.nullSafeToString(obj4)); <span class="comment">// &quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取对象的类名</span></span><br><span class="line">        System.out.println(<span class="string">&quot;obj2 的类名: &quot;</span> + ObjectUtils.getClassName(obj2)); <span class="comment">// &quot;java.lang.Object&quot;</span></span><br><span class="line">        System.out.println(<span class="string">&quot;obj4 的类名: &quot;</span> + ObjectUtils.getClassName(obj4)); <span class="comment">// &quot;null&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="集合工具类"><a href="#集合工具类" class="headerlink" title="集合工具类"></a>集合工具类</h2><h3 id="1-CollectionUtils"><a href="#1-CollectionUtils" class="headerlink" title="1. CollectionUtils"></a>1. CollectionUtils</h3><p><strong>应用场景</strong>：集合的判空、操作、转换等</p><p><strong>示例代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.CollectionUtils;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CollectionUtilsDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 判空操作</span></span><br><span class="line">        List&lt;String&gt; list1 = <span class="literal">null</span>;</span><br><span class="line">        List&lt;String&gt; list2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;String&gt; list3 = List.of(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;list1 是否为空: &quot;</span> + CollectionUtils.isEmpty(list1)); <span class="comment">// true</span></span><br><span class="line">        System.out.println(<span class="string">&quot;list2 是否为空: &quot;</span> + CollectionUtils.isEmpty(list2)); <span class="comment">// true</span></span><br><span class="line">        System.out.println(<span class="string">&quot;list3 是否为空: &quot;</span> + CollectionUtils.isEmpty(list3)); <span class="comment">// false</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 合并集合</span></span><br><span class="line">        List&lt;String&gt; list4 = List.of(<span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>, <span class="string">&quot;f&quot;</span>);</span><br><span class="line">        List&lt;String&gt; mergedList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list3);</span><br><span class="line">        CollectionUtils.mergeArrayIntoCollection(list4.toArray(), mergedList);</span><br><span class="line">        System.out.println(<span class="string">&quot;合并后的集合: &quot;</span> + mergedList); <span class="comment">// [a, b, c, d, e, f]</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查集合是否包含指定元素</span></span><br><span class="line">        System.out.println(<span class="string">&quot;list3 是否包含a: &quot;</span> + CollectionUtils.contains(list3.iterator(), <span class="string">&quot;a&quot;</span>)); <span class="comment">// true</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Map 操作</span></span><br><span class="line">        Map&lt;String, String&gt; map1 = <span class="literal">null</span>;</span><br><span class="line">        Map&lt;String, String&gt; map2 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Map&lt;String, String&gt; map3 = Map.of(<span class="string">&quot;key1&quot;</span>, <span class="string">&quot;value1&quot;</span>, <span class="string">&quot;key2&quot;</span>, <span class="string">&quot;value2&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;map1 是否为空: &quot;</span> + CollectionUtils.isEmpty(map1)); <span class="comment">// true</span></span><br><span class="line">        System.out.println(<span class="string">&quot;map2 是否为空: &quot;</span> + CollectionUtils.isEmpty(map2)); <span class="comment">// true</span></span><br><span class="line">        System.out.println(<span class="string">&quot;map3 是否为空: &quot;</span> + CollectionUtils.isEmpty(map3)); <span class="comment">// false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-ArrayUtils"><a href="#2-ArrayUtils" class="headerlink" title="2. ArrayUtils"></a>2. ArrayUtils</h3><p><strong>应用场景</strong>：数组的判空、操作、转换等</p><p><strong>示例代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.ArrayUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayUtilsDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 判空操作</span></span><br><span class="line">        String[] arr1 = <span class="literal">null</span>;</span><br><span class="line">        String[] arr2 = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>];</span><br><span class="line">        String[] arr3 = &#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>&#125;;</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;arr1 是否为空: &quot;</span> + ArrayUtils.isEmpty(arr1)); <span class="comment">// true</span></span><br><span class="line">        System.out.println(<span class="string">&quot;arr2 是否为空: &quot;</span> + ArrayUtils.isEmpty(arr2)); <span class="comment">// true</span></span><br><span class="line">        System.out.println(<span class="string">&quot;arr3 是否为空: &quot;</span> + ArrayUtils.isEmpty(arr3)); <span class="comment">// false</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 合并数组</span></span><br><span class="line">        String[] arr4 = &#123;<span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>, <span class="string">&quot;f&quot;</span>&#125;;</span><br><span class="line">        String[] mergedArray = ArrayUtils.addAll(arr3, arr4);</span><br><span class="line">        System.out.println(<span class="string">&quot;合并后的数组: &quot;</span> + Arrays.toString(mergedArray)); <span class="comment">// [a, b, c, d, e, f]</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 查找元素索引</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> ArrayUtils.indexOf(arr3, <span class="string">&quot;b&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;b 的索引: &quot;</span> + index); <span class="comment">// 1</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查数组是否包含指定元素</span></span><br><span class="line">        System.out.println(<span class="string">&quot;arr3 是否包含c: &quot;</span> + ArrayUtils.contains(arr3, <span class="string">&quot;c&quot;</span>)); <span class="comment">// true</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 数组转列表</span></span><br><span class="line">        List&lt;String&gt; list = Arrays.asList(arr3);</span><br><span class="line">        System.out.println(<span class="string">&quot;数组转列表: &quot;</span> + list); <span class="comment">// [a, b, c]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="时间日期工具类"><a href="#时间日期工具类" class="headerlink" title="时间日期工具类"></a>时间日期工具类</h2><h3 id="1-DateTimeUtils"><a href="#1-DateTimeUtils" class="headerlink" title="1. DateTimeUtils"></a>1. DateTimeUtils</h3><p><strong>应用场景</strong>：日期时间的格式化、解析、计算等</p><p><strong>示例代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.DateTimeUtils;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DateTimeUtilsDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 日期转字符串</span></span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">dateStr</span> <span class="operator">=</span> DateTimeUtils.formatDateTime(date);</span><br><span class="line">        System.out.println(<span class="string">&quot;日期转字符串: &quot;</span> + dateStr); <span class="comment">// 格式: yyyy-MM-dd HH:mm:ss</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 时间戳转日期</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">timestamp</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">Date</span> <span class="variable">dateFromTimestamp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(timestamp);</span><br><span class="line">        System.out.println(<span class="string">&quot;时间戳转日期: &quot;</span> + DateTimeUtils.formatDateTime(dateFromTimestamp));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Java 8 时间API示例</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">        <span class="type">DateTimeFormatter</span> <span class="variable">formatter</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">formattedNow</span> <span class="operator">=</span> now.format(formatter);</span><br><span class="line">        System.out.println(<span class="string">&quot;LocalDateTime 格式化: &quot;</span> + formattedNow);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 解析字符串为 LocalDateTime</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">dateTimeStr</span> <span class="operator">=</span> <span class="string">&quot;2023-12-25 10:30:00&quot;</span>;</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">parsedDateTime</span> <span class="operator">=</span> LocalDateTime.parse(dateTimeStr, formatter);</span><br><span class="line">        System.out.println(<span class="string">&quot;解析后的 LocalDateTime: &quot;</span> + parsedDateTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-StopWatch"><a href="#2-StopWatch" class="headerlink" title="2. StopWatch"></a>2. StopWatch</h3><p><strong>应用场景</strong>：性能测试、代码执行时间统计</p><p><strong>示例代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.StopWatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StopWatchDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">StopWatch</span> <span class="variable">stopWatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>(<span class="string">&quot;测试代码执行时间&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 任务1</span></span><br><span class="line">        stopWatch.start(<span class="string">&quot;任务1&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        stopWatch.stop();</span><br><span class="line">        System.out.println(<span class="string">&quot;任务1 执行时间: &quot;</span> + stopWatch.getLastTaskTimeMillis() + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 任务2</span></span><br><span class="line">        stopWatch.start(<span class="string">&quot;任务2&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">1500</span>);</span><br><span class="line">        stopWatch.stop();</span><br><span class="line">        System.out.println(<span class="string">&quot;任务2 执行时间: &quot;</span> + stopWatch.getLastTaskTimeMillis() + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 任务3</span></span><br><span class="line">        stopWatch.start(<span class="string">&quot;任务3&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        stopWatch.stop();</span><br><span class="line">        System.out.println(<span class="string">&quot;任务3 执行时间: &quot;</span> + stopWatch.getLastTaskTimeMillis() + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 总执行时间</span></span><br><span class="line">        System.out.println(<span class="string">&quot;总执行时间: &quot;</span> + stopWatch.getTotalTimeMillis() + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 打印详细信息</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n详细信息:&quot;</span>);</span><br><span class="line">        System.out.println(stopWatch.prettyPrint());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="反射工具类"><a href="#反射工具类" class="headerlink" title="反射工具类"></a>反射工具类</h2><h3 id="1-ReflectionUtils"><a href="#1-ReflectionUtils" class="headerlink" title="1. ReflectionUtils"></a>1. ReflectionUtils</h3><p><strong>应用场景</strong>：反射操作，如获取方法、字段、调用方法等</p><p><strong>示例代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.ReflectionUtils;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectionUtilsDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取类的方法</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectionUtils.findMethod(Person.class, <span class="string">&quot;getName&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;找到的方法: &quot;</span> + method.getName());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取类的字段</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> ReflectionUtils.findField(Person.class, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;找到的字段: &quot;</span> + field.getName());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建实例</span></span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">25</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 调用方法</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) ReflectionUtils.invokeMethod(method, person);</span><br><span class="line">        System.out.println(<span class="string">&quot;调用方法结果: &quot;</span> + name);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置字段值</span></span><br><span class="line">        ReflectionUtils.setField(field, person, <span class="string">&quot;李四&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;设置字段后的值: &quot;</span> + person.getName());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取字段值</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">ageField</span> <span class="operator">=</span> ReflectionUtils.findField(Person.class, <span class="string">&quot;age&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">age</span> <span class="operator">=</span> (Integer) ReflectionUtils.getField(ageField, person);</span><br><span class="line">        System.out.println(<span class="string">&quot;获取字段值: &quot;</span> + age);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> Integer age;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, Integer age)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> Integer <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> age;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(Integer age)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Web-相关工具类"><a href="#Web-相关工具类" class="headerlink" title="Web 相关工具类"></a>Web 相关工具类</h2><h3 id="1-WebUtils"><a href="#1-WebUtils" class="headerlink" title="1. WebUtils"></a>1. WebUtils</h3><p><strong>应用场景</strong>：Web 应用中的请求、响应处理</p><p><strong>示例代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.util.WebUtils;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebUtilsDemo</span> &#123;</span><br><span class="line">    <span class="comment">// 在控制器中使用</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 获取会话属性</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> WebUtils.getSessionAttribute(request, <span class="string">&quot;user&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;会话中的用户: &quot;</span> + user);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置会话属性</span></span><br><span class="line">        WebUtils.setSessionAttribute(request, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;新用户&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 移除会话属性</span></span><br><span class="line">        WebUtils.removeSessionAttribute(request, <span class="string">&quot;oldUser&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取请求参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> WebUtils.findParameterValue(request, <span class="string">&quot;id&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;请求参数id: &quot;</span> + id);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查请求是否为ajax请求</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isAjax</span> <span class="operator">=</span> WebUtils.isAjaxRequest(request);</span><br><span class="line">        System.out.println(<span class="string">&quot;是否为ajax请求: &quot;</span> + isAjax);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查请求是否为multipart请求</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isMultipart</span> <span class="operator">=</span> WebUtils.isMultipartRequest(request);</span><br><span class="line">        System.out.println(<span class="string">&quot;是否为multipart请求: &quot;</span> + isMultipart);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-UriComponentsBuilder"><a href="#2-UriComponentsBuilder" class="headerlink" title="2. UriComponentsBuilder"></a>2. UriComponentsBuilder</h3><p><strong>应用场景</strong>：URL 的构建、解析、编码等</p><p><strong>示例代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.util.UriComponentsBuilder;</span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UriComponentsBuilderDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 构建URL</span></span><br><span class="line">        <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> UriComponentsBuilder</span><br><span class="line">            .fromHttpUrl(<span class="string">&quot;http://example.com/api&quot;</span>)</span><br><span class="line">            .path(<span class="string">&quot;/users&quot;</span>)</span><br><span class="line">            .queryParam(<span class="string">&quot;page&quot;</span>, <span class="number">1</span>)</span><br><span class="line">            .queryParam(<span class="string">&quot;size&quot;</span>, <span class="number">10</span>)</span><br><span class="line">            .queryParam(<span class="string">&quot;sort&quot;</span>, <span class="string">&quot;name,asc&quot;</span>)</span><br><span class="line">            .build()</span><br><span class="line">            .toUri();</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;构建的URL: &quot;</span> + uri); <span class="comment">// http://example.com/api/users?page=1&amp;size=10&amp;sort=name,asc</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 解析URL</span></span><br><span class="line">        <span class="type">UriComponentsBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> UriComponentsBuilder.fromHttpUrl(<span class="string">&quot;http://example.com/api/users?id=123&amp;name=test&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;主机: &quot;</span> + builder.build().getHost()); <span class="comment">// example.com</span></span><br><span class="line">        System.out.println(<span class="string">&quot;路径: &quot;</span> + builder.build().getPath()); <span class="comment">// /api/users</span></span><br><span class="line">        System.out.println(<span class="string">&quot;查询参数: &quot;</span> + builder.build().getQuery()); <span class="comment">// id=123&amp;name=test</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-HtmlUtils"><a href="#3-HtmlUtils" class="headerlink" title="3. HtmlUtils"></a>3. HtmlUtils</h3><p><strong>应用场景</strong>：HTML 的转义、unescape 等</p><p><strong>示例代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.util.HtmlUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HtmlUtilsDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// HTML 转义</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">html</span> <span class="operator">=</span> <span class="string">&quot;&lt;div&gt;Hello World&lt;/div&gt;&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">escapedHtml</span> <span class="operator">=</span> HtmlUtils.htmlEscape(html);</span><br><span class="line">        System.out.println(<span class="string">&quot;转义后的HTML: &quot;</span> + escapedHtml); <span class="comment">// &amp;lt;div&amp;gt;Hello World&amp;lt;/div&amp;gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// HTML unescape</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">unescapedHtml</span> <span class="operator">=</span> HtmlUtils.htmlUnescape(escapedHtml);</span><br><span class="line">        System.out.println(<span class="string">&quot;unescape后的HTML: &quot;</span> + unescapedHtml); <span class="comment">// &lt;div&gt;Hello World&lt;/div&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// JavaScript 转义</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">js</span> <span class="operator">=</span> <span class="string">&quot;alert(&#x27;Hello World&#x27;);&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">escapedJs</span> <span class="operator">=</span> HtmlUtils.javaScriptEscape(js);</span><br><span class="line">        System.out.println(<span class="string">&quot;转义后的JavaScript: &quot;</span> + escapedJs); <span class="comment">// alert(&#x27;Hello World&#x27;);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="其他常用工具类"><a href="#其他常用工具类" class="headerlink" title="其他常用工具类"></a>其他常用工具类</h2><h3 id="1-ClassUtils"><a href="#1-ClassUtils" class="headerlink" title="1. ClassUtils"></a>1. ClassUtils</h3><p><strong>应用场景</strong>：类的加载、检查、操作等</p><p><strong>示例代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.ClassUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassUtilsDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 加载类</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; clazz = ClassUtils.forName(<span class="string">&quot;java.lang.String&quot;</span>, ClassUtils.getDefaultClassLoader());</span><br><span class="line">            System.out.println(<span class="string">&quot;加载的类: &quot;</span> + clazz.getName());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查类是否存在</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> ClassUtils.isPresent(<span class="string">&quot;java.lang.String&quot;</span>, ClassUtils.getDefaultClassLoader());</span><br><span class="line">        System.out.println(<span class="string">&quot;String类是否存在: &quot;</span> + exists); <span class="comment">// true</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取类的包名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">packageName</span> <span class="operator">=</span> ClassUtils.getPackageName(String.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;String类的包名: &quot;</span> + packageName); <span class="comment">// java.lang</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取简单类名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">simpleName</span> <span class="operator">=</span> ClassUtils.getShortName(String.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;String类的简单名称: &quot;</span> + simpleName); <span class="comment">// String</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查类是否为内部类</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isInnerClass</span> <span class="operator">=</span> ClassUtils.isInnerClass(ClassUtilsDemo.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;是否为内部类: &quot;</span> + isInnerClass); <span class="comment">// false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-FileCopyUtils"><a href="#2-FileCopyUtils" class="headerlink" title="2. FileCopyUtils"></a>2. FileCopyUtils</h3><p><strong>应用场景</strong>：文件的复制、读取、写入等</p><p><strong>示例代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.FileCopyUtils;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileCopyUtilsDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 复制文件</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;source.txt&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">dest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;dest.txt&quot;</span>);</span><br><span class="line">        FileCopyUtils.copy(source, dest);</span><br><span class="line">        System.out.println(<span class="string">&quot;文件复制完成&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 读取文件内容</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = FileCopyUtils.copyToByteArray(source);</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(bytes);</span><br><span class="line">        System.out.println(<span class="string">&quot;文件内容: &quot;</span> + content);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入文件</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">newContent</span> <span class="operator">=</span> <span class="string">&quot;Hello Spring Boot&quot;</span>;</span><br><span class="line">        FileCopyUtils.copy(newContent.getBytes(), dest);</span><br><span class="line">        System.out.println(<span class="string">&quot;文件写入完成&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 从输入流复制到输出流</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(source);</span><br><span class="line">             <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;copy.txt&quot;</span>)) &#123;</span><br><span class="line">            FileCopyUtils.copy(is, os);</span><br><span class="line">            System.out.println(<span class="string">&quot;流复制完成&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-Base64Utils"><a href="#3-Base64Utils" class="headerlink" title="3. Base64Utils"></a>3. Base64Utils</h3><p><strong>应用场景</strong>：Base64 编码和解码</p><p><strong>示例代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.Base64Utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Base64UtilsDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 编码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">original</span> <span class="operator">=</span> <span class="string">&quot;Hello Spring Boot&quot;</span>;</span><br><span class="line">        <span class="type">byte</span>[] encodedBytes = Base64Utils.encode(original.getBytes());</span><br><span class="line">        <span class="type">String</span> <span class="variable">encodedString</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(encodedBytes);</span><br><span class="line">        System.out.println(<span class="string">&quot;Base64编码结果: &quot;</span> + encodedString);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 解码</span></span><br><span class="line">        <span class="type">byte</span>[] decodedBytes = Base64Utils.decode(encodedBytes);</span><br><span class="line">        <span class="type">String</span> <span class="variable">decodedString</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(decodedBytes);</span><br><span class="line">        System.out.println(<span class="string">&quot;Base64解码结果: &quot;</span> + decodedString);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// URL安全的编码</span></span><br><span class="line">        <span class="type">byte</span>[] urlEncodedBytes = Base64Utils.encodeUrlSafe(original.getBytes());</span><br><span class="line">        <span class="type">String</span> <span class="variable">urlEncodedString</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(urlEncodedBytes);</span><br><span class="line">        System.out.println(<span class="string">&quot;URL安全的Base64编码结果: &quot;</span> + urlEncodedString);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// URL安全的解码</span></span><br><span class="line">        <span class="type">byte</span>[] urlDecodedBytes = Base64Utils.decodeUrlSafe(urlEncodedBytes);</span><br><span class="line">        <span class="type">String</span> <span class="variable">urlDecodedString</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(urlDecodedBytes);</span><br><span class="line">        System.out.println(<span class="string">&quot;URL安全的Base64解码结果: &quot;</span> + urlDecodedString);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="冷门但有用的工具类"><a href="#冷门但有用的工具类" class="headerlink" title="冷门但有用的工具类"></a>冷门但有用的工具类</h2><h3 id="1-DigestUtils"><a href="#1-DigestUtils" class="headerlink" title="1. DigestUtils"></a>1. DigestUtils</h3><p><strong>应用场景</strong>：消息摘要计算（MD5、SHA 等）</p><p><strong>示例代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.DigestUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DigestUtilsDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 计算MD5摘要</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">original</span> <span class="operator">=</span> <span class="string">&quot;Hello Spring Boot&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">md5</span> <span class="operator">=</span> DigestUtils.md5DigestAsHex(original.getBytes());</span><br><span class="line">        System.out.println(<span class="string">&quot;MD5摘要: &quot;</span> + md5);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 计算SHA-256摘要</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sha256</span> <span class="operator">=</span> DigestUtils.sha256AsHex(original.getBytes());</span><br><span class="line">        System.out.println(<span class="string">&quot;SHA-256摘要: &quot;</span> + sha256);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-SystemPropertyUtils"><a href="#2-SystemPropertyUtils" class="headerlink" title="2. SystemPropertyUtils"></a>2. SystemPropertyUtils</h3><p><strong>应用场景</strong>：系统属性的解析和替换</p><p><strong>示例代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.SystemPropertyUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemPropertyUtilsDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 解析包含系统属性的字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> SystemPropertyUtils.resolvePlaceholders(<span class="string">&quot;$&#123;user.home&#125;/springboot&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;解析后的路径: &quot;</span> + path);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 解析时忽略未定义的属性</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">config</span> <span class="operator">=</span> SystemPropertyUtils.resolvePlaceholders(<span class="string">&quot;$&#123;app.home:default&#125;/config&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;解析后的配置路径: &quot;</span> + config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-Assert"><a href="#3-Assert" class="headerlink" title="3. Assert"></a>3. Assert</h3><p><strong>应用场景</strong>：断言检查，用于参数验证等</p><p><strong>示例代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.Assert;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AssertDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processUser</span><span class="params">(String userId, String name)</span> &#123;</span><br><span class="line">        <span class="comment">// 断言userId不为空</span></span><br><span class="line">        Assert.notNull(userId, <span class="string">&quot;用户ID不能为空&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 断言name不为空字符串</span></span><br><span class="line">        Assert.hasText(name, <span class="string">&quot;用户名不能为空&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 断言userId长度大于0</span></span><br><span class="line">        Assert.isTrue(userId.length() &gt; <span class="number">0</span>, <span class="string">&quot;用户ID长度必须大于0&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 断言name长度在合理范围内</span></span><br><span class="line">        Assert.isTrue(name.length() &gt;= <span class="number">2</span> &amp;&amp; name.length() &lt;= <span class="number">20</span>, <span class="string">&quot;用户名长度必须在2-20之间&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;处理用户: &quot;</span> + userId + <span class="string">&quot;, &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AssertDemo</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AssertDemo</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            demo.processUser(<span class="string">&quot;123&quot;</span>, <span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;断言失败: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-RandomValueStringGenerator"><a href="#4-RandomValueStringGenerator" class="headerlink" title="4. RandomValueStringGenerator"></a>4. RandomValueStringGenerator</h3><p><strong>应用场景</strong>：生成随机字符串，用于令牌、密码等</p><p><strong>示例代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.RandomValueStringGenerator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RandomValueStringGeneratorDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建默认生成器（长度为32，使用字母和数字）</span></span><br><span class="line">        <span class="type">RandomValueStringGenerator</span> <span class="variable">generator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomValueStringGenerator</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">random1</span> <span class="operator">=</span> generator.generate();</span><br><span class="line">        System.out.println(<span class="string">&quot;默认随机字符串: &quot;</span> + random1);</span><br><span class="line">        System.out.println(<span class="string">&quot;长度: &quot;</span> + random1.length()); <span class="comment">// 32</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建指定长度的生成器</span></span><br><span class="line">        <span class="type">RandomValueStringGenerator</span> <span class="variable">generator2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomValueStringGenerator</span>(<span class="number">16</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">random2</span> <span class="operator">=</span> generator2.generate();</span><br><span class="line">        System.out.println(<span class="string">&quot;16位随机字符串: &quot;</span> + random2);</span><br><span class="line">        System.out.println(<span class="string">&quot;长度: &quot;</span> + random2.length()); <span class="comment">// 16</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 生成多个随机字符串</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;随机字符串&quot;</span> + (i+<span class="number">1</span>) + <span class="string">&quot;: &quot;</span> + generator.generate());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Spring Boot 3 提供了丰富的内置工具类，这些工具类可以大大简化开发工作，提高代码质量和开发效率。本文介绍了一些常用且高效的工具类，包括：</p><ol><li><strong>字符串工具类</strong>：<code>StringUtils</code>、<code>ObjectUtils</code></li><li><strong>集合工具类</strong>：<code>CollectionUtils</code>、<code>ArrayUtils</code></li><li><strong>时间日期工具类</strong>：<code>DateTimeUtils</code>、<code>StopWatch</code></li><li><strong>反射工具类</strong>：<code>ReflectionUtils</code></li><li><strong>Web 相关工具类</strong>：<code>WebUtils</code>、<code>UriComponentsBuilder</code>、<code>HtmlUtils</code></li><li><strong>其他工具类</strong>：<code>ClassUtils</code>、<code>FileCopyUtils</code>、<code>Base64Utils</code></li><li><strong>冷门但有用的工具类</strong>：<code>DigestUtils</code>、<code>SystemPropertyUtils</code>、<code>Assert</code>、<code>RandomValueStringGenerator</code></li></ol><p>这些工具类涵盖了开发中的各个方面，从基本的字符串操作到复杂的 Web 开发，都能找到相应的工具类来简化操作。在实际开发中，我们应该充分利用这些工具类，避免重复造轮子，提高开发效率和代码质量。</p><p>当然，Spring Boot 中还有许多其他的工具类，本文只是介绍了其中的一部分。在使用这些工具类时，我们应该查阅官方文档，了解它们的详细用法和注意事项，以便更好地应用到实际项目中。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
            <tag> 工具类 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unity--Vector类</title>
      <link href="/2026/01/30/Unity-Vector%E7%B1%BB/"/>
      <url>/2026/01/30/Unity-Vector%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<p>在Unity中，Vector类是一系列用于表示和操作向量的结构体，是游戏开发中不可或缺的数学工具。Vector类包括Vector2（二维向量）、Vector3（三维向量）和Vector4（四维向量），它们用于处理位置、方向、速度、力等概念。本文将详细介绍Vector类的各个类型、属性、方法、使用场景，并提供丰富的示例代码。</p><h2 id="Vector-类概述"><a href="#Vector-类概述" class="headerlink" title="Vector 类概述"></a>Vector 类概述</h2><p>Vector类是Unity数学库的核心部分，用于表示多维空间中的点或方向。它们是值类型（struct），具有高效的性能。Vector类支持向量运算，如加法、减法、点积、叉积等。</p><ul><li><strong>Vector2</strong>：表示二维向量，常用于2D游戏、UI坐标、纹理坐标等。</li><li><strong>Vector3</strong>：表示三维向量，最常用，用于3D空间中的位置、方向、速度等。</li><li><strong>Vector4</strong>：表示四维向量，常用于齐次坐标、颜色（RGBA）、矩阵运算等。</li></ul><h2 id="Vector2-类详解"><a href="#Vector2-类详解" class="headerlink" title="Vector2 类详解"></a>Vector2 类详解</h2><p>Vector2用于二维空间，包含x和y两个分量。</p><h3 id="Vector2-的属性"><a href="#Vector2-的属性" class="headerlink" title="Vector2 的属性"></a>Vector2 的属性</h3><ul><li><code>x, y</code>：向量的分量。</li><li><code>magnitude</code>：向量长度（模）。</li><li><code>normalized</code>：单位向量。</li><li><code>sqrMagnitude</code>：向量长度的平方（计算更快）。</li></ul><h3 id="Vector2-的常用方法"><a href="#Vector2-的常用方法" class="headerlink" title="Vector2 的常用方法"></a>Vector2 的常用方法</h3><ul><li><code>Vector2.Distance(a, b)</code>：两点距离。</li><li><code>Vector2.Angle(a, b)</code>：两向量夹角。</li><li><code>Vector2.Dot(a, b)</code>：点积。</li><li><code>Normalize()</code>：归一化向量。</li></ul><h3 id="Vector2-的使用场景"><a href="#Vector2-的使用场景" class="headerlink" title="Vector2 的使用场景"></a>Vector2 的使用场景</h3><p>Vector2主要用于2D游戏开发、UI布局、纹理映射等。</p><h4 id="示例：计算两点距离"><a href="#示例：计算两点距离" class="headerlink" title="示例：计算两点距离"></a>示例：计算两点距离</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Vector2Example</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Vector2 pointA = <span class="keyword">new</span> Vector2(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">public</span> Vector2 pointB = <span class="keyword">new</span> Vector2(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">float</span> distance = Vector2.Distance(pointA, pointB);</span><br><span class="line">        Debug.Log(<span class="string">&quot;Distance: &quot;</span> + distance); <span class="comment">// 输出: 5</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="示例：向量归一化"><a href="#示例：向量归一化" class="headerlink" title="示例：向量归一化"></a>示例：向量归一化</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Vector2Normalize</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Vector2 vec = <span class="keyword">new</span> Vector2(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">        Vector2 normalized = vec.normalized;</span><br><span class="line">        Debug.Log(<span class="string">&quot;Original: &quot;</span> + vec + <span class="string">&quot;, Normalized: &quot;</span> + normalized);</span><br><span class="line">        <span class="comment">// 输出: Original: (3.0, 4.0), Normalized: (0.6, 0.8)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="示例：2D移动"><a href="#示例：2D移动" class="headerlink" title="示例：2D移动"></a>示例：2D移动</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Move2D</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> speed = <span class="number">5f</span>;</span><br><span class="line">    <span class="keyword">private</span> Vector2 position;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        position = transform.position; <span class="comment">// 注意：Transform是Vector3，这里简化</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Vector2 input = <span class="keyword">new</span> Vector2(Input.GetAxis(<span class="string">&quot;Horizontal&quot;</span>), Input.GetAxis(<span class="string">&quot;Vertical&quot;</span>));</span><br><span class="line">        position += input * speed * Time.deltaTime;</span><br><span class="line">        <span class="comment">// 在2D游戏中更新位置</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Vector3-类详解"><a href="#Vector3-类详解" class="headerlink" title="Vector3 类详解"></a>Vector3 类详解</h2><p>Vector3是Unity中最常用的向量类，用于三维空间。</p><h3 id="Vector3-的属性"><a href="#Vector3-的属性" class="headerlink" title="Vector3 的属性"></a>Vector3 的属性</h3><ul><li><code>x, y, z</code>：向量的分量。</li><li><code>magnitude, normalized, sqrMagnitude</code>：同Vector2。</li><li>静态属性：<code>Vector3.zero</code>（零向量）、<code>Vector3.one</code>（全1向量）、<code>Vector3.up</code>（上方向）、<code>Vector3.right</code>（右方向）、<code>Vector3.forward</code>（前方向）。</li></ul><h3 id="Vector3-的常用方法"><a href="#Vector3-的常用方法" class="headerlink" title="Vector3 的常用方法"></a>Vector3 的常用方法</h3><ul><li><code>Vector3.Distance(a, b)</code>：距离。</li><li><code>Vector3.Angle(a, b)</code>：夹角。</li><li><code>Vector3.Dot(a, b)</code>：点积。</li><li><code>Vector3.Cross(a, b)</code>：叉积（结果是垂直于两向量的向量）。</li><li><code>Vector3.Lerp(a, b, t)</code>：线性插值。</li><li><code>Vector3.MoveTowards(current, target, maxDistance)</code>：朝目标移动。</li></ul><h3 id="Vector3-的使用场景"><a href="#Vector3-的使用场景" class="headerlink" title="Vector3 的使用场景"></a>Vector3 的使用场景</h3><p>Vector3广泛用于3D游戏的位置、旋转、物理模拟等。</p><h4 id="示例：对象移动"><a href="#示例：对象移动" class="headerlink" title="示例：对象移动"></a>示例：对象移动</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MoveObject</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> speed = <span class="number">5f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 向右移动</span></span><br><span class="line">        transform.position += Vector3.right * speed * Time.deltaTime;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="示例：计算方向和距离"><a href="#示例：计算方向和距离" class="headerlink" title="示例：计算方向和距离"></a>示例：计算方向和距离</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DirectionExample</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Transform target;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (target != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Vector3 direction = target.position - transform.position;</span><br><span class="line">            <span class="built_in">float</span> distance = direction.magnitude;</span><br><span class="line">            Vector3 normalizedDirection = direction.normalized;</span><br><span class="line">            </span><br><span class="line">            Debug.Log(<span class="string">&quot;Distance: &quot;</span> + distance + <span class="string">&quot;, Direction: &quot;</span> + normalizedDirection);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="示例：使用叉积计算垂直向量"><a href="#示例：使用叉积计算垂直向量" class="headerlink" title="示例：使用叉积计算垂直向量"></a>示例：使用叉积计算垂直向量</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CrossProductExample</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Vector3 a = Vector3.up;</span><br><span class="line">        Vector3 b = Vector3.right;</span><br><span class="line">        Vector3 cross = Vector3.Cross(a, b);</span><br><span class="line">        Debug.Log(<span class="string">&quot;Cross product: &quot;</span> + cross); <span class="comment">// 输出: (0, 0, 1) 前方向</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="示例：线性插值移动"><a href="#示例：线性插值移动" class="headerlink" title="示例：线性插值移动"></a>示例：线性插值移动</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LerpExample</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Vector3 startPosition = Vector3.zero;</span><br><span class="line">    <span class="keyword">public</span> Vector3 endPosition = <span class="keyword">new</span> Vector3(<span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> duration = <span class="number">2f</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">float</span> timeElapsed = <span class="number">0f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        timeElapsed += Time.deltaTime;</span><br><span class="line">        <span class="built_in">float</span> t = Mathf.Clamp01(timeElapsed / duration);</span><br><span class="line">        transform.position = Vector3.Lerp(startPosition, endPosition, t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="示例：物理速度"><a href="#示例：物理速度" class="headerlink" title="示例：物理速度"></a>示例：物理速度</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PhysicsVelocity</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Rigidbody rb;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        rb = GetComponent&lt;Rigidbody&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">FixedUpdate</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Vector3 force = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>); <span class="comment">// 向上力</span></span><br><span class="line">        rb.AddForce(force);</span><br><span class="line">        </span><br><span class="line">        Debug.Log(<span class="string">&quot;Velocity: &quot;</span> + rb.velocity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Vector4-类详解"><a href="#Vector4-类详解" class="headerlink" title="Vector4 类详解"></a>Vector4 类详解</h2><p>Vector4用于四维空间，常用于齐次坐标、颜色表示等。</p><h3 id="Vector4-的属性"><a href="#Vector4-的属性" class="headerlink" title="Vector4 的属性"></a>Vector4 的属性</h3><ul><li><code>x, y, z, w</code>：四个分量。</li><li><code>magnitude, normalized, sqrMagnitude</code>：同上。</li></ul><h3 id="Vector4-的常用方法"><a href="#Vector4-的常用方法" class="headerlink" title="Vector4 的常用方法"></a>Vector4 的常用方法</h3><ul><li>基本运算同Vector2&#x2F;Vector3。</li><li>常用于矩阵变换。</li></ul><h3 id="Vector4-的使用场景"><a href="#Vector4-的使用场景" class="headerlink" title="Vector4 的使用场景"></a>Vector4 的使用场景</h3><p>Vector4用于高级数学运算，如透视投影、颜色（RGBA）、四元数扩展等。</p><h4 id="示例：颜色表示"><a href="#示例：颜色表示" class="headerlink" title="示例：颜色表示"></a>示例：颜色表示</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ColorVector4</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// RGBA颜色</span></span><br><span class="line">        Vector4 color = <span class="keyword">new</span> Vector4(<span class="number">1f</span>, <span class="number">0.5f</span>, <span class="number">0f</span>, <span class="number">1f</span>); <span class="comment">// 橙色，不透明</span></span><br><span class="line">        Debug.Log(<span class="string">&quot;Color: &quot;</span> + color);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="示例：齐次坐标"><a href="#示例：齐次坐标" class="headerlink" title="示例：齐次坐标"></a>示例：齐次坐标</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HomogeneousCoordinates</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 3D点转换为齐次坐标</span></span><br><span class="line">        Vector3 point3D = <span class="keyword">new</span> Vector3(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">        Vector4 homogeneous = <span class="keyword">new</span> Vector4(point3D.x, point3D.y, point3D.z, <span class="number">1f</span>);</span><br><span class="line">        Debug.Log(<span class="string">&quot;Homogeneous: &quot;</span> + homogeneous);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="向量运算详解"><a href="#向量运算详解" class="headerlink" title="向量运算详解"></a>向量运算详解</h2><h3 id="基本运算"><a href="#基本运算" class="headerlink" title="基本运算"></a>基本运算</h3><ul><li><strong>加法&#x2F;减法</strong>：<code>Vector3 result = a + b;</code></li><li><strong>标量乘法</strong>：<code>Vector3 result = vec * 2f;</code></li><li><strong>点积</strong>：<code>float dot = Vector3.Dot(a, b);</code> &#x2F;&#x2F; 用于判断方向相似性</li><li><strong>叉积</strong>：<code>Vector3 cross = Vector3.Cross(a, b);</code> &#x2F;&#x2F; 用于计算垂直向量</li></ul><h4 id="示例：向量运算"><a href="#示例：向量运算" class="headerlink" title="示例：向量运算"></a>示例：向量运算</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">VectorOperations</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Vector3 a = <span class="keyword">new</span> Vector3(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">        Vector3 b = <span class="keyword">new</span> Vector3(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">        </span><br><span class="line">        Vector3 sum = a + b; <span class="comment">// (5, 7, 9)</span></span><br><span class="line">        Vector3 scaled = a * <span class="number">2</span>; <span class="comment">// (2, 4, 6)</span></span><br><span class="line">        <span class="built_in">float</span> dot = Vector3.Dot(a, b); <span class="comment">// 1*4 + 2*5 + 3*6 = 32</span></span><br><span class="line">        Vector3 cross = Vector3.Cross(a, b); <span class="comment">// 计算叉积</span></span><br><span class="line">        </span><br><span class="line">        Debug.Log(<span class="string">&quot;Sum: &quot;</span> + sum + <span class="string">&quot;, Scaled: &quot;</span> + scaled + <span class="string">&quot;, Dot: &quot;</span> + dot + <span class="string">&quot;, Cross: &quot;</span> + cross);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="性能优化建议"><a href="#性能优化建议" class="headerlink" title="性能优化建议"></a>性能优化建议</h2><ul><li>Vector是值类型，传递时会复制；对于频繁使用，考虑使用ref或缓存。</li><li>使用sqrMagnitude代替magnitude进行比较（避免开方运算）。</li><li>在Update中避免创建新向量；使用静态方法或预计算。</li></ul><p>通过掌握Vector类，你可以高效处理Unity中的空间计算、物理模拟和动画效果，为游戏开发提供坚实的数学基础。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Unity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unity--Transform类</title>
      <link href="/2026/01/30/Unity-Transform%E7%B1%BB/"/>
      <url>/2026/01/30/Unity-Transform%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<p>在Unity3D中，<code>Transform</code> 类是游戏对象（GameObject）的一个核心组件，它负责管理对象的空间变换信息。几乎每个游戏对象都包含一个Transform组件，因为它定义了对象在3D空间中的位置、旋转和缩放。本文将详细介绍Transform类的作用、影响的属性、在脚本中的调用方式以及如何修改其字段，并提供示例代码。</p><h2 id="Transform-类的作用"><a href="#Transform-类的作用" class="headerlink" title="Transform 类的作用"></a>Transform 类的作用</h2><p>Transform类是Unity中用于表示和操作游戏对象空间属性的基础类。它允许开发者控制对象的：</p><ul><li><strong>位置（Position）</strong>：对象在世界坐标系中的坐标。</li><li><strong>旋转（Rotation）</strong>：对象的朝向，以欧拉角或四元数表示。</li><li><strong>缩放（Scale）</strong>：对象的尺寸变化。</li></ul><p>Transform不仅影响对象本身，还会影响其子对象，形成一个层次结构（Hierarchy）。父对象的变换会传递给子对象，这使得构建复杂的对象关系（如角色模型的骨骼系统）成为可能。此外，Transform还提供了一些实用方法，如移动、旋转和查找子对象等。</p><h2 id="Transform-能影响到对象的什么属性"><a href="#Transform-能影响到对象的什么属性" class="headerlink" title="Transform 能影响到对象的什么属性"></a>Transform 能影响到对象的什么属性</h2><p>Transform直接影响对象的以下属性：</p><ul><li><strong>位置（Position）</strong>：决定对象在场景中的坐标。修改位置会改变对象在世界空间中的位置。</li><li><strong>旋转（Rotation）</strong>：控制对象的朝向。旋转可以是局部（相对于父对象）或全局的。</li><li><strong>缩放（Scale）</strong>：改变对象的尺寸。缩放可以是非均匀的（X、Y、Z轴不同），但会影响子对象的继承。</li><li><strong>子对象继承</strong>：子对象的Transform会相对于父对象计算，这意味着移动父对象会带动所有子对象。</li><li><strong>渲染和物理</strong>：位置和旋转影响对象的渲染位置和碰撞检测；缩放影响模型的视觉大小和物理体积。</li></ul><p>需要注意的是，Transform的变化会触发Unity的渲染更新和物理模拟，因此频繁修改可能影响性能。</p><h2 id="在脚本中怎么调用Transform"><a href="#在脚本中怎么调用Transform" class="headerlink" title="在脚本中怎么调用Transform"></a>在脚本中怎么调用Transform</h2><p>在Unity脚本中，每个继承自<code>MonoBehaviour</code>的脚本都可以通过<code>transform</code>属性访问当前游戏对象的Transform组件。这个属性是自动提供的，无需手动获取。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ExampleScript</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取当前对象的Transform</span></span><br><span class="line">        Transform myTransform = transform;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 输出当前位置</span></span><br><span class="line">        Debug.Log(<span class="string">&quot;Position: &quot;</span> + myTransform.position);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果需要访问其他对象的Transform，可以通过<code>GetComponent&lt;Transform&gt;()</code>或直接引用：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> GameObject otherObject;</span><br><span class="line">Transform otherTransform = otherObject.transform;</span><br></pre></td></tr></table></figure><p>此外，还有其他方式获取指定对象的Transform：</p><h3 id="通过名称查找对象"><a href="#通过名称查找对象" class="headerlink" title="通过名称查找对象"></a>通过名称查找对象</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FindByName</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 通过名称查找GameObject，然后获取其Transform</span></span><br><span class="line">        GameObject targetObject = GameObject.Find(<span class="string">&quot;MyObjectName&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (targetObject != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Transform targetTransform = targetObject.transform;</span><br><span class="line">            Debug.Log(<span class="string">&quot;Found object position: &quot;</span> + targetTransform.position);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="通过标签查找对象"><a href="#通过标签查找对象" class="headerlink" title="通过标签查找对象"></a>通过标签查找对象</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FindByTag</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 通过标签查找GameObject，然后获取其Transform</span></span><br><span class="line">        GameObject targetObject = GameObject.FindWithTag(<span class="string">&quot;Player&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (targetObject != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Transform targetTransform = targetObject.transform;</span><br><span class="line">            Debug.Log(<span class="string">&quot;Player position: &quot;</span> + targetTransform.position);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="通过路径查找对象（在Hierarchy中）"><a href="#通过路径查找对象（在Hierarchy中）" class="headerlink" title="通过路径查找对象（在Hierarchy中）"></a>通过路径查找对象（在Hierarchy中）</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FindByPath</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 通过路径查找GameObject（相对于根对象）</span></span><br><span class="line">        Transform targetTransform = transform.Find(<span class="string">&quot;ChildObject/GrandChild&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (targetTransform != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">&quot;GrandChild position: &quot;</span> + targetTransform.position);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="通过GetComponent获取（如果对象有多个组件）"><a href="#通过GetComponent获取（如果对象有多个组件）" class="headerlink" title="通过GetComponent获取（如果对象有多个组件）"></a>通过GetComponent获取（如果对象有多个组件）</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GetComponentExample</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取当前对象的Transform组件（虽然通常不需要）</span></span><br><span class="line">        Transform myTransform = GetComponent&lt;Transform&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取其他组件的Transform（例如从Rigidbody获取）</span></span><br><span class="line">        Rigidbody rb = GetComponent&lt;Rigidbody&gt;();</span><br><span class="line">        <span class="keyword">if</span> (rb != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Transform rbTransform = rb.transform;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="通过Inspector拖拽引用（推荐方式）"><a href="#通过Inspector拖拽引用（推荐方式）" class="headerlink" title="通过Inspector拖拽引用（推荐方式）"></a>通过Inspector拖拽引用（推荐方式）</h3><p>在脚本中声明public变量，然后在Inspector中拖拽对象：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">InspectorReference</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Transform targetTransform; <span class="comment">// 在Inspector中拖拽赋值</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (targetTransform != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 使用引用的Transform</span></span><br><span class="line">            transform.position = targetTransform.position;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这些方法各有优缺点：Find方法简单但性能较低（尤其在Update中），Inspector引用高效且安全。建议在性能敏感场景使用引用方式。</p><h2 id="怎么修改Transform相应的字段"><a href="#怎么修改Transform相应的字段" class="headerlink" title="怎么修改Transform相应的字段"></a>怎么修改Transform相应的字段</h2><p>Transform的字段可以通过赋值来修改。主要的字段包括：</p><ul><li><code>position</code>：Vector3类型，表示位置。</li><li><code>rotation</code>：Quaternion类型，表示旋转（推荐使用四元数避免万向节锁）。</li><li><code>localPosition</code>、<code>localRotation</code>、<code>localScale</code>：相对于父对象的局部变换。</li><li><code>scale</code>：Vector3类型，表示缩放。</li></ul><p>修改时，可以直接赋值或使用方法。</p><h3 id="示例代码：修改位置"><a href="#示例代码：修改位置" class="headerlink" title="示例代码：修改位置"></a>示例代码：修改位置</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MoveObject</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 每帧向右移动对象</span></span><br><span class="line">        transform.position += Vector3.right * Time.deltaTime;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="示例代码：修改旋转"><a href="#示例代码：修改旋转" class="headerlink" title="示例代码：修改旋转"></a>示例代码：修改旋转</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RotateObject</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> speed = <span class="number">50f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 每帧绕Y轴旋转</span></span><br><span class="line">        transform.Rotate(Vector3.up, speed * Time.deltaTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="示例代码：修改缩放"><a href="#示例代码：修改缩放" class="headerlink" title="示例代码：修改缩放"></a>示例代码：修改缩放</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ScaleObject</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 将对象放大2倍</span></span><br><span class="line">        transform.localScale = <span class="keyword">new</span> Vector3(<span class="number">2f</span>, <span class="number">2f</span>, <span class="number">2f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="示例代码：使用方法移动和旋转"><a href="#示例代码：使用方法移动和旋转" class="headerlink" title="示例代码：使用方法移动和旋转"></a>示例代码：使用方法移动和旋转</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TransformMethods</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> moveSpeed = <span class="number">5f</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> rotateSpeed = <span class="number">100f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 使用Translate移动（相对于自身坐标）</span></span><br><span class="line">        <span class="keyword">if</span> (Input.GetKey(KeyCode.W))</span><br><span class="line">        &#123;</span><br><span class="line">            transform.Translate(Vector3.forward * moveSpeed * Time.deltaTime);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用Rotate旋转</span></span><br><span class="line">        <span class="keyword">if</span> (Input.GetKey(KeyCode.A))</span><br><span class="line">        &#123;</span><br><span class="line">            transform.Rotate(Vector3.up, -rotateSpeed * Time.deltaTime);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="示例代码：处理父子关系"><a href="#示例代码：处理父子关系" class="headerlink" title="示例代码：处理父子关系"></a>示例代码：处理父子关系</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ParentChildExample</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Transform childObject;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 设置子对象</span></span><br><span class="line">        childObject.SetParent(transform);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置局部位置</span></span><br><span class="line">        childObject.localPosition = <span class="keyword">new</span> Vector3(<span class="number">1f</span>, <span class="number">0f</span>, <span class="number">0f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ul><li><strong>性能优化</strong>：频繁修改Transform可能导致性能问题。考虑使用缓存或在FixedUpdate中处理物理相关变换。</li><li><strong>四元数 vs 欧拉角</strong>：对于旋转，推荐使用<code>Quaternion</code>而不是欧拉角，以避免万向节锁。</li><li><strong>局部 vs 全局</strong>：<code>localPosition</code>等是相对于父对象的，而<code>position</code>是世界坐标。</li><li><strong>变换顺序</strong>：缩放、旋转、位置的顺序很重要，Unity按缩放→旋转→位置的顺序应用变换。</li></ul><p>通过掌握Transform类，你可以灵活控制游戏对象的位置、朝向和大小，实现各种动态效果。希望本文对你理解Unity的Transform有所帮助！</p>]]></content>
      
      
      
        <tags>
            
            <tag> Unity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unity--MonoBehaviour生命周期</title>
      <link href="/2026/01/30/Unity-MonoBehaviour%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"/>
      <url>/2026/01/30/Unity-MonoBehaviour%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/</url>
      
        <content type="html"><![CDATA[<p>在Unity中，<code>MonoBehaviour</code> 是所有脚本组件的基类，它定义了一系列生命周期方法，这些方法在脚本的生命周期中按特定顺序自动调用。理解这些生命周期方法对于编写高效、正确的Unity脚本至关重要。本文将详细介绍MonoBehaviour的生命周期函数，包括每个函数的作用、触发时机以及相似函数之间的区别。</p><h2 id="MonoBehaviour-生命周期概述"><a href="#MonoBehaviour-生命周期概述" class="headerlink" title="MonoBehaviour 生命周期概述"></a>MonoBehaviour 生命周期概述</h2><p>MonoBehaviour的生命周期从脚本实例创建开始，到对象销毁结束。生命周期方法按以下顺序执行（某些方法可能在特定条件下不调用）：</p><ol><li><strong>Awake()</strong></li><li><strong>OnEnable()</strong></li><li><strong>Start()</strong></li><li><strong>FixedUpdate()</strong> (如果启用)</li><li><strong>Update()</strong> (如果启用)</li><li><strong>LateUpdate()</strong> (如果启用)</li><li><strong>OnDisable()</strong></li><li><strong>OnDestroy()</strong></li></ol><p>此外，还有一些其他方法如 <code>OnApplicationQuit()</code> 等，但本文重点介绍核心生命周期方法。</p><p><img src="https://img2024.cnblogs.com/blog/2511904/202410/2511904-20241018113815540-1986490574.png" alt="MonoBehaviour 生命周期顺序示意图"></p><h2 id="详细介绍每个生命周期函数"><a href="#详细介绍每个生命周期函数" class="headerlink" title="详细介绍每个生命周期函数"></a>详细介绍每个生命周期函数</h2><h3 id="1-Awake"><a href="#1-Awake" class="headerlink" title="1. Awake()"></a>1. Awake()</h3><p><strong>作用</strong>：<br>Awake() 方法用于初始化脚本。它在脚本实例被创建后立即调用，用于设置脚本的初始状态、获取组件引用或进行一次性初始化。</p><p><strong>触发时机</strong>：</p><ul><li>当脚本组件被添加到GameObject上时（在编辑器中或运行时）。</li><li>在所有脚本的Awake()方法执行完毕后，才会开始执行其他生命周期方法。</li><li>即使GameObject被禁用（inactive），Awake()也会被调用。</li></ul><p><strong>什么时候会触发</strong>：</p><ul><li>场景加载时，所有MonoBehaviour的Awake()会在Start()之前被调用。</li><li>运行时动态实例化对象时。</li></ul><p><strong>注意</strong>：</p><ul><li>Awake()在对象生命周期中只调用一次。</li><li>不要在Awake()中进行依赖于其他脚本的初始化，因为其他脚本的Awake()可能还未执行。</li></ul><p><strong>性能优化建议</strong>：</p><ul><li>避免在Awake()中进行耗时操作，如同步加载资源或复杂计算，以免影响场景加载性能。</li><li>缓存组件引用（如GetComponent()的结果）以减少后续查找开销。</li><li>如果需要异步加载，使用协程或异步方法，但避免阻塞主线程。</li></ul><h3 id="2-OnEnable"><a href="#2-OnEnable" class="headerlink" title="2. OnEnable()"></a>2. OnEnable()</h3><p><strong>作用</strong>：<br>OnEnable() 用于启用脚本时的初始化。它类似于Awake()，但可以被多次调用，用于重新启用对象时的设置。</p><p><strong>触发时机</strong>：</p><ul><li>当脚本组件被启用时（GameObject.activeSelf &#x3D; true 或脚本.enabled &#x3D; true）。</li><li>在Start()之后，如果对象被禁用再启用，OnEnable()会再次调用。</li></ul><p><strong>什么时候会触发</strong>：</p><ul><li>场景开始时，如果对象是启用的。</li><li>运行时启用GameObject或脚本组件。</li><li>从禁用状态切换到启用状态。</li></ul><p><strong>与Awake()的区别</strong>：</p><ul><li>Awake()只调用一次，而OnEnable()可以多次调用。</li><li>Awake()在对象创建时调用，无论是否启用；OnEnable()只在启用时调用。</li></ul><p><strong>性能优化建议</strong>：</p><ul><li>由于OnEnable()可多次调用，避免重复执行耗时初始化；使用标志位检查是否已初始化。</li><li>缓存必要的引用，避免每次启用时重新查找组件。</li><li>如果启用&#x2F;禁用频繁，考虑使用对象池来减少实例化开销。</li></ul><h3 id="3-Start"><a href="#3-Start" class="headerlink" title="3. Start()"></a>3. Start()</h3><p><strong>作用</strong>：<br>Start() 用于在脚本开始执行前的最后初始化。它通常用于设置依赖于其他脚本或场景中其他对象的引用。</p><p><strong>触发时机</strong>：</p><ul><li>在第一次Update()方法调用之前。</li><li>确保所有脚本的Awake()和OnEnable()都已执行完毕。</li></ul><p><strong>什么时候会触发</strong>：</p><ul><li>场景加载后，第一次帧更新前。</li><li>对象被启用后，如果之前未调用过Start()。</li></ul><p><strong>与Awake()的区别</strong>：</p><ul><li>Awake()用于早期初始化，Start()用于依赖其他组件的初始化。</li><li>Awake()在Start()之前调用，且Start()可能在Awake()执行后延迟调用。</li></ul><p><strong>性能优化建议</strong>：</p><ul><li>Start()只调用一次，适合进行依赖其他对象的初始化，但避免同步加载大量资源。</li><li>使用异步加载或预加载资源，以防止阻塞游戏启动。</li><li>缓存跨脚本引用，避免在Start()中频繁使用FindObjectOfType()等耗时方法。</li></ul><h3 id="4-FixedUpdate"><a href="#4-FixedUpdate" class="headerlink" title="4. FixedUpdate()"></a>4. FixedUpdate()</h3><p><strong>作用</strong>：<br>FixedUpdate() 用于处理物理相关的更新。它以固定的时间间隔调用，与帧率无关，适合处理刚体运动、碰撞检测等物理计算。</p><p>调用 FixedUpdate 的频度常常超过 Update。如果帧率很低，可以每帧调用该函数多次；如果帧率很高，可能在帧之间完全不调用该函数。在 FixedUpdate 之后将立即进行所有物理计算和更新。在 FixedUpdate 内应用运动计算时，无需将值乘以 Time.deltaTime。这是因为 FixedUpdate 的调用基于可靠的计时器（独立于帧率）。</p><p><strong>触发时机</strong>：</p><ul><li>以固定的时间步长（默认0.02秒，可在Time.fixedDeltaTime中设置）调用。</li><li>在Update()之前或之后，取决于物理更新顺序。</li></ul><p><strong>什么时候会触发</strong>：</p><ul><li>每当物理引擎更新时，通常每秒50次（如果fixedDeltaTime&#x3D;0.02）。</li><li>即使帧率变化，FixedUpdate()的调用频率保持不变。</li></ul><p><strong>与Update()的区别</strong>：</p><ul><li>Update()与帧率相关，FixedUpdate()与时间相关。</li><li>FixedUpdate()适合物理计算，Update()适合一般更新。</li></ul><p><strong>性能优化建议</strong>：</p><ul><li>FixedUpdate()以固定频率调用，保持逻辑简单高效，避免复杂循环或大量计算。</li><li>使用Time.fixedDeltaTime进行时间相关计算，确保物理行为一致。</li><li>如果物理对象过多，考虑使用对象池或LOD（细节层次）来减少计算量。</li></ul><h3 id="5-Update"><a href="#5-Update" class="headerlink" title="5. Update()"></a>5. Update()</h3><p><strong>作用</strong>：<br>Update() 是最常用的更新方法，用于处理每帧的逻辑，如输入处理、动画更新、AI行为等。</p><p><strong>触发时机</strong>：</p><ul><li>每帧调用一次，与渲染帧率同步。</li><li>在FixedUpdate()之后，LateUpdate()之前。</li></ul><p><strong>什么时候会触发</strong>：</p><ul><li>游戏运行时，每渲染一帧。</li><li>如果帧率是60FPS，每秒调用60次。</li></ul><p><strong>注意</strong>：</p><ul><li>Update()的调用频率不固定，取决于硬件性能。</li></ul><p><strong>性能优化建议</strong>：</p><ul><li>Update()每帧调用，是性能瓶颈的主要来源；避免耗时操作，如复杂数学计算或大量字符串操作。</li><li>缓存变量和组件引用，避免每帧调用GetComponent()或Find()。</li><li>使用Time.deltaTime进行平滑插值，但注意在低帧率下可能导致不一致。</li><li>考虑使用协程或事件驱动来替代频繁的Update()检查。</li></ul><h3 id="6-LateUpdate"><a href="#6-LateUpdate" class="headerlink" title="6. LateUpdate()"></a>6. LateUpdate()</h3><p><strong>作用</strong>：<br>LateUpdate() 用于在所有Update()方法执行完毕后的更新，常用于相机跟随、动画调整等需要最后执行的操作。</p><p><strong>触发时机</strong>：</p><ul><li>每帧在所有Update()方法之后调用。</li><li>在渲染之前。</li></ul><p><strong>什么时候会触发</strong>：</p><ul><li>每帧一次，在Update()之后。</li><li>适合处理依赖于其他对象位置更新的逻辑。</li></ul><p><strong>与Update()的区别</strong>：</p><ul><li>LateUpdate()确保在所有Update()之后执行，避免更新顺序问题。</li><li>例如，相机跟随玩家时，应在LateUpdate()中更新相机位置。</li></ul><p><strong>性能优化建议</strong>：</p><ul><li>LateUpdate()类似Update()，保持轻量，避免复杂逻辑。</li><li>用于最终调整，如相机位置，确保所有对象已更新。</li><li>如果相机跟随复杂，考虑使用Cinemachine等优化工具。</li></ul><h3 id="7-OnDisable"><a href="#7-OnDisable" class="headerlink" title="7. OnDisable()"></a>7. OnDisable()</h3><p><strong>作用</strong>：<br>OnDisable() 用于清理或保存状态，当脚本被禁用时调用。它是OnEnable()的反操作。</p><p><strong>触发时机</strong>：</p><ul><li>当脚本组件被禁用时（GameObject.activeSelf &#x3D; false 或脚本.enabled &#x3D; false）。</li><li>在对象被销毁前调用。</li></ul><p><strong>什么时候会触发</strong>：</p><ul><li>运行时禁用GameObject或脚本。</li><li>场景结束时。</li><li>对象被销毁前。</li></ul><p><strong>与OnDestroy()的区别</strong>：</p><ul><li>OnDisable()在对象禁用时调用，可多次调用；OnDestroy()只在销毁时调用一次。</li><li>OnDisable()不意味着对象被销毁，可能只是临时禁用。</li></ul><p><strong>性能优化建议</strong>：</p><ul><li>OnDisable()可多次调用，快速执行清理，避免耗时操作。</li><li>取消订阅事件，释放临时资源，但保留可重用状态。</li><li>如果禁用频繁，使用对象池避免重复初始化&#x2F;销毁开销。</li></ul><h3 id="8-OnDestroy"><a href="#8-OnDestroy" class="headerlink" title="8. OnDestroy()"></a>8. OnDestroy()</h3><p><strong>作用</strong>：<br>OnDestroy() 用于最终清理，当脚本实例被销毁时调用。用于释放资源、取消订阅事件等。</p><p><strong>触发时机</strong>：</p><ul><li>当GameObject被销毁时，或脚本组件被移除时。</li><li>在对象生命周期结束时。</li></ul><p><strong>什么时候会触发</strong>：</p><ul><li>运行时调用Destroy()方法。</li><li>场景卸载时。</li><li>应用程序退出时（但不保证）。</li></ul><p><strong>注意</strong>：</p><ul><li>OnDestroy()不保证在应用程序退出时调用，因为Unity可能强制退出。</li><li>不要依赖OnDestroy()进行关键保存操作。</li></ul><p><strong>性能优化建议</strong>：</p><ul><li>OnDestroy()用于最终清理，确保释放所有资源，如取消事件订阅、销毁手动创建的对象。</li><li>避免在OnDestroy()中进行耗时操作，以免影响场景切换性能。</li><li>使用对象池可以减少Destroy()和Instantiate()的开销。</li></ul><h2 id="相似函数之间的区别总结"><a href="#相似函数之间的区别总结" class="headerlink" title="相似函数之间的区别总结"></a>相似函数之间的区别总结</h2><ul><li><strong>Awake() vs Start()</strong>：Awake()用于早期初始化，Start()用于依赖初始化；Awake()总是在Start()前调用。</li><li><strong>OnEnable() vs Start()</strong>：OnEnable()可多次调用，用于启用时的初始化；Start()只调用一次，在首次启用后。</li><li><strong>Update() vs FixedUpdate()</strong>：Update()每帧调用，适合非物理逻辑；FixedUpdate()固定间隔，适合物理计算。</li><li><strong>Update() vs LateUpdate()</strong>：LateUpdate()在所有Update()后执行，适合相机跟随等最后更新。</li><li><strong>OnDisable() vs OnDestroy()</strong>：OnDisable()在禁用时调用，可恢复；OnDestroy()在销毁时调用，不可恢复。</li></ul><h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><p>下面写一段简单的代码示例，可以尝试在Unity编辑器中创建一个GameObject并附加此脚本，思考如何合理使用这些生命周期方法，通过不断尝试了解不同节点这些函数的启动时机：</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> Unity.VisualScripting;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameMono</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;Awake执行了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnEnable</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;OnEnable执行了&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;Start执行了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">FixedUpdate</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;FixedUpdate正在执行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;Update正在执行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">LateUpdate</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;LateUpdate正在执行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDisable</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;OnDisable执行了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDestroy</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;OnDestroy执行了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure><ul><li>在Awake()中进行初始化，避免依赖其他脚本。</li><li>在Start()中处理跨脚本依赖。</li><li>使用FixedUpdate()处理物理，使用Update()处理输入和动画。</li><li>在OnDisable()和OnDestroy()中清理资源。</li><li>避免在Update()中进行耗时操作，以保持帧率稳定。</li><li><strong>性能优化扩展</strong>：<ul><li>缓存所有组件引用，避免重复GetComponent()调用。</li><li>使用对象池管理频繁创建&#x2F;销毁的对象，减少GC压力。</li><li>最小化Update()和LateUpdate()中的逻辑，使用事件或状态机优化。</li><li>监控Profiler，识别性能瓶颈，如过多的Draw Calls或物理计算。</li><li>对于大量对象，使用批处理或LOD系统。</li><li>异步加载资源，避免阻塞主线程。</li></ul></li></ul><p>通过理解这些生命周期方法，可以更好地控制脚本的行为，确保游戏逻辑正确执行。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Unity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式——适配器模式</title>
      <link href="/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
      <url>/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="适配器模式（Adapter-Pattern）详解"><a href="#适配器模式（Adapter-Pattern）详解" class="headerlink" title="适配器模式（Adapter Pattern）详解"></a>适配器模式（Adapter Pattern）详解</h1><h2 id="什么是适配器模式"><a href="#什么是适配器模式" class="headerlink" title="什么是适配器模式"></a>什么是适配器模式</h2><p>适配器模式是一种结构型设计模式，它允许将一个类的接口转换为客户端期望的另一个接口。适配器模式使得原本由于接口不兼容而不能一起工作的类可以一起工作。</p><h2 id="适配器模式解决的问题"><a href="#适配器模式解决的问题" class="headerlink" title="适配器模式解决的问题"></a>适配器模式解决的问题</h2><p>适配器模式主要解决以下问题：</p><ol><li><strong>接口不兼容</strong>：当两个类的接口不兼容时，无法直接使用</li><li><strong>复用现有代码</strong>：当需要使用一个已有的类，但它的接口不符合需求时</li><li><strong>系统集成</strong>：当需要集成不同系统的组件时，它们的接口可能不同</li><li><strong>渐进式重构</strong>：当需要逐步替换旧系统的组件时，可以使用适配器作为过渡</li><li><strong>减少修改</strong>：当修改现有代码风险较大时，可以使用适配器来适配新的接口</li></ol><h2 id="适配器模式的好处"><a href="#适配器模式的好处" class="headerlink" title="适配器模式的好处"></a>适配器模式的好处</h2><ol><li><strong>兼容性</strong>：使得接口不兼容的类可以一起工作</li><li><strong>复用性</strong>：可以复用现有的类，而不需要修改它们</li><li><strong>可维护性</strong>：将适配逻辑集中在适配器中，易于维护</li><li><strong>灵活性</strong>：可以在不修改现有代码的情况下，适配新的接口</li><li><strong>符合设计原则</strong>：遵循开闭原则，对扩展开放，对修改关闭</li></ol><h2 id="适配器模式的结构"><a href="#适配器模式的结构" class="headerlink" title="适配器模式的结构"></a>适配器模式的结构</h2><p>适配器模式包含以下几个角色：</p><ol><li><strong>目标接口（Target）</strong>：客户端期望的接口</li><li><strong>适配者（Adaptee）</strong>：需要被适配的类</li><li><strong>适配器（Adapter）</strong>：将适配者的接口转换为目标接口</li></ol><p>适配器模式有两种实现方式：</p><ol><li><strong>类适配器</strong>：通过继承适配者类并实现目标接口</li><li><strong>对象适配器</strong>：通过持有适配者的引用并实现目标接口</li></ol><h2 id="各语言实现"><a href="#各语言实现" class="headerlink" title="各语言实现"></a>各语言实现</h2><h3 id="C-实现"><a href="#C-实现" class="headerlink" title="C++ 实现"></a>C++ 实现</h3><h4 id="类适配器"><a href="#类适配器" class="headerlink" title="类适配器"></a>类适配器</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 目标接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Target</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Target</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">request</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 适配者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Adaptee</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">specificRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;适配者的具体请求&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类适配器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassAdapter</span> : <span class="keyword">public</span> Target, <span class="keyword">private</span> Adaptee &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">request</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;类适配器处理请求&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="built_in">specificRequest</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象适配器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ObjectAdapter</span> : <span class="keyword">public</span> Target &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Adaptee* adaptee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ObjectAdapter</span>(Adaptee* a) : <span class="built_in">adaptee</span>(a) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">request</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;对象适配器处理请求&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        adaptee-&gt;<span class="built_in">specificRequest</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 使用类适配器</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;使用类适配器：&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    Target* classAdapter = <span class="keyword">new</span> <span class="built_in">ClassAdapter</span>();</span><br><span class="line">    classAdapter-&gt;<span class="built_in">request</span>();</span><br><span class="line">    <span class="keyword">delete</span> classAdapter;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用对象适配器</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\n使用对象适配器：&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    Adaptee* adaptee = <span class="keyword">new</span> <span class="built_in">Adaptee</span>();</span><br><span class="line">    Target* objectAdapter = <span class="keyword">new</span> <span class="built_in">ObjectAdapter</span>(adaptee);</span><br><span class="line">    objectAdapter-&gt;<span class="built_in">request</span>();</span><br><span class="line">    <span class="keyword">delete</span> objectAdapter;</span><br><span class="line">    <span class="keyword">delete</span> adaptee;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Java-实现"><a href="#Java-实现" class="headerlink" title="Java 实现"></a>Java 实现</h3><h4 id="类适配器-1"><a href="#类适配器-1" class="headerlink" title="类适配器"></a>类适配器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 目标接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Target</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">request</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 适配者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Adaptee</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">specificRequest</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;适配者的具体请求&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类适配器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassAdapter</span> <span class="keyword">extends</span> <span class="title class_">Adaptee</span> <span class="keyword">implements</span> <span class="title class_">Target</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">request</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;类适配器处理请求&quot;</span>);</span><br><span class="line">        specificRequest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象适配器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ObjectAdapter</span> <span class="keyword">implements</span> <span class="title class_">Target</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Adaptee adaptee;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ObjectAdapter</span><span class="params">(Adaptee adaptee)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.adaptee = adaptee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">request</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;对象适配器处理请求&quot;</span>);</span><br><span class="line">        adaptee.specificRequest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdapterPatternDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用类适配器</span></span><br><span class="line">        System.out.println(<span class="string">&quot;使用类适配器：&quot;</span>);</span><br><span class="line">        <span class="type">Target</span> <span class="variable">classAdapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassAdapter</span>();</span><br><span class="line">        classAdapter.request();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用对象适配器</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n使用对象适配器：&quot;</span>);</span><br><span class="line">        <span class="type">Adaptee</span> <span class="variable">adaptee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Adaptee</span>();</span><br><span class="line">        <span class="type">Target</span> <span class="variable">objectAdapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectAdapter</span>(adaptee);</span><br><span class="line">        objectAdapter.request();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Python-实现"><a href="#Python-实现" class="headerlink" title="Python 实现"></a>Python 实现</h3><h4 id="类适配器-2"><a href="#类适配器-2" class="headerlink" title="类适配器"></a>类适配器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 目标接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Target</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 适配者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Adaptee</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">specific_request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;适配者的具体请求&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 类适配器（Python 支持多重继承）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassAdapter</span>(Target, Adaptee):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;类适配器处理请求&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.specific_request()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对象适配器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ObjectAdapter</span>(<span class="title class_ inherited__">Target</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, adaptee</span>):</span><br><span class="line">        <span class="variable language_">self</span>.adaptee = adaptee</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;对象适配器处理请求&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.adaptee.specific_request()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 使用类适配器</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;使用类适配器：&quot;</span>)</span><br><span class="line">    class_adapter = ClassAdapter()</span><br><span class="line">    class_adapter.request()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 使用对象适配器</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n使用对象适配器：&quot;</span>)</span><br><span class="line">    adaptee = Adaptee()</span><br><span class="line">    object_adapter = ObjectAdapter(adaptee)</span><br><span class="line">    object_adapter.request()</span><br></pre></td></tr></table></figure><h3 id="C-实现-1"><a href="#C-实现-1" class="headerlink" title="C# 实现"></a>C# 实现</h3><h4 id="类适配器-3"><a href="#类适配器-3" class="headerlink" title="类适配器"></a>类适配器</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 目标接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title">Target</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Request</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 适配者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Adaptee</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SpecificRequest</span>()</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;适配者的具体请求&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类适配器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">ClassAdapter</span> : <span class="title">Adaptee</span>, <span class="title">Target</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Request</span>()</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;类适配器处理请求&quot;</span>);</span><br><span class="line">        SpecificRequest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象适配器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">ObjectAdapter</span> : <span class="title">Target</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Adaptee adaptee;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ObjectAdapter</span>(<span class="params">Adaptee adaptee</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.adaptee = adaptee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Request</span>()</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;对象适配器处理请求&quot;</span>);</span><br><span class="line">        adaptee.SpecificRequest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用类适配器</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;使用类适配器：&quot;</span>);</span><br><span class="line">        Target classAdapter = <span class="keyword">new</span> ClassAdapter();</span><br><span class="line">        classAdapter.Request();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用对象适配器</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;\n使用对象适配器：&quot;</span>);</span><br><span class="line">        Adaptee adaptee = <span class="keyword">new</span> Adaptee();</span><br><span class="line">        Target objectAdapter = <span class="keyword">new</span> ObjectAdapter(adaptee);</span><br><span class="line">        objectAdapter.Request();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="适配器模式的适用场景"><a href="#适配器模式的适用场景" class="headerlink" title="适配器模式的适用场景"></a>适配器模式的适用场景</h2><p>适配器模式适用于以下情况：</p><ol><li><strong>接口不兼容</strong>：当需要使用一个接口与现有代码不兼容的类时</li><li><strong>系统集成</strong>：当需要集成不同系统的组件时</li><li><strong>复用现有代码</strong>：当需要复用现有的类，但它们的接口不符合需求时</li><li><strong>渐进式重构</strong>：当需要逐步替换旧系统的组件时</li><li><strong>第三方库集成</strong>：当需要使用第三方库，但它们的接口与系统不兼容时</li></ol><h2 id="实际应用场景"><a href="#实际应用场景" class="headerlink" title="实际应用场景"></a>实际应用场景</h2><ol><li><strong>数据转换</strong>：将一种数据格式转换为另一种数据格式</li><li><strong>API 适配</strong>：适配不同版本的 API 或不同厂商的 API</li><li><strong>设备驱动</strong>：适配不同设备的驱动接口</li><li><strong>数据库访问</strong>：适配不同数据库的访问接口</li><li><strong>图形界面</strong>：适配不同平台的图形界面接口</li><li><strong>网络协议</strong>：适配不同的网络协议</li></ol><h2 id="适配器模式的变体"><a href="#适配器模式的变体" class="headerlink" title="适配器模式的变体"></a>适配器模式的变体</h2><ol><li><strong>双向适配器</strong>：同时适配两个接口，使得两个接口可以相互转换</li><li><strong>默认适配器</strong>：提供一个默认实现的适配器，子类可以只覆盖需要的方法</li><li><strong>缺省适配器</strong>：实现目标接口的所有方法，但默认什么都不做</li><li><strong>智能适配器</strong>：在适配过程中添加额外的逻辑，如缓存、日志等</li></ol><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ol><li><strong>过度使用</strong>：不要过度使用适配器模式，否则会增加系统的复杂性</li><li><strong>接口设计</strong>：在设计系统时，应尽量保持接口的一致性，减少适配器的使用</li><li><strong>性能考虑</strong>：适配器可能会增加一些性能开销，特别是在频繁调用的场景下</li><li><strong>维护成本</strong>：适配器会增加系统的维护成本，因为需要维护额外的代码</li><li><strong>命名规范</strong>：适配器的命名应该清晰地表明它的作用</li></ol><h2 id="适配器模式与其他模式的对比"><a href="#适配器模式与其他模式的对比" class="headerlink" title="适配器模式与其他模式的对比"></a>适配器模式与其他模式的对比</h2><h3 id="适配器模式-vs-装饰器模式"><a href="#适配器模式-vs-装饰器模式" class="headerlink" title="适配器模式 vs 装饰器模式"></a>适配器模式 vs 装饰器模式</h3><ul><li><strong>适配器模式</strong>：改变接口，使得不兼容的类可以一起工作</li><li><strong>装饰器模式</strong>：不改变接口，而是在原有接口的基础上添加功能</li></ul><h3 id="适配器模式-vs-外观模式"><a href="#适配器模式-vs-外观模式" class="headerlink" title="适配器模式 vs 外观模式"></a>适配器模式 vs 外观模式</h3><ul><li><strong>适配器模式</strong>：将一个接口转换为另一个接口，关注接口的兼容性</li><li><strong>外观模式</strong>：为子系统提供一个统一的接口，关注简化接口</li></ul><h3 id="适配器模式-vs-桥接模式"><a href="#适配器模式-vs-桥接模式" class="headerlink" title="适配器模式 vs 桥接模式"></a>适配器模式 vs 桥接模式</h3><ul><li><strong>适配器模式</strong>：在系统设计完成后使用，用于解决接口不兼容的问题</li><li><strong>桥接模式</strong>：在系统设计时使用，用于分离抽象和实现</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>适配器模式是一种非常实用的设计模式，它通过将一个接口转换为另一个接口，使得原本不兼容的类可以一起工作。适配器模式不仅可以解决接口不兼容的问题，还可以提高代码的复用性和可维护性。</p><p>在实际开发中，当需要集成不同系统的组件、复用现有代码或逐步替换旧系统的组件时，适配器模式是一个很好的解决方案。通过合理的设计，可以在不修改现有代码的情况下，适配新的接口需求。</p><p>适配器模式有两种实现方式：类适配器和对象适配器。对象适配器更加灵活，因为它可以适配多个适配者，而类适配器只能适配一个适配者。在实际开发中，对象适配器使用得更加广泛。</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> Python </tag>
            
            <tag> Java </tag>
            
            <tag> C# </tag>
            
            <tag> 设计模式 </tag>
            
            <tag> 结构型模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式——备忘录模式</title>
      <link href="/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F/"/>
      <url>/2026/01/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="备忘录模式（Memento-Pattern）详解"><a href="#备忘录模式（Memento-Pattern）详解" class="headerlink" title="备忘录模式（Memento Pattern）详解"></a>备忘录模式（Memento Pattern）详解</h1><h2 id="什么是备忘录模式"><a href="#什么是备忘录模式" class="headerlink" title="什么是备忘录模式"></a>什么是备忘录模式</h2><p>备忘录模式是一种行为型设计模式，它允许在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态。这样，以后就可以将该对象恢复到原先保存的状态。</p><h2 id="备忘录模式解决的问题"><a href="#备忘录模式解决的问题" class="headerlink" title="备忘录模式解决的问题"></a>备忘录模式解决的问题</h2><p>备忘录模式主要解决以下问题：</p><ol><li><strong>状态保存与恢复</strong>：需要保存对象在某一时刻的状态，以便在将来的某个时候恢复到该状态</li><li><strong>封装性保护</strong>：在保存和恢复状态的同时，不破坏对象的封装性</li><li><strong>状态管理</strong>：避免将对象的状态暴露给其他对象</li><li><strong>撤销操作</strong>：实现撤销（Undo）和重做（Redo）功能</li><li><strong>历史记录</strong>：记录对象的历史状态，以便回溯</li></ol><h2 id="备忘录模式的好处"><a href="#备忘录模式的好处" class="headerlink" title="备忘录模式的好处"></a>备忘录模式的好处</h2><ol><li><strong>状态封装</strong>：将对象的状态封装在备忘录中，不暴露给其他对象</li><li><strong>状态管理</strong>：集中管理对象的状态，避免状态散落在代码各处</li><li><strong>撤销&#x2F;重做</strong>：轻松实现撤销和重做功能</li><li><strong>简化代码</strong>：将状态保存和恢复的逻辑与业务逻辑分离</li><li><strong>符合设计原则</strong>：遵循单一职责原则和封装原则</li></ol><h2 id="备忘录模式的结构"><a href="#备忘录模式的结构" class="headerlink" title="备忘录模式的结构"></a>备忘录模式的结构</h2><p>备忘录模式包含以下几个角色：</p><ol><li><strong>原发器（Originator）</strong>：创建一个备忘录，记录当前状态；使用备忘录恢复状态</li><li><strong>备忘录（Memento）</strong>：存储原发器的内部状态</li><li><strong>管理者（Caretaker）</strong>：负责保存备忘录，不操作或检查备忘录的内容</li></ol><h2 id="各语言实现"><a href="#各语言实现" class="headerlink" title="各语言实现"></a>各语言实现</h2><h3 id="C-实现"><a href="#C-实现" class="headerlink" title="C++ 实现"></a>C++ 实现</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 备忘录类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Memento</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string state;</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">class</span> <span class="title class_">Originator</span>; <span class="comment">// 允许 Originator 访问私有成员</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">Memento</span>(<span class="type">const</span> std::string&amp; s) : <span class="built_in">state</span>(s) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::string <span class="title">getState</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 禁止外部修改状态</span></span><br><span class="line">    <span class="function">std::string <span class="title">getStateInfo</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Memento状态: &quot;</span> + state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原发器类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Originator</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string state;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setState</span><span class="params">(<span class="type">const</span> std::string&amp; s)</span> </span>&#123;</span><br><span class="line">        state = s;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;设置状态: &quot;</span> &lt;&lt; state &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::string <span class="title">getState</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建备忘录</span></span><br><span class="line">    <span class="function">Memento <span class="title">createMemento</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Memento</span>(state);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从备忘录恢复状态</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">restoreMemento</span><span class="params">(<span class="type">const</span> Memento&amp; m)</span> </span>&#123;</span><br><span class="line">        state = m.<span class="built_in">getState</span>();</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;恢复状态: &quot;</span> &lt;&lt; state &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 管理者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Caretaker</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;Memento&gt; mementos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addMemento</span><span class="params">(<span class="type">const</span> Memento&amp; m)</span> </span>&#123;</span><br><span class="line">        mementos.<span class="built_in">push_back</span>(m);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;保存状态&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Memento <span class="title">getMemento</span><span class="params">(<span class="type">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &gt;= <span class="number">0</span> &amp;&amp; index &lt; mementos.<span class="built_in">size</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span> mementos[index];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">out_of_range</span>(<span class="string">&quot;索引超出范围&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">getMementoCount</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mementos.<span class="built_in">size</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Originator originator;</span><br><span class="line">    Caretaker caretaker;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 改变状态并保存</span></span><br><span class="line">    originator.<span class="built_in">setState</span>(<span class="string">&quot;状态1&quot;</span>);</span><br><span class="line">    caretaker.<span class="built_in">addMemento</span>(originator.<span class="built_in">createMemento</span>());</span><br><span class="line"></span><br><span class="line">    originator.<span class="built_in">setState</span>(<span class="string">&quot;状态2&quot;</span>);</span><br><span class="line">    caretaker.<span class="built_in">addMemento</span>(originator.<span class="built_in">createMemento</span>());</span><br><span class="line"></span><br><span class="line">    originator.<span class="built_in">setState</span>(<span class="string">&quot;状态3&quot;</span>);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;当前状态: &quot;</span> &lt;&lt; originator.<span class="built_in">getState</span>() &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 恢复到之前的状态</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\n恢复到状态1:&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    originator.<span class="built_in">restoreMemento</span>(caretaker.<span class="built_in">getMemento</span>(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\n恢复到状态2:&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    originator.<span class="built_in">restoreMemento</span>(caretaker.<span class="built_in">getMemento</span>(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Java-实现"><a href="#Java-实现" class="headerlink" title="Java 实现"></a>Java 实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 备忘录类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Memento</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 只允许 Originator 创建 Memento</span></span><br><span class="line">    Memento(String state) &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 只允许 Originator 访问状态</span></span><br><span class="line">    String <span class="title function_">getState</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提供公开的状态信息方法</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getStateInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Memento状态: &quot;</span> + state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原发器类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Originator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(String state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">        System.out.println(<span class="string">&quot;设置状态: &quot;</span> + state);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getState</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建备忘录</span></span><br><span class="line">    <span class="keyword">public</span> Memento <span class="title function_">createMemento</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Memento</span>(state);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从备忘录恢复状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">restoreMemento</span><span class="params">(Memento memento)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = memento.getState();</span><br><span class="line">        System.out.println(<span class="string">&quot;恢复状态: &quot;</span> + state);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 管理者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Caretaker</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Memento&gt; mementos = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addMemento</span><span class="params">(Memento memento)</span> &#123;</span><br><span class="line">        mementos.add(memento);</span><br><span class="line">        System.out.println(<span class="string">&quot;保存状态&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Memento <span class="title function_">getMemento</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &gt;= <span class="number">0</span> &amp;&amp; index &lt; mementos.size()) &#123;</span><br><span class="line">            <span class="keyword">return</span> mementos.get(index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(<span class="string">&quot;索引超出范围&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getMementoCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mementos.size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MementoPatternDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Originator</span> <span class="variable">originator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Originator</span>();</span><br><span class="line">        <span class="type">Caretaker</span> <span class="variable">caretaker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Caretaker</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 改变状态并保存</span></span><br><span class="line">        originator.setState(<span class="string">&quot;状态1&quot;</span>);</span><br><span class="line">        caretaker.addMemento(originator.createMemento());</span><br><span class="line"></span><br><span class="line">        originator.setState(<span class="string">&quot;状态2&quot;</span>);</span><br><span class="line">        caretaker.addMemento(originator.createMemento());</span><br><span class="line"></span><br><span class="line">        originator.setState(<span class="string">&quot;状态3&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;当前状态: &quot;</span> + originator.getState());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 恢复到之前的状态</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n恢复到状态1:&quot;</span>);</span><br><span class="line">        originator.restoreMemento(caretaker.getMemento(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;\n恢复到状态2:&quot;</span>);</span><br><span class="line">        originator.restoreMemento(caretaker.getMemento(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Python-实现"><a href="#Python-实现" class="headerlink" title="Python 实现"></a>Python 实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备忘录类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Memento</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, state</span>):</span><br><span class="line">        <span class="variable language_">self</span>._state = state  <span class="comment"># 私有属性</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_state</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;只允许 Originator 访问&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._state</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_state_info</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;提供公开的状态信息&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Memento状态: <span class="subst">&#123;self._state&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 原发器类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Originator</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>._state = <span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_state</span>(<span class="params">self, state</span>):</span><br><span class="line">        <span class="variable language_">self</span>._state = state</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;设置状态: <span class="subst">&#123;state&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_state</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._state</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_memento</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;创建备忘录&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> Memento(<span class="variable language_">self</span>._state)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">restore_memento</span>(<span class="params">self, memento</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;从备忘录恢复状态&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>._state = memento.get_state()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;恢复状态: <span class="subst">&#123;self._state&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 管理者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Caretaker</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>._mementos = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_memento</span>(<span class="params">self, memento</span>):</span><br><span class="line">        <span class="variable language_">self</span>._mementos.append(memento)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;保存状态&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_memento</span>(<span class="params">self, index</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= index &lt; <span class="built_in">len</span>(<span class="variable language_">self</span>._mementos):</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>._mementos[index]</span><br><span class="line">        <span class="keyword">raise</span> IndexError(<span class="string">&quot;索引超出范围&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_memento_count</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(<span class="variable language_">self</span>._mementos)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    originator = Originator()</span><br><span class="line">    caretaker = Caretaker()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 改变状态并保存</span></span><br><span class="line">    originator.set_state(<span class="string">&quot;状态1&quot;</span>)</span><br><span class="line">    caretaker.add_memento(originator.create_memento())</span><br><span class="line">    </span><br><span class="line">    originator.set_state(<span class="string">&quot;状态2&quot;</span>)</span><br><span class="line">    caretaker.add_memento(originator.create_memento())</span><br><span class="line">    </span><br><span class="line">    originator.set_state(<span class="string">&quot;状态3&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;当前状态: <span class="subst">&#123;originator.get_state()&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 恢复到之前的状态</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n恢复到状态1:&quot;</span>)</span><br><span class="line">    originator.restore_memento(caretaker.get_memento(<span class="number">0</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n恢复到状态2:&quot;</span>)</span><br><span class="line">    originator.restore_memento(caretaker.get_memento(<span class="number">1</span>))</span><br></pre></td></tr></table></figure><h3 id="C-实现-1"><a href="#C-实现-1" class="headerlink" title="C# 实现"></a>C# 实现</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 备忘录类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Memento</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> state;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 只允许 Originator 创建 Memento</span></span><br><span class="line">    <span class="function"><span class="keyword">internal</span> <span class="title">Memento</span>(<span class="params"><span class="built_in">string</span> state</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 只允许 Originator 访问状态</span></span><br><span class="line">    <span class="function"><span class="keyword">internal</span> <span class="built_in">string</span> <span class="title">GetState</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提供公开的状态信息方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetStateInfo</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">$&quot;Memento状态: <span class="subst">&#123;state&#125;</span>&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原发器类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Originator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> state;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetState</span>(<span class="params"><span class="built_in">string</span> state</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.state = state;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;设置状态: <span class="subst">&#123;state&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetState</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建备忘录</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Memento <span class="title">CreateMemento</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Memento(state);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从备忘录恢复状态</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RestoreMemento</span>(<span class="params">Memento memento</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.state = memento.GetState();</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;恢复状态: <span class="subst">&#123;state&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 管理者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Caretaker</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Memento&gt; mementos = <span class="keyword">new</span> List&lt;Memento&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddMemento</span>(<span class="params">Memento memento</span>)</span> &#123;</span><br><span class="line">        mementos.Add(memento);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;保存状态&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Memento <span class="title">GetMemento</span>(<span class="params"><span class="built_in">int</span> index</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &gt;= <span class="number">0</span> &amp;&amp; index &lt; mementos.Count) &#123;</span><br><span class="line">            <span class="keyword">return</span> mementos[index];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfRangeException(<span class="string">&quot;索引超出范围&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">GetMementoCount</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mementos.Count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span> &#123;</span><br><span class="line">        Originator originator = <span class="keyword">new</span> Originator();</span><br><span class="line">        Caretaker caretaker = <span class="keyword">new</span> Caretaker();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 改变状态并保存</span></span><br><span class="line">        originator.SetState(<span class="string">&quot;状态1&quot;</span>);</span><br><span class="line">        caretaker.AddMemento(originator.CreateMemento());</span><br><span class="line"></span><br><span class="line">        originator.SetState(<span class="string">&quot;状态2&quot;</span>);</span><br><span class="line">        caretaker.AddMemento(originator.CreateMemento());</span><br><span class="line"></span><br><span class="line">        originator.SetState(<span class="string">&quot;状态3&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;当前状态: <span class="subst">&#123;originator.GetState()&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 恢复到之前的状态</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;\n恢复到状态1:&quot;</span>);</span><br><span class="line">        originator.RestoreMemento(caretaker.GetMemento(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;\n恢复到状态2:&quot;</span>);</span><br><span class="line">        originator.RestoreMemento(caretaker.GetMemento(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="备忘录模式的适用场景"><a href="#备忘录模式的适用场景" class="headerlink" title="备忘录模式的适用场景"></a>备忘录模式的适用场景</h2><p>备忘录模式适用于以下情况：</p><ol><li><strong>需要撤销&#x2F;重做功能</strong>：如文本编辑器、图形编辑器等</li><li><strong>需要保存和恢复状态</strong>：如游戏存档、应用程序配置等</li><li><strong>需要历史记录</strong>：如事务处理、日志系统等</li><li><strong>需要状态回滚</strong>：如数据库事务、操作回滚等</li><li><strong>需要保护封装性</strong>：在保存和恢复状态的同时，不破坏对象的封装性</li></ol><h2 id="实际应用场景"><a href="#实际应用场景" class="headerlink" title="实际应用场景"></a>实际应用场景</h2><ol><li><strong>文本编辑器</strong>：保存文档的历史版本，支持撤销和重做</li><li><strong>图形编辑器</strong>：保存绘图的历史状态，支持撤销和重做</li><li><strong>游戏</strong>：保存游戏进度，支持存档和读档</li><li><strong>配置管理</strong>：保存应用程序的配置状态，支持配置回滚</li><li><strong>数据库事务</strong>：保存事务的状态，支持提交和回滚</li><li><strong>表单编辑器</strong>：保存表单的编辑状态，支持撤销操作</li></ol><h2 id="备忘录模式的变体"><a href="#备忘录模式的变体" class="headerlink" title="备忘录模式的变体"></a>备忘录模式的变体</h2><ol><li><strong>增量备忘录</strong>：只记录状态的变化，而不是完整状态，减少内存使用</li><li><strong>多状态备忘录</strong>：同时保存多个属性的状态</li><li><strong>版本控制</strong>：保存对象的多个版本，支持版本切换</li><li><strong>快照模式</strong>：定期创建对象的快照，用于恢复</li></ol><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ol><li><strong>内存使用</strong>：如果对象的状态很大，保存多个备忘录可能会占用大量内存</li><li><strong>序列化</strong>：如果需要持久化备忘录，需要考虑序列化问题</li><li><strong>线程安全</strong>：在多线程环境下，需要考虑线程安全问题</li><li><strong>封装性</strong>：确保备忘录的状态不被外部修改</li><li><strong>性能</strong>：频繁创建和恢复备忘录可能会影响性能</li></ol><h2 id="备忘录模式与其他模式的结合"><a href="#备忘录模式与其他模式的结合" class="headerlink" title="备忘录模式与其他模式的结合"></a>备忘录模式与其他模式的结合</h2><ol><li><strong>命令模式</strong>：命令模式可以使用备忘录模式实现撤销功能</li><li><strong>状态模式</strong>：状态模式可以使用备忘录模式保存状态</li><li><strong>原型模式</strong>：原型模式可以用于创建备忘录的深拷贝</li></ol><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>备忘录模式是一种非常实用的设计模式，它通过将对象的状态封装在备忘录中，实现了状态的保存和恢复，同时保护了对象的封装性。备忘录模式不仅可以用于实现撤销和重做功能，还可以用于状态管理、历史记录等场景。</p><p>在实际开发中，当需要保存对象的状态以便将来恢复时，备忘录模式是一个很好的解决方案。通过合理的设计，可以在不破坏封装性的前提下，实现灵活的状态管理。</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> Python </tag>
            
            <tag> Java </tag>
            
            <tag> C# </tag>
            
            <tag> 设计模式 </tag>
            
            <tag> 行为型模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java 类加载器</title>
      <link href="/2026/01/23/Java-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8/"/>
      <url>/2026/01/23/Java-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-类加载器详解"><a href="#Java-类加载器详解" class="headerlink" title="Java 类加载器详解"></a>Java 类加载器详解</h1><h2 id="什么是类加载器"><a href="#什么是类加载器" class="headerlink" title="什么是类加载器"></a>什么是类加载器</h2><p>类加载器（ClassLoader）是 Java 虚拟机（JVM）的重要组成部分，它负责将 Java 类的字节码加载到内存中，并转换为 JVM 可以识别的 Class 对象。</p><h2 id="类加载器的作用"><a href="#类加载器的作用" class="headerlink" title="类加载器的作用"></a>类加载器的作用</h2><ol><li><strong>加载类</strong>：将类的字节码从磁盘、网络或其他来源加载到内存中</li><li><strong>链接类</strong>：验证字节码的有效性，准备类的静态变量，解析符号引用</li><li><strong>初始化类</strong>：执行静态初始化块，初始化静态变量</li><li><strong>命名空间管理</strong>：每个类加载器都有自己的命名空间，相同名称的类在不同的类加载器中是不同的</li></ol><h2 id="类加载的过程"><a href="#类加载的过程" class="headerlink" title="类加载的过程"></a>类加载的过程</h2><p>类加载的过程包括以下几个步骤：</p><ol><li><strong>加载（Loading）</strong>：通过类的全限定名找到类的字节码，将其加载到内存中</li><li><strong>链接（Linking）</strong>：<ul><li><strong>验证（Verification）</strong>：验证字节码的有效性</li><li><strong>准备（Preparation）</strong>：为静态变量分配内存并设置默认值</li><li><strong>解析（Resolution）</strong>：将符号引用转换为直接引用</li></ul></li><li><strong>初始化（Initialization）</strong>：执行静态初始化块，初始化静态变量</li></ol><h2 id="Java-内置的类加载器"><a href="#Java-内置的类加载器" class="headerlink" title="Java 内置的类加载器"></a>Java 内置的类加载器</h2><p>Java 中有三种类加载器：</p><ol><li><p><strong>引导类加载器（Bootstrap ClassLoader）</strong>：</p><ul><li>负责加载 Java 核心类库（如 rt.jar）</li><li>由 C++ 实现，不是 Java 类</li><li>没有父类加载器</li></ul></li><li><p><strong>扩展类加载器（Extension ClassLoader）</strong>：</p><ul><li>负责加载 Java 扩展类库（如 lib&#x2F;ext 目录下的 jar 包）</li><li>父类加载器是引导类加载器</li></ul></li><li><p><strong>应用类加载器（Application ClassLoader）</strong>：</p><ul><li>负责加载应用程序的类（如 classpath 下的类）</li><li>父类加载器是扩展类加载器</li></ul></li></ol><h2 id="类加载器的工作原理"><a href="#类加载器的工作原理" class="headerlink" title="类加载器的工作原理"></a>类加载器的工作原理</h2><h3 id="类加载的伪代码"><a href="#类加载的伪代码" class="headerlink" title="类加载的伪代码"></a>类加载的伪代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类加载的核心逻辑</span></span><br><span class="line">Class&lt;?&gt; loadClass(String name) &#123;</span><br><span class="line">    <span class="comment">// 1. 检查是否已经加载过该类</span></span><br><span class="line">    Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 2. 调用父类加载器加载</span></span><br><span class="line">            <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">                c = parent.loadClass(name);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 3. 如果没有父类加载器，使用引导类加载器</span></span><br><span class="line">                c = findBootstrapClassOrNull(name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="comment">// 父类加载器无法加载</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 如果父类加载器无法加载，自己加载</span></span><br><span class="line">        <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">            c = findClass(name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找并加载类的字节码</span></span><br><span class="line">Class&lt;?&gt; findClass(String name) &#123;</span><br><span class="line">    <span class="comment">// 1. 找到类的字节码</span></span><br><span class="line">    <span class="type">byte</span>[] b = loadClassData(name);</span><br><span class="line">    <span class="comment">// 2. 将字节码转换为 Class 对象</span></span><br><span class="line">    <span class="keyword">return</span> defineClass(name, b, <span class="number">0</span>, b.length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="类加载的示例"><a href="#类加载的示例" class="headerlink" title="类加载的示例"></a>类加载的示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassLoaderDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取类加载器</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> ClassLoaderDemo.class.getClassLoader();</span><br><span class="line">        System.out.println(<span class="string">&quot;应用类加载器：&quot;</span> + classLoader);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取父类加载器</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">parentClassLoader</span> <span class="operator">=</span> classLoader.getParent();</span><br><span class="line">        System.out.println(<span class="string">&quot;扩展类加载器：&quot;</span> + parentClassLoader);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取父父类加载器（引导类加载器）</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">grandParentClassLoader</span> <span class="operator">=</span> parentClassLoader.getParent();</span><br><span class="line">        System.out.println(<span class="string">&quot;引导类加载器：&quot;</span> + grandParentClassLoader); <span class="comment">// 输出 null，因为引导类加载器不是 Java 类</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取核心类的类加载器</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">stringClassLoader</span> <span class="operator">=</span> String.class.getClassLoader();</span><br><span class="line">        System.out.println(<span class="string">&quot;String 类的加载器：&quot;</span> + stringClassLoader); <span class="comment">// 输出 null，因为由引导类加载器加载</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="双亲委派模型"><a href="#双亲委派模型" class="headerlink" title="双亲委派模型"></a>双亲委派模型</h2><h3 id="什么是双亲委派模型"><a href="#什么是双亲委派模型" class="headerlink" title="什么是双亲委派模型"></a>什么是双亲委派模型</h3><p>双亲委派模型是 Java 类加载器的一种工作机制，它要求每个类加载器在加载类之前，首先将加载请求委托给父类加载器，只有当父类加载器无法加载时，才由自己尝试加载。</p><h3 id="双亲委派模型的工作流程"><a href="#双亲委派模型的工作流程" class="headerlink" title="双亲委派模型的工作流程"></a>双亲委派模型的工作流程</h3><ol><li>当一个类加载器收到加载类的请求时，它首先不会自己尝试加载，而是将请求委托给父类加载器</li><li>父类加载器也会同样将请求委托给它的父类加载器，直到到达顶层的引导类加载器</li><li>如果父类加载器能够加载该类，则返回加载的结果</li><li>如果父类加载器无法加载，则由当前类加载器尝试加载</li></ol><h3 id="双亲委派模型的代码实现"><a href="#双亲委派模型的代码实现" class="headerlink" title="双亲委派模型的代码实现"></a>双亲委派模型的代码实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 双亲委派模型的核心实现</span></span><br><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="type">boolean</span> resolve) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (getClassLoadingLock(name)) &#123;</span><br><span class="line">        <span class="comment">// 1. 检查是否已经加载过</span></span><br><span class="line">        Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">t0</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 2. 委托给父类加载器</span></span><br><span class="line">                <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">                    c = parent.loadClass(name, <span class="literal">false</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 3. 如果没有父类，使用引导类加载器</span></span><br><span class="line">                    c = findBootstrapClassOrNull(name);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                <span class="comment">// 父类加载器无法加载</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 4. 父类加载器无法加载，自己加载</span></span><br><span class="line">                <span class="type">long</span> <span class="variable">t1</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">                c = findClass(name);</span><br><span class="line">                <span class="comment">// 记录统计信息</span></span><br><span class="line">                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class="line">                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">            resolveClass(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="双亲委派模型的作用"><a href="#双亲委派模型的作用" class="headerlink" title="双亲委派模型的作用"></a>双亲委派模型的作用</h3><ol><li><strong>避免类的重复加载</strong>：当父类加载器已经加载了该类时，子类加载器就不需要再加载一次</li><li><strong>保护 Java 核心类库</strong>：防止核心类库被篡改，例如自定义一个 <code>java.lang.String</code> 类是无法被加载的</li><li><strong>确保类的层次结构</strong>：保证了 Java 核心类的一致性，不同的类加载器加载的类之间的关系是确定的</li></ol><h3 id="为什么需要双亲委派模型"><a href="#为什么需要双亲委派模型" class="headerlink" title="为什么需要双亲委派模型"></a>为什么需要双亲委派模型</h3><ol><li><strong>安全性</strong>：防止恶意代码替换 Java 核心类库的类</li><li><strong>一致性</strong>：确保相同的类在不同的类加载器中是相同的</li><li><strong>效率</strong>：避免类的重复加载，提高加载效率</li></ol><h2 id="自定义类加载器"><a href="#自定义类加载器" class="headerlink" title="自定义类加载器"></a>自定义类加载器</h2><h3 id="如何自定义类加载器"><a href="#如何自定义类加载器" class="headerlink" title="如何自定义类加载器"></a>如何自定义类加载器</h3><p>自定义类加载器需要继承 <code>ClassLoader</code> 类，并重写 <code>findClass</code> 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String classPath;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CustomClassLoader</span><span class="params">(String classPath)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.classPath = classPath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. 读取类的字节码</span></span><br><span class="line">            <span class="type">byte</span>[] classData = loadClassData(name);</span><br><span class="line">            <span class="keyword">if</span> (classData == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassNotFoundException</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 2. 将字节码转换为 Class 对象</span></span><br><span class="line">            <span class="keyword">return</span> defineClass(name, classData, <span class="number">0</span>, classData.length);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassNotFoundException</span>(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] loadClassData(String className) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 将类名转换为路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> classPath + File.separatorChar + </span><br><span class="line">            className.replace(<span class="string">&#x27;.&#x27;</span>, File.separatorChar) + <span class="string">&quot;.class&quot;</span>;</span><br><span class="line">        <span class="comment">// 读取字节码</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(path);</span><br><span class="line">             <span class="type">ByteArrayOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>()) &#123;</span><br><span class="line">            <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = is.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                bos.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> bos.toByteArray();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="自定义类加载器的使用"><a href="#自定义类加载器的使用" class="headerlink" title="自定义类加载器的使用"></a>自定义类加载器的使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomClassLoaderTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 创建自定义类加载器</span></span><br><span class="line">        <span class="type">CustomClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomClassLoader</span>(<span class="string">&quot;d:/classes&quot;</span>);</span><br><span class="line">        <span class="comment">// 加载类</span></span><br><span class="line">        Class&lt;?&gt; clazz = classLoader.loadClass(<span class="string">&quot;com.example.TestClass&quot;</span>);</span><br><span class="line">        <span class="comment">// 创建实例</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> clazz.newInstance();</span><br><span class="line">        <span class="comment">// 调用方法</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> clazz.getMethod(<span class="string">&quot;sayHello&quot;</span>);</span><br><span class="line">        method.invoke(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="自定义类加载器的作用"><a href="#自定义类加载器的作用" class="headerlink" title="自定义类加载器的作用"></a>自定义类加载器的作用</h3><ol><li><strong>加载非标准位置的类</strong>：从网络、数据库、加密文件等非标准位置加载类</li><li><strong>实现类的热部署</strong>：在不重启应用的情况下替换类的实现</li><li><strong>实现类的加密和解密</strong>：对类的字节码进行加密，防止反编译</li><li><strong>实现类的隔离</strong>：不同的类加载器加载的类是隔离的，可以在同一个 JVM 中运行不同版本的类</li></ol><h3 id="自定义类加载器的使用场景"><a href="#自定义类加载器的使用场景" class="headerlink" title="自定义类加载器的使用场景"></a>自定义类加载器的使用场景</h3><ol><li><strong>应用服务器</strong>：如 Tomcat，需要隔离不同的 Web 应用</li><li><strong>OSGi 框架</strong>：需要实现模块的热部署和隔离</li><li><strong>插件系统</strong>：需要动态加载插件</li><li><strong>加密应用</strong>：需要对类进行加密保护</li><li><strong>远程调用</strong>：需要从网络加载类</li></ol><h2 id="打破双亲委派模型"><a href="#打破双亲委派模型" class="headerlink" title="打破双亲委派模型"></a>打破双亲委派模型</h2><p>在某些情况下，需要打破双亲委派模型，例如：</p><ol><li><strong>Tomcat</strong>：需要加载 Web 应用的类，而不是委托给父类加载器</li><li><strong>OSGi</strong>：需要实现模块的热部署和隔离</li></ol><p>打破双亲委派模型的方法是重写 <code>loadClass</code> 方法，不按照双亲委派的顺序加载类。</p><h3 id="打破双亲委派模型的示例"><a href="#打破双亲委派模型的示例" class="headerlink" title="打破双亲委派模型的示例"></a>打破双亲委派模型的示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BreakClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String classPath;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BreakClassLoader</span><span class="params">(String classPath)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.classPath = classPath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="type">boolean</span> resolve) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">// 1. 检查是否已经加载过</span></span><br><span class="line">        Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 2. 直接自己加载，不委托给父类</span></span><br><span class="line">                c = findClass(name);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                <span class="comment">// 3. 如果自己无法加载，再委托给父类</span></span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">super</span>.loadClass(name, resolve);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">            resolveClass(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">// 读取类的字节码并转换为 Class 对象</span></span><br><span class="line">        <span class="comment">// 实现与自定义类加载器相同</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="类加载器的命名空间"><a href="#类加载器的命名空间" class="headerlink" title="类加载器的命名空间"></a>类加载器的命名空间</h2><p>每个类加载器都有自己的命名空间，命名空间由该类加载器及其所有父类加载器加载的类组成。</p><p>两个类相等的条件：</p><ol><li>类的全限定名相同</li><li>由同一个类加载器加载</li></ol><h2 id="类加载器的引用"><a href="#类加载器的引用" class="headerlink" title="类加载器的引用"></a>类加载器的引用</h2><p>类加载器会引用它加载的类，类也会引用它的类加载器：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类引用类加载器</span></span><br><span class="line"><span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> TestClass.class.getClassLoader();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类加载器引用类（通过缓存）</span></span><br><span class="line"><span class="comment">// ClassLoader 内部有一个缓存，保存了已加载的类</span></span><br></pre></td></tr></table></figure><h2 id="类加载器的垃圾回收"><a href="#类加载器的垃圾回收" class="headerlink" title="类加载器的垃圾回收"></a>类加载器的垃圾回收</h2><p>当类加载器不再被引用时，它加载的类也可能被垃圾回收（如果这些类也不再被引用）。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>类加载器是 Java 虚拟机的重要组成部分，它负责将类的字节码加载到内存中并转换为 Class 对象。双亲委派模型是类加载器的核心机制，它保证了 Java 核心类的安全性和一致性。自定义类加载器可以实现一些特殊的功能，如加载非标准位置的类、实现类的热部署、加密类等。</p><p>通过理解类加载器的工作原理，我们可以更好地掌握 Java 的运行机制，解决一些与类加载相关的问题，如类冲突、类加载失败等。同时，自定义类加载器也为我们提供了一种灵活的扩展机制，可以根据需要实现一些特殊的功能。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
            <tag> 类加载器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式——状态模式</title>
      <link href="/2026/01/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F/"/>
      <url>/2026/01/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="状态模式（State-Pattern）详解"><a href="#状态模式（State-Pattern）详解" class="headerlink" title="状态模式（State Pattern）详解"></a>状态模式（State Pattern）详解</h1><h2 id="什么是状态模式"><a href="#什么是状态模式" class="headerlink" title="什么是状态模式"></a>什么是状态模式</h2><p>状态模式是一种行为型设计模式，它允许一个对象在其内部状态改变时改变它的行为。状态模式将状态的行为封装在对应的状态类中，使得状态的转换更加清晰和可维护。</p><h2 id="状态模式解决的问题"><a href="#状态模式解决的问题" class="headerlink" title="状态模式解决的问题"></a>状态模式解决的问题</h2><p>状态模式主要解决以下问题：</p><ol><li><strong>消除状态判断</strong>：避免使用大量的 <code>if-else</code> 或 <code>switch-case</code> 语句来处理不同状态的行为</li><li><strong>状态转换管理</strong>：将状态转换的逻辑集中管理，避免状态转换分散在代码各处</li><li><strong>状态行为封装</strong>：将每个状态的行为封装在对应的状态类中，职责单一</li><li><strong>状态的动态切换</strong>：允许在运行时动态地切换对象的状态</li><li><strong>代码复用</strong>：通过状态类复用不同状态的行为</li></ol><h2 id="状态模式的好处"><a href="#状态模式的好处" class="headerlink" title="状态模式的好处"></a>状态模式的好处</h2><ol><li><strong>代码清晰</strong>：消除了复杂的条件判断，代码结构清晰</li><li><strong>可维护性</strong>：每个状态的行为都在自己的类中，易于维护</li><li><strong>可扩展性</strong>：可以通过添加新的状态类来扩展功能</li><li><strong>状态转换明确</strong>：状态转换的逻辑更加明确和集中</li><li><strong>符合设计原则</strong>：遵循开闭原则和单一职责原则</li></ol><h2 id="状态模式的结构"><a href="#状态模式的结构" class="headerlink" title="状态模式的结构"></a>状态模式的结构</h2><p>状态模式包含以下几个角色：</p><ol><li><strong>状态接口（State）</strong>：定义所有状态的公共接口</li><li><strong>具体状态（Concrete State）</strong>：实现状态接口的具体状态类</li><li><strong>上下文（Context）</strong>：持有一个状态对象的引用，使用状态对象处理请求</li></ol><h2 id="各语言实现"><a href="#各语言实现" class="headerlink" title="各语言实现"></a>各语言实现</h2><h3 id="C-实现"><a href="#C-实现" class="headerlink" title="C++ 实现"></a>C++ 实现</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 前向声明</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Context</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 状态接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">State</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">handle</span><span class="params">(Context&amp; context)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::string <span class="title">getName</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上下文</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Context</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::unique_ptr&lt;State&gt; currentState;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Context</span>(std::unique_ptr&lt;State&gt; state)</span><br><span class="line">        : <span class="built_in">currentState</span>(std::<span class="built_in">move</span>(state)) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setState</span><span class="params">(std::unique_ptr&lt;State&gt; state)</span> </span>&#123;</span><br><span class="line">        currentState = std::<span class="built_in">move</span>(state);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;状态切换到：&quot;</span> &lt;&lt; currentState-&gt;<span class="built_in">getName</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        currentState-&gt;<span class="built_in">handle</span>(*<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态：就绪状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ReadyState</span> : <span class="keyword">public</span> State &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handle</span><span class="params">(Context&amp; context)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function">std::string <span class="title">getName</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;就绪状态&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态：运行状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RunningState</span> : <span class="keyword">public</span> State &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handle</span><span class="params">(Context&amp; context)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function">std::string <span class="title">getName</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;运行状态&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态：暂停状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PausedState</span> : <span class="keyword">public</span> State &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handle</span><span class="params">(Context&amp; context)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function">std::string <span class="title">getName</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;暂停状态&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态：停止状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StoppedState</span> : <span class="keyword">public</span> State &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handle</span><span class="params">(Context&amp; context)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function">std::string <span class="title">getName</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;停止状态&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现状态转换逻辑</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ReadyState::handle</span><span class="params">(Context&amp; context)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;当前是就绪状态，开始运行...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    context.<span class="built_in">setState</span>(std::<span class="built_in">make_unique</span>&lt;RunningState&gt;());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">RunningState::handle</span><span class="params">(Context&amp; context)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;当前是运行状态，暂停运行...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    context.<span class="built_in">setState</span>(std::<span class="built_in">make_unique</span>&lt;PausedState&gt;());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PausedState::handle</span><span class="params">(Context&amp; context)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;当前是暂停状态，继续运行...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    context.<span class="built_in">setState</span>(std::<span class="built_in">make_unique</span>&lt;RunningState&gt;());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">StoppedState::handle</span><span class="params">(Context&amp; context)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;当前是停止状态，准备就绪...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    context.<span class="built_in">setState</span>(std::<span class="built_in">make_unique</span>&lt;ReadyState&gt;());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Context <span class="title">context</span><span class="params">(std::make_unique&lt;StoppedState&gt;())</span></span>;</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;第一次请求：&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    context.<span class="built_in">request</span>();</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\n第二次请求：&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    context.<span class="built_in">request</span>();</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\n第三次请求：&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    context.<span class="built_in">request</span>();</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\n第四次请求：&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    context.<span class="built_in">request</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Java-实现"><a href="#Java-实现" class="headerlink" title="Java 实现"></a>Java 实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 状态接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Context context)</span>;</span><br><span class="line">    String <span class="title function_">getName</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上下文</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Context</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> State currentState;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Context</span><span class="params">(State state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.currentState = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(State state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.currentState = state;</span><br><span class="line">        System.out.println(<span class="string">&quot;状态切换到：&quot;</span> + currentState.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">request</span><span class="params">()</span> &#123;</span><br><span class="line">        currentState.handle(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态：就绪状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ReadyState</span> <span class="keyword">implements</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;当前是就绪状态，开始运行...&quot;</span>);</span><br><span class="line">        context.setState(<span class="keyword">new</span> <span class="title class_">RunningState</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;就绪状态&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态：运行状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RunningState</span> <span class="keyword">implements</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;当前是运行状态，暂停运行...&quot;</span>);</span><br><span class="line">        context.setState(<span class="keyword">new</span> <span class="title class_">PausedState</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;运行状态&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态：暂停状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PausedState</span> <span class="keyword">implements</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;当前是暂停状态，继续运行...&quot;</span>);</span><br><span class="line">        context.setState(<span class="keyword">new</span> <span class="title class_">RunningState</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;暂停状态&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态：停止状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StoppedState</span> <span class="keyword">implements</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;当前是停止状态，准备就绪...&quot;</span>);</span><br><span class="line">        context.setState(<span class="keyword">new</span> <span class="title class_">ReadyState</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;停止状态&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StatePatternDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>(<span class="keyword">new</span> <span class="title class_">StoppedState</span>());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;第一次请求：&quot;</span>);</span><br><span class="line">        context.request();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;\n第二次请求：&quot;</span>);</span><br><span class="line">        context.request();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;\n第三次请求：&quot;</span>);</span><br><span class="line">        context.request();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;\n第四次请求：&quot;</span>);</span><br><span class="line">        context.request();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Python-实现"><a href="#Python-实现" class="headerlink" title="Python 实现"></a>Python 实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 状态接口</span></span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self, context</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 上下文</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Context</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, state</span>):</span><br><span class="line">        <span class="variable language_">self</span>.current_state = state</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_state</span>(<span class="params">self, state</span>):</span><br><span class="line">        <span class="variable language_">self</span>.current_state = state</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;状态切换到：<span class="subst">&#123;self.current_state.get_name()&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.current_state.handle(<span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体状态：就绪状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ReadyState</span>(<span class="title class_ inherited__">State</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self, context</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;当前是就绪状态，开始运行...&quot;</span>)</span><br><span class="line">        context.set_state(RunningState())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;就绪状态&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体状态：运行状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RunningState</span>(<span class="title class_ inherited__">State</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self, context</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;当前是运行状态，暂停运行...&quot;</span>)</span><br><span class="line">        context.set_state(PausedState())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;运行状态&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体状态：暂停状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PausedState</span>(<span class="title class_ inherited__">State</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self, context</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;当前是暂停状态，继续运行...&quot;</span>)</span><br><span class="line">        context.set_state(RunningState())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;暂停状态&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体状态：停止状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StoppedState</span>(<span class="title class_ inherited__">State</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self, context</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;当前是停止状态，准备就绪...&quot;</span>)</span><br><span class="line">        context.set_state(ReadyState())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;停止状态&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    context = Context(StoppedState())</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;第一次请求：&quot;</span>)</span><br><span class="line">    context.request()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n第二次请求：&quot;</span>)</span><br><span class="line">    context.request()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n第三次请求：&quot;</span>)</span><br><span class="line">    context.request()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n第四次请求：&quot;</span>)</span><br><span class="line">    context.request()</span><br></pre></td></tr></table></figure><h3 id="C-实现-1"><a href="#C-实现-1" class="headerlink" title="C# 实现"></a>C# 实现</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 状态接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title">IState</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Handle</span>(<span class="params">Context context</span>)</span>;</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">GetName</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上下文</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Context</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> IState currentState;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Context</span>(<span class="params">IState state</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.currentState = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetState</span>(<span class="params">IState state</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.currentState = state;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;状态切换到：<span class="subst">&#123;currentState.GetName()&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Request</span>()</span> &#123;</span><br><span class="line">        currentState.Handle(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态：就绪状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">ReadyState</span> : <span class="title">IState</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Handle</span>(<span class="params">Context context</span>)</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;当前是就绪状态，开始运行...&quot;</span>);</span><br><span class="line">        context.SetState(<span class="keyword">new</span> RunningState());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetName</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;就绪状态&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态：运行状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">RunningState</span> : <span class="title">IState</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Handle</span>(<span class="params">Context context</span>)</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;当前是运行状态，暂停运行...&quot;</span>);</span><br><span class="line">        context.SetState(<span class="keyword">new</span> PausedState());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetName</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;运行状态&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态：暂停状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">PausedState</span> : <span class="title">IState</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Handle</span>(<span class="params">Context context</span>)</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;当前是暂停状态，继续运行...&quot;</span>);</span><br><span class="line">        context.SetState(<span class="keyword">new</span> RunningState());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetName</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;暂停状态&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态：停止状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">StoppedState</span> : <span class="title">IState</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Handle</span>(<span class="params">Context context</span>)</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;当前是停止状态，准备就绪...&quot;</span>);</span><br><span class="line">        context.SetState(<span class="keyword">new</span> ReadyState());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetName</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;停止状态&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span> &#123;</span><br><span class="line">        Context context = <span class="keyword">new</span> Context(<span class="keyword">new</span> StoppedState());</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;第一次请求：&quot;</span>);</span><br><span class="line">        context.Request();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;\n第二次请求：&quot;</span>);</span><br><span class="line">        context.Request();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;\n第三次请求：&quot;</span>);</span><br><span class="line">        context.Request();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;\n第四次请求：&quot;</span>);</span><br><span class="line">        context.Request();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="状态模式的适用场景"><a href="#状态模式的适用场景" class="headerlink" title="状态模式的适用场景"></a>状态模式的适用场景</h2><p>状态模式适用于以下情况：</p><ol><li><strong>对象有多个状态</strong>：当一个对象有多个状态，并且状态之间需要相互转换时</li><li><strong>状态影响行为</strong>：当对象的行为随着状态的改变而改变时</li><li><strong>消除条件判断</strong>：当使用大量的条件语句来处理不同状态的行为时</li><li><strong>状态转换复杂</strong>：当状态转换的逻辑比较复杂时</li><li><strong>状态需要扩展</strong>：当需要频繁地添加新的状态时</li></ol><h2 id="实际应用场景"><a href="#实际应用场景" class="headerlink" title="实际应用场景"></a>实际应用场景</h2><ol><li><strong>订单系统</strong>：订单的不同状态（待支付、已支付、待发货、已发货、已完成、已取消等）</li><li><strong>工作流系统</strong>：流程的不同状态（待处理、处理中、已完成、已拒绝等）</li><li><strong>游戏开发</strong>：游戏角色的不同状态（ idle、running、jumping、attacking 等）</li><li><strong>网络连接</strong>：网络连接的不同状态（断开、连接中、已连接、错误等）</li><li><strong>文档编辑器</strong>：文档的不同状态（编辑中、已保存、已锁定等）</li><li><strong>电梯系统</strong>：电梯的不同状态（停止、上升、下降、开门、关门等）</li></ol><h2 id="状态模式与策略模式的区别"><a href="#状态模式与策略模式的区别" class="headerlink" title="状态模式与策略模式的区别"></a>状态模式与策略模式的区别</h2><p>虽然状态模式和策略模式的结构相似，但它们的意图不同：</p><ol><li><strong>状态模式</strong>：关注对象状态的变化和状态之间的转换</li><li><strong>策略模式</strong>：关注算法的选择和替换</li><li><strong>状态转换</strong>：状态模式中，状态的转换通常由状态类自己控制；策略模式中，策略的选择由客户端控制</li><li><strong>状态数量</strong>：状态模式中，状态的数量通常是固定的；策略模式中，策略的数量可以根据需要添加</li></ol><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ol><li><strong>状态数量</strong>：如果状态数量过多，可能会导致类的数量激增</li><li><strong>状态转换</strong>：状态转换的逻辑需要仔细设计，避免出现循环转换</li><li><strong>上下文与状态的关系</strong>：上下文和状态之间可能存在循环引用，需要注意内存管理</li><li><strong>性能考虑</strong>：如果状态切换非常频繁，可能会有性能开销</li><li><strong>状态的持久化</strong>：如果需要持久化对象的状态，需要考虑状态的序列化</li></ol><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>状态模式是一种非常实用的设计模式，它通过将状态的行为封装在对应的状态类中，使得状态的管理更加清晰和可维护。状态模式不仅可以消除复杂的条件判断，还可以提高代码的可扩展性和可维护性。在实际开发中，当遇到对象有多个状态且状态之间需要相互转换的场景时，状态模式是一个很好的解决方案。</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> Python </tag>
            
            <tag> Java </tag>
            
            <tag> C# </tag>
            
            <tag> 设计模式 </tag>
            
            <tag> 行为型模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式——策略模式</title>
      <link href="/2026/01/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/"/>
      <url>/2026/01/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="策略模式（Strategy-Pattern）详解"><a href="#策略模式（Strategy-Pattern）详解" class="headerlink" title="策略模式（Strategy Pattern）详解"></a>策略模式（Strategy Pattern）详解</h1><h2 id="什么是策略模式"><a href="#什么是策略模式" class="headerlink" title="什么是策略模式"></a>什么是策略模式</h2><p>策略模式是一种行为型设计模式，它定义了一系列算法，并将每个算法封装起来，使它们可以相互替换。策略模式让算法的变化独立于使用算法的客户端。</p><h2 id="策略模式解决的问题"><a href="#策略模式解决的问题" class="headerlink" title="策略模式解决的问题"></a>策略模式解决的问题</h2><p>策略模式主要解决以下问题：</p><ol><li><strong>消除条件语句</strong>：避免使用大量的 <code>if-else</code> 或 <code>switch-case</code> 语句来选择不同的算法</li><li><strong>算法的动态切换</strong>：允许在运行时动态地切换算法</li><li><strong>算法的封装</strong>：将算法的实现细节封装起来，对客户端隐藏</li><li><strong>代码复用</strong>：通过接口复用不同的算法实现</li><li><strong>遵循开闭原则</strong>：可以在不修改现有代码的情况下添加新的算法</li></ol><h2 id="策略模式的好处"><a href="#策略模式的好处" class="headerlink" title="策略模式的好处"></a>策略模式的好处</h2><ol><li><strong>灵活性</strong>：可以轻松切换不同的算法实现</li><li><strong>可维护性</strong>：每个算法都有自己的类，职责单一，易于维护</li><li><strong>可扩展性</strong>：可以通过添加新的策略类来扩展功能</li><li><strong>可读性</strong>：避免了复杂的条件判断，代码结构清晰</li><li><strong>符合设计原则</strong>：遵循开闭原则和单一职责原则</li></ol><h2 id="策略模式的结构"><a href="#策略模式的结构" class="headerlink" title="策略模式的结构"></a>策略模式的结构</h2><p>策略模式包含以下几个角色：</p><ol><li><strong>策略接口（Strategy）</strong>：定义所有支持的算法的公共接口</li><li><strong>具体策略（Concrete Strategy）</strong>：实现策略接口的具体算法</li><li><strong>上下文（Context）</strong>：持有一个策略对象的引用，使用策略对象执行算法</li></ol><h2 id="各语言实现"><a href="#各语言实现" class="headerlink" title="各语言实现"></a>各语言实现</h2><h3 id="C-实现"><a href="#C-实现" class="headerlink" title="C++ 实现"></a>C++ 实现</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 策略接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">PaymentStrategy</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">pay</span><span class="params">(<span class="type">int</span> amount)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体策略：信用卡支付</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreditCardPayment</span> : <span class="keyword">public</span> PaymentStrategy &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string cardNumber;</span><br><span class="line">    std::string cardHolder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">CreditCardPayment</span>(<span class="type">const</span> std::string&amp; number, <span class="type">const</span> std::string&amp; holder)</span><br><span class="line">        : <span class="built_in">cardNumber</span>(number), <span class="built_in">cardHolder</span>(holder) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pay</span><span class="params">(<span class="type">int</span> amount)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;用信用卡支付 &quot;</span> &lt;&lt; amount &lt;&lt; <span class="string">&quot; 元，卡号：&quot;</span> &lt;&lt; cardNumber &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体策略：支付宝支付</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AlipayPayment</span> : <span class="keyword">public</span> PaymentStrategy &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string account;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">AlipayPayment</span>(<span class="type">const</span> std::string&amp; acc) : <span class="built_in">account</span>(acc) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pay</span><span class="params">(<span class="type">int</span> amount)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;用支付宝支付 &quot;</span> &lt;&lt; amount &lt;&lt; <span class="string">&quot; 元，账号：&quot;</span> &lt;&lt; account &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上下文：购物车</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShoppingCart</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    PaymentStrategy* paymentStrategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setPaymentStrategy</span><span class="params">(PaymentStrategy* strategy)</span> </span>&#123;</span><br><span class="line">        paymentStrategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">checkout</span><span class="params">(<span class="type">int</span> amount)</span> </span>&#123;</span><br><span class="line">        paymentStrategy-&gt;<span class="built_in">pay</span>(amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ShoppingCart cart;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用信用卡支付</span></span><br><span class="line">    <span class="function">CreditCardPayment <span class="title">creditCard</span><span class="params">(<span class="string">&quot;1234-5678-9012-3456&quot;</span>, <span class="string">&quot;张三&quot;</span>)</span></span>;</span><br><span class="line">    cart.<span class="built_in">setPaymentStrategy</span>(&amp;creditCard);</span><br><span class="line">    cart.<span class="built_in">checkout</span>(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 切换到支付宝支付</span></span><br><span class="line">    <span class="function">AlipayPayment <span class="title">alipay</span><span class="params">(<span class="string">&quot;zhangsan@example.com&quot;</span>)</span></span>;</span><br><span class="line">    cart.<span class="built_in">setPaymentStrategy</span>(&amp;alipay);</span><br><span class="line">    cart.<span class="built_in">checkout</span>(<span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Java-实现"><a href="#Java-实现" class="headerlink" title="Java 实现"></a>Java 实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 策略接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">int</span> amount)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体策略：信用卡支付</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreditCardPayment</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String cardNumber;</span><br><span class="line">    <span class="keyword">private</span> String cardHolder;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CreditCardPayment</span><span class="params">(String number, String holder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cardNumber = number;</span><br><span class="line">        <span class="built_in">this</span>.cardHolder = holder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;用信用卡支付 &quot;</span> + amount + <span class="string">&quot; 元，卡号：&quot;</span> + cardNumber);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体策略：支付宝支付</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AlipayPayment</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String account;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AlipayPayment</span><span class="params">(String account)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.account = account;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;用支付宝支付 &quot;</span> + amount + <span class="string">&quot; 元，账号：&quot;</span> + account);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上下文：购物车</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShoppingCart</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> PaymentStrategy paymentStrategy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPaymentStrategy</span><span class="params">(PaymentStrategy strategy)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.paymentStrategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkout</span><span class="params">(<span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        paymentStrategy.pay(amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StrategyPatternDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ShoppingCart</span> <span class="variable">cart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用信用卡支付</span></span><br><span class="line">        <span class="type">CreditCardPayment</span> <span class="variable">creditCard</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreditCardPayment</span>(<span class="string">&quot;1234-5678-9012-3456&quot;</span>, <span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        cart.setPaymentStrategy(creditCard);</span><br><span class="line">        cart.checkout(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 切换到支付宝支付</span></span><br><span class="line">        <span class="type">AlipayPayment</span> <span class="variable">alipay</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlipayPayment</span>(<span class="string">&quot;zhangsan@example.com&quot;</span>);</span><br><span class="line">        cart.setPaymentStrategy(alipay);</span><br><span class="line">        cart.checkout(<span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Python-实现"><a href="#Python-实现" class="headerlink" title="Python 实现"></a>Python 实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 策略接口</span></span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PaymentStrategy</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pay</span>(<span class="params">self, amount</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体策略：信用卡支付</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreditCardPayment</span>(<span class="title class_ inherited__">PaymentStrategy</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, card_number, card_holder</span>):</span><br><span class="line">        <span class="variable language_">self</span>.card_number = card_number</span><br><span class="line">        <span class="variable language_">self</span>.card_holder = card_holder</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pay</span>(<span class="params">self, amount</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;用信用卡支付 <span class="subst">&#123;amount&#125;</span> 元，卡号：<span class="subst">&#123;self.card_number&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体策略：支付宝支付</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AlipayPayment</span>(<span class="title class_ inherited__">PaymentStrategy</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, account</span>):</span><br><span class="line">        <span class="variable language_">self</span>.account = account</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pay</span>(<span class="params">self, amount</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;用支付宝支付 <span class="subst">&#123;amount&#125;</span> 元，账号：<span class="subst">&#123;self.account&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上下文：购物车</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShoppingCart</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.payment_strategy = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_payment_strategy</span>(<span class="params">self, strategy</span>):</span><br><span class="line">        <span class="variable language_">self</span>.payment_strategy = strategy</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">checkout</span>(<span class="params">self, amount</span>):</span><br><span class="line">        <span class="variable language_">self</span>.payment_strategy.pay(amount)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    cart = ShoppingCart()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 使用信用卡支付</span></span><br><span class="line">    credit_card = CreditCardPayment(<span class="string">&quot;1234-5678-9012-3456&quot;</span>, <span class="string">&quot;张三&quot;</span>)</span><br><span class="line">    cart.set_payment_strategy(credit_card)</span><br><span class="line">    cart.checkout(<span class="number">100</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 切换到支付宝支付</span></span><br><span class="line">    alipay = AlipayPayment(<span class="string">&quot;zhangsan@example.com&quot;</span>)</span><br><span class="line">    cart.set_payment_strategy(alipay)</span><br><span class="line">    cart.checkout(<span class="number">200</span>)</span><br></pre></td></tr></table></figure><h3 id="C-实现-1"><a href="#C-实现-1" class="headerlink" title="C# 实现"></a>C# 实现</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 策略接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title">IPaymentStrategy</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Pay</span>(<span class="params"><span class="built_in">int</span> amount</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体策略：信用卡支付</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">CreditCardPayment</span> : <span class="title">IPaymentStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> cardNumber;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> cardHolder;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CreditCardPayment</span>(<span class="params"><span class="built_in">string</span> number, <span class="built_in">string</span> holder</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.cardNumber = number;</span><br><span class="line">        <span class="keyword">this</span>.cardHolder = holder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Pay</span>(<span class="params"><span class="built_in">int</span> amount</span>)</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;用信用卡支付 <span class="subst">&#123;amount&#125;</span> 元，卡号：<span class="subst">&#123;cardNumber&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体策略：支付宝支付</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">AlipayPayment</span> : <span class="title">IPaymentStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> account;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AlipayPayment</span>(<span class="params"><span class="built_in">string</span> account</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.account = account;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Pay</span>(<span class="params"><span class="built_in">int</span> amount</span>)</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;用支付宝支付 <span class="subst">&#123;amount&#125;</span> 元，账号：<span class="subst">&#123;account&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上下文：购物车</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">ShoppingCart</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> IPaymentStrategy paymentStrategy;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetPaymentStrategy</span>(<span class="params">IPaymentStrategy strategy</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.paymentStrategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Checkout</span>(<span class="params"><span class="built_in">int</span> amount</span>)</span> &#123;</span><br><span class="line">        paymentStrategy.Pay(amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span> &#123;</span><br><span class="line">        ShoppingCart cart = <span class="keyword">new</span> ShoppingCart();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用信用卡支付</span></span><br><span class="line">        CreditCardPayment creditCard = <span class="keyword">new</span> CreditCardPayment(<span class="string">&quot;1234-5678-9012-3456&quot;</span>, <span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        cart.SetPaymentStrategy(creditCard);</span><br><span class="line">        cart.Checkout(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 切换到支付宝支付</span></span><br><span class="line">        AlipayPayment alipay = <span class="keyword">new</span> AlipayPayment(<span class="string">&quot;zhangsan@example.com&quot;</span>);</span><br><span class="line">        cart.SetPaymentStrategy(alipay);</span><br><span class="line">        cart.Checkout(<span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="策略模式的适用场景"><a href="#策略模式的适用场景" class="headerlink" title="策略模式的适用场景"></a>策略模式的适用场景</h2><p>策略模式适用于以下情况：</p><ol><li><strong>需要多种算法选择</strong>：当一个问题有多种解决方案，需要根据不同情况选择不同的算法时</li><li><strong>算法需要动态切换</strong>：当需要在运行时动态切换算法时</li><li><strong>避免复杂条件判断</strong>：当使用大量的条件语句来选择算法时</li><li><strong>算法需要封装</strong>：当需要将算法的实现细节对客户端隐藏时</li><li><strong>需要遵循开闭原则</strong>：当需要在不修改现有代码的情况下添加新的算法时</li></ol><h2 id="实际应用场景"><a href="#实际应用场景" class="headerlink" title="实际应用场景"></a>实际应用场景</h2><ol><li><strong>支付系统</strong>：不同的支付方式（信用卡、支付宝、微信支付等）</li><li><strong>排序算法</strong>：不同的排序策略（快速排序、归并排序、冒泡排序等）</li><li><strong>压缩算法</strong>：不同的压缩策略（ZIP、RAR、7Z等）</li><li><strong>日志系统</strong>：不同的日志输出策略（控制台、文件、数据库等）</li><li><strong>图形绘制</strong>：不同的绘制策略（2D、3D等）</li><li><strong>游戏AI</strong>：不同的AI行为策略</li></ol><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ol><li><strong>策略数量</strong>：如果策略数量过多，可能会导致类的数量激增</li><li><strong>策略选择</strong>：客户端需要知道有哪些策略可供选择</li><li><strong>性能考虑</strong>：如果策略的创建成本较高，可以考虑使用享元模式</li><li><strong>状态管理</strong>：策略对象通常是无状态的，如果需要维护状态，需要谨慎设计</li></ol><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>策略模式是一种非常实用的设计模式，它通过将算法封装成独立的策略类，使算法的选择和使用更加灵活。策略模式不仅可以消除复杂的条件判断，还可以提高代码的可维护性和可扩展性。在实际开发中，当遇到多种算法选择的场景时，策略模式是一个很好的解决方案。</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> Python </tag>
            
            <tag> Java </tag>
            
            <tag> C# </tag>
            
            <tag> 设计模式 </tag>
            
            <tag> 行为型模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java 8 新特性</title>
      <link href="/2026/01/23/Java-8-%E6%96%B0%E7%89%B9%E6%80%A7/"/>
      <url>/2026/01/23/Java-8-%E6%96%B0%E7%89%B9%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-8-新特性详解"><a href="#Java-8-新特性详解" class="headerlink" title="Java 8 新特性详解"></a>Java 8 新特性详解</h1><p>Java 8 是 Java 语言的一个重要版本，于 2014 年 3 月发布。它引入了许多新特性，这些特性不仅改变了 Java 代码的编写方式，也解决了之前版本中存在的一些问题。本文将详细介绍 Java 8 的主要新特性，包括它们的概念、解决的问题、代码示例以及应用场景。</p><h2 id="一、Lambda-表达式"><a href="#一、Lambda-表达式" class="headerlink" title="一、Lambda 表达式"></a>一、Lambda 表达式</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p><strong>Lambda 表达式</strong>是一种匿名函数，它允许我们将函数作为参数传递给方法，或者将代码作为数据处理。Lambda 表达式的语法简洁明了，使代码更加紧凑。</p><h3 id="解决的问题"><a href="#解决的问题" class="headerlink" title="解决的问题"></a>解决的问题</h3><ul><li><strong>代码冗余</strong>：之前的匿名内部类代码冗长，Lambda 表达式提供了更简洁的语法。</li><li><strong>函数式编程</strong>：Java 8 之前，Java 是一种面向对象的语言，不支持函数式编程。Lambda 表达式引入了函数式编程的思想。</li><li><strong>可读性差</strong>：匿名内部类的代码可读性差，Lambda 表达式使代码更加清晰。</li></ul><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(parameters) -&gt; expression</span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line">(parameters) -&gt; &#123;</span><br><span class="line">    statements;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h3><h4 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 Lambda 表达式实现 Runnable 接口</span></span><br><span class="line"><span class="type">Runnable</span> <span class="variable">runnable</span> <span class="operator">=</span> () -&gt; System.out.println(<span class="string">&quot;Hello Lambda!&quot;</span>);</span><br><span class="line">runnable.run(); <span class="comment">// 输出: Hello Lambda!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 Lambda 表达式实现 Comparator 接口</span></span><br><span class="line">List&lt;String&gt; names = Arrays.asList(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line">names.sort((s1, s2) -&gt; s1.compareTo(s2));</span><br><span class="line">System.out.println(names); <span class="comment">// 输出: [Alice, Bob, Charlie]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 Lambda 表达式作为方法参数</span></span><br><span class="line">names.forEach(name -&gt; System.out.println(name));</span><br></pre></td></tr></table></figure><h4 id="类型推断"><a href="#类型推断" class="headerlink" title="类型推断"></a>类型推断</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 编译器会根据上下文推断参数类型</span></span><br><span class="line">BinaryOperator&lt;Integer&gt; add = (a, b) -&gt; a + b;</span><br><span class="line">System.out.println(add.apply(<span class="number">1</span>, <span class="number">2</span>)); <span class="comment">// 输出: 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 显式指定参数类型</span></span><br><span class="line">BinaryOperator&lt;Integer&gt; subtract = (Integer a, Integer b) -&gt; a - b;</span><br><span class="line">System.out.println(subtract.apply(<span class="number">5</span>, <span class="number">3</span>)); <span class="comment">// 输出: 2</span></span><br></pre></td></tr></table></figure><h4 id="多行-Lambda-表达式"><a href="#多行-Lambda-表达式" class="headerlink" title="多行 Lambda 表达式"></a>多行 Lambda 表达式</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多行 Lambda 表达式需要使用花括号和 return 语句</span></span><br><span class="line">BinaryOperator&lt;Integer&gt; multiply = (a, b) -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Multiplying &quot;</span> + a + <span class="string">&quot; and &quot;</span> + b);</span><br><span class="line">    <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;;</span><br><span class="line">System.out.println(multiply.apply(<span class="number">3</span>, <span class="number">4</span>)); <span class="comment">// 输出: 12</span></span><br></pre></td></tr></table></figure><h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul><li><strong>函数式接口</strong>：实现只包含一个抽象方法的接口，如 Runnable、Comparator 等。</li><li><strong>集合操作</strong>：使用 forEach、sort 等方法操作集合。</li><li><strong>事件处理</strong>：处理 GUI 事件或其他回调函数。</li><li><strong>Stream API</strong>：与 Stream API 结合使用，进行数据处理。</li></ul><h2 id="二、Stream-API"><a href="#二、Stream-API" class="headerlink" title="二、Stream API"></a>二、Stream API</h2><h3 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h3><p><strong>Stream API</strong> 是 Java 8 引入的一个新的抽象，它允许我们以声明式的方式处理数据集合。Stream API 提供了丰富的操作，如过滤、映射、排序、聚合等。</p><h3 id="解决的问题-1"><a href="#解决的问题-1" class="headerlink" title="解决的问题"></a>解决的问题</h3><ul><li><strong>代码冗余</strong>：之前的集合处理代码冗长，Stream API 提供了更简洁的语法。</li><li><strong>并行处理</strong>：Stream API 内置了并行处理能力，简化了并行代码的编写。</li><li><strong>可读性差</strong>：传统的集合处理代码可读性差，Stream API 使代码更加清晰。</li><li><strong>性能优化</strong>：Stream API 可以自动优化处理过程，提高性能。</li></ul><h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h3><ul><li><strong>中间操作</strong>：返回一个新的 Stream，如 filter、map、sorted 等。</li><li><strong>终端操作</strong>：返回一个结果或副作用，如 forEach、collect、reduce 等。</li></ul><h3 id="代码示例-1"><a href="#代码示例-1" class="headerlink" title="代码示例"></a>代码示例</h3><h4 id="基本操作-1"><a href="#基本操作-1" class="headerlink" title="基本操作"></a>基本操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; names = Arrays.asList(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Charlie&quot;</span>, <span class="string">&quot;David&quot;</span>, <span class="string">&quot;Eve&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 过滤长度大于 3 的名字，并转换为大写</span></span><br><span class="line">List&lt;String&gt; result = names.stream()</span><br><span class="line">    .filter(name -&gt; name.length() &gt; <span class="number">3</span>)</span><br><span class="line">    .map(String::toUpperCase)</span><br><span class="line">    .collect(Collectors.toList());</span><br><span class="line">System.out.println(result); <span class="comment">// 输出: [ALICE, CHARLIE, DAVID]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算名字长度的总和</span></span><br><span class="line"><span class="type">int</span> <span class="variable">totalLength</span> <span class="operator">=</span> names.stream()</span><br><span class="line">    .mapToInt(String::length)</span><br><span class="line">    .sum();</span><br><span class="line">System.out.println(totalLength); <span class="comment">// 输出: 20</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找第一个长度大于 3 的名字</span></span><br><span class="line">Optional&lt;String&gt; first = names.stream()</span><br><span class="line">    .filter(name -&gt; name.length() &gt; <span class="number">3</span>)</span><br><span class="line">    .findFirst();</span><br><span class="line">System.out.println(first.orElse(<span class="string">&quot;Not found&quot;</span>)); <span class="comment">// 输出: Alice</span></span><br></pre></td></tr></table></figure><h4 id="并行处理"><a href="#并行处理" class="headerlink" title="并行处理"></a>并行处理</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 并行处理大型集合</span></span><br><span class="line">List&lt;Integer&gt; numbers = IntStream.rangeClosed(<span class="number">1</span>, <span class="number">1000000</span>)</span><br><span class="line">    .boxed()</span><br><span class="line">    .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 串行处理</span></span><br><span class="line"><span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"><span class="type">int</span> <span class="variable">sum1</span> <span class="operator">=</span> numbers.stream()</span><br><span class="line">    .filter(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">    .mapToInt(Integer::intValue)</span><br><span class="line">    .sum();</span><br><span class="line"><span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">System.out.println(<span class="string">&quot;串行处理结果: &quot;</span> + sum1 + <span class="string">&quot;, 用时: &quot;</span> + (end - start) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 并行处理</span></span><br><span class="line">start = System.currentTimeMillis();</span><br><span class="line"><span class="type">int</span> <span class="variable">sum2</span> <span class="operator">=</span> numbers.parallelStream()</span><br><span class="line">    .filter(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">    .mapToInt(Integer::intValue)</span><br><span class="line">    .sum();</span><br><span class="line">end = System.currentTimeMillis();</span><br><span class="line">System.out.println(<span class="string">&quot;并行处理结果: &quot;</span> + sum2 + <span class="string">&quot;, 用时: &quot;</span> + (end - start) + <span class="string">&quot;ms&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="高级操作"><a href="#高级操作" class="headerlink" title="高级操作"></a>高级操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分组</span></span><br><span class="line">Map&lt;Integer, List&lt;String&gt;&gt; groupByLength = names.stream()</span><br><span class="line">    .collect(Collectors.groupingBy(String::length));</span><br><span class="line">System.out.println(groupByLength); <span class="comment">// 输出: &#123;3=[Bob, Eve], 4=[Alice, Dave], 7=[Charlie]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 分区</span></span><br><span class="line">Map&lt;Boolean, List&lt;String&gt;&gt; partitionByLength = names.stream()</span><br><span class="line">    .collect(Collectors.partitioningBy(name -&gt; name.length() &gt; <span class="number">3</span>));</span><br><span class="line">System.out.println(partitionByLength); <span class="comment">// 输出: &#123;false=[Bob, Eve], true=[Alice, Charlie, Dave]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 归约</span></span><br><span class="line">Optional&lt;String&gt; concatenated = names.stream()</span><br><span class="line">    .reduce((s1, s2) -&gt; s1 + <span class="string">&quot;, &quot;</span> + s2);</span><br><span class="line">System.out.println(concatenated.orElse(<span class="string">&quot;&quot;</span>)); <span class="comment">// 输出: Alice, Bob, Charlie, Dave, Eve</span></span><br></pre></td></tr></table></figure><h3 id="应用场景-1"><a href="#应用场景-1" class="headerlink" title="应用场景"></a>应用场景</h3><ul><li><strong>数据过滤和转换</strong>：过滤集合中的元素，转换元素类型。</li><li><strong>数据聚合</strong>：计算总和、平均值、最大值、最小值等。</li><li><strong>数据分组和分区</strong>：根据条件对数据进行分组或分区。</li><li><strong>并行处理</strong>：处理大型数据集，提高性能。</li><li><strong>链式操作</strong>：将多个操作链接在一起，形成一个处理管道。</li></ul><h2 id="三、Optional-类"><a href="#三、Optional-类" class="headerlink" title="三、Optional 类"></a>三、Optional 类</h2><h3 id="概念-2"><a href="#概念-2" class="headerlink" title="概念"></a>概念</h3><p><strong>Optional</strong> 类是 Java 8 引入的一个容器类，它可以包含一个非空值，或者表示一个空值。Optional 类的目的是解决空指针异常（NullPointerException）的问题。</p><h3 id="解决的问题-2"><a href="#解决的问题-2" class="headerlink" title="解决的问题"></a>解决的问题</h3><ul><li><strong>空指针异常</strong>：Java 中最常见的异常之一，Optional 类提供了一种优雅的方式来处理可能为 null 的值。</li><li><strong>代码可读性</strong>：Optional 类的方法使代码更加清晰，表达了值可能不存在的意图。</li><li><strong>防御性编程</strong>：Optional 类鼓励程序员编写更加健壮的代码，避免空指针异常。</li></ul><h3 id="主要方法"><a href="#主要方法" class="headerlink" title="主要方法"></a>主要方法</h3><table><thead><tr><th>方法签名</th><th>描述</th></tr></thead><tbody><tr><td><strong>of(T value)</strong></td><td>创建一个包含非空值的 Optional 对象</td></tr><tr><td><strong>ofNullable(T value)</strong></td><td>创建一个可能包含 null 值的 Optional 对象</td></tr><tr><td><strong>empty()</strong></td><td>创建一个空的 Optional 对象</td></tr><tr><td><strong>isPresent()</strong></td><td>检查 Optional 对象是否包含值</td></tr><tr><td><strong>ifPresent(Consumer&lt;? super T&gt; consumer)</strong></td><td>如果 Optional 对象包含值，则执行消费者操作</td></tr><tr><td><strong>get()</strong></td><td>获取 Optional 对象中的值，如果值为 null，则抛出异常</td></tr><tr><td><strong>orElse(T other)</strong></td><td>获取 Optional 对象中的值，如果值为 null，则返回默认值</td></tr><tr><td><strong>orElseGet(Supplier&lt;? extends T&gt; other)</strong></td><td>获取 Optional 对象中的值，如果值为 null，则通过供应商函数获取默认值</td></tr><tr><td><strong>orElseThrow(Supplier&lt;? extends X&gt; exceptionSupplier)</strong></td><td>获取 Optional 对象中的值，如果值为 null，则抛出供应商函数提供的异常</td></tr><tr><td><strong>map(Function&lt;? super T, ? extends U&gt; mapper)</strong></td><td>如果 Optional 对象包含值，则对值应用映射函数</td></tr><tr><td><strong>flatMap(Function&lt;? super T, Optional<U>&gt; mapper)</strong></td><td>如果 Optional 对象包含值，则对值应用映射函数，返回映射后的 Optional 对象</td></tr><tr><td><strong>filter(Predicate&lt;? super T&gt; predicate)</strong></td><td>如果 Optional 对象包含值，并且值满足谓词条件，则返回该 Optional 对象，否则返回空的 Optional 对象</td></tr></tbody></table><h3 id="代码示例-2"><a href="#代码示例-2" class="headerlink" title="代码示例"></a>代码示例</h3><h4 id="基本用法-1"><a href="#基本用法-1" class="headerlink" title="基本用法"></a>基本用法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 Optional 对象</span></span><br><span class="line">Optional&lt;String&gt; optional1 = Optional.of(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">Optional&lt;String&gt; optional2 = Optional.ofNullable(<span class="literal">null</span>);</span><br><span class="line">Optional&lt;String&gt; optional3 = Optional.empty();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查值是否存在</span></span><br><span class="line">System.out.println(optional1.isPresent()); <span class="comment">// 输出: true</span></span><br><span class="line">System.out.println(optional2.isPresent()); <span class="comment">// 输出: false</span></span><br><span class="line">System.out.println(optional3.isPresent()); <span class="comment">// 输出: false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取值</span></span><br><span class="line">System.out.println(optional1.get()); <span class="comment">// 输出: Hello</span></span><br><span class="line"><span class="comment">// System.out.println(optional2.get()); // 抛出 NoSuchElementException</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取值，提供默认值</span></span><br><span class="line">System.out.println(optional1.orElse(<span class="string">&quot;Default&quot;</span>)); <span class="comment">// 输出: Hello</span></span><br><span class="line">System.out.println(optional2.orElse(<span class="string">&quot;Default&quot;</span>)); <span class="comment">// 输出: Default</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取值，通过供应商函数提供默认值</span></span><br><span class="line">System.out.println(optional1.orElseGet(() -&gt; <span class="string">&quot;Default&quot;</span>)); <span class="comment">// 输出: Hello</span></span><br><span class="line">System.out.println(optional2.orElseGet(() -&gt; <span class="string">&quot;Default&quot;</span>)); <span class="comment">// 输出: Default</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取值，抛出异常</span></span><br><span class="line">System.out.println(optional1.orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Value is null&quot;</span>))); <span class="comment">// 输出: Hello</span></span><br><span class="line"><span class="comment">// System.out.println(optional2.orElseThrow(() -&gt; new IllegalArgumentException(&quot;Value is null&quot;))); // 抛出 IllegalArgumentException</span></span><br></pre></td></tr></table></figure><h4 id="函数式操作"><a href="#函数式操作" class="headerlink" title="函数式操作"></a>函数式操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;String&gt; optional = Optional.of(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// map 操作</span></span><br><span class="line">Optional&lt;Integer&gt; lengthOptional = optional.map(String::length);</span><br><span class="line">System.out.println(lengthOptional.orElse(<span class="number">0</span>)); <span class="comment">// 输出: 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// flatMap 操作</span></span><br><span class="line">Optional&lt;String&gt; flatMapped = optional.flatMap(s -&gt; Optional.of(s.toUpperCase()));</span><br><span class="line">System.out.println(flatMapped.orElse(<span class="string">&quot;&quot;</span>)); <span class="comment">// 输出: HELLO</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// filter 操作</span></span><br><span class="line">Optional&lt;String&gt; filtered = optional.filter(s -&gt; s.length() &gt; <span class="number">3</span>);</span><br><span class="line">System.out.println(filtered.orElse(<span class="string">&quot;Not found&quot;</span>)); <span class="comment">// 输出: Hello</span></span><br><span class="line"></span><br><span class="line">Optional&lt;String&gt; filtered2 = optional.filter(s -&gt; s.length() &gt; <span class="number">10</span>);</span><br><span class="line">System.out.println(filtered2.orElse(<span class="string">&quot;Not found&quot;</span>)); <span class="comment">// 输出: Not found</span></span><br></pre></td></tr></table></figure><h4 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 传统方式：可能会导致空指针异常</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getUserName</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (user != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> user.getName();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Unknown&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 Optional：更加优雅</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getUserNameWithOptional</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Optional.ofNullable(user)</span><br><span class="line">        .map(User::getName)</span><br><span class="line">        .orElse(<span class="string">&quot;Unknown&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 链式操作</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getAddressCity</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Optional.ofNullable(user)</span><br><span class="line">        .map(User::getAddress)</span><br><span class="line">        .map(Address::getCity)</span><br><span class="line">        .orElse(<span class="string">&quot;Unknown City&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="应用场景-2"><a href="#应用场景-2" class="headerlink" title="应用场景"></a>应用场景</h3><ul><li><strong>避免空指针异常</strong>：处理可能为 null 的值，避免空指针异常。</li><li><strong>方法返回值</strong>：当方法可能返回 null 时，使用 Optional 作为返回类型，明确表达值可能不存在的意图。</li><li><strong>链式调用</strong>：通过 Optional 的 map 和 flatMap 方法，实现安全的链式调用。</li><li><strong>配置值处理</strong>：处理可能不存在的配置值，提供默认值。</li><li><strong>API 设计</strong>：设计更加健壮的 API，避免 null 返回值。</li></ul><h2 id="四、默认方法"><a href="#四、默认方法" class="headerlink" title="四、默认方法"></a>四、默认方法</h2><h3 id="概念-3"><a href="#概念-3" class="headerlink" title="概念"></a>概念</h3><p><strong>默认方法</strong>是 Java 8 引入的一个新特性，它允许在接口中定义带有默认实现的方法。默认方法的目的是为了向后兼容，使得接口可以在不破坏现有实现的情况下添加新方法。</p><h3 id="解决的问题-3"><a href="#解决的问题-3" class="headerlink" title="解决的问题"></a>解决的问题</h3><ul><li><strong>向后兼容</strong>：在 Java 8 之前，接口不能添加新方法，否则会破坏所有现有实现。默认方法解决了这个问题。</li><li><strong>代码复用</strong>：默认方法允许在接口中提供方法实现，实现了接口级别的代码复用。</li><li><strong>函数式接口</strong>：默认方法使得接口可以包含多个方法，同时仍然保持函数式接口的特性（只需要一个抽象方法）。</li></ul><h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MyInterface</span> &#123;</span><br><span class="line">    <span class="comment">// 抽象方法</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">abstractMethod</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 默认方法</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">defaultMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Default method implementation&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="代码示例-3"><a href="#代码示例-3" class="headerlink" title="代码示例"></a>代码示例</h3><h4 id="基本用法-2"><a href="#基本用法-2" class="headerlink" title="基本用法"></a>基本用法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">honk</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Beep beep!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> <span class="keyword">implements</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Car started&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 可选：重写默认方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">honk</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Car honks: Beep beep!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bicycle</span> <span class="keyword">implements</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Bicycle started&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 不重写默认方法，使用接口提供的实现</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>();</span><br><span class="line">        car.start(); <span class="comment">// 输出: Car started</span></span><br><span class="line">        car.honk(); <span class="comment">// 输出: Car honks: Beep beep!</span></span><br><span class="line">        </span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">bicycle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bicycle</span>();</span><br><span class="line">        bicycle.start(); <span class="comment">// 输出: Bicycle started</span></span><br><span class="line">        bicycle.honk(); <span class="comment">// 输出: Beep beep!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="接口冲突"><a href="#接口冲突" class="headerlink" title="接口冲突"></a>接口冲突</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;A.method()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">B</span> &#123;</span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;B.method()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现两个接口，必须重写冲突的默认方法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> <span class="keyword">implements</span> <span class="title class_">A</span>, B &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 可以选择调用其中一个接口的默认方法</span></span><br><span class="line">        A.<span class="built_in">super</span>.method();</span><br><span class="line">        <span class="comment">// 或者提供自己的实现</span></span><br><span class="line">        System.out.println(<span class="string">&quot;C.method()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">C</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">C</span>();</span><br><span class="line">        c.method(); <span class="comment">// 输出: A.method() 和 C.method()</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="实际应用-1"><a href="#实际应用-1" class="headerlink" title="实际应用"></a>实际应用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 8 中的 Collection 接口添加了默认方法</span></span><br><span class="line">List&lt;String&gt; names = Arrays.asList(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// forEach 是一个默认方法</span></span><br><span class="line">names.forEach(name -&gt; System.out.println(name));</span><br><span class="line"></span><br><span class="line"><span class="comment">// removeIf 是一个默认方法</span></span><br><span class="line">names.removeIf(name -&gt; name.length() &gt; <span class="number">3</span>);</span><br><span class="line">System.out.println(names); <span class="comment">// 输出: [Bob]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// replaceAll 是一个默认方法</span></span><br><span class="line">names.replaceAll(String::toUpperCase);</span><br><span class="line">System.out.println(names); <span class="comment">// 输出: [BOB]</span></span><br></pre></td></tr></table></figure><h3 id="应用场景-3"><a href="#应用场景-3" class="headerlink" title="应用场景"></a>应用场景</h3><ul><li><strong>接口扩展</strong>：在不破坏现有实现的情况下，为接口添加新方法。</li><li><strong>代码复用</strong>：在接口中提供通用的方法实现，实现接口级别的代码复用。</li><li><strong>函数式接口</strong>：创建包含多个默认方法的函数式接口，只需要一个抽象方法。</li><li><strong>向后兼容</strong>：为老接口添加新功能，同时保持向后兼容。</li></ul><h2 id="五、方法引用"><a href="#五、方法引用" class="headerlink" title="五、方法引用"></a>五、方法引用</h2><h3 id="概念-4"><a href="#概念-4" class="headerlink" title="概念"></a>概念</h3><p><strong>方法引用</strong>是 Java 8 引入的一个新特性，它允许我们直接引用已有的方法，而不需要创建 Lambda 表达式。方法引用的语法简洁明了，使代码更加紧凑。</p><h3 id="解决的问题-4"><a href="#解决的问题-4" class="headerlink" title="解决的问题"></a>解决的问题</h3><ul><li><strong>代码冗余</strong>：当 Lambda 表达式只是调用一个已有的方法时，方法引用提供了更简洁的语法。</li><li><strong>可读性差</strong>：方法引用使代码更加清晰，直接表达了要调用的方法。</li></ul><h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><ul><li><strong>静态方法引用</strong>：<code>ClassName::staticMethod</code></li><li><strong>实例方法引用</strong>：<code>instance::instanceMethod</code></li><li><strong>类的实例方法引用</strong>：<code>ClassName::instanceMethod</code></li><li><strong>构造方法引用</strong>：<code>ClassName::new</code></li></ul><h3 id="代码示例-4"><a href="#代码示例-4" class="headerlink" title="代码示例"></a>代码示例</h3><h4 id="静态方法引用"><a href="#静态方法引用" class="headerlink" title="静态方法引用"></a>静态方法引用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 静态方法引用</span></span><br><span class="line">List&lt;String&gt; names = Arrays.asList(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 Lambda 表达式</span></span><br><span class="line">names.forEach(name -&gt; System.out.println(name));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用方法引用</span></span><br><span class="line">names.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态方法引用作为函数式接口的实现</span></span><br><span class="line">Function&lt;Integer, String&gt; converter = String::valueOf;</span><br><span class="line">System.out.println(converter.apply(<span class="number">42</span>)); <span class="comment">// 输出: 42</span></span><br></pre></td></tr></table></figure><h4 id="实例方法引用"><a href="#实例方法引用" class="headerlink" title="实例方法引用"></a>实例方法引用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实例方法引用</span></span><br><span class="line">List&lt;String&gt; names = Arrays.asList(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个实例</span></span><br><span class="line"><span class="type">StringFormatter</span> <span class="variable">formatter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringFormatter</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 Lambda 表达式</span></span><br><span class="line">names.forEach(name -&gt; formatter.format(name));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用方法引用</span></span><br><span class="line">names.forEach(formatter::format);</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StringFormatter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">format</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Formatted: &quot;</span> + str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="类的实例方法引用"><a href="#类的实例方法引用" class="headerlink" title="类的实例方法引用"></a>类的实例方法引用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类的实例方法引用</span></span><br><span class="line">List&lt;String&gt; names = Arrays.asList(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 Lambda 表达式</span></span><br><span class="line">names.sort((s1, s2) -&gt; s1.compareTo(s2));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用方法引用</span></span><br><span class="line">names.sort(String::compareTo);</span><br><span class="line">System.out.println(names); <span class="comment">// 输出: [Alice, Bob, Charlie]</span></span><br></pre></td></tr></table></figure><h4 id="构造方法引用"><a href="#构造方法引用" class="headerlink" title="构造方法引用"></a>构造方法引用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构造方法引用</span></span><br><span class="line">List&lt;String&gt; names = Arrays.asList(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 Lambda 表达式</span></span><br><span class="line">List&lt;User&gt; users = names.stream()</span><br><span class="line">    .map(name -&gt; <span class="keyword">new</span> <span class="title class_">User</span>(name))</span><br><span class="line">    .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用方法引用</span></span><br><span class="line">List&lt;User&gt; users2 = names.stream()</span><br><span class="line">    .map(User::<span class="keyword">new</span>)</span><br><span class="line">    .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;name=&#x27;&quot;</span> + name + <span class="string">&quot;&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="应用场景-4"><a href="#应用场景-4" class="headerlink" title="应用场景"></a>应用场景</h3><ul><li><strong>简化 Lambda 表达式</strong>：当 Lambda 表达式只是调用一个已有的方法时，使用方法引用使代码更加简洁。</li><li><strong>提高可读性</strong>：方法引用直接表达了要调用的方法，使代码更加清晰。</li><li><strong>与 Stream API 结合</strong>：在 Stream API 的操作中，使用方法引用可以使代码更加紧凑。</li></ul><h2 id="六、日期时间-API"><a href="#六、日期时间-API" class="headerlink" title="六、日期时间 API"></a>六、日期时间 API</h2><h3 id="概念-5"><a href="#概念-5" class="headerlink" title="概念"></a>概念</h3><p><strong>日期时间 API</strong> 是 Java 8 引入的一个新的日期时间处理库，它位于 <code>java.time</code> 包中。新的日期时间 API 解决了旧的 <code>java.util.Date</code> 和 <code>java.util.Calendar</code> 类存在的问题，提供了更加清晰、更加易用的日期时间处理功能。</p><h3 id="解决的问题-5"><a href="#解决的问题-5" class="headerlink" title="解决的问题"></a>解决的问题</h3><ul><li><strong>可变性</strong>：旧的日期时间类是可变的，容易导致并发问题。新的日期时间类是不可变的，更加安全。</li><li><strong>设计混乱</strong>：旧的日期时间类设计混乱，<code>Date</code> 类同时包含日期和时间，<code>Calendar</code> 类用于日期时间的计算。新的日期时间 API 有明确的职责划分。</li><li><strong>时区处理</strong>：旧的日期时间类时区处理复杂。新的日期时间 API 提供了更好的时区支持。</li><li><strong>格式化和解析</strong>：旧的日期时间类的格式化和解析功能有限。新的日期时间 API 提供了更强大的格式化和解析功能。</li></ul><h3 id="主要类"><a href="#主要类" class="headerlink" title="主要类"></a>主要类</h3><ul><li><strong>LocalDate</strong>：表示日期，不包含时间和时区。</li><li><strong>LocalTime</strong>：表示时间，不包含日期和时区。</li><li><strong>LocalDateTime</strong>：表示日期和时间，不包含时区。</li><li><strong>ZonedDateTime</strong>：表示日期、时间和时区。</li><li><strong>Instant</strong>：表示时间戳，从 UTC 1970-01-01 00:00:00 开始的秒数。</li><li><strong>Duration</strong>：表示时间间隔。</li><li><strong>Period</strong>：表示日期间隔。</li><li><strong>DateTimeFormatter</strong>：用于日期时间的格式化和解析。</li></ul><h3 id="代码示例-5"><a href="#代码示例-5" class="headerlink" title="代码示例"></a>代码示例</h3><h4 id="基本操作-2"><a href="#基本操作-2" class="headerlink" title="基本操作"></a>基本操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取当前日期</span></span><br><span class="line"><span class="type">LocalDate</span> <span class="variable">today</span> <span class="operator">=</span> LocalDate.now();</span><br><span class="line">System.out.println(<span class="string">&quot;Today: &quot;</span> + today); <span class="comment">// 输出: 2026-01-23</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前时间</span></span><br><span class="line"><span class="type">LocalTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalTime.now();</span><br><span class="line">System.out.println(<span class="string">&quot;Now: &quot;</span> + now); <span class="comment">// 输出: 10:00:00.123</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前日期时间</span></span><br><span class="line"><span class="type">LocalDateTime</span> <span class="variable">current</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">System.out.println(<span class="string">&quot;Current: &quot;</span> + current); <span class="comment">// 输出: 2026-01-23T10:00:00.123</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前时间戳</span></span><br><span class="line"><span class="type">Instant</span> <span class="variable">instant</span> <span class="operator">=</span> Instant.now();</span><br><span class="line">System.out.println(<span class="string">&quot;Instant: &quot;</span> + instant); <span class="comment">// 输出: 2026-01-23T10:00:00.123Z</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建指定日期</span></span><br><span class="line"><span class="type">LocalDate</span> <span class="variable">date</span> <span class="operator">=</span> LocalDate.of(<span class="number">2026</span>, <span class="number">1</span>, <span class="number">23</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;Date: &quot;</span> + date); <span class="comment">// 输出: 2026-01-23</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建指定时间</span></span><br><span class="line"><span class="type">LocalTime</span> <span class="variable">time</span> <span class="operator">=</span> LocalTime.of(<span class="number">10</span>, <span class="number">30</span>, <span class="number">45</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;Time: &quot;</span> + time); <span class="comment">// 输出: 10:30:45</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建指定日期时间</span></span><br><span class="line"><span class="type">LocalDateTime</span> <span class="variable">dateTime</span> <span class="operator">=</span> LocalDateTime.of(<span class="number">2026</span>, <span class="number">1</span>, <span class="number">23</span>, <span class="number">10</span>, <span class="number">30</span>, <span class="number">45</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;DateTime: &quot;</span> + dateTime); <span class="comment">// 输出: 2026-01-23T10:30:45</span></span><br></pre></td></tr></table></figure><h4 id="日期时间计算"><a href="#日期时间计算" class="headerlink" title="日期时间计算"></a>日期时间计算</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 日期计算</span></span><br><span class="line"><span class="type">LocalDate</span> <span class="variable">today</span> <span class="operator">=</span> LocalDate.now();</span><br><span class="line"><span class="type">LocalDate</span> <span class="variable">tomorrow</span> <span class="operator">=</span> today.plusDays(<span class="number">1</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;Tomorrow: &quot;</span> + tomorrow); <span class="comment">// 输出: 2026-01-24</span></span><br><span class="line"></span><br><span class="line"><span class="type">LocalDate</span> <span class="variable">nextWeek</span> <span class="operator">=</span> today.plusWeeks(<span class="number">1</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;Next week: &quot;</span> + nextWeek); <span class="comment">// 输出: 2026-01-30</span></span><br><span class="line"></span><br><span class="line"><span class="type">LocalDate</span> <span class="variable">nextMonth</span> <span class="operator">=</span> today.plusMonths(<span class="number">1</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;Next month: &quot;</span> + nextMonth); <span class="comment">// 输出: 2026-02-23</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 时间计算</span></span><br><span class="line"><span class="type">LocalTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalTime.now();</span><br><span class="line"><span class="type">LocalTime</span> <span class="variable">later</span> <span class="operator">=</span> now.plusHours(<span class="number">1</span>).plusMinutes(<span class="number">30</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;Later: &quot;</span> + later); <span class="comment">// 输出: 11:30:00.123</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 日期时间计算</span></span><br><span class="line"><span class="type">LocalDateTime</span> <span class="variable">current</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line"><span class="type">LocalDateTime</span> <span class="variable">future</span> <span class="operator">=</span> current.plusDays(<span class="number">1</span>).plusHours(<span class="number">2</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;Future: &quot;</span> + future); <span class="comment">// 输出: 2026-01-24T12:00:00.123</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算时间间隔</span></span><br><span class="line"><span class="type">Duration</span> <span class="variable">duration</span> <span class="operator">=</span> Duration.between(LocalTime.of(<span class="number">10</span>, <span class="number">0</span>), LocalTime.of(<span class="number">12</span>, <span class="number">30</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;Duration in hours: &quot;</span> + duration.toHours()); <span class="comment">// 输出: 2</span></span><br><span class="line">System.out.println(<span class="string">&quot;Duration in minutes: &quot;</span> + duration.toMinutes()); <span class="comment">// 输出: 150</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算日期间隔</span></span><br><span class="line"><span class="type">Period</span> <span class="variable">period</span> <span class="operator">=</span> Period.between(LocalDate.of(<span class="number">2026</span>, <span class="number">1</span>, <span class="number">1</span>), LocalDate.of(<span class="number">2026</span>, <span class="number">12</span>, <span class="number">31</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;Period in months: &quot;</span> + period.getMonths()); <span class="comment">// 输出: 11</span></span><br><span class="line">System.out.println(<span class="string">&quot;Period in days: &quot;</span> + period.getDays()); <span class="comment">// 输出: 30</span></span><br></pre></td></tr></table></figure><h4 id="格式化和解析"><a href="#格式化和解析" class="headerlink" title="格式化和解析"></a>格式化和解析</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 格式化日期时间</span></span><br><span class="line"><span class="type">LocalDateTime</span> <span class="variable">dateTime</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line"><span class="type">DateTimeFormatter</span> <span class="variable">formatter</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">formattedDateTime</span> <span class="operator">=</span> dateTime.format(formatter);</span><br><span class="line">System.out.println(<span class="string">&quot;Formatted: &quot;</span> + formattedDateTime); <span class="comment">// 输出: 2026-01-23 10:00:00</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析日期时间</span></span><br><span class="line"><span class="type">String</span> <span class="variable">dateTimeStr</span> <span class="operator">=</span> <span class="string">&quot;2026-01-23 10:30:45&quot;</span>;</span><br><span class="line"><span class="type">LocalDateTime</span> <span class="variable">parsedDateTime</span> <span class="operator">=</span> LocalDateTime.parse(dateTimeStr, formatter);</span><br><span class="line">System.out.println(<span class="string">&quot;Parsed: &quot;</span> + parsedDateTime); <span class="comment">// 输出: 2026-01-23T10:30:45</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 预定义格式化器</span></span><br><span class="line"><span class="type">LocalDate</span> <span class="variable">date</span> <span class="operator">=</span> LocalDate.now();</span><br><span class="line"><span class="type">String</span> <span class="variable">isoDate</span> <span class="operator">=</span> date.format(DateTimeFormatter.ISO_DATE);</span><br><span class="line">System.out.println(<span class="string">&quot;ISO date: &quot;</span> + isoDate); <span class="comment">// 输出: 2026-01-23</span></span><br><span class="line"></span><br><span class="line"><span class="type">LocalDateTime</span> <span class="variable">dateTime2</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line"><span class="type">String</span> <span class="variable">isoDateTime</span> <span class="operator">=</span> dateTime2.format(DateTimeFormatter.ISO_DATE_TIME);</span><br><span class="line">System.out.println(<span class="string">&quot;ISO date time: &quot;</span> + isoDateTime); <span class="comment">// 输出: 2026-01-23T10:00:00.123</span></span><br></pre></td></tr></table></figure><h4 id="时区处理"><a href="#时区处理" class="headerlink" title="时区处理"></a>时区处理</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 时区处理</span></span><br><span class="line"><span class="type">ZonedDateTime</span> <span class="variable">zonedDateTime</span> <span class="operator">=</span> ZonedDateTime.now();</span><br><span class="line">System.out.println(<span class="string">&quot;Current zoned date time: &quot;</span> + zonedDateTime); <span class="comment">// 输出: 2026-01-23T10:00:00.123+08:00[Asia/Shanghai]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建指定时区的日期时间</span></span><br><span class="line"><span class="type">ZonedDateTime</span> <span class="variable">newYorkTime</span> <span class="operator">=</span> ZonedDateTime.now(ZoneId.of(<span class="string">&quot;America/New_York&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;New York time: &quot;</span> + newYorkTime); <span class="comment">// 输出: 2026-01-22T21:00:00.123-05:00[America/New_York]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 时区转换</span></span><br><span class="line"><span class="type">ZonedDateTime</span> <span class="variable">tokyoTime</span> <span class="operator">=</span> newYorkTime.withZoneSameInstant(ZoneId.of(<span class="string">&quot;Asia/Tokyo&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;Tokyo time: &quot;</span> + tokyoTime); <span class="comment">// 输出: 2026-01-23T11:00:00.123+09:00[Asia/Tokyo]</span></span><br></pre></td></tr></table></figure><h3 id="应用场景-5"><a href="#应用场景-5" class="headerlink" title="应用场景"></a>应用场景</h3><ul><li><strong>日期时间处理</strong>：处理日期、时间、日期时间等。</li><li><strong>日期时间计算</strong>：计算日期时间的差值、添加或减去时间间隔等。</li><li><strong>日期时间格式化</strong>：将日期时间格式化为字符串，或者将字符串解析为日期时间。</li><li><strong>时区处理</strong>：处理不同时区的日期时间，进行时区转换。</li><li><strong>时间戳处理</strong>：处理时间戳，进行时间戳和日期时间的转换。</li></ul><h2 id="七、其他新特性"><a href="#七、其他新特性" class="headerlink" title="七、其他新特性"></a>七、其他新特性</h2><h3 id="1-Base64-编码"><a href="#1-Base64-编码" class="headerlink" title="1. Base64 编码"></a>1. Base64 编码</h3><p>Java 8 引入了内置的 Base64 编码和解码功能，位于 <code>java.util.Base64</code> 类中。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Base64 编码</span></span><br><span class="line"><span class="type">String</span> <span class="variable">original</span> <span class="operator">=</span> <span class="string">&quot;Hello, Base64!&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">encoded</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(original.getBytes());</span><br><span class="line">System.out.println(<span class="string">&quot;Encoded: &quot;</span> + encoded); <span class="comment">// 输出: SGVsbG8sIEJhc2U2NCE=</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Base64 解码</span></span><br><span class="line"><span class="type">byte</span>[] decodedBytes = Base64.getDecoder().decode(encoded);</span><br><span class="line"><span class="type">String</span> <span class="variable">decoded</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(decodedBytes);</span><br><span class="line">System.out.println(<span class="string">&quot;Decoded: &quot;</span> + decoded); <span class="comment">// 输出: Hello, Base64!</span></span><br></pre></td></tr></table></figure><h3 id="2-并行数组操作"><a href="#2-并行数组操作" class="headerlink" title="2. 并行数组操作"></a>2. 并行数组操作</h3><p>Java 8 为数组添加了并行操作方法，位于 <code>java.util.Arrays</code> 类中。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 并行排序</span></span><br><span class="line"><span class="type">int</span>[] numbers = &#123;<span class="number">5</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">6</span>&#125;;</span><br><span class="line">Arrays.parallelSort(numbers);</span><br><span class="line">System.out.println(Arrays.toString(numbers)); <span class="comment">// 输出: [1, 2, 3, 4, 5, 6, 7, 8, 9]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 并行前缀</span></span><br><span class="line"><span class="type">int</span>[] arr = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">Arrays.parallelPrefix(arr, (a, b) -&gt; a + b);</span><br><span class="line">System.out.println(Arrays.toString(arr)); <span class="comment">// 输出: [1, 3, 6, 10, 15]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 并行设置</span></span><br><span class="line"><span class="type">int</span>[] arr2 = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">5</span>];</span><br><span class="line">Arrays.parallelSetAll(arr2, i -&gt; i * <span class="number">2</span>);</span><br><span class="line">System.out.println(Arrays.toString(arr2)); <span class="comment">// 输出: [0, 2, 4, 6, 8]</span></span><br></pre></td></tr></table></figure><h3 id="3-重复注解"><a href="#3-重复注解" class="headerlink" title="3. 重复注解"></a>3. 重复注解</h3><p>Java 8 允许在同一位置重复使用相同的注解。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义可重复的注解</span></span><br><span class="line"><span class="meta">@Repeatable(Filters.class)</span></span><br><span class="line"><span class="meta">@interface</span> Filter &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 容器注解</span></span><br><span class="line"><span class="meta">@interface</span> Filters &#123;</span><br><span class="line">    Filter[] value();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用重复注解</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="meta">@Filter(&quot;filter1&quot;)</span></span><br><span class="line">    <span class="meta">@Filter(&quot;filter2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-类型注解"><a href="#4-类型注解" class="headerlink" title="4. 类型注解"></a>4. 类型注解</h3><p>Java 8 允许在更多的位置使用注解，包括类型参数、类型变量、数组元素等。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类型注解</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="comment">// 类型参数注解</span></span><br><span class="line">    <span class="keyword">public</span> &lt;<span class="meta">@NonNull</span> T&gt; <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">(T t)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型变量注解</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">(List&lt;<span class="meta">@NonNull</span> String&gt; list)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 数组元素注解</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method3</span><span class="params">(<span class="meta">@NonNull</span> String[] array)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="八、Java-8-新特性的实际应用"><a href="#八、Java-8-新特性的实际应用" class="headerlink" title="八、Java 8 新特性的实际应用"></a>八、Java 8 新特性的实际应用</h2><h3 id="1-Web-开发"><a href="#1-Web-开发" class="headerlink" title="1. Web 开发"></a>1. Web 开发</h3><ul><li><strong>Stream API</strong>：处理 HTTP 请求和响应中的数据。</li><li><strong>Lambda 表达式</strong>：简化事件处理和回调函数。</li><li><strong>Optional</strong>：处理可能不存在的请求参数和响应数据。</li><li><strong>日期时间 API</strong>：处理时间戳和日期时间数据。</li></ul><h3 id="2-大数据处理"><a href="#2-大数据处理" class="headerlink" title="2. 大数据处理"></a>2. 大数据处理</h3><ul><li><strong>Stream API</strong>：处理大型数据集，支持并行处理。</li><li><strong>Lambda 表达式</strong>：简化数据处理逻辑。</li><li><strong>方法引用</strong>：简化代码，提高可读性。</li></ul><h3 id="3-移动应用开发"><a href="#3-移动应用开发" class="headerlink" title="3. 移动应用开发"></a>3. 移动应用开发</h3><ul><li><strong>Lambda 表达式</strong>：简化事件处理和异步操作。</li><li><strong>Optional</strong>：处理可能不存在的数据，避免空指针异常。</li><li><strong>日期时间 API</strong>：处理时间和日期数据。</li></ul><h3 id="4-企业应用开发"><a href="#4-企业应用开发" class="headerlink" title="4. 企业应用开发"></a>4. 企业应用开发</h3><ul><li><strong>Stream API</strong>：处理业务数据，支持并行处理。</li><li><strong>Lambda 表达式</strong>：简化业务逻辑代码。</li><li><strong>Optional</strong>：处理可能不存在的业务数据，避免空指针异常。</li><li><strong>默认方法</strong>：为接口添加新功能，保持向后兼容。</li><li><strong>日期时间 API</strong>：处理业务时间和日期数据。</li></ul><h2 id="九、总结"><a href="#九、总结" class="headerlink" title="九、总结"></a>九、总结</h2><p>Java 8 引入了许多重要的新特性，这些特性不仅改变了 Java 代码的编写方式，也解决了之前版本中存在的一些问题：</p><ol><li><strong>Lambda 表达式</strong>：引入了函数式编程的思想，简化了代码。</li><li><strong>Stream API</strong>：提供了一种声明式的数据处理方式，支持并行处理。</li><li><strong>Optional 类</strong>：解决了空指针异常的问题，使代码更加健壮。</li><li><strong>默认方法</strong>：允许在接口中定义默认实现，实现了向后兼容。</li><li><strong>方法引用</strong>：简化了 Lambda 表达式，使代码更加清晰。</li><li><strong>日期时间 API</strong>：提供了更加清晰、更加易用的日期时间处理功能。</li></ol><p>这些新特性的引入，使得 Java 8 成为了 Java 语言发展的一个重要里程碑。它们不仅提高了开发效率，也使代码更加清晰、更加健壮。在实际开发中，我们应该充分利用这些新特性，编写更加优雅、更加高效的 Java 代码。</p><p>Java 8 的新特性为我们打开了一扇新的大门，让我们能够以一种更加现代、更加函数式的方式编写 Java 代码。无论是处理集合数据、处理日期时间，还是避免空指针异常，Java 8 都提供了更加优雅的解决方案。让我们拥抱这些新特性，享受 Java 8 带来的编程乐趣！</p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Java 8 </tag>
            
            <tag> Lambda表达式 </tag>
            
            <tag> Stream API </tag>
            
            <tag> Optional </tag>
            
            <tag> 默认方法 </tag>
            
            <tag> 方法引用 </tag>
            
            <tag> 日期时间API </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式六大原则</title>
      <link href="/2026/01/22/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%85%AD%E5%A4%A7%E5%8E%9F%E5%88%99/"/>
      <url>/2026/01/22/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%85%AD%E5%A4%A7%E5%8E%9F%E5%88%99/</url>
      
        <content type="html"><![CDATA[<h1 id="设计模式六大原则详解"><a href="#设计模式六大原则详解" class="headerlink" title="设计模式六大原则详解"></a>设计模式六大原则详解</h1><p>设计模式的六大原则是软件设计的基础，它们为我们提供了一套指导原则，帮助我们设计出更加灵活、可维护、可扩展的软件系统。本文将详细阐述这六大原则，包括它们的概念、解决的问题、适用场景以及代码示例。</p><h2 id="一、单一职责原则-Single-Responsibility-Principle-SRP"><a href="#一、单一职责原则-Single-Responsibility-Principle-SRP" class="headerlink" title="一、单一职责原则 (Single Responsibility Principle, SRP)"></a>一、单一职责原则 (Single Responsibility Principle, SRP)</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p><strong>单一职责原则</strong>：一个类应该只负责一项职责，或者说，一个类只应该有一个引起它变化的原因。</p><h3 id="解决的问题"><a href="#解决的问题" class="headerlink" title="解决的问题"></a>解决的问题</h3><ul><li><strong>职责过多</strong>：一个类承担了过多的职责，导致类变得复杂，难以维护。</li><li><strong>耦合度高</strong>：当一个职责发生变化时，可能会影响到其他职责，导致系统变得脆弱。</li><li><strong>可维护性差</strong>：职责过多的类难以理解和维护，测试也变得困难。</li></ul><h3 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h3><ul><li><strong>类的职责划分</strong>：当一个类承担了多个职责时，应该考虑将其拆分为多个类。</li><li><strong>方法的职责划分</strong>：当一个方法承担了多个职责时，应该考虑将其拆分为多个方法。</li><li><strong>模块的职责划分</strong>：当一个模块承担了多个职责时，应该考虑将其拆分为多个模块。</li></ul><h3 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h3><h4 id="违反单一职责原则的示例"><a href="#违反单一职责原则的示例" class="headerlink" title="违反单一职责原则的示例"></a>违反单一职责原则的示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 违反单一职责原则的类：同时负责用户管理和日志记录</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">// 用户管理职责</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="comment">// 添加用户的逻辑</span></span><br><span class="line">        System.out.println(<span class="string">&quot;添加用户：&quot;</span> + username);</span><br><span class="line">        <span class="comment">// 记录日志（违反单一职责原则）</span></span><br><span class="line">        log(<span class="string">&quot;添加用户：&quot;</span> + username);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="comment">// 删除用户的逻辑</span></span><br><span class="line">        System.out.println(<span class="string">&quot;删除用户：&quot;</span> + username);</span><br><span class="line">        <span class="comment">// 记录日志（违反单一职责原则）</span></span><br><span class="line">        log(<span class="string">&quot;删除用户：&quot;</span> + username);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 日志记录职责（应该分离出去）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[日志] &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="遵循单一职责原则的示例"><a href="#遵循单一职责原则的示例" class="headerlink" title="遵循单一职责原则的示例"></a>遵循单一职责原则的示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遵循单一职责原则：将用户管理和日志记录分离</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Logger logger;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(Logger logger)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.logger = logger;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只负责用户管理职责</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="comment">// 添加用户的逻辑</span></span><br><span class="line">        System.out.println(<span class="string">&quot;添加用户：&quot;</span> + username);</span><br><span class="line">        <span class="comment">// 通过依赖的Logger记录日志</span></span><br><span class="line">        logger.log(<span class="string">&quot;添加用户：&quot;</span> + username);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="comment">// 删除用户的逻辑</span></span><br><span class="line">        System.out.println(<span class="string">&quot;删除用户：&quot;</span> + username);</span><br><span class="line">        <span class="comment">// 通过依赖的Logger记录日志</span></span><br><span class="line">        logger.log(<span class="string">&quot;删除用户：&quot;</span> + username);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 专门负责日志记录职责</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[日志] &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="违反单一职责原则的后果"><a href="#违反单一职责原则的后果" class="headerlink" title="违反单一职责原则的后果"></a>违反单一职责原则的后果</h3><ul><li><strong>代码复用性差</strong>：职责混合的类难以被其他模块复用。</li><li><strong>测试困难</strong>：一个类承担多个职责，测试时需要考虑更多的场景。</li><li><strong>维护成本高</strong>：修改一个职责可能会影响到其他职责，导致意外的bug。</li><li><strong>可读性差</strong>：职责过多的类难以理解，降低代码的可读性。</li></ul><h3 id="如何正确应用单一职责原则"><a href="#如何正确应用单一职责原则" class="headerlink" title="如何正确应用单一职责原则"></a>如何正确应用单一职责原则</h3><ul><li><strong>识别职责</strong>：分析类的职责，找出可能引起变化的原因。</li><li><strong>合理拆分</strong>：将不同的职责拆分为不同的类或方法。</li><li><strong>保持适度</strong>：不要过度拆分，避免产生过多的小类。</li><li><strong>关注变化</strong>：关注那些可能会变化的职责，优先将其分离。</li></ul><h2 id="二、开放封闭原则-Open-Closed-Principle-OCP"><a href="#二、开放封闭原则-Open-Closed-Principle-OCP" class="headerlink" title="二、开放封闭原则 (Open-Closed Principle, OCP)"></a>二、开放封闭原则 (Open-Closed Principle, OCP)</h2><h3 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h3><p><strong>开放封闭原则</strong>：软件实体（类、模块、函数等）应该对扩展开放，对修改封闭。</p><h3 id="解决的问题-1"><a href="#解决的问题-1" class="headerlink" title="解决的问题"></a>解决的问题</h3><ul><li><strong>修改风险</strong>：修改现有代码可能会引入新的bug。</li><li><strong>扩展性差</strong>：难以在不修改现有代码的情况下添加新功能。</li><li><strong>维护成本高</strong>：每次添加新功能都需要修改现有代码，增加了维护成本。</li></ul><h3 id="适用场景-1"><a href="#适用场景-1" class="headerlink" title="适用场景"></a>适用场景</h3><ul><li><strong>功能扩展</strong>：当需要添加新功能时，应该通过扩展现有代码来实现，而不是修改现有代码。</li><li><strong>行为变化</strong>：当需要改变现有功能的行为时，应该通过扩展现有代码来实现，而不是修改现有代码。</li><li><strong>配置化</strong>：通过配置来控制系统的行为，而不是通过硬编码。</li></ul><h3 id="代码示例-1"><a href="#代码示例-1" class="headerlink" title="代码示例"></a>代码示例</h3><h4 id="违反开放封闭原则的示例"><a href="#违反开放封闭原则的示例" class="headerlink" title="违反开放封闭原则的示例"></a>违反开放封闭原则的示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 违反开放封闭原则的类：添加新的图形类型需要修改现有代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShapeDrawer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawShape</span><span class="params">(Shape shape)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (shape.getType().equals(<span class="string">&quot;circle&quot;</span>)) &#123;</span><br><span class="line">            drawCircle(shape);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shape.getType().equals(<span class="string">&quot;rectangle&quot;</span>)) &#123;</span><br><span class="line">            drawRectangle(shape);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shape.getType().equals(<span class="string">&quot;triangle&quot;</span>)) &#123;</span><br><span class="line">            drawTriangle(shape);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 添加新的图形类型需要修改这里</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawCircle</span><span class="params">(Shape shape)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制圆形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawRectangle</span><span class="params">(Shape shape)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制矩形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawTriangle</span><span class="params">(Shape shape)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制三角形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Shape</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="遵循开放封闭原则的示例"><a href="#遵循开放封闭原则的示例" class="headerlink" title="遵循开放封闭原则的示例"></a>遵循开放封闭原则的示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遵循开放封闭原则：通过抽象和多态实现扩展</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制圆形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制矩形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Triangle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制三角形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不需要修改，支持扩展</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShapeDrawer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawShape</span><span class="params">(Shape shape)</span> &#123;</span><br><span class="line">        shape.draw();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="违反开放封闭原则的后果"><a href="#违反开放封闭原则的后果" class="headerlink" title="违反开放封闭原则的后果"></a>违反开放封闭原则的后果</h3><ul><li><strong>修改风险</strong>：修改现有代码可能会引入新的bug，影响现有功能。</li><li><strong>扩展性差</strong>：难以添加新功能，每次添加新功能都需要修改现有代码。</li><li><strong>维护成本高</strong>：代码变得越来越复杂，维护成本越来越高。</li><li><strong>测试困难</strong>：修改现有代码需要重新测试所有相关功能。</li></ul><h3 id="如何正确应用开放封闭原则"><a href="#如何正确应用开放封闭原则" class="headerlink" title="如何正确应用开放封闭原则"></a>如何正确应用开放封闭原则</h3><ul><li><strong>抽象化</strong>：使用抽象类和接口来定义系统的行为。</li><li><strong>多态</strong>：通过子类继承和接口实现来扩展系统的行为。</li><li><strong>依赖注入</strong>：通过依赖注入来管理对象之间的依赖关系。</li><li><strong>配置化</strong>：通过配置文件或配置类来控制系统的行为。</li><li><strong>策略模式</strong>：使用策略模式来封装不同的算法和行为。</li></ul><h2 id="三、里氏替换原则-Liskov-Substitution-Principle-LSP"><a href="#三、里氏替换原则-Liskov-Substitution-Principle-LSP" class="headerlink" title="三、里氏替换原则 (Liskov Substitution Principle, LSP)"></a>三、里氏替换原则 (Liskov Substitution Principle, LSP)</h2><h3 id="概念-2"><a href="#概念-2" class="headerlink" title="概念"></a>概念</h3><p><strong>里氏替换原则</strong>：子类应该能够替换掉它们的父类，而不影响系统的功能。</p><h3 id="解决的问题-2"><a href="#解决的问题-2" class="headerlink" title="解决的问题"></a>解决的问题</h3><ul><li><strong>继承滥用</strong>：不当的继承关系导致子类无法替换父类。</li><li><strong>行为不一致</strong>：子类的行为与父类的行为不一致，导致系统出现问题。</li><li><strong>可维护性差</strong>：继承关系混乱，难以理解和维护。</li></ul><h3 id="适用场景-2"><a href="#适用场景-2" class="headerlink" title="适用场景"></a>适用场景</h3><ul><li><strong>继承关系</strong>：当使用继承时，应该确保子类能够替换父类。</li><li><strong>多态</strong>：当使用多态时，应该确保子类的行为符合父类的预期。</li><li><strong>接口实现</strong>：当实现接口时，应该确保实现类的行为符合接口的预期。</li></ul><h3 id="代码示例-2"><a href="#代码示例-2" class="headerlink" title="代码示例"></a>代码示例</h3><h4 id="违反里氏替换原则的示例"><a href="#违反里氏替换原则的示例" class="headerlink" title="违反里氏替换原则的示例"></a>违反里氏替换原则的示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 违反里氏替换原则的示例：正方形不是长方形的子类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> width;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> height;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWidth</span><span class="params">(<span class="type">int</span> width)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.width = width;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHeight</span><span class="params">(<span class="type">int</span> height)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getArea</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> width * height;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 违反里氏替换原则：正方形不能同时独立设置宽和高</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Square</span> <span class="keyword">extends</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWidth</span><span class="params">(<span class="type">int</span> width)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.width = width;</span><br><span class="line">        <span class="built_in">this</span>.height = width; <span class="comment">// 同时设置宽和高</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHeight</span><span class="params">(<span class="type">int</span> height)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.width = height;</span><br><span class="line">        <span class="built_in">this</span>.height = height; <span class="comment">// 同时设置宽和高</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试代码：违反里氏替换原则的后果</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用父类</span></span><br><span class="line">        <span class="type">Rectangle</span> <span class="variable">rectangle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>();</span><br><span class="line">        rectangle.setWidth(<span class="number">5</span>);</span><br><span class="line">        rectangle.setHeight(<span class="number">10</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;矩形面积：&quot;</span> + rectangle.getArea()); <span class="comment">// 输出50</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用子类替换父类</span></span><br><span class="line">        <span class="type">Rectangle</span> <span class="variable">square</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Square</span>();</span><br><span class="line">        square.setWidth(<span class="number">5</span>);</span><br><span class="line">        square.setHeight(<span class="number">10</span>); <span class="comment">// 这里会导致宽也被设置为10</span></span><br><span class="line">        System.out.println(<span class="string">&quot;正方形面积：&quot;</span> + square.getArea()); <span class="comment">// 输出100，而不是预期的50</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="遵循里氏替换原则的示例"><a href="#遵循里氏替换原则的示例" class="headerlink" title="遵循里氏替换原则的示例"></a>遵循里氏替换原则的示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遵循里氏替换原则的示例：使用抽象基类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">int</span> <span class="title function_">getArea</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> width;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> height;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWidth</span><span class="params">(<span class="type">int</span> width)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.width = width;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHeight</span><span class="params">(<span class="type">int</span> height)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getArea</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> width * height;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Square</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> side;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSide</span><span class="params">(<span class="type">int</span> side)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.side = side;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getArea</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> side * side;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试代码：遵循里氏替换原则</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用矩形</span></span><br><span class="line">        <span class="type">Rectangle</span> <span class="variable">rectangle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>();</span><br><span class="line">        rectangle.setWidth(<span class="number">5</span>);</span><br><span class="line">        rectangle.setHeight(<span class="number">10</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;矩形面积：&quot;</span> + rectangle.getArea()); <span class="comment">// 输出50</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用正方形</span></span><br><span class="line">        <span class="type">Square</span> <span class="variable">square</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Square</span>();</span><br><span class="line">        square.setSide(<span class="number">5</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;正方形面积：&quot;</span> + square.getArea()); <span class="comment">// 输出25</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="违反里氏替换原则的后果"><a href="#违反里氏替换原则的后果" class="headerlink" title="违反里氏替换原则的后果"></a>违反里氏替换原则的后果</h3><ul><li><strong>行为不一致</strong>：子类的行为与父类的行为不一致，导致系统出现问题。</li><li><strong>可维护性差</strong>：继承关系混乱，难以理解和维护。</li><li><strong>测试困难</strong>：需要为每个子类编写专门的测试代码。</li><li><strong>扩展性差</strong>：难以添加新的子类，因为需要考虑与父类的兼容性。</li></ul><h3 id="如何正确应用里氏替换原则"><a href="#如何正确应用里氏替换原则" class="headerlink" title="如何正确应用里氏替换原则"></a>如何正确应用里氏替换原则</h3><ul><li><strong>正确理解继承关系</strong>：确保子类确实是父类的一种特殊类型。</li><li><strong>保持行为一致</strong>：子类应该保持父类的行为不变，或者在父类行为的基础上进行扩展。</li><li><strong>遵循约定</strong>：子类应该遵循父类的约定，包括方法的参数、返回值、异常等。</li><li><strong>使用组合替代继承</strong>：当继承关系不适合时，考虑使用组合来实现代码复用。</li></ul><h2 id="四、接口隔离原则-Interface-Segregation-Principle-ISP"><a href="#四、接口隔离原则-Interface-Segregation-Principle-ISP" class="headerlink" title="四、接口隔离原则 (Interface Segregation Principle, ISP)"></a>四、接口隔离原则 (Interface Segregation Principle, ISP)</h2><h3 id="概念-3"><a href="#概念-3" class="headerlink" title="概念"></a>概念</h3><p><strong>接口隔离原则</strong>：客户端不应该依赖它不使用的接口，或者说，应该为客户端提供最小的必要接口。</p><h3 id="解决的问题-3"><a href="#解决的问题-3" class="headerlink" title="解决的问题"></a>解决的问题</h3><ul><li><strong>接口臃肿</strong>：一个接口包含了过多的方法，导致实现类必须实现所有方法，即使有些方法不需要。</li><li><strong>耦合度高</strong>：客户端依赖了它不使用的接口，导致耦合度增加。</li><li><strong>可维护性差</strong>：接口变更会影响所有实现类，增加了维护成本。</li></ul><h3 id="适用场景-3"><a href="#适用场景-3" class="headerlink" title="适用场景"></a>适用场景</h3><ul><li><strong>接口设计</strong>：设计接口时，应该考虑客户端的需求，只提供必要的方法。</li><li><strong>实现类</strong>：实现类应该只实现它需要的接口方法。</li><li><strong>客户端</strong>：客户端应该只依赖它需要的接口。</li></ul><h3 id="代码示例-3"><a href="#代码示例-3" class="headerlink" title="代码示例"></a>代码示例</h3><h4 id="违反接口隔离原则的示例"><a href="#违反接口隔离原则的示例" class="headerlink" title="违反接口隔离原则的示例"></a>违反接口隔离原则的示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 违反接口隔离原则的示例：臃肿的接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Worker</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">work</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现类必须实现所有方法，即使有些方法不需要</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Robot</span> <span class="keyword">implements</span> <span class="title class_">Worker</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">work</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;机器人工作&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 机器人不需要吃饭，但是必须实现这个方法</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;机器人不需要吃饭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 机器人不需要睡觉，但是必须实现这个方法</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;机器人不需要睡觉&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Human</span> <span class="keyword">implements</span> <span class="title class_">Worker</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">work</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;人类工作&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;人类吃饭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;人类睡觉&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="遵循接口隔离原则的示例"><a href="#遵循接口隔离原则的示例" class="headerlink" title="遵循接口隔离原则的示例"></a>遵循接口隔离原则的示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遵循接口隔离原则：将臃肿的接口拆分为多个小接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Workable</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">work</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Eatable</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Sleepable</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 机器人只实现它需要的接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Robot</span> <span class="keyword">implements</span> <span class="title class_">Workable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">work</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;机器人工作&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 人类实现所有接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Human</span> <span class="keyword">implements</span> <span class="title class_">Workable</span>, Eatable, Sleepable &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">work</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;人类工作&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;人类吃饭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;人类睡觉&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="违反接口隔离原则的后果"><a href="#违反接口隔离原则的后果" class="headerlink" title="违反接口隔离原则的后果"></a>违反接口隔离原则的后果</h3><ul><li><strong>实现负担</strong>：实现类必须实现所有接口方法，即使有些方法不需要。</li><li><strong>耦合度高</strong>：客户端依赖了它不使用的接口，导致耦合度增加。</li><li><strong>可维护性差</strong>：接口变更会影响所有实现类，增加了维护成本。</li><li><strong>可读性差</strong>：臃肿的接口难以理解和使用。</li></ul><h3 id="如何正确应用接口隔离原则"><a href="#如何正确应用接口隔离原则" class="headerlink" title="如何正确应用接口隔离原则"></a>如何正确应用接口隔离原则</h3><ul><li><strong>接口拆分</strong>：将臃肿的接口拆分为多个小接口，每个接口只包含相关的方法。</li><li><strong>客户端优先</strong>：根据客户端的需求设计接口，只提供必要的方法。</li><li><strong>最小化接口</strong>：接口应该尽可能小，只包含必要的方法。</li><li><strong>合理组合</strong>：通过接口组合来满足不同客户端的需求。</li></ul><h2 id="五、依赖倒置原则-Dependency-Inversion-Principle-DIP"><a href="#五、依赖倒置原则-Dependency-Inversion-Principle-DIP" class="headerlink" title="五、依赖倒置原则 (Dependency Inversion Principle, DIP)"></a>五、依赖倒置原则 (Dependency Inversion Principle, DIP)</h2><h3 id="概念-4"><a href="#概念-4" class="headerlink" title="概念"></a>概念</h3><p><strong>依赖倒置原则</strong>：高层模块不应该依赖低层模块，两者都应该依赖于抽象；抽象不应该依赖于具体实现，具体实现应该依赖于抽象。</p><h3 id="解决的问题-4"><a href="#解决的问题-4" class="headerlink" title="解决的问题"></a>解决的问题</h3><ul><li><strong>耦合度高</strong>：高层模块直接依赖低层模块，导致耦合度增加。</li><li><strong>可扩展性差</strong>：难以替换低层模块的实现，因为高层模块直接依赖于具体实现。</li><li><strong>可测试性差</strong>：难以对高层模块进行单元测试，因为它直接依赖于具体实现。</li></ul><h3 id="适用场景-4"><a href="#适用场景-4" class="headerlink" title="适用场景"></a>适用场景</h3><ul><li><strong>模块设计</strong>：设计模块时，应该使用抽象来定义模块之间的依赖关系。</li><li><strong>类设计</strong>：设计类时，应该依赖于抽象，而不是具体实现。</li><li><strong>方法设计</strong>：设计方法时，应该使用抽象类型作为参数和返回值。</li></ul><h3 id="代码示例-4"><a href="#代码示例-4" class="headerlink" title="代码示例"></a>代码示例</h3><h4 id="违反依赖倒置原则的示例"><a href="#违反依赖倒置原则的示例" class="headerlink" title="违反依赖倒置原则的示例"></a>违反依赖倒置原则的示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 违反依赖倒置原则的示例：高层模块直接依赖低层模块</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Keyboard</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">input</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;键盘输入&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Mouse</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">click</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;鼠标点击&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 违反依赖倒置原则：高层模块直接依赖具体的低层模块</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Computer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Keyboard keyboard;</span><br><span class="line">    <span class="keyword">private</span> Mouse mouse;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Computer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.keyboard = <span class="keyword">new</span> <span class="title class_">Keyboard</span>();</span><br><span class="line">        <span class="built_in">this</span>.mouse = <span class="keyword">new</span> <span class="title class_">Mouse</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">useKeyboard</span><span class="params">()</span> &#123;</span><br><span class="line">        keyboard.input();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">useMouse</span><span class="params">()</span> &#123;</span><br><span class="line">        mouse.click();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="遵循依赖倒置原则的示例"><a href="#遵循依赖倒置原则的示例" class="headerlink" title="遵循依赖倒置原则的示例"></a>遵循依赖倒置原则的示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遵循依赖倒置原则：使用抽象来定义依赖关系</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">InputDevice</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">operate</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Keyboard</span> <span class="keyword">implements</span> <span class="title class_">InputDevice</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operate</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;键盘输入&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Mouse</span> <span class="keyword">implements</span> <span class="title class_">InputDevice</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operate</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;鼠标点击&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遵循依赖倒置原则：高层模块依赖于抽象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Computer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;InputDevice&gt; inputDevices;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过构造函数注入依赖</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Computer</span><span class="params">(List&lt;InputDevice&gt; inputDevices)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.inputDevices = inputDevices;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">useInputDevices</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (InputDevice device : inputDevices) &#123;</span><br><span class="line">            device.operate();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="违反依赖倒置原则的后果"><a href="#违反依赖倒置原则的后果" class="headerlink" title="违反依赖倒置原则的后果"></a>违反依赖倒置原则的后果</h3><ul><li><strong>耦合度高</strong>：高层模块直接依赖低层模块，导致耦合度增加。</li><li><strong>可扩展性差</strong>：难以替换低层模块的实现，因为高层模块直接依赖于具体实现。</li><li><strong>可测试性差</strong>：难以对高层模块进行单元测试，因为它直接依赖于具体实现。</li><li><strong>维护成本高</strong>：低层模块变更会影响高层模块，增加了维护成本。</li></ul><h3 id="如何正确应用依赖倒置原则"><a href="#如何正确应用依赖倒置原则" class="headerlink" title="如何正确应用依赖倒置原则"></a>如何正确应用依赖倒置原则</h3><ul><li><strong>使用抽象</strong>：使用接口或抽象类来定义依赖关系。</li><li><strong>依赖注入</strong>：通过构造函数注入、 setter 方法注入或接口注入来管理依赖关系。</li><li><strong>面向接口编程</strong>：客户端应该面向接口编程，而不是面向具体实现编程。</li><li><strong>控制反转</strong>：使用控制反转容器来管理对象的生命周期和依赖关系。</li></ul><h2 id="六、迪米特法则-Law-of-Demeter-LoD"><a href="#六、迪米特法则-Law-of-Demeter-LoD" class="headerlink" title="六、迪米特法则 (Law of Demeter, LoD)"></a>六、迪米特法则 (Law of Demeter, LoD)</h2><h3 id="概念-5"><a href="#概念-5" class="headerlink" title="概念"></a>概念</h3><p><strong>迪米特法则</strong>：一个对象应该对其他对象有尽可能少的了解，或者说，一个对象应该只与它的直接朋友通信。</p><h3 id="解决的问题-5"><a href="#解决的问题-5" class="headerlink" title="解决的问题"></a>解决的问题</h3><ul><li><strong>耦合度高</strong>：对象之间的依赖关系复杂，导致耦合度增加。</li><li><strong>可维护性差</strong>：对象之间的依赖关系复杂，难以理解和维护。</li><li><strong>可测试性差</strong>：对象之间的依赖关系复杂，难以对单个对象进行测试。</li></ul><h3 id="适用场景-5"><a href="#适用场景-5" class="headerlink" title="适用场景"></a>适用场景</h3><ul><li><strong>对象设计</strong>：设计对象时，应该减少对象之间的直接依赖关系。</li><li><strong>方法设计</strong>：设计方法时，应该减少方法对外部对象的依赖。</li><li><strong>模块设计</strong>：设计模块时，应该减少模块之间的直接依赖关系。</li></ul><h3 id="代码示例-5"><a href="#代码示例-5" class="headerlink" title="代码示例"></a>代码示例</h3><h4 id="违反迪米特法则的示例"><a href="#违反迪米特法则的示例" class="headerlink" title="违反迪米特法则的示例"></a>违反迪米特法则的示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 违反迪米特法则的示例：过度暴露内部细节</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Computer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Cpu cpu;</span><br><span class="line">    <span class="keyword">private</span> Memory memory;</span><br><span class="line">    <span class="keyword">private</span> HardDisk hardDisk;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Computer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cpu = <span class="keyword">new</span> <span class="title class_">Cpu</span>();</span><br><span class="line">        <span class="built_in">this</span>.memory = <span class="keyword">new</span> <span class="title class_">Memory</span>();</span><br><span class="line">        <span class="built_in">this</span>.hardDisk = <span class="keyword">new</span> <span class="title class_">HardDisk</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 违反迪米特法则：暴露了内部组件</span></span><br><span class="line">    <span class="keyword">public</span> Cpu <span class="title function_">getCpu</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cpu;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Memory <span class="title function_">getMemory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> memory;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> HardDisk <span class="title function_">getHardDisk</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> hardDisk;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cpu</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;CPU运行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Memory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;内存读取&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HardDisk</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readData</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;硬盘读取数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 违反迪米特法则：客户端直接操作计算机的内部组件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Computer</span> <span class="variable">computer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Computer</span>();</span><br><span class="line">        <span class="comment">// 违反迪米特法则：客户端直接操作内部组件</span></span><br><span class="line">        computer.getCpu().run();</span><br><span class="line">        computer.getMemory().read();</span><br><span class="line">        computer.getHardDisk().readData();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="遵循迪米特法则的示例"><a href="#遵循迪米特法则的示例" class="headerlink" title="遵循迪米特法则的示例"></a>遵循迪米特法则的示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遵循迪米特法则：封装内部细节</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Computer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Cpu cpu;</span><br><span class="line">    <span class="keyword">private</span> Memory memory;</span><br><span class="line">    <span class="keyword">private</span> HardDisk hardDisk;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Computer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cpu = <span class="keyword">new</span> <span class="title class_">Cpu</span>();</span><br><span class="line">        <span class="built_in">this</span>.memory = <span class="keyword">new</span> <span class="title class_">Memory</span>();</span><br><span class="line">        <span class="built_in">this</span>.hardDisk = <span class="keyword">new</span> <span class="title class_">HardDisk</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遵循迪米特法则：提供高层方法，封装内部细节</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        cpu.run();</span><br><span class="line">        memory.read();</span><br><span class="line">        hardDisk.readData();</span><br><span class="line">        System.out.println(<span class="string">&quot;计算机启动完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cpu</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;CPU运行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Memory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;内存读取&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HardDisk</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readData</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;硬盘读取数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遵循迪米特法则：客户端只与计算机通信，不直接操作内部组件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Computer</span> <span class="variable">computer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Computer</span>();</span><br><span class="line">        <span class="comment">// 遵循迪米特法则：客户端只调用计算机的高层方法</span></span><br><span class="line">        computer.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="违反迪米特法则的后果"><a href="#违反迪米特法则的后果" class="headerlink" title="违反迪米特法则的后果"></a>违反迪米特法则的后果</h3><ul><li><strong>耦合度高</strong>：对象之间的依赖关系复杂，导致耦合度增加。</li><li><strong>可维护性差</strong>：对象之间的依赖关系复杂，难以理解和维护。</li><li><strong>可测试性差</strong>：对象之间的依赖关系复杂，难以对单个对象进行测试。</li><li><strong>变更影响大</strong>：一个对象的变更可能会影响到多个其他对象。</li></ul><h3 id="如何正确应用迪米特法则"><a href="#如何正确应用迪米特法则" class="headerlink" title="如何正确应用迪米特法则"></a>如何正确应用迪米特法则</h3><ul><li><strong>封装内部细节</strong>：对象应该封装自己的内部细节，只提供必要的公开方法。</li><li><strong>减少依赖</strong>：减少对象之间的直接依赖关系，通过中介对象来传递消息。</li><li><strong>最小知识</strong>：对象只需要知道它的直接朋友，不需要知道其他对象的存在。</li><li><strong>合理使用访问修饰符</strong>：使用 private、protected 等访问修饰符来控制对象的可见性。</li></ul><h2 id="六大原则的关系与总结"><a href="#六大原则的关系与总结" class="headerlink" title="六大原则的关系与总结"></a>六大原则的关系与总结</h2><h3 id="六大原则的关系"><a href="#六大原则的关系" class="headerlink" title="六大原则的关系"></a>六大原则的关系</h3><p>设计模式的六大原则不是孤立的，它们之间相互关联、相互补充：</p><ul><li><strong>单一职责原则</strong>是其他原则的基础，它确保了类的职责清晰。</li><li><strong>开放封闭原则</strong>是设计模式的核心，它通过抽象和多态来实现扩展。</li><li><strong>里氏替换原则</strong>是开放封闭原则的具体实现，它确保了继承关系的正确性。</li><li><strong>接口隔离原则</strong>是开放封闭原则的补充，它确保了接口的简洁性。</li><li><strong>依赖倒置原则</strong>是实现开放封闭原则的关键，它通过抽象来解耦。</li><li><strong>迪米特法则</strong>是减少耦合的重要原则，它确保了对象之间的最小依赖。</li></ul><h3 id="六大原则的总结"><a href="#六大原则的总结" class="headerlink" title="六大原则的总结"></a>六大原则的总结</h3><p>设计模式的六大原则为我们提供了一套指导原则，帮助我们设计出更加灵活、可维护、可扩展的软件系统：</p><ol><li><strong>单一职责原则</strong>：一个类只负责一项职责，提高代码的可维护性。</li><li><strong>开放封闭原则</strong>：对扩展开放，对修改封闭，提高代码的可扩展性。</li><li><strong>里氏替换原则</strong>：子类可以替换父类，提高代码的可复用性。</li><li><strong>接口隔离原则</strong>：提供最小的必要接口，提高代码的灵活性。</li><li><strong>依赖倒置原则</strong>：依赖于抽象，提高代码的可测试性。</li><li><strong>迪米特法则</strong>：减少对象之间的依赖，提高代码的可维护性。</li></ol><h3 id="如何应用六大原则"><a href="#如何应用六大原则" class="headerlink" title="如何应用六大原则"></a>如何应用六大原则</h3><p>在实际开发中，我们应该：</p><ul><li><strong>理解原则</strong>：深入理解六大原则的概念和含义。</li><li><strong>灵活应用</strong>：根据具体的场景和需求，灵活应用六大原则。</li><li><strong>权衡利弊</strong>：在应用六大原则时，应该权衡其利弊，避免过度设计。</li><li><strong>持续改进</strong>：不断反思和改进代码，使其更加符合六大原则。</li></ul><h3 id="六大原则的价值"><a href="#六大原则的价值" class="headerlink" title="六大原则的价值"></a>六大原则的价值</h3><p>设计模式的六大原则的价值在于：</p><ul><li><strong>提高代码质量</strong>：遵循六大原则可以提高代码的质量，使其更加灵活、可维护、可扩展。</li><li><strong>降低开发成本</strong>：高质量的代码可以降低开发成本，减少bug的产生。</li><li><strong>提高团队效率</strong>：清晰的代码结构可以提高团队的开发效率，便于团队协作。</li><li><strong>促进代码复用</strong>：遵循六大原则可以促进代码的复用，减少重复代码的产生。</li></ul><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>设计模式的六大原则是软件设计的基础，它们为我们提供了一套指导原则，帮助我们设计出更加灵活、可维护、可扩展的软件系统。在实际开发中，我们应该深入理解这些原则，灵活应用它们，并且在应用过程中不断反思和改进，以提高代码的质量和开发效率。</p><p>记住，设计模式的六大原则不是教条，而是工具。我们应该根据具体的场景和需求，合理应用这些原则，以达到最佳的设计效果。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
            <tag> 单一职责原则 </tag>
            
            <tag> 开放封闭原则 </tag>
            
            <tag> 里氏替换原则 </tag>
            
            <tag> 接口隔离原则 </tag>
            
            <tag> 依赖倒置原则 </tag>
            
            <tag> 迪米特法则 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式——中介者模式</title>
      <link href="/2026/01/22/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
      <url>/2026/01/22/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="中介者模式详解"><a href="#中介者模式详解" class="headerlink" title="中介者模式详解"></a>中介者模式详解</h1><h2 id="什么是中介者模式？"><a href="#什么是中介者模式？" class="headerlink" title="什么是中介者模式？"></a>什么是中介者模式？</h2><p>中介者模式（Mediator Pattern）是一种行为型设计模式，它定义了一个中介对象，用于封装一组对象之间的交互，使这些对象不需要直接相互引用，从而降低它们之间的耦合度。</p><h3 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h3><ul><li><strong>Mediator（中介者）</strong>：定义同事对象之间交互的接口，维护同事对象的引用。</li><li><strong>ConcreteMediator（具体中介者）</strong>：实现中介者接口，协调同事对象之间的交互。</li><li><strong>Colleague（同事）</strong>：定义与其他同事对象交互的接口，维护中介者的引用。</li><li><strong>ConcreteColleague（具体同事）</strong>：实现同事接口，通过中介者与其他同事对象交互。</li></ul><h3 id="中介者模式的UML图"><a href="#中介者模式的UML图" class="headerlink" title="中介者模式的UML图"></a>中介者模式的UML图</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">+----------------+       +----------------+</span><br><span class="line">|   Mediator     |&lt;------|   Colleague    |</span><br><span class="line">+----------------+       +----------------+</span><br><span class="line">| +mediate()     |       | -mediator      |</span><br><span class="line">| +register()    |       | +send()        |</span><br><span class="line">+----------------+       | +receive()     |</span><br><span class="line">        ^                +----------------+</span><br><span class="line">        |                        ^</span><br><span class="line">        |                        |</span><br><span class="line">+----------------+       +----------------+</span><br><span class="line">| ConcreteMediator|       | ConcreteColleague|</span><br><span class="line">+----------------+       +----------------+</span><br><span class="line">| -colleagues    |       | +send()        |</span><br><span class="line">| +mediate()     |       | +receive()     |</span><br><span class="line">| +register()    |       +----------------+</span><br><span class="line">+----------------+</span><br></pre></td></tr></table></figure><h2 id="中介者模式的优缺点"><a href="#中介者模式的优缺点" class="headerlink" title="中介者模式的优缺点"></a>中介者模式的优缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol><li><strong>减少耦合</strong>：同事对象之间不再直接相互引用，而是通过中介者进行通信，降低了耦合度。</li><li><strong>集中控制</strong>：将同事对象之间的交互逻辑集中到中介者中，便于管理和维护。</li><li><strong>简化通信</strong>：同事对象只需要与中介者通信，而不需要知道其他同事对象的存在。</li><li><strong>可扩展性</strong>：可以通过添加新的同事类或修改中介者来扩展系统，而不需要修改现有同事类。</li><li><strong>符合迪米特法则</strong>：每个同事对象只与中介者通信，符合”最少知识原则”。</li></ol><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol><li><strong>中介者复杂性</strong>：中介者可能会变得复杂，因为它需要处理所有同事对象之间的交互。</li><li><strong>单点故障</strong>：中介者成为系统的核心，如果中介者出现问题，整个系统可能会受到影响。</li><li><strong>性能问题</strong>：所有通信都经过中介者，可能会影响系统的性能。</li><li><strong>维护困难</strong>：当同事对象之间的交互逻辑变得复杂时，中介者的维护可能会变得困难。</li></ol><h2 id="中介者模式的实现"><a href="#中介者模式的实现" class="headerlink" title="中介者模式的实现"></a>中介者模式的实现</h2><h3 id="C-实现"><a href="#C-实现" class="headerlink" title="C++ 实现"></a>C++ 实现</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 前向声明</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mediator</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同事接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Colleague</span> &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Mediator* mediator;</span><br><span class="line">    std::string name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Colleague</span>(Mediator* mediator, <span class="type">const</span> std::string&amp; name)</span><br><span class="line">        : <span class="built_in">mediator</span>(mediator), <span class="built_in">name</span>(name) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Colleague</span>() &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getName</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">send</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">receive</span><span class="params">(<span class="type">const</span> std::string&amp; message, <span class="type">const</span> std::string&amp; sender)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中介者接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Mediator</span>() &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">registerColleague</span><span class="params">(Colleague* colleague)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mediate</span><span class="params">(<span class="type">const</span> std::string&amp; message, Colleague* sender)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体中介者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteMediator</span> : <span class="keyword">public</span> Mediator &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;Colleague*&gt; colleagues;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">registerColleague</span><span class="params">(Colleague* colleague)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        colleagues.<span class="built_in">push_back</span>(colleague);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mediate</span><span class="params">(<span class="type">const</span> std::string&amp; message, Colleague* sender)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Colleague* colleague : colleagues) &#123;</span><br><span class="line">            <span class="comment">// 不发送给发送者自己</span></span><br><span class="line">            <span class="keyword">if</span> (colleague != sender) &#123;</span><br><span class="line">                colleague-&gt;<span class="built_in">receive</span>(message, sender-&gt;<span class="built_in">getName</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体同事</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteColleague</span> : <span class="keyword">public</span> Colleague &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ConcreteColleague</span>(Mediator* mediator, <span class="type">const</span> std::string&amp; name)</span><br><span class="line">        : <span class="built_in">Colleague</span>(mediator, name) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">send</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; name &lt;&lt; <span class="string">&quot; sends: &quot;</span> &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">        mediator-&gt;<span class="built_in">mediate</span>(message, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">receive</span><span class="params">(<span class="type">const</span> std::string&amp; message, <span class="type">const</span> std::string&amp; sender)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; name &lt;&lt; <span class="string">&quot; receives from &quot;</span> &lt;&lt; sender &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试代码</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建中介者</span></span><br><span class="line">    ConcreteMediator mediator;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建同事</span></span><br><span class="line">    <span class="function">ConcreteColleague <span class="title">colleague1</span><span class="params">(&amp;mediator, <span class="string">&quot;Colleague 1&quot;</span>)</span></span>;</span><br><span class="line">    <span class="function">ConcreteColleague <span class="title">colleague2</span><span class="params">(&amp;mediator, <span class="string">&quot;Colleague 2&quot;</span>)</span></span>;</span><br><span class="line">    <span class="function">ConcreteColleague <span class="title">colleague3</span><span class="params">(&amp;mediator, <span class="string">&quot;Colleague 3&quot;</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注册同事</span></span><br><span class="line">    mediator.<span class="built_in">registerColleague</span>(&amp;colleague1);</span><br><span class="line">    mediator.<span class="built_in">registerColleague</span>(&amp;colleague2);</span><br><span class="line">    mediator.<span class="built_in">registerColleague</span>(&amp;colleague3);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;=== Testing Mediator Pattern ===&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    colleague<span class="number">1.</span><span class="built_in">send</span>(<span class="string">&quot;Hello everyone!&quot;</span>);</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    colleague<span class="number">2.</span><span class="built_in">send</span>(<span class="string">&quot;Hi there!&quot;</span>);</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    colleague<span class="number">3.</span><span class="built_in">send</span>(<span class="string">&quot;How are you?&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Java-实现"><a href="#Java-实现" class="headerlink" title="Java 实现"></a>Java 实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同事接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Colleague</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String message, String sender)</span>;</span><br><span class="line">    String <span class="title function_">getName</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中介者接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">registerColleague</span><span class="params">(Colleague colleague)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">mediate</span><span class="params">(String message, Colleague sender)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体中介者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteMediator</span> <span class="keyword">implements</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Colleague&gt; colleagues = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerColleague</span><span class="params">(Colleague colleague)</span> &#123;</span><br><span class="line">        colleagues.add(colleague);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">mediate</span><span class="params">(String message, Colleague sender)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Colleague colleague : colleagues) &#123;</span><br><span class="line">            <span class="comment">// 不发送给发送者自己</span></span><br><span class="line">            <span class="keyword">if</span> (colleague != sender) &#123;</span><br><span class="line">                colleague.receive(message, sender.getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体同事</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteColleague</span> <span class="keyword">implements</span> <span class="title class_">Colleague</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Mediator mediator;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcreteColleague</span><span class="params">(Mediator mediator, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mediator = mediator;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot; sends: &quot;</span> + message);</span><br><span class="line">        mediator.mediate(message, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String message, String sender)</span> &#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot; receives from &quot;</span> + sender + <span class="string">&quot;: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MediatorPatternDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建中介者</span></span><br><span class="line">        <span class="type">ConcreteMediator</span> <span class="variable">mediator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteMediator</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建同事</span></span><br><span class="line">        <span class="type">ConcreteColleague</span> <span class="variable">colleague1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteColleague</span>(mediator, <span class="string">&quot;Colleague 1&quot;</span>);</span><br><span class="line">        <span class="type">ConcreteColleague</span> <span class="variable">colleague2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteColleague</span>(mediator, <span class="string">&quot;Colleague 2&quot;</span>);</span><br><span class="line">        <span class="type">ConcreteColleague</span> <span class="variable">colleague3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteColleague</span>(mediator, <span class="string">&quot;Colleague 3&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 注册同事</span></span><br><span class="line">        mediator.registerColleague(colleague1);</span><br><span class="line">        mediator.registerColleague(colleague2);</span><br><span class="line">        mediator.registerColleague(colleague3);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 发送消息</span></span><br><span class="line">        System.out.println(<span class="string">&quot;=== Testing Mediator Pattern ===&quot;</span>);</span><br><span class="line">        colleague1.send(<span class="string">&quot;Hello everyone!&quot;</span>);</span><br><span class="line">        System.out.println();</span><br><span class="line">        </span><br><span class="line">        colleague2.send(<span class="string">&quot;Hi there!&quot;</span>);</span><br><span class="line">        System.out.println();</span><br><span class="line">        </span><br><span class="line">        colleague3.send(<span class="string">&quot;How are you?&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Python-实现"><a href="#Python-实现" class="headerlink" title="Python 实现"></a>Python 实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 同事接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Colleague</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, mediator, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.mediator = mediator</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">receive</span>(<span class="params">self, message, sender</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 中介者接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mediator</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">register_colleague</span>(<span class="params">self, colleague</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mediate</span>(<span class="params">self, message, sender</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体中介者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteMediator</span>(<span class="title class_ inherited__">Mediator</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.colleagues = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">register_colleague</span>(<span class="params">self, colleague</span>):</span><br><span class="line">        <span class="variable language_">self</span>.colleagues.append(colleague)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mediate</span>(<span class="params">self, message, sender</span>):</span><br><span class="line">        <span class="keyword">for</span> colleague <span class="keyword">in</span> <span class="variable language_">self</span>.colleagues:</span><br><span class="line">            <span class="comment"># 不发送给发送者自己</span></span><br><span class="line">            <span class="keyword">if</span> colleague != sender:</span><br><span class="line">                colleague.receive(message, sender.get_name())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体同事</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteColleague</span>(<span class="title class_ inherited__">Colleague</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span> sends: <span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.mediator.mediate(message, <span class="variable language_">self</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">receive</span>(<span class="params">self, message, sender</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span> receives from <span class="subst">&#123;sender&#125;</span>: <span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试代码</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 创建中介者</span></span><br><span class="line">    mediator = ConcreteMediator()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建同事</span></span><br><span class="line">    colleague1 = ConcreteColleague(mediator, <span class="string">&quot;Colleague 1&quot;</span>)</span><br><span class="line">    colleague2 = ConcreteColleague(mediator, <span class="string">&quot;Colleague 2&quot;</span>)</span><br><span class="line">    colleague3 = ConcreteColleague(mediator, <span class="string">&quot;Colleague 3&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 注册同事</span></span><br><span class="line">    mediator.register_colleague(colleague1)</span><br><span class="line">    mediator.register_colleague(colleague2)</span><br><span class="line">    mediator.register_colleague(colleague3)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 发送消息</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=== Testing Mediator Pattern ===&quot;</span>)</span><br><span class="line">    colleague1.send(<span class="string">&quot;Hello everyone!&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    </span><br><span class="line">    colleague2.send(<span class="string">&quot;Hi there!&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    </span><br><span class="line">    colleague3.send(<span class="string">&quot;How are you?&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="C-实现-1"><a href="#C-实现-1" class="headerlink" title="C# 实现"></a>C# 实现</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同事接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title">IColleague</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Send</span>(<span class="params"><span class="built_in">string</span> message</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Receive</span>(<span class="params"><span class="built_in">string</span> message, <span class="built_in">string</span> sender</span>)</span>;</span><br><span class="line">    <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中介者接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title">IMediator</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">RegisterColleague</span>(<span class="params">IColleague colleague</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Mediate</span>(<span class="params"><span class="built_in">string</span> message, IColleague sender</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体中介者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">ConcreteMediator</span> : <span class="title">IMediator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;IColleague&gt; colleagues = <span class="keyword">new</span> List&lt;IColleague&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RegisterColleague</span>(<span class="params">IColleague colleague</span>)</span> &#123;</span><br><span class="line">        colleagues.Add(colleague);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Mediate</span>(<span class="params"><span class="built_in">string</span> message, IColleague sender</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (IColleague colleague <span class="keyword">in</span> colleagues) &#123;</span><br><span class="line">            <span class="comment">// 不发送给发送者自己</span></span><br><span class="line">            <span class="keyword">if</span> (colleague != sender) &#123;</span><br><span class="line">                colleague.Receive(message, sender.Name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体同事</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">ConcreteColleague</span> : <span class="title">IColleague</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> IMediator mediator;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> name; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreteColleague</span>(<span class="params">IMediator mediator, <span class="built_in">string</span> name</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.mediator = mediator;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Send</span>(<span class="params"><span class="built_in">string</span> message</span>)</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;<span class="subst">&#123;name&#125;</span> sends: <span class="subst">&#123;message&#125;</span>&quot;</span>);</span><br><span class="line">        mediator.Mediate(message, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Receive</span>(<span class="params"><span class="built_in">string</span> message, <span class="built_in">string</span> sender</span>)</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;<span class="subst">&#123;name&#125;</span> receives from <span class="subst">&#123;sender&#125;</span>: <span class="subst">&#123;message&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试代码</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建中介者</span></span><br><span class="line">        ConcreteMediator mediator = <span class="keyword">new</span> ConcreteMediator();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建同事</span></span><br><span class="line">        ConcreteColleague colleague1 = <span class="keyword">new</span> ConcreteColleague(mediator, <span class="string">&quot;Colleague 1&quot;</span>);</span><br><span class="line">        ConcreteColleague colleague2 = <span class="keyword">new</span> ConcreteColleague(mediator, <span class="string">&quot;Colleague 2&quot;</span>);</span><br><span class="line">        ConcreteColleague colleague3 = <span class="keyword">new</span> ConcreteColleague(mediator, <span class="string">&quot;Colleague 3&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 注册同事</span></span><br><span class="line">        mediator.RegisterColleague(colleague1);</span><br><span class="line">        mediator.RegisterColleague(colleague2);</span><br><span class="line">        mediator.RegisterColleague(colleague3);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 发送消息</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;=== Testing Mediator Pattern ===&quot;</span>);</span><br><span class="line">        colleague1.Send(<span class="string">&quot;Hello everyone!&quot;</span>);</span><br><span class="line">        Console.WriteLine();</span><br><span class="line">        </span><br><span class="line">        colleague2.Send(<span class="string">&quot;Hi there!&quot;</span>);</span><br><span class="line">        Console.WriteLine();</span><br><span class="line">        </span><br><span class="line">        colleague3.Send(<span class="string">&quot;How are you?&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="中介者模式的使用场景"><a href="#中介者模式的使用场景" class="headerlink" title="中介者模式的使用场景"></a>中介者模式的使用场景</h2><h3 id="1-多人聊天系统"><a href="#1-多人聊天系统" class="headerlink" title="1. 多人聊天系统"></a>1. 多人聊天系统</h3><ul><li><strong>聊天室</strong>：所有用户通过聊天室（中介者）发送和接收消息</li><li><strong>群聊</strong>：群成员通过群（中介者）进行通信</li></ul><h3 id="2-GUI-组件交互"><a href="#2-GUI-组件交互" class="headerlink" title="2. GUI 组件交互"></a>2. GUI 组件交互</h3><ul><li><strong>表单验证</strong>：表单中的各个组件通过表单（中介者）进行验证和交互</li><li><strong>复合组件</strong>：复合组件中的子组件通过父组件（中介者）进行通信</li></ul><h3 id="3-微服务架构"><a href="#3-微服务架构" class="headerlink" title="3. 微服务架构"></a>3. 微服务架构</h3><ul><li><strong>服务注册中心</strong>：微服务通过注册中心（中介者）发现和通信</li><li><strong>API 网关</strong>：客户端通过 API 网关（中介者）访问后端服务</li></ul><h3 id="4-游戏开发"><a href="#4-游戏开发" class="headerlink" title="4. 游戏开发"></a>4. 游戏开发</h3><ul><li><strong>游戏服务器</strong>：游戏客户端通过游戏服务器（中介者）进行通信</li><li><strong>游戏对象交互</strong>：游戏中的对象通过游戏管理器（中介者）进行交互</li></ul><h3 id="5-事件处理系统"><a href="#5-事件处理系统" class="headerlink" title="5. 事件处理系统"></a>5. 事件处理系统</h3><ul><li><strong>事件总线</strong>：组件通过事件总线（中介者）发布和订阅事件</li><li><strong>消息队列</strong>：生产者和消费者通过消息队列（中介者）进行通信</li></ul><h3 id="6-其他场景"><a href="#6-其他场景" class="headerlink" title="6. 其他场景"></a>6. 其他场景</h3><ul><li><strong>航空管制系统</strong>：飞机通过航空管制中心（中介者）进行通信</li><li><strong>交通管理系统</strong>：车辆通过交通管理中心（中介者）进行通信</li><li><strong>分布式系统</strong>：节点通过协调器（中介者）进行通信</li></ul><h2 id="适合使用中介者模式的问题"><a href="#适合使用中介者模式的问题" class="headerlink" title="适合使用中介者模式的问题"></a>适合使用中介者模式的问题</h2><h3 id="1-当对象之间存在复杂的多对多关系时"><a href="#1-当对象之间存在复杂的多对多关系时" class="headerlink" title="1. 当对象之间存在复杂的多对多关系时"></a>1. 当对象之间存在复杂的多对多关系时</h3><p>例如：</p><ul><li>多个 GUI 组件之间的交互</li><li>多个微服务之间的通信</li><li>多个游戏对象之间的交互</li></ul><h3 id="2-当对象之间的耦合度高，难以维护时"><a href="#2-当对象之间的耦合度高，难以维护时" class="headerlink" title="2. 当对象之间的耦合度高，难以维护时"></a>2. 当对象之间的耦合度高，难以维护时</h3><p>例如：</p><ul><li>每个对象都需要引用其他多个对象</li><li>对象之间的交互逻辑分散在各个对象中</li><li>修改一个对象可能会影响其他多个对象</li></ul><h3 id="3-当需要集中控制对象之间的交互时"><a href="#3-当需要集中控制对象之间的交互时" class="headerlink" title="3. 当需要集中控制对象之间的交互时"></a>3. 当需要集中控制对象之间的交互时</h3><p>例如：</p><ul><li>需要对对象之间的交互进行监控或记录</li><li>需要对对象之间的交互进行权限控制</li><li>需要对对象之间的交互进行事务管理</li></ul><h3 id="4-当需要减少对象之间的直接依赖时"><a href="#4-当需要减少对象之间的直接依赖时" class="headerlink" title="4. 当需要减少对象之间的直接依赖时"></a>4. 当需要减少对象之间的直接依赖时</h3><p>例如：</p><ul><li>符合迪米特法则（最少知识原则）</li><li>提高系统的可测试性</li><li>提高系统的可扩展性</li></ul><h3 id="5-当需要统一管理对象之间的通信时"><a href="#5-当需要统一管理对象之间的通信时" class="headerlink" title="5. 当需要统一管理对象之间的通信时"></a>5. 当需要统一管理对象之间的通信时</h3><p>例如：</p><ul><li>需要实现消息的广播</li><li>需要实现消息的路由</li><li>需要实现消息的过滤</li></ul><h2 id="中介者模式的变体"><a href="#中介者模式的变体" class="headerlink" title="中介者模式的变体"></a>中介者模式的变体</h2><h3 id="1-集中式中介者-vs-分布式中介者"><a href="#1-集中式中介者-vs-分布式中介者" class="headerlink" title="1. 集中式中介者 vs 分布式中介者"></a>1. 集中式中介者 vs 分布式中介者</h3><ul><li><strong>集中式中介者</strong>：所有通信都经过一个中央中介者</li><li><strong>分布式中介者</strong>：通信经过多个中介者，每个中介者负责一部分功能</li></ul><h3 id="2-静态中介者-vs-动态中介者"><a href="#2-静态中介者-vs-动态中介者" class="headerlink" title="2. 静态中介者 vs 动态中介者"></a>2. 静态中介者 vs 动态中介者</h3><ul><li><strong>静态中介者</strong>：中介者的结构在编译时确定</li><li><strong>动态中介者</strong>：中介者的结构在运行时动态构建</li></ul><h3 id="3-同步中介者-vs-异步中介者"><a href="#3-同步中介者-vs-异步中介者" class="headerlink" title="3. 同步中介者 vs 异步中介者"></a>3. 同步中介者 vs 异步中介者</h3><ul><li><strong>同步中介者</strong>：消息的传递是同步的</li><li><strong>异步中介者</strong>：消息的传递是异步的</li></ul><h3 id="4-消息中介者-vs-事件中介者"><a href="#4-消息中介者-vs-事件中介者" class="headerlink" title="4. 消息中介者 vs 事件中介者"></a>4. 消息中介者 vs 事件中介者</h3><ul><li><strong>消息中介者</strong>：基于消息的传递</li><li><strong>事件中介者</strong>：基于事件的发布和订阅</li></ul><h3 id="5-中介者与观察者模式结合"><a href="#5-中介者与观察者模式结合" class="headerlink" title="5. 中介者与观察者模式结合"></a>5. 中介者与观察者模式结合</h3><p>中介者作为事件的发布者，同事作为观察者，订阅中介者的事件</p><h2 id="实际应用案例"><a href="#实际应用案例" class="headerlink" title="实际应用案例"></a>实际应用案例</h2><h3 id="1-Java-Swing-的-EventDispatchThread"><a href="#1-Java-Swing-的-EventDispatchThread" class="headerlink" title="1. Java Swing 的 EventDispatchThread"></a>1. Java Swing 的 EventDispatchThread</h3><p>Java Swing 使用事件分发线程作为中介者，处理 UI 组件之间的事件传递。</p><h3 id="2-Spring-的-ApplicationContext"><a href="#2-Spring-的-ApplicationContext" class="headerlink" title="2. Spring 的 ApplicationContext"></a>2. Spring 的 ApplicationContext</h3><p>Spring 框架中的 ApplicationContext 作为中介者，管理 bean 之间的依赖注入和事件传递。</p><h3 id="3-消息队列系统"><a href="#3-消息队列系统" class="headerlink" title="3. 消息队列系统"></a>3. 消息队列系统</h3><p>RabbitMQ、Kafka 等消息队列系统作为中介者，实现生产者和消费者之间的通信。</p><h3 id="4-微服务架构中的服务注册与发现"><a href="#4-微服务架构中的服务注册与发现" class="headerlink" title="4. 微服务架构中的服务注册与发现"></a>4. 微服务架构中的服务注册与发现</h3><p>Eureka、Consul 等服务注册中心作为中介者，实现微服务之间的服务发现和通信。</p><h3 id="5-前端框架中的状态管理"><a href="#5-前端框架中的状态管理" class="headerlink" title="5. 前端框架中的状态管理"></a>5. 前端框架中的状态管理</h3><p>Redux、Vuex 等状态管理库作为中介者，管理组件之间的状态共享和通信。</p><h3 id="6-聊天室应用"><a href="#6-聊天室应用" class="headerlink" title="6. 聊天室应用"></a>6. 聊天室应用</h3><p>聊天室服务器作为中介者，实现用户之间的消息传递。</p><h2 id="代码优化建议"><a href="#代码优化建议" class="headerlink" title="代码优化建议"></a>代码优化建议</h2><h3 id="1-合理设计中介者的职责"><a href="#1-合理设计中介者的职责" class="headerlink" title="1. 合理设计中介者的职责"></a>1. 合理设计中介者的职责</h3><ul><li>中介者的职责应该明确，避免过于复杂</li><li>可以将中介者的职责分解为多个子中介者</li><li>可以使用策略模式或模板方法模式来处理不同类型的交互</li></ul><h3 id="2-优化中介者的性能"><a href="#2-优化中介者的性能" class="headerlink" title="2. 优化中介者的性能"></a>2. 优化中介者的性能</h3><ul><li>对于高频通信，可以考虑使用缓存或批处理</li><li>对于异步通信，可以使用消息队列或事件总线</li><li>可以使用线程池来处理并发请求</li></ul><h3 id="3-提高中介者的可靠性"><a href="#3-提高中介者的可靠性" class="headerlink" title="3. 提高中介者的可靠性"></a>3. 提高中介者的可靠性</h3><ul><li>实现中介者的容错机制，避免单点故障</li><li>实现中介者的备份和恢复机制</li><li>实现中介者的监控和告警机制</li></ul><h3 id="4-增强中介者的可扩展性"><a href="#4-增强中介者的可扩展性" class="headerlink" title="4. 增强中介者的可扩展性"></a>4. 增强中介者的可扩展性</h3><ul><li>使用依赖注入来管理中介者的依赖</li><li>使用插件机制来扩展中介者的功能</li><li>使用配置文件来配置中介者的行为</li></ul><h3 id="5-提高代码的可测试性"><a href="#5-提高代码的可测试性" class="headerlink" title="5. 提高代码的可测试性"></a>5. 提高代码的可测试性</h3><ul><li>为中介者和同事编写单元测试</li><li>使用模拟对象（Mock）来测试中介者的行为</li><li>使用集成测试来测试整个系统的行为</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>中介者模式是一种有效的设计模式，它通过引入一个中介对象，将对象之间的直接交互转换为通过中介者的间接交互，从而降低了对象之间的耦合度，提高了系统的可维护性和可扩展性。</p><p>中介者模式在多人聊天系统、GUI 组件交互、微服务架构、游戏开发、事件处理系统等场景中有着广泛的应用。通过合理使用中介者模式，可以使系统的设计更加清晰，代码更加易于维护。</p><p>然而，中介者模式也有其局限性，如中介者可能会变得复杂、成为单点故障等。因此，在使用中介者模式时，需要根据具体的场景和需求，权衡其优缺点，做出合理的设计决策。</p><p>总之，中介者模式是一种重要的设计模式，掌握它对于构建松耦合、可维护的系统具有重要意义。</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> Python </tag>
            
            <tag> Java </tag>
            
            <tag> C# </tag>
            
            <tag> 设计模式 </tag>
            
            <tag> 中介者模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式——命令模式</title>
      <link href="/2026/01/22/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F/"/>
      <url>/2026/01/22/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="命令模式详解"><a href="#命令模式详解" class="headerlink" title="命令模式详解"></a>命令模式详解</h1><h2 id="什么是命令模式？"><a href="#什么是命令模式？" class="headerlink" title="什么是命令模式？"></a>什么是命令模式？</h2><p>命令模式（Command Pattern）是一种行为型设计模式，它将请求封装为对象，从而使你可以用不同的请求参数化客户端，支持可撤销操作、队列化请求以及日志记录等功能。</p><h3 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h3><ul><li><strong>Command（命令）</strong>：定义执行操作的接口，包含一个执行方法。</li><li><strong>ConcreteCommand（具体命令）</strong>：实现命令接口，绑定接收者和动作，调用接收者的方法执行操作。</li><li><strong>Receiver（接收者）</strong>：执行命令的实际对象，知道如何执行与命令相关的操作。</li><li><strong>Invoker（调用者）</strong>：要求命令执行请求，持有命令对象。</li><li><strong>Client（客户端）</strong>：创建具体命令对象并设置其接收者。</li></ul><h3 id="命令模式的UML图"><a href="#命令模式的UML图" class="headerlink" title="命令模式的UML图"></a>命令模式的UML图</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">+----------------+       +----------------+</span><br><span class="line">|   Command      |&lt;------|   Invoker      |</span><br><span class="line">+----------------+       +----------------+</span><br><span class="line">| +execute()     |       | -command       |</span><br><span class="line">| +undo()        |       | +setCommand()  |</span><br><span class="line">+----------------+       | +invoke()      |</span><br><span class="line">        ^                +----------------+</span><br><span class="line">        |                        |</span><br><span class="line">+----------------+       +----------------+</span><br><span class="line">| ConcreteCommand|       |   Client       |</span><br><span class="line">+----------------+       +----------------+</span><br><span class="line">| -receiver      |       | +createCommand()|</span><br><span class="line">| +execute()     |       | +run()         |</span><br><span class="line">| +undo()        |       +----------------+</span><br><span class="line">+----------------+                |</span><br><span class="line">        |                         |</span><br><span class="line">        v                         |</span><br><span class="line">+----------------+       +----------------+</span><br><span class="line">|   Receiver     |&lt;------|                |</span><br><span class="line">+----------------+       +----------------+</span><br><span class="line">| +action()      |</span><br><span class="line">+----------------+</span><br></pre></td></tr></table></figure><h2 id="命令模式的优缺点"><a href="#命令模式的优缺点" class="headerlink" title="命令模式的优缺点"></a>命令模式的优缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol><li><strong>解耦</strong>：将请求的发送者和接收者解耦，发送者不需要知道接收者的具体实现。</li><li><strong>可扩展性</strong>：可以轻松添加新的命令，而不需要修改现有代码。</li><li><strong>可撤销操作</strong>：支持命令的撤销和重做操作。</li><li><strong>宏命令</strong>：可以组合多个命令为一个复合命令。</li><li><strong>队列化请求</strong>：可以将命令放入队列中执行，支持异步操作。</li><li><strong>日志记录</strong>：可以记录命令的执行历史，支持崩溃恢复。</li></ol><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol><li><strong>类数量增加</strong>：每个命令都需要创建一个类，可能会导致类数量增加。</li><li><strong>复杂度增加</strong>：命令模式的实现可能会增加系统的复杂度。</li><li><strong>性能开销</strong>：命令对象的创建和管理可能会带来一定的性能开销。</li></ol><h2 id="命令模式的实现"><a href="#命令模式的实现" class="headerlink" title="命令模式的实现"></a>命令模式的实现</h2><h3 id="C-实现"><a href="#C-实现" class="headerlink" title="C++ 实现"></a>C++ 实现</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Receiver</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">action</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Receiver: &quot;</span> &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 命令接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Command</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Command</span>() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">execute</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">undo</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体命令</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteCommand</span> : <span class="keyword">public</span> Command &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Receiver* receiver;</span><br><span class="line">    std::string message;</span><br><span class="line">    std::string previousMessage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ConcreteCommand</span>(Receiver* receiver, <span class="type">const</span> std::string&amp; message) </span><br><span class="line">        : <span class="built_in">receiver</span>(receiver), <span class="built_in">message</span>(message) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">execute</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        previousMessage = <span class="string">&quot;Previous state&quot;</span>; <span class="comment">// 模拟保存前一状态</span></span><br><span class="line">        receiver-&gt;<span class="built_in">action</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">undo</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        receiver-&gt;<span class="built_in">action</span>(previousMessage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Invoker</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Command* command;</span><br><span class="line">    std::vector&lt;Command*&gt; history;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ~<span class="built_in">Invoker</span>() &#123;</span><br><span class="line">        <span class="keyword">for</span> (Command* cmd : history) &#123;</span><br><span class="line">            <span class="keyword">delete</span> cmd;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setCommand</span><span class="params">(Command* cmd)</span> </span>&#123;</span><br><span class="line">        command = cmd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">invoke</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (command) &#123;</span><br><span class="line">            command-&gt;<span class="built_in">execute</span>();</span><br><span class="line">            history.<span class="built_in">push_back</span>(command);</span><br><span class="line">            command = <span class="literal">nullptr</span>; <span class="comment">// 避免重复执行</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">undo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!history.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            Command* lastCommand = history.<span class="built_in">back</span>();</span><br><span class="line">            lastCommand-&gt;<span class="built_in">undo</span>();</span><br><span class="line">            history.<span class="built_in">pop_back</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Invoker* invoker;</span><br><span class="line">    Receiver* receiver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Client</span>(Invoker* invoker, Receiver* receiver) </span><br><span class="line">        : <span class="built_in">invoker</span>(invoker), <span class="built_in">receiver</span>(receiver) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">createAndExecuteCommand</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        Command* command = <span class="keyword">new</span> <span class="built_in">ConcreteCommand</span>(receiver, message);</span><br><span class="line">        invoker-&gt;<span class="built_in">setCommand</span>(command);</span><br><span class="line">        invoker-&gt;<span class="built_in">invoke</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">undoLastCommand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        invoker-&gt;<span class="built_in">undo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试代码</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建接收者</span></span><br><span class="line">    Receiver receiver;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建调用者</span></span><br><span class="line">    Invoker invoker;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建客户端</span></span><br><span class="line">    <span class="function">Client <span class="title">client</span><span class="params">(&amp;invoker, &amp;receiver)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 执行命令</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;=== Executing Command 1 ===&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    client.<span class="built_in">createAndExecuteCommand</span>(<span class="string">&quot;Execute command 1&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\n=== Executing Command 2 ===&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    client.<span class="built_in">createAndExecuteCommand</span>(<span class="string">&quot;Execute command 2&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 撤销命令</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\n=== Undoing Last Command ===&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    client.<span class="built_in">undoLastCommand</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Java-实现"><a href="#Java-实现" class="headerlink" title="Java 实现"></a>Java 实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Receiver</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">action</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Receiver: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 命令接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体命令</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Receiver receiver;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> String previousMessage;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcreteCommand</span><span class="params">(Receiver receiver, String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.receiver = receiver;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        previousMessage = <span class="string">&quot;Previous state&quot;</span>; <span class="comment">// 模拟保存前一状态</span></span><br><span class="line">        receiver.action(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span> &#123;</span><br><span class="line">        receiver.action(previousMessage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Invoker</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Command command;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Command&gt; history = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCommand</span><span class="params">(Command cmd)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.command = cmd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (command != <span class="literal">null</span>) &#123;</span><br><span class="line">            command.execute();</span><br><span class="line">            history.add(command);</span><br><span class="line">            command = <span class="literal">null</span>; <span class="comment">// 避免重复执行</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!history.isEmpty()) &#123;</span><br><span class="line">            <span class="type">Command</span> <span class="variable">lastCommand</span> <span class="operator">=</span> history.remove(history.size() - <span class="number">1</span>);</span><br><span class="line">            lastCommand.undo();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Invoker invoker;</span><br><span class="line">    <span class="keyword">private</span> Receiver receiver;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Client</span><span class="params">(Invoker invoker, Receiver receiver)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.invoker = invoker;</span><br><span class="line">        <span class="built_in">this</span>.receiver = receiver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createAndExecuteCommand</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="type">Command</span> <span class="variable">command</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteCommand</span>(receiver, message);</span><br><span class="line">        invoker.setCommand(command);</span><br><span class="line">        invoker.invoke();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undoLastCommand</span><span class="params">()</span> &#123;</span><br><span class="line">        invoker.undo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommandPatternDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建接收者</span></span><br><span class="line">        <span class="type">Receiver</span> <span class="variable">receiver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Receiver</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建调用者</span></span><br><span class="line">        <span class="type">Invoker</span> <span class="variable">invoker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Invoker</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建客户端</span></span><br><span class="line">        <span class="type">Client</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Client</span>(invoker, receiver);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 执行命令</span></span><br><span class="line">        System.out.println(<span class="string">&quot;=== Executing Command 1 ===&quot;</span>);</span><br><span class="line">        client.createAndExecuteCommand(<span class="string">&quot;Execute command 1&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;\n=== Executing Command 2 ===&quot;</span>);</span><br><span class="line">        client.createAndExecuteCommand(<span class="string">&quot;Execute command 2&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 撤销命令</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n=== Undoing Last Command ===&quot;</span>);</span><br><span class="line">        client.undoLastCommand();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Python-实现"><a href="#Python-实现" class="headerlink" title="Python 实现"></a>Python 实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 接收者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Receiver</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Receiver: <span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 命令接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Command</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">undo</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体命令</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteCommand</span>(<span class="title class_ inherited__">Command</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, receiver, message</span>):</span><br><span class="line">        <span class="variable language_">self</span>.receiver = receiver</span><br><span class="line">        <span class="variable language_">self</span>.message = message</span><br><span class="line">        <span class="variable language_">self</span>.previous_message = <span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.previous_message = <span class="string">&quot;Previous state&quot;</span>  <span class="comment"># 模拟保存前一状态</span></span><br><span class="line">        <span class="variable language_">self</span>.receiver.action(<span class="variable language_">self</span>.message)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">undo</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.receiver.action(<span class="variable language_">self</span>.previous_message)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Invoker</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.command = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.history = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_command</span>(<span class="params">self, command</span>):</span><br><span class="line">        <span class="variable language_">self</span>.command = command</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">invoke</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.command:</span><br><span class="line">            <span class="variable language_">self</span>.command.execute()</span><br><span class="line">            <span class="variable language_">self</span>.history.append(<span class="variable language_">self</span>.command)</span><br><span class="line">            <span class="variable language_">self</span>.command = <span class="literal">None</span>  <span class="comment"># 避免重复执行</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">undo</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.history:</span><br><span class="line">            last_command = <span class="variable language_">self</span>.history.pop()</span><br><span class="line">            last_command.undo()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Client</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, invoker, receiver</span>):</span><br><span class="line">        <span class="variable language_">self</span>.invoker = invoker</span><br><span class="line">        <span class="variable language_">self</span>.receiver = receiver</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_and_execute_command</span>(<span class="params">self, message</span>):</span><br><span class="line">        command = ConcreteCommand(<span class="variable language_">self</span>.receiver, message)</span><br><span class="line">        <span class="variable language_">self</span>.invoker.set_command(command)</span><br><span class="line">        <span class="variable language_">self</span>.invoker.invoke()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">undo_last_command</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.invoker.undo()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试代码</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 创建接收者</span></span><br><span class="line">    receiver = Receiver()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建调用者</span></span><br><span class="line">    invoker = Invoker()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建客户端</span></span><br><span class="line">    client = Client(invoker, receiver)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 执行命令</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=== Executing Command 1 ===&quot;</span>)</span><br><span class="line">    client.create_and_execute_command(<span class="string">&quot;Execute command 1&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n=== Executing Command 2 ===&quot;</span>)</span><br><span class="line">    client.create_and_execute_command(<span class="string">&quot;Execute command 2&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 撤销命令</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n=== Undoing Last Command ===&quot;</span>)</span><br><span class="line">    client.undo_last_command()</span><br></pre></td></tr></table></figure><h3 id="C-实现-1"><a href="#C-实现-1" class="headerlink" title="C# 实现"></a>C# 实现</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Receiver</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Action</span>(<span class="params"><span class="built_in">string</span> message</span>)</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Receiver: <span class="subst">&#123;message&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 命令接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title">ICommand</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Execute</span>()</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Undo</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体命令</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">ConcreteCommand</span> : <span class="title">ICommand</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Receiver receiver;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> message;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> previousMessage;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreteCommand</span>(<span class="params">Receiver receiver, <span class="built_in">string</span> message</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.receiver = receiver;</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Execute</span>()</span> &#123;</span><br><span class="line">        previousMessage = <span class="string">&quot;Previous state&quot;</span>; <span class="comment">// 模拟保存前一状态</span></span><br><span class="line">        receiver.Action(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Undo</span>()</span> &#123;</span><br><span class="line">        receiver.Action(previousMessage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Invoker</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ICommand command;</span><br><span class="line">    <span class="keyword">private</span> List&lt;ICommand&gt; history = <span class="keyword">new</span> List&lt;ICommand&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetCommand</span>(<span class="params">ICommand cmd</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.command = cmd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Invoke</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (command != <span class="literal">null</span>) &#123;</span><br><span class="line">            command.Execute();</span><br><span class="line">            history.Add(command);</span><br><span class="line">            command = <span class="literal">null</span>; <span class="comment">// 避免重复执行</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Undo</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (history.Count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            ICommand lastCommand = history[history.Count - <span class="number">1</span>];</span><br><span class="line">            history.RemoveAt(history.Count - <span class="number">1</span>);</span><br><span class="line">            lastCommand.Undo();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Client</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Invoker invoker;</span><br><span class="line">    <span class="keyword">private</span> Receiver receiver;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Client</span>(<span class="params">Invoker invoker, Receiver receiver</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.invoker = invoker;</span><br><span class="line">        <span class="keyword">this</span>.receiver = receiver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CreateAndExecuteCommand</span>(<span class="params"><span class="built_in">string</span> message</span>)</span> &#123;</span><br><span class="line">        ICommand command = <span class="keyword">new</span> ConcreteCommand(receiver, message);</span><br><span class="line">        invoker.SetCommand(command);</span><br><span class="line">        invoker.Invoke();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UndoLastCommand</span>()</span> &#123;</span><br><span class="line">        invoker.Undo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试代码</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建接收者</span></span><br><span class="line">        Receiver receiver = <span class="keyword">new</span> Receiver();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建调用者</span></span><br><span class="line">        Invoker invoker = <span class="keyword">new</span> Invoker();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建客户端</span></span><br><span class="line">        Client client = <span class="keyword">new</span> Client(invoker, receiver);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 执行命令</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;=== Executing Command 1 ===&quot;</span>);</span><br><span class="line">        client.CreateAndExecuteCommand(<span class="string">&quot;Execute command 1&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        Console.WriteLine(<span class="string">&quot;\n=== Executing Command 2 ===&quot;</span>);</span><br><span class="line">        client.CreateAndExecuteCommand(<span class="string">&quot;Execute command 2&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 撤销命令</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;\n=== Undoing Last Command ===&quot;</span>);</span><br><span class="line">        client.UndoLastCommand();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="命令模式的使用场景"><a href="#命令模式的使用场景" class="headerlink" title="命令模式的使用场景"></a>命令模式的使用场景</h2><h3 id="1-GUI-应用"><a href="#1-GUI-应用" class="headerlink" title="1. GUI 应用"></a>1. GUI 应用</h3><ul><li><strong>按钮点击</strong>：每个按钮对应一个命令</li><li><strong>菜单操作</strong>：每个菜单项对应一个命令</li><li><strong>快捷键</strong>：每个快捷键对应一个命令</li></ul><h3 id="2-撤销-重做操作"><a href="#2-撤销-重做操作" class="headerlink" title="2. 撤销&#x2F;重做操作"></a>2. 撤销&#x2F;重做操作</h3><ul><li><strong>文本编辑器</strong>：撤销&#x2F;重做文本修改</li><li><strong>图形编辑器</strong>：撤销&#x2F;重做图形操作</li><li><strong>表单操作</strong>：撤销&#x2F;重做表单修改</li></ul><h3 id="3-队列化请求"><a href="#3-队列化请求" class="headerlink" title="3. 队列化请求"></a>3. 队列化请求</h3><ul><li><strong>任务队列</strong>：将命令放入队列中异步执行</li><li><strong>线程池</strong>：线程池执行命令队列</li><li><strong>消息队列</strong>：消息队列中的消息作为命令执行</li></ul><h3 id="4-事务处理"><a href="#4-事务处理" class="headerlink" title="4. 事务处理"></a>4. 事务处理</h3><ul><li><strong>数据库事务</strong>：将多个操作封装为一个命令，支持回滚</li><li><strong>业务事务</strong>：将多个业务操作封装为一个命令，支持回滚</li></ul><h3 id="5-远程方法调用"><a href="#5-远程方法调用" class="headerlink" title="5. 远程方法调用"></a>5. 远程方法调用</h3><ul><li><strong>RPC</strong>：将远程调用封装为命令</li><li><strong>Web 服务</strong>：将 HTTP 请求封装为命令</li><li><strong>消息传递</strong>：将消息封装为命令</li></ul><h3 id="6-宏命令"><a href="#6-宏命令" class="headerlink" title="6. 宏命令"></a>6. 宏命令</h3><ul><li><strong>批处理操作</strong>：将多个命令组合为一个复合命令</li><li><strong>快捷键组合</strong>：将多个操作绑定到一个快捷键</li><li><strong>工作流</strong>：将工作流步骤封装为命令链</li></ul><h3 id="7-其他场景"><a href="#7-其他场景" class="headerlink" title="7. 其他场景"></a>7. 其他场景</h3><ul><li><strong>日志记录</strong>：记录命令执行历史，支持崩溃恢复</li><li><strong>游戏开发</strong>：游戏中的操作命令，支持撤销&#x2F;重做</li><li><strong>配置管理</strong>：配置变更的命令化，支持回滚</li></ul><h2 id="适合使用命令模式的问题"><a href="#适合使用命令模式的问题" class="headerlink" title="适合使用命令模式的问题"></a>适合使用命令模式的问题</h2><h3 id="1-当需要将请求的发送者和接收者解耦时"><a href="#1-当需要将请求的发送者和接收者解耦时" class="headerlink" title="1. 当需要将请求的发送者和接收者解耦时"></a>1. 当需要将请求的发送者和接收者解耦时</h3><p>例如：</p><ul><li>GUI 组件不需要知道具体的业务逻辑实现</li><li>业务逻辑层不需要知道具体的底层实现</li></ul><h3 id="2-当需要支持撤销和重做操作时"><a href="#2-当需要支持撤销和重做操作时" class="headerlink" title="2. 当需要支持撤销和重做操作时"></a>2. 当需要支持撤销和重做操作时</h3><p>例如：</p><ul><li>文本编辑器的撤销&#x2F;重做功能</li><li>图形编辑器的撤销&#x2F;重做功能</li></ul><h3 id="3-当需要将请求队列化或异步执行时"><a href="#3-当需要将请求队列化或异步执行时" class="headerlink" title="3. 当需要将请求队列化或异步执行时"></a>3. 当需要将请求队列化或异步执行时</h3><p>例如：</p><ul><li>任务调度系统</li><li>消息队列系统</li></ul><h3 id="4-当需要将多个操作组合为一个复合操作时"><a href="#4-当需要将多个操作组合为一个复合操作时" class="headerlink" title="4. 当需要将多个操作组合为一个复合操作时"></a>4. 当需要将多个操作组合为一个复合操作时</h3><p>例如：</p><ul><li>宏命令</li><li>事务操作</li></ul><h3 id="5-当需要记录命令执行历史时"><a href="#5-当需要记录命令执行历史时" class="headerlink" title="5. 当需要记录命令执行历史时"></a>5. 当需要记录命令执行历史时</h3><p>例如：</p><ul><li>日志系统</li><li>崩溃恢复系统</li></ul><h2 id="命令模式的变体"><a href="#命令模式的变体" class="headerlink" title="命令模式的变体"></a>命令模式的变体</h2><h3 id="1-简单命令-vs-复合命令"><a href="#1-简单命令-vs-复合命令" class="headerlink" title="1. 简单命令 vs 复合命令"></a>1. 简单命令 vs 复合命令</h3><ul><li><strong>简单命令</strong>：单个操作的命令</li><li><strong>复合命令</strong>：多个操作的组合命令（宏命令）</li></ul><h3 id="2-有状态命令-vs-无状态命令"><a href="#2-有状态命令-vs-无状态命令" class="headerlink" title="2. 有状态命令 vs 无状态命令"></a>2. 有状态命令 vs 无状态命令</h3><ul><li><strong>有状态命令</strong>：命令对象包含执行所需的状态</li><li><strong>无状态命令</strong>：命令对象不包含状态，状态由接收者管理</li></ul><h3 id="3-同步命令-vs-异步命令"><a href="#3-同步命令-vs-异步命令" class="headerlink" title="3. 同步命令 vs 异步命令"></a>3. 同步命令 vs 异步命令</h3><ul><li><strong>同步命令</strong>：命令执行是同步的</li><li><strong>异步命令</strong>：命令执行是异步的</li></ul><h3 id="4-可撤销命令-vs-不可撤销命令"><a href="#4-可撤销命令-vs-不可撤销命令" class="headerlink" title="4. 可撤销命令 vs 不可撤销命令"></a>4. 可撤销命令 vs 不可撤销命令</h3><ul><li><strong>可撤销命令</strong>：支持 undo 操作</li><li><strong>不可撤销命令</strong>：不支持 undo 操作</li></ul><h3 id="5-命令处理器模式"><a href="#5-命令处理器模式" class="headerlink" title="5. 命令处理器模式"></a>5. 命令处理器模式</h3><p>命令处理器管理命令的执行、队列化和调度</p><h2 id="实际应用案例"><a href="#实际应用案例" class="headerlink" title="实际应用案例"></a>实际应用案例</h2><h3 id="1-Java-Swing-AWT"><a href="#1-Java-Swing-AWT" class="headerlink" title="1. Java Swing&#x2F;AWT"></a>1. Java Swing&#x2F;AWT</h3><p>Java Swing 中的 Action 接口和 AbstractAction 类是命令模式的应用。</p><h3 id="2-遥控器"><a href="#2-遥控器" class="headerlink" title="2. 遥控器"></a>2. 遥控器</h3><p>电视、空调等遥控器的设计使用了命令模式。</p><h3 id="3-游戏开发"><a href="#3-游戏开发" class="headerlink" title="3. 游戏开发"></a>3. 游戏开发</h3><p>游戏中的操作（移动、攻击、跳跃等）通常使用命令模式实现。</p><h3 id="4-事务系统"><a href="#4-事务系统" class="headerlink" title="4. 事务系统"></a>4. 事务系统</h3><p>数据库事务、业务事务等使用命令模式实现。</p><h3 id="5-工作流系统"><a href="#5-工作流系统" class="headerlink" title="5. 工作流系统"></a>5. 工作流系统</h3><p>工作流中的每个步骤可以看作是一个命令。</p><h3 id="6-批处理系统"><a href="#6-批处理系统" class="headerlink" title="6. 批处理系统"></a>6. 批处理系统</h3><p>批处理作业可以看作是一系列命令的组合。</p><h2 id="代码优化建议"><a href="#代码优化建议" class="headerlink" title="代码优化建议"></a>代码优化建议</h2><h3 id="1-使用命令工厂"><a href="#1-使用命令工厂" class="headerlink" title="1. 使用命令工厂"></a>1. 使用命令工厂</h3><p>使用工厂方法或抽象工厂模式创建命令对象，提高代码的可维护性。</p><h3 id="2-使用命令池"><a href="#2-使用命令池" class="headerlink" title="2. 使用命令池"></a>2. 使用命令池</h3><p>对于频繁创建的命令对象，考虑使用对象池模式，减少对象创建的开销。</p><h3 id="3-优化命令的序列化"><a href="#3-优化命令的序列化" class="headerlink" title="3. 优化命令的序列化"></a>3. 优化命令的序列化</h3><p>对于需要持久化或网络传输的命令，优化序列化和反序列化过程。</p><h3 id="4-合理处理异常"><a href="#4-合理处理异常" class="headerlink" title="4. 合理处理异常"></a>4. 合理处理异常</h3><p>在命令的 execute() 和 undo() 方法中添加异常处理逻辑，确保命令的执行和撤销不会因异常而中断。</p><h3 id="5-考虑线程安全性"><a href="#5-考虑线程安全性" class="headerlink" title="5. 考虑线程安全性"></a>5. 考虑线程安全性</h3><p>如果命令在多线程环境中执行，确保命令的线程安全性。</p><h3 id="6-使用装饰器模式增强命令"><a href="#6-使用装饰器模式增强命令" class="headerlink" title="6. 使用装饰器模式增强命令"></a>6. 使用装饰器模式增强命令</h3><p>使用装饰器模式为命令添加额外的功能，如日志记录、性能监控等。</p><h3 id="7-合理设计命令的粒度"><a href="#7-合理设计命令的粒度" class="headerlink" title="7. 合理设计命令的粒度"></a>7. 合理设计命令的粒度</h3><p>命令的粒度应该适中，过大的命令会降低灵活性，过小的命令会增加系统复杂度。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>命令模式是一种非常实用的设计模式，它通过将请求封装为对象，实现了请求发送者和接收者的解耦，支持撤销&#x2F;重做、队列化请求、事务处理等功能。</p><p>命令模式在 GUI 应用、撤销&#x2F;重做操作、队列化请求、事务处理、远程方法调用等场景中有着广泛的应用。通过合理使用命令模式，可以提高系统的灵活性、可扩展性和可维护性。</p><p>在实际开发中，当你遇到需要解耦请求发送者和接收者、支持撤销&#x2F;重做操作、队列化请求或组合多个操作的场景时，不妨考虑使用命令模式。</p><p>记住，命令模式的核心是将行为封装为对象，通过这种方式，可以实现更灵活、更可扩展的系统设计。</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> Python </tag>
            
            <tag> Java </tag>
            
            <tag> C# </tag>
            
            <tag> 设计模式 </tag>
            
            <tag> 命令模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式——责任链模式</title>
      <link href="/2026/01/22/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/"/>
      <url>/2026/01/22/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="责任链模式详解"><a href="#责任链模式详解" class="headerlink" title="责任链模式详解"></a>责任链模式详解</h1><h2 id="什么是责任链模式？"><a href="#什么是责任链模式？" class="headerlink" title="什么是责任链模式？"></a>什么是责任链模式？</h2><p>责任链模式（Chain of Responsibility Pattern）是一种行为型设计模式，它允许将请求沿着处理者链进行传递，直到有一个处理者处理该请求为止。每个处理者都包含对下一个处理者的引用，形成一条链。</p><h3 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h3><ul><li><strong>Handler（处理者）</strong>：定义处理请求的接口，包含处理请求的方法和设置下一个处理者的方法。</li><li><strong>ConcreteHandler（具体处理者）</strong>：实现处理者接口，处理它所负责的请求，如果不能处理则将请求传递给下一个处理者。</li><li><strong>Client（客户端）</strong>：创建处理者链并向链头的处理者提交请求。</li></ul><h3 id="责任链模式的UML图"><a href="#责任链模式的UML图" class="headerlink" title="责任链模式的UML图"></a>责任链模式的UML图</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">+----------------+       +----------------+</span><br><span class="line">|   Handler      |&lt;------|   Handler      |</span><br><span class="line">+----------------+       +----------------+</span><br><span class="line">| -successor     |       | +handleRequest()|</span><br><span class="line">| +setSuccessor()|       | +setSuccessor()|</span><br><span class="line">| +handleRequest()|       +----------------+</span><br><span class="line">+----------------+               ^</span><br><span class="line">        ^                        |</span><br><span class="line">        |                        |</span><br><span class="line">+----------------+       +----------------+</span><br><span class="line">| ConcreteHandlerA|       | ConcreteHandlerB|</span><br><span class="line">+----------------+       +----------------+</span><br><span class="line">| +handleRequest()|       | +handleRequest()|</span><br><span class="line">+----------------+       +----------------+</span><br></pre></td></tr></table></figure><h2 id="责任链模式的优缺点"><a href="#责任链模式的优缺点" class="headerlink" title="责任链模式的优缺点"></a>责任链模式的优缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol><li><strong>解耦</strong>：将请求的发送者和接收者解耦，发送者不需要知道谁处理了请求。</li><li><strong>灵活性</strong>：可以动态调整处理者链的结构，添加或删除处理者。</li><li><strong>单一职责</strong>：每个处理者只负责自己的处理逻辑，符合单一职责原则。</li><li><strong>可扩展性</strong>：可以轻松添加新的处理者，而不需要修改现有代码。</li></ol><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol><li><strong>效率问题</strong>：如果链过长，可能会影响请求的处理效率。</li><li><strong>不确定性</strong>：请求可能会在链中传递而不被任何处理者处理。</li><li><strong>调试困难</strong>：由于请求的处理路径不确定，可能会增加调试的难度。</li></ol><h2 id="责任链模式的实现"><a href="#责任链模式的实现" class="headerlink" title="责任链模式的实现"></a>责任链模式的实现</h2><h3 id="C-实现"><a href="#C-实现" class="headerlink" title="C++ 实现"></a>C++ 实现</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理者接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Handler* successor;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Handler</span>() : <span class="built_in">successor</span>(<span class="literal">nullptr</span>) &#123;&#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Handler</span>() &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置下一个处理者</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setSuccessor</span><span class="params">(Handler* next)</span> </span>&#123;</span><br><span class="line">        successor = next;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理请求</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">handleRequest</span><span class="params">(<span class="type">int</span> request)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者A：处理1-10的请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteHandlerA</span> : <span class="keyword">public</span> Handler &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handleRequest</span><span class="params">(<span class="type">int</span> request)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (request &gt;= <span class="number">1</span> &amp;&amp; request &lt;= <span class="number">10</span>) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;ConcreteHandlerA handled request &quot;</span> &lt;&lt; request &lt;&lt; std::endl;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (successor != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            successor-&gt;<span class="built_in">handleRequest</span>(request);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;No handler can handle request &quot;</span> &lt;&lt; request &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者B：处理11-20的请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteHandlerB</span> : <span class="keyword">public</span> Handler &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handleRequest</span><span class="params">(<span class="type">int</span> request)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (request &gt;= <span class="number">11</span> &amp;&amp; request &lt;= <span class="number">20</span>) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;ConcreteHandlerB handled request &quot;</span> &lt;&lt; request &lt;&lt; std::endl;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (successor != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            successor-&gt;<span class="built_in">handleRequest</span>(request);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;No handler can handle request &quot;</span> &lt;&lt; request &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者C：处理21-30的请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteHandlerC</span> : <span class="keyword">public</span> Handler &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handleRequest</span><span class="params">(<span class="type">int</span> request)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (request &gt;= <span class="number">21</span> &amp;&amp; request &lt;= <span class="number">30</span>) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;ConcreteHandlerC handled request &quot;</span> &lt;&lt; request &lt;&lt; std::endl;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (successor != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            successor-&gt;<span class="built_in">handleRequest</span>(request);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;No handler can handle request &quot;</span> &lt;&lt; request &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试代码</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建处理者</span></span><br><span class="line">    Handler* handlerA = <span class="keyword">new</span> <span class="built_in">ConcreteHandlerA</span>();</span><br><span class="line">    Handler* handlerB = <span class="keyword">new</span> <span class="built_in">ConcreteHandlerB</span>();</span><br><span class="line">    Handler* handlerC = <span class="keyword">new</span> <span class="built_in">ConcreteHandlerC</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置责任链</span></span><br><span class="line">    handlerA-&gt;<span class="built_in">setSuccessor</span>(handlerB);</span><br><span class="line">    handlerB-&gt;<span class="built_in">setSuccessor</span>(handlerC);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 测试请求</span></span><br><span class="line">    <span class="type">int</span> requests[] = &#123;<span class="number">5</span>, <span class="number">15</span>, <span class="number">25</span>, <span class="number">35</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> request : requests) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;\nSending request &quot;</span> &lt;&lt; request &lt;&lt; std::endl;</span><br><span class="line">        handlerA-&gt;<span class="built_in">handleRequest</span>(request);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 释放资源</span></span><br><span class="line">    <span class="keyword">delete</span> handlerA;</span><br><span class="line">    <span class="keyword">delete</span> handlerB;</span><br><span class="line">    <span class="keyword">delete</span> handlerC;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Java-实现"><a href="#Java-实现" class="headerlink" title="Java 实现"></a>Java 实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理者接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setSuccessor</span><span class="params">(Handler successor)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(<span class="type">int</span> request)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者A：处理1-10的请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteHandlerA</span> <span class="keyword">implements</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Handler successor;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSuccessor</span><span class="params">(Handler successor)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.successor = successor;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(<span class="type">int</span> request)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (request &gt;= <span class="number">1</span> &amp;&amp; request &lt;= <span class="number">10</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ConcreteHandlerA handled request &quot;</span> + request);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (successor != <span class="literal">null</span>) &#123;</span><br><span class="line">            successor.handleRequest(request);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;No handler can handle request &quot;</span> + request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者B：处理11-20的请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteHandlerB</span> <span class="keyword">implements</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Handler successor;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSuccessor</span><span class="params">(Handler successor)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.successor = successor;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(<span class="type">int</span> request)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (request &gt;= <span class="number">11</span> &amp;&amp; request &lt;= <span class="number">20</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ConcreteHandlerB handled request &quot;</span> + request);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (successor != <span class="literal">null</span>) &#123;</span><br><span class="line">            successor.handleRequest(request);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;No handler can handle request &quot;</span> + request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者C：处理21-30的请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteHandlerC</span> <span class="keyword">implements</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Handler successor;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSuccessor</span><span class="params">(Handler successor)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.successor = successor;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(<span class="type">int</span> request)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (request &gt;= <span class="number">21</span> &amp;&amp; request &lt;= <span class="number">30</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ConcreteHandlerC handled request &quot;</span> + request);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (successor != <span class="literal">null</span>) &#123;</span><br><span class="line">            successor.handleRequest(request);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;No handler can handle request &quot;</span> + request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChainOfResponsibilityDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建处理者</span></span><br><span class="line">        <span class="type">Handler</span> <span class="variable">handlerA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteHandlerA</span>();</span><br><span class="line">        <span class="type">Handler</span> <span class="variable">handlerB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteHandlerB</span>();</span><br><span class="line">        <span class="type">Handler</span> <span class="variable">handlerC</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteHandlerC</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置责任链</span></span><br><span class="line">        handlerA.setSuccessor(handlerB);</span><br><span class="line">        handlerB.setSuccessor(handlerC);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 测试请求</span></span><br><span class="line">        <span class="type">int</span>[] requests = &#123;<span class="number">5</span>, <span class="number">15</span>, <span class="number">25</span>, <span class="number">35</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> request : requests) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;\nSending request &quot;</span> + request);</span><br><span class="line">            handlerA.handleRequest(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Python-实现"><a href="#Python-实现" class="headerlink" title="Python 实现"></a>Python 实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 处理者基类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handler</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.successor = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_successor</span>(<span class="params">self, successor</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;设置下一个处理者&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.successor = successor</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle_request</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;处理请求&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体处理者A：处理1-10的请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteHandlerA</span>(<span class="title class_ inherited__">Handler</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle_request</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">1</span> &lt;= request &lt;= <span class="number">10</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;ConcreteHandlerA handled request <span class="subst">&#123;request&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="variable language_">self</span>.successor:</span><br><span class="line">            <span class="variable language_">self</span>.successor.handle_request(request)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;No handler can handle request <span class="subst">&#123;request&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体处理者B：处理11-20的请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteHandlerB</span>(<span class="title class_ inherited__">Handler</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle_request</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">11</span> &lt;= request &lt;= <span class="number">20</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;ConcreteHandlerB handled request <span class="subst">&#123;request&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="variable language_">self</span>.successor:</span><br><span class="line">            <span class="variable language_">self</span>.successor.handle_request(request)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;No handler can handle request <span class="subst">&#123;request&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体处理者C：处理21-30的请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteHandlerC</span>(<span class="title class_ inherited__">Handler</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle_request</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">21</span> &lt;= request &lt;= <span class="number">30</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;ConcreteHandlerC handled request <span class="subst">&#123;request&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="variable language_">self</span>.successor:</span><br><span class="line">            <span class="variable language_">self</span>.successor.handle_request(request)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;No handler can handle request <span class="subst">&#123;request&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试代码</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 创建处理者</span></span><br><span class="line">    handler_a = ConcreteHandlerA()</span><br><span class="line">    handler_b = ConcreteHandlerB()</span><br><span class="line">    handler_c = ConcreteHandlerC()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 设置责任链</span></span><br><span class="line">    handler_a.set_successor(handler_b)</span><br><span class="line">    handler_b.set_successor(handler_c)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 测试请求</span></span><br><span class="line">    requests = [<span class="number">5</span>, <span class="number">15</span>, <span class="number">25</span>, <span class="number">35</span>]</span><br><span class="line">    <span class="keyword">for</span> request <span class="keyword">in</span> requests:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\nSending request <span class="subst">&#123;request&#125;</span>&quot;</span>)</span><br><span class="line">        handler_a.handle_request(request)</span><br></pre></td></tr></table></figure><h3 id="C-实现-1"><a href="#C-实现-1" class="headerlink" title="C# 实现"></a>C# 实现</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理者接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title">IHandler</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetSuccessor</span>(<span class="params">IHandler successor</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">HandleRequest</span>(<span class="params"><span class="built_in">int</span> request</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者A：处理1-10的请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">ConcreteHandlerA</span> : <span class="title">IHandler</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> IHandler successor;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetSuccessor</span>(<span class="params">IHandler successor</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.successor = successor;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">HandleRequest</span>(<span class="params"><span class="built_in">int</span> request</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (request &gt;= <span class="number">1</span> &amp;&amp; request &lt;= <span class="number">10</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;ConcreteHandlerA handled request <span class="subst">&#123;request&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (successor != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            successor.HandleRequest(request);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;No handler can handle request <span class="subst">&#123;request&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者B：处理11-20的请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">ConcreteHandlerB</span> : <span class="title">IHandler</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> IHandler successor;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetSuccessor</span>(<span class="params">IHandler successor</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.successor = successor;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">HandleRequest</span>(<span class="params"><span class="built_in">int</span> request</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (request &gt;= <span class="number">11</span> &amp;&amp; request &lt;= <span class="number">20</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;ConcreteHandlerB handled request <span class="subst">&#123;request&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (successor != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            successor.HandleRequest(request);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;No handler can handle request <span class="subst">&#123;request&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者C：处理21-30的请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">ConcreteHandlerC</span> : <span class="title">IHandler</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> IHandler successor;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetSuccessor</span>(<span class="params">IHandler successor</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.successor = successor;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">HandleRequest</span>(<span class="params"><span class="built_in">int</span> request</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (request &gt;= <span class="number">21</span> &amp;&amp; request &lt;= <span class="number">30</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;ConcreteHandlerC handled request <span class="subst">&#123;request&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (successor != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            successor.HandleRequest(request);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;No handler can handle request <span class="subst">&#123;request&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试代码</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 创建处理者</span></span><br><span class="line">        IHandler handlerA = <span class="keyword">new</span> ConcreteHandlerA();</span><br><span class="line">        IHandler handlerB = <span class="keyword">new</span> ConcreteHandlerB();</span><br><span class="line">        IHandler handlerC = <span class="keyword">new</span> ConcreteHandlerC();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置责任链</span></span><br><span class="line">        handlerA.SetSuccessor(handlerB);</span><br><span class="line">        handlerB.SetSuccessor(handlerC);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 测试请求</span></span><br><span class="line">        <span class="built_in">int</span>[] requests = &#123; <span class="number">5</span>, <span class="number">15</span>, <span class="number">25</span>, <span class="number">35</span> &#125;;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="built_in">int</span> request <span class="keyword">in</span> requests)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;\nSending request <span class="subst">&#123;request&#125;</span>&quot;</span>);</span><br><span class="line">            handlerA.HandleRequest(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="责任链模式的使用场景"><a href="#责任链模式的使用场景" class="headerlink" title="责任链模式的使用场景"></a>责任链模式的使用场景</h2><h3 id="1-事件处理系统"><a href="#1-事件处理系统" class="headerlink" title="1. 事件处理系统"></a>1. 事件处理系统</h3><ul><li><strong>GUI 应用</strong>：按钮点击、键盘输入等事件的处理</li><li><strong>前端框架</strong>：DOM 事件冒泡机制</li><li><strong>游戏开发</strong>：游戏事件的处理</li></ul><h3 id="2-审批流程"><a href="#2-审批流程" class="headerlink" title="2. 审批流程"></a>2. 审批流程</h3><ul><li><strong>请假审批</strong>：从组长到经理到总监的审批流程</li><li><strong>报销审批</strong>：不同金额的报销需要不同级别的审批</li><li><strong>采购审批</strong>：不同金额的采购需要不同级别的审批</li></ul><h3 id="3-过滤器-拦截器"><a href="#3-过滤器-拦截器" class="headerlink" title="3. 过滤器&#x2F;拦截器"></a>3. 过滤器&#x2F;拦截器</h3><ul><li><strong>Web 框架</strong>：请求拦截器、过滤器链</li><li><strong>安全系统</strong>：权限验证、身份认证、防 CSRF 攻击等</li><li><strong>日志系统</strong>：不同级别的日志处理</li></ul><h3 id="4-异常处理"><a href="#4-异常处理" class="headerlink" title="4. 异常处理"></a>4. 异常处理</h3><ul><li><strong>异常处理链</strong>：不同类型的异常由不同的处理器处理</li><li><strong>错误处理</strong>：不同级别的错误由不同的处理器处理</li></ul><h3 id="5-命令处理"><a href="#5-命令处理" class="headerlink" title="5. 命令处理"></a>5. 命令处理</h3><ul><li><strong>命令模式与责任链结合</strong>：命令的处理链</li><li><strong>消息处理</strong>：消息的路由和处理</li></ul><h3 id="6-其他场景"><a href="#6-其他场景" class="headerlink" title="6. 其他场景"></a>6. 其他场景</h3><ul><li><strong>解析器</strong>：XML、JSON 等格式的解析器</li><li><strong>规则引擎</strong>：业务规则的处理链</li><li><strong>工作流系统</strong>：工作流节点的处理链</li></ul><h2 id="适合使用责任链模式的问题"><a href="#适合使用责任链模式的问题" class="headerlink" title="适合使用责任链模式的问题"></a>适合使用责任链模式的问题</h2><h3 id="1-当一个请求需要经过多个处理步骤时"><a href="#1-当一个请求需要经过多个处理步骤时" class="headerlink" title="1. 当一个请求需要经过多个处理步骤时"></a>1. 当一个请求需要经过多个处理步骤时</h3><p>例如：</p><ul><li>一个 HTTP 请求需要经过身份验证、权限检查、日志记录等多个步骤</li><li>一个订单需要经过验证、库存检查、支付处理等多个步骤</li></ul><h3 id="2-当请求的处理者不确定，需要动态确定时"><a href="#2-当请求的处理者不确定，需要动态确定时" class="headerlink" title="2. 当请求的处理者不确定，需要动态确定时"></a>2. 当请求的处理者不确定，需要动态确定时</h3><p>例如：</p><ul><li>根据用户的角色和权限，动态确定审批流程</li><li>根据请求的类型和内容，动态确定处理链</li></ul><h3 id="3-当需要避免请求的发送者与接收者之间的耦合时"><a href="#3-当需要避免请求的发送者与接收者之间的耦合时" class="headerlink" title="3. 当需要避免请求的发送者与接收者之间的耦合时"></a>3. 当需要避免请求的发送者与接收者之间的耦合时</h3><p>例如：</p><ul><li>客户端不需要知道具体的处理者，只需要将请求发送到链头</li><li>处理者之间不需要知道彼此的存在，只需要处理自己的部分</li></ul><h3 id="4-当需要动态调整处理流程时"><a href="#4-当需要动态调整处理流程时" class="headerlink" title="4. 当需要动态调整处理流程时"></a>4. 当需要动态调整处理流程时</h3><p>例如：</p><ul><li>根据业务需求，动态添加或删除处理步骤</li><li>根据配置，动态调整处理顺序</li></ul><h3 id="5-当多个对象都可能处理同一个请求时"><a href="#5-当多个对象都可能处理同一个请求时" class="headerlink" title="5. 当多个对象都可能处理同一个请求时"></a>5. 当多个对象都可能处理同一个请求时</h3><p>例如：</p><ul><li>多个日志处理器，根据日志级别处理不同的日志</li><li>多个异常处理器，根据异常类型处理不同的异常</li></ul><h2 id="责任链模式的变体"><a href="#责任链模式的变体" class="headerlink" title="责任链模式的变体"></a>责任链模式的变体</h2><h3 id="1-纯责任链-vs-不纯责任链"><a href="#1-纯责任链-vs-不纯责任链" class="headerlink" title="1. 纯责任链 vs 不纯责任链"></a>1. 纯责任链 vs 不纯责任链</h3><ul><li><strong>纯责任链</strong>：每个处理者要么处理请求，要么将其传递给下一个处理者，不能两者都做</li><li><strong>不纯责任链</strong>：处理者可以处理请求的一部分，然后将其传递给下一个处理者</li></ul><h3 id="2-单向链-vs-环形链"><a href="#2-单向链-vs-环形链" class="headerlink" title="2. 单向链 vs 环形链"></a>2. 单向链 vs 环形链</h3><ul><li><strong>单向链</strong>：链是线性的，有明确的起点和终点</li><li><strong>环形链</strong>：链是环形的，没有明确的终点，请求会在链中循环直到被处理</li></ul><h3 id="3-静态链-vs-动态链"><a href="#3-静态链-vs-动态链" class="headerlink" title="3. 静态链 vs 动态链"></a>3. 静态链 vs 动态链</h3><ul><li><strong>静态链</strong>：链的结构在编译时确定</li><li><strong>动态链</strong>：链的结构在运行时动态构建</li></ul><h3 id="4-带返回值的责任链"><a href="#4-带返回值的责任链" class="headerlink" title="4. 带返回值的责任链"></a>4. 带返回值的责任链</h3><p>处理者可以返回处理结果，而不仅仅是处理或传递请求</p><h3 id="5-异步责任链"><a href="#5-异步责任链" class="headerlink" title="5. 异步责任链"></a>5. 异步责任链</h3><p>处理者可以异步处理请求，而不是同步处理</p><h2 id="实际应用案例"><a href="#实际应用案例" class="headerlink" title="实际应用案例"></a>实际应用案例</h2><h3 id="1-Java-Servlet-Filter"><a href="#1-Java-Servlet-Filter" class="headerlink" title="1. Java Servlet Filter"></a>1. Java Servlet Filter</h3><p>Java Servlet 中的 Filter 链是责任链模式的典型应用，每个 Filter 可以处理请求或传递给下一个 Filter。</p><h3 id="2-Spring-Security-Filter-Chain"><a href="#2-Spring-Security-Filter-Chain" class="headerlink" title="2. Spring Security Filter Chain"></a>2. Spring Security Filter Chain</h3><p>Spring Security 中的过滤器链用于处理认证和授权请求。</p><h3 id="3-ASP-NET-Core-Middleware"><a href="#3-ASP-NET-Core-Middleware" class="headerlink" title="3. ASP.NET Core Middleware"></a>3. ASP.NET Core Middleware</h3><p>ASP.NET Core 中的中间件链用于处理 HTTP 请求。</p><h3 id="4-Node-js-Express-Middleware"><a href="#4-Node-js-Express-Middleware" class="headerlink" title="4. Node.js Express Middleware"></a>4. Node.js Express Middleware</h3><p>Express 框架中的中间件链用于处理 HTTP 请求。</p><h3 id="5-日志框架"><a href="#5-日志框架" class="headerlink" title="5. 日志框架"></a>5. 日志框架</h3><p>许多日志框架使用责任链模式来处理不同级别的日志。</p><h2 id="代码优化建议"><a href="#代码优化建议" class="headerlink" title="代码优化建议"></a>代码优化建议</h2><h3 id="1-避免过长的链"><a href="#1-避免过长的链" class="headerlink" title="1. 避免过长的链"></a>1. 避免过长的链</h3><ul><li>合理设计链的长度，避免链过长影响性能</li><li>考虑使用组合模式来管理复杂的链结构</li></ul><h3 id="2-确保请求被处理"><a href="#2-确保请求被处理" class="headerlink" title="2. 确保请求被处理"></a>2. 确保请求被处理</h3><ul><li>在链的末端添加一个默认处理者，确保所有请求都被处理</li><li>添加监控和日志，及时发现未被处理的请求</li></ul><h3 id="3-优化链的构建"><a href="#3-优化链的构建" class="headerlink" title="3. 优化链的构建"></a>3. 优化链的构建</h3><ul><li>使用工厂方法或构建器模式来构建责任链</li><li>考虑使用依赖注入来管理处理者的依赖关系</li></ul><h3 id="4-提高可测试性"><a href="#4-提高可测试性" class="headerlink" title="4. 提高可测试性"></a>4. 提高可测试性</h3><ul><li>为每个处理者编写单元测试</li><li>使用模拟对象（Mock）来测试链的行为</li><li>测试不同的链结构和处理场景</li></ul><h3 id="5-处理异常"><a href="#5-处理异常" class="headerlink" title="5. 处理异常"></a>5. 处理异常</h3><ul><li>在处理者中添加异常处理逻辑</li><li>确保异常不会导致链的中断</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>责任链模式是一种非常实用的设计模式，它通过将请求沿着处理者链传递，实现了请求发送者和接收者的解耦。责任链模式在事件处理、审批流程、过滤器&#x2F;拦截器等场景中有着广泛的应用。</p><p>通过本文的介绍，相信你已经对责任链模式有了更深入的了解。在实际开发中，当你遇到需要多个处理步骤、动态确定处理者、避免耦合或动态调整处理流程的场景时，不妨考虑使用责任链模式。</p><p>记住，设计模式的选择应该基于具体的问题场景，而不是为了使用模式而使用模式。只有在合适的场景中使用合适的设计模式，才能真正发挥其价值。</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> Python </tag>
            
            <tag> Java </tag>
            
            <tag> C# </tag>
            
            <tag> 设计模式 </tag>
            
            <tag> 责任链模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式——观察者模式</title>
      <link href="/2026/01/22/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
      <url>/2026/01/22/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="观察者模式详解"><a href="#观察者模式详解" class="headerlink" title="观察者模式详解"></a>观察者模式详解</h1><h2 id="什么是观察者模式？"><a href="#什么是观察者模式？" class="headerlink" title="什么是观察者模式？"></a>什么是观察者模式？</h2><p>观察者模式（Observer Pattern）是一种行为型设计模式，它定义了对象之间的一对多依赖关系，使得当一个对象状态发生变化时，所有依赖它的对象都会自动收到通知并更新。</p><h3 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h3><ul><li><strong>Subject（主题&#x2F;被观察者）</strong>：维护一组观察者对象，提供添加和删除观察者的方法，当状态变化时通知所有观察者。</li><li><strong>Observer（观察者）</strong>：定义接收通知的接口，当主题状态变化时更新自己。</li><li><strong>ConcreteSubject（具体主题）</strong>：实现主题接口，维护状态，当状态变化时通知观察者。</li><li><strong>ConcreteObserver（具体观察者）</strong>：实现观察者接口，存储与主题相关的状态，当收到通知时更新自己。</li></ul><h3 id="观察者模式的UML图"><a href="#观察者模式的UML图" class="headerlink" title="观察者模式的UML图"></a>观察者模式的UML图</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">+----------------+       +----------------+</span><br><span class="line">|   Subject      |&lt;------|   Observer     |</span><br><span class="line">+----------------+       +----------------+</span><br><span class="line">| +attach()      |       | +update()      |</span><br><span class="line">| +detach()      |       +----------------+</span><br><span class="line">| +notify()      |               ^</span><br><span class="line">+----------------+               |</span><br><span class="line">        ^                        |</span><br><span class="line">        |                        |</span><br><span class="line">+----------------+       +----------------+</span><br><span class="line">| ConcreteSubject|       | ConcreteObserver|</span><br><span class="line">+----------------+       +----------------+</span><br><span class="line">| -state         |       | -observerState |</span><br><span class="line">| +getState()    |       | +update()      |</span><br><span class="line">| +setState()    |       +----------------+</span><br><span class="line">+----------------+</span><br></pre></td></tr></table></figure><h2 id="观察者模式的优缺点"><a href="#观察者模式的优缺点" class="headerlink" title="观察者模式的优缺点"></a>观察者模式的优缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol><li><strong>松耦合</strong>：主题和观察者之间是松耦合的，它们可以独立变化。</li><li><strong>可扩展性</strong>：可以轻松添加新的观察者，而不需要修改主题的代码。</li><li><strong>广播通信</strong>：主题可以同时通知多个观察者，实现一对多的通信。</li><li><strong>符合开闭原则</strong>：对扩展开放，对修改关闭。</li></ol><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol><li><strong>内存泄漏</strong>：如果观察者没有正确从主题中移除，可能会导致内存泄漏。</li><li><strong>通知顺序</strong>：观察者的通知顺序是不确定的，可能会导致依赖于顺序的问题。</li><li><strong>性能问题</strong>：如果观察者数量过多，可能会影响通知的性能。</li></ol><h2 id="观察者模式的实现"><a href="#观察者模式的实现" class="headerlink" title="观察者模式的实现"></a>观察者模式的实现</h2><h3 id="C-实现"><a href="#C-实现" class="headerlink" title="C++ 实现"></a>C++ 实现</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察者接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Observer</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主题接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Subject</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">attach</span><span class="params">(Observer* observer)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">detach</span><span class="params">(Observer* observer)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">notify</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体主题</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteSubject</span> : <span class="keyword">public</span> Subject &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;Observer*&gt; observers;</span><br><span class="line">    std::string message;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">attach</span><span class="params">(Observer* observer)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        observers.<span class="built_in">push_back</span>(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">detach</span><span class="params">(Observer* observer)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> it = std::<span class="built_in">find</span>(observers.<span class="built_in">begin</span>(), observers.<span class="built_in">end</span>(), observer);</span><br><span class="line">        <span class="keyword">if</span> (it != observers.<span class="built_in">end</span>()) &#123;</span><br><span class="line">            observers.<span class="built_in">erase</span>(it);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">notify</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Observer* observer : observers) &#123;</span><br><span class="line">            observer-&gt;<span class="built_in">update</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setMessage</span><span class="params">(<span class="type">const</span> std::string&amp; msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;message = msg;</span><br><span class="line">        <span class="built_in">notify</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::string <span class="title">getMessage</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体观察者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteObserver</span> : <span class="keyword">public</span> Observer &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name;</span><br><span class="line">    ConcreteSubject&amp; subject;</span><br><span class="line">    std::string observerState;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ConcreteObserver</span>(std::string name, ConcreteSubject&amp; subject) </span><br><span class="line">        : <span class="built_in">name</span>(std::<span class="built_in">move</span>(name)), <span class="built_in">subject</span>(subject) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        observerState = message;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Observer &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot; received message: &quot;</span> &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试代码</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建主题</span></span><br><span class="line">    ConcreteSubject subject;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建观察者</span></span><br><span class="line">    <span class="function">ConcreteObserver <span class="title">observer1</span><span class="params">(<span class="string">&quot;Observer 1&quot;</span>, subject)</span></span>;</span><br><span class="line">    <span class="function">ConcreteObserver <span class="title">observer2</span><span class="params">(<span class="string">&quot;Observer 2&quot;</span>, subject)</span></span>;</span><br><span class="line">    <span class="function">ConcreteObserver <span class="title">observer3</span><span class="params">(<span class="string">&quot;Observer 3&quot;</span>, subject)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册观察者</span></span><br><span class="line">    subject.<span class="built_in">attach</span>(&amp;observer1);</span><br><span class="line">    subject.<span class="built_in">attach</span>(&amp;observer2);</span><br><span class="line">    subject.<span class="built_in">attach</span>(&amp;observer3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更改主题状态</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Setting message to &#x27;Hello World&#x27;&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    subject.<span class="built_in">setMessage</span>(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 移除一个观察者</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\nRemoving Observer 2&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    subject.<span class="built_in">detach</span>(&amp;observer2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 再次更改主题状态</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Setting message to &#x27;Observer Pattern&#x27;&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    subject.<span class="built_in">setMessage</span>(<span class="string">&quot;Observer Pattern&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Java-实现"><a href="#Java-实现" class="headerlink" title="Java 实现"></a>Java 实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察者接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主题接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">attach</span><span class="params">(Observer observer)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">detach</span><span class="params">(Observer observer)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">notifyObservers</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体主题</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteSubject</span> <span class="keyword">implements</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Observer&gt; observers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">attach</span><span class="params">(Observer observer)</span> &#123;</span><br><span class="line">        observers.add(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">detach</span><span class="params">(Observer observer)</span> &#123;</span><br><span class="line">        observers.remove(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyObservers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Observer observer : observers) &#123;</span><br><span class="line">            observer.update(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = msg;</span><br><span class="line">        notifyObservers();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体观察者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteObserver</span> <span class="keyword">implements</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> ConcreteSubject subject;</span><br><span class="line">    <span class="keyword">private</span> String observerState;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcreteObserver</span><span class="params">(String name, ConcreteSubject subject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.subject = subject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.observerState = message;</span><br><span class="line">        System.out.println(<span class="string">&quot;Observer &quot;</span> + name + <span class="string">&quot; received message: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ObserverPatternDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建主题</span></span><br><span class="line">        <span class="type">ConcreteSubject</span> <span class="variable">subject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteSubject</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建观察者</span></span><br><span class="line">        <span class="type">ConcreteObserver</span> <span class="variable">observer1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteObserver</span>(<span class="string">&quot;Observer 1&quot;</span>, subject);</span><br><span class="line">        <span class="type">ConcreteObserver</span> <span class="variable">observer2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteObserver</span>(<span class="string">&quot;Observer 2&quot;</span>, subject);</span><br><span class="line">        <span class="type">ConcreteObserver</span> <span class="variable">observer3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteObserver</span>(<span class="string">&quot;Observer 3&quot;</span>, subject);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 注册观察者</span></span><br><span class="line">        subject.attach(observer1);</span><br><span class="line">        subject.attach(observer2);</span><br><span class="line">        subject.attach(observer3);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 更改主题状态</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Setting message to &#x27;Hello World&#x27;&quot;</span>);</span><br><span class="line">        subject.setMessage(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 移除一个观察者</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\nRemoving Observer 2&quot;</span>);</span><br><span class="line">        subject.detach(observer2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 再次更改主题状态</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Setting message to &#x27;Observer Pattern&#x27;&quot;</span>);</span><br><span class="line">        subject.setMessage(<span class="string">&quot;Observer Pattern&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Python-实现"><a href="#Python-实现" class="headerlink" title="Python 实现"></a>Python 实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 观察者模式的Python实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;观察者接口&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;接收通知并更新&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subject</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;主题接口&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">attach</span>(<span class="params">self, observer</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;添加观察者&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detach</span>(<span class="params">self, observer</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;移除观察者&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;通知所有观察者&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteSubject</span>(<span class="title class_ inherited__">Subject</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;具体主题&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.observers = []</span><br><span class="line">        <span class="variable language_">self</span>.message = <span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">attach</span>(<span class="params">self, observer</span>):</span><br><span class="line">        <span class="keyword">if</span> observer <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.observers:</span><br><span class="line">            <span class="variable language_">self</span>.observers.append(observer)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detach</span>(<span class="params">self, observer</span>):</span><br><span class="line">        <span class="keyword">if</span> observer <span class="keyword">in</span> <span class="variable language_">self</span>.observers:</span><br><span class="line">            <span class="variable language_">self</span>.observers.remove(observer)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> observer <span class="keyword">in</span> <span class="variable language_">self</span>.observers:</span><br><span class="line">            observer.update(<span class="variable language_">self</span>.message)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_message</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;设置消息并通知观察者&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.message = message</span><br><span class="line">        <span class="variable language_">self</span>.notify()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_message</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.message</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteObserver</span>(<span class="title class_ inherited__">Observer</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;具体观察者&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, subject</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.subject = subject</span><br><span class="line">        <span class="variable language_">self</span>.observer_state = <span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;接收通知并更新状态&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.observer_state = message</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Observer <span class="subst">&#123;self.name&#125;</span> received message: <span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试代码</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 创建主题</span></span><br><span class="line">    subject = ConcreteSubject()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建观察者</span></span><br><span class="line">    observer1 = ConcreteObserver(<span class="string">&quot;Observer 1&quot;</span>, subject)</span><br><span class="line">    observer2 = ConcreteObserver(<span class="string">&quot;Observer 2&quot;</span>, subject)</span><br><span class="line">    observer3 = ConcreteObserver(<span class="string">&quot;Observer 3&quot;</span>, subject)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 注册观察者</span></span><br><span class="line">    subject.attach(observer1)</span><br><span class="line">    subject.attach(observer2)</span><br><span class="line">    subject.attach(observer3)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 更改主题状态</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Setting message to &#x27;Hello World&#x27;&quot;</span>)</span><br><span class="line">    subject.set_message(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 移除一个观察者</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\nRemoving Observer 2&quot;</span>)</span><br><span class="line">    subject.detach(observer2)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 再次更改主题状态</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Setting message to &#x27;Observer Pattern&#x27;&quot;</span>)</span><br><span class="line">    subject.set_message(<span class="string">&quot;Observer Pattern&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="C-实现-1"><a href="#C-实现-1" class="headerlink" title="C# 实现"></a>C# 实现</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察者接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title">IObserver</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"><span class="built_in">string</span> message</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主题接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title">ISubject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Attach</span>(<span class="params">IObserver observer</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Detach</span>(<span class="params">IObserver observer</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Notify</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体主题</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">ConcreteSubject</span> : <span class="title">ISubject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;IObserver&gt; observers = <span class="keyword">new</span> List&lt;IObserver&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> message;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Attach</span>(<span class="params">IObserver observer</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        observers.Add(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Detach</span>(<span class="params">IObserver observer</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        observers.Remove(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Notify</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (IObserver observer <span class="keyword">in</span> observers)</span><br><span class="line">        &#123;</span><br><span class="line">            observer.Update(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetMessage</span>(<span class="params"><span class="built_in">string</span> msg</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.message = msg;</span><br><span class="line">        Notify();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetMessage</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体观察者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">ConcreteObserver</span> : <span class="title">IObserver</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">private</span> ConcreteSubject subject;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> observerState;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreteObserver</span>(<span class="params"><span class="built_in">string</span> name, ConcreteSubject subject</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.subject = subject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"><span class="built_in">string</span> message</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.observerState = message;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Observer <span class="subst">&#123;name&#125;</span> received message: <span class="subst">&#123;message&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试代码</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 创建主题</span></span><br><span class="line">        ConcreteSubject subject = <span class="keyword">new</span> ConcreteSubject();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建观察者</span></span><br><span class="line">        ConcreteObserver observer1 = <span class="keyword">new</span> ConcreteObserver(<span class="string">&quot;Observer 1&quot;</span>, subject);</span><br><span class="line">        ConcreteObserver observer2 = <span class="keyword">new</span> ConcreteObserver(<span class="string">&quot;Observer 2&quot;</span>, subject);</span><br><span class="line">        ConcreteObserver observer3 = <span class="keyword">new</span> ConcreteObserver(<span class="string">&quot;Observer 3&quot;</span>, subject);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 注册观察者</span></span><br><span class="line">        subject.Attach(observer1);</span><br><span class="line">        subject.Attach(observer2);</span><br><span class="line">        subject.Attach(observer3);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 更改主题状态</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Setting message to &#x27;Hello World&#x27;&quot;</span>);</span><br><span class="line">        subject.SetMessage(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 移除一个观察者</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;\nRemoving Observer 2&quot;</span>);</span><br><span class="line">        subject.Detach(observer2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 再次更改主题状态</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Setting message to &#x27;Observer Pattern&#x27;&quot;</span>);</span><br><span class="line">        subject.SetMessage(<span class="string">&quot;Observer Pattern&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="观察者模式的使用场景"><a href="#观察者模式的使用场景" class="headerlink" title="观察者模式的使用场景"></a>观察者模式的使用场景</h2><h3 id="1-事件处理系统"><a href="#1-事件处理系统" class="headerlink" title="1. 事件处理系统"></a>1. 事件处理系统</h3><ul><li><strong>GUI 应用</strong>：按钮点击、鼠标移动等事件的处理</li><li><strong>游戏开发</strong>：键盘输入、碰撞检测等事件的处理</li><li><strong>前端框架</strong>：React、Vue 等框架中的事件系统</li></ul><h3 id="2-消息通知系统"><a href="#2-消息通知系统" class="headerlink" title="2. 消息通知系统"></a>2. 消息通知系统</h3><ul><li><strong>邮件订阅</strong>：用户订阅邮件列表，当有新邮件时通知用户</li><li><strong>新闻推送</strong>：用户订阅新闻频道，当有新闻时推送通知</li><li><strong>社交媒体</strong>：关注的人发布新内容时的通知</li></ul><h3 id="3-状态监控系统"><a href="#3-状态监控系统" class="headerlink" title="3. 状态监控系统"></a>3. 状态监控系统</h3><ul><li><strong>监控系统</strong>：服务器状态、网络状态等的监控</li><li><strong>传感器网络</strong>：温度、湿度等传感器数据的监控</li><li><strong>金融系统</strong>：股票价格、汇率等的实时更新</li></ul><h3 id="4-业务逻辑解耦"><a href="#4-业务逻辑解耦" class="headerlink" title="4. 业务逻辑解耦"></a>4. 业务逻辑解耦</h3><ul><li><strong>微服务架构</strong>：服务之间的事件通知</li><li><strong>工作流系统</strong>：流程节点之间的状态传递</li><li><strong>插件系统</strong>：主程序与插件之间的通信</li></ul><h3 id="5-其他场景"><a href="#5-其他场景" class="headerlink" title="5. 其他场景"></a>5. 其他场景</h3><ul><li><strong>配置管理</strong>：配置文件变化时的通知</li><li><strong>日志系统</strong>：日志级别变化时的通知</li><li><strong>缓存系统</strong>：缓存失效时的通知</li></ul><h2 id="适合使用观察者模式的问题"><a href="#适合使用观察者模式的问题" class="headerlink" title="适合使用观察者模式的问题"></a>适合使用观察者模式的问题</h2><h3 id="1-当一个对象的状态变化需要通知多个其他对象时"><a href="#1-当一个对象的状态变化需要通知多个其他对象时" class="headerlink" title="1. 当一个对象的状态变化需要通知多个其他对象时"></a>1. 当一个对象的状态变化需要通知多个其他对象时</h3><p>例如：</p><ul><li>股票价格变化时，需要通知所有关注该股票的投资者</li><li>天气变化时，需要通知所有订阅天气服务的用户</li></ul><h3 id="2-当对象之间需要松耦合，以提高系统的可扩展性时"><a href="#2-当对象之间需要松耦合，以提高系统的可扩展性时" class="headerlink" title="2. 当对象之间需要松耦合，以提高系统的可扩展性时"></a>2. 当对象之间需要松耦合，以提高系统的可扩展性时</h3><p>例如：</p><ul><li>电商系统中，订单状态变化时需要通知库存系统、支付系统、物流系统等</li><li>游戏系统中，玩家状态变化时需要通知UI系统、成就系统、社交系统等</li></ul><h3 id="3-当需要实现广播通信时"><a href="#3-当需要实现广播通信时" class="headerlink" title="3. 当需要实现广播通信时"></a>3. 当需要实现广播通信时</h3><p>例如：</p><ul><li>聊天室中，一条消息需要广播给所有在线用户</li><li>系统通知需要发送给所有相关模块</li></ul><h3 id="4-当需要符合开闭原则，对扩展开放，对修改关闭时"><a href="#4-当需要符合开闭原则，对扩展开放，对修改关闭时" class="headerlink" title="4. 当需要符合开闭原则，对扩展开放，对修改关闭时"></a>4. 当需要符合开闭原则，对扩展开放，对修改关闭时</h3><p>例如：</p><ul><li>可以轻松添加新的观察者，而不需要修改主题的代码</li><li>可以轻松添加新的主题，而不需要修改观察者的代码</li></ul><h3 id="5-当需要避免组件之间的直接依赖时"><a href="#5-当需要避免组件之间的直接依赖时" class="headerlink" title="5. 当需要避免组件之间的直接依赖时"></a>5. 当需要避免组件之间的直接依赖时</h3><p>例如：</p><ul><li>模块A不需要知道哪些模块依赖于它的状态变化</li><li>模块B不需要知道它依赖的模块A的具体实现</li></ul><h2 id="观察者模式的变体"><a href="#观察者模式的变体" class="headerlink" title="观察者模式的变体"></a>观察者模式的变体</h2><h3 id="1-推模型-vs-拉模型"><a href="#1-推模型-vs-拉模型" class="headerlink" title="1. 推模型 vs 拉模型"></a>1. 推模型 vs 拉模型</h3><ul><li><strong>推模型</strong>：主题将详细信息推送给观察者</li><li><strong>拉模型</strong>：观察者根据需要从主题中拉取信息</li></ul><h3 id="2-事件总线"><a href="#2-事件总线" class="headerlink" title="2. 事件总线"></a>2. 事件总线</h3><p>事件总线是观察者模式的一种扩展，它提供了一个中央枢纽，用于管理事件的发布和订阅。</p><h3 id="3-消息队列"><a href="#3-消息队列" class="headerlink" title="3. 消息队列"></a>3. 消息队列</h3><p>消息队列是一种更复杂的观察者模式实现，它提供了异步消息传递、消息持久化等功能。</p><h3 id="4-响应式编程"><a href="#4-响应式编程" class="headerlink" title="4. 响应式编程"></a>4. 响应式编程</h3><p>响应式编程是观察者模式的一种现代应用，它强调数据流和变化的传播。</p><h2 id="实际应用案例"><a href="#实际应用案例" class="headerlink" title="实际应用案例"></a>实际应用案例</h2><h3 id="1-Java中的Observable和Observer"><a href="#1-Java中的Observable和Observer" class="headerlink" title="1. Java中的Observable和Observer"></a>1. Java中的Observable和Observer</h3><p>Java 内置了观察者模式的实现：<code>java.util.Observable</code> 和 <code>java.util.Observer</code>。</p><h3 id="2-C-中的事件和委托"><a href="#2-C-中的事件和委托" class="headerlink" title="2. C#中的事件和委托"></a>2. C#中的事件和委托</h3><p>C# 使用事件（Event）和委托（Delegate）来实现观察者模式。</p><h3 id="3-JavaScript中的事件监听"><a href="#3-JavaScript中的事件监听" class="headerlink" title="3. JavaScript中的事件监听"></a>3. JavaScript中的事件监听</h3><p>JavaScript 使用事件监听机制来实现观察者模式，如 <code>addEventListener</code>。</p><h3 id="4-Python中的观察者模式实现"><a href="#4-Python中的观察者模式实现" class="headerlink" title="4. Python中的观察者模式实现"></a>4. Python中的观察者模式实现</h3><p>Python 可以使用内置的 <code>observable</code> 模块或第三方库来实现观察者模式。</p><h3 id="5-前端框架中的观察者模式"><a href="#5-前端框架中的观察者模式" class="headerlink" title="5. 前端框架中的观察者模式"></a>5. 前端框架中的观察者模式</h3><ul><li><strong>React</strong>：使用状态管理和生命周期方法实现观察者模式</li><li><strong>Vue</strong>：使用响应式数据和 watch 实现观察者模式</li><li><strong>Angular</strong>：使用 Observable 和 Subject 实现观察者模式</li></ul><h2 id="代码优化建议"><a href="#代码优化建议" class="headerlink" title="代码优化建议"></a>代码优化建议</h2><h3 id="1-避免内存泄漏"><a href="#1-避免内存泄漏" class="headerlink" title="1. 避免内存泄漏"></a>1. 避免内存泄漏</h3><ul><li>确保在观察者不再需要时，从主题中正确移除</li><li>在 C++ 中，使用智能指针管理观察者的生命周期</li><li>在 Java 中，考虑使用弱引用避免内存泄漏</li></ul><h3 id="2-优化通知性能"><a href="#2-优化通知性能" class="headerlink" title="2. 优化通知性能"></a>2. 优化通知性能</h3><ul><li>对于大量观察者的场景，考虑使用异步通知</li><li>对于频繁更新的场景，考虑使用批处理或节流</li><li>对于复杂的更新逻辑，考虑使用策略模式或模板方法模式</li></ul><h3 id="3-增强灵活性"><a href="#3-增强灵活性" class="headerlink" title="3. 增强灵活性"></a>3. 增强灵活性</h3><ul><li>考虑使用事件对象传递更丰富的信息</li><li>考虑使用泛型或模板来增加代码的复用性</li><li>考虑使用配置文件或注解来管理观察者的注册</li></ul><h3 id="4-提高可测试性"><a href="#4-提高可测试性" class="headerlink" title="4. 提高可测试性"></a>4. 提高可测试性</h3><ul><li>使用依赖注入来管理观察者和主题的依赖关系</li><li>使用模拟对象（Mock）来测试观察者模式的行为</li><li>使用单元测试来验证观察者模式的正确性</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>观察者模式是一种非常实用的设计模式，它通过定义对象之间的一对多依赖关系，实现了对象之间的松耦合通信。无论是在GUI应用、消息系统还是状态监控系统中，观察者模式都有着广泛的应用。</p><p>通过本文的介绍，相信你已经对观察者模式有了更深入的了解。在实际开发中，当你遇到需要实现对象之间的一对多通信、需要松耦合设计或需要符合开闭原则的场景时，不妨考虑使用观察者模式。</p><p>记住，设计模式的选择应该基于具体的问题场景，而不是为了使用模式而使用模式。只有在合适的场景中使用合适的设计模式，才能真正发挥其价值。</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> Python </tag>
            
            <tag> Java </tag>
            
            <tag> C# </tag>
            
            <tag> 设计模式 </tag>
            
            <tag> 观察者模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis数据结构</title>
      <link href="/2026/01/21/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
      <url>/2026/01/21/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h1 id="Redis-数据结构详解"><a href="#Redis-数据结构详解" class="headerlink" title="Redis 数据结构详解"></a>Redis 数据结构详解</h1><h2 id="什么是-Redis？"><a href="#什么是-Redis？" class="headerlink" title="什么是 Redis？"></a>什么是 Redis？</h2><p>Redis（Remote Dictionary Server）是一个开源的、内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。Redis 支持多种数据结构，这使得它非常灵活和强大。</p><h2 id="Redis-支持的数据结构"><a href="#Redis-支持的数据结构" class="headerlink" title="Redis 支持的数据结构"></a>Redis 支持的数据结构</h2><p>Redis 支持以下主要数据结构：</p><ol><li><strong>字符串（String）</strong></li><li><strong>列表（List）</strong></li><li><strong>集合（Set）</strong></li><li><strong>有序集合（Sorted Set &#x2F; ZSet）</strong></li><li><strong>哈希表（Hash）</strong></li><li><strong>位图（Bitmap）</strong></li><li><strong>HyperLogLog</strong></li><li><strong>地理空间索引（Geospatial Index）</strong></li></ol><h2 id="详细介绍每个数据结构"><a href="#详细介绍每个数据结构" class="headerlink" title="详细介绍每个数据结构"></a>详细介绍每个数据结构</h2><h3 id="1-字符串（String）"><a href="#1-字符串（String）" class="headerlink" title="1. 字符串（String）"></a>1. 字符串（String）</h3><p>字符串是 Redis 最基本的数据结构，可以存储任何类型的字符串，包括二进制数据。单个字符串的最大长度为 512 MB。</p><h4 id="常用命令及时间复杂度"><a href="#常用命令及时间复杂度" class="headerlink" title="常用命令及时间复杂度"></a>常用命令及时间复杂度</h4><table><thead><tr><th>命令</th><th>功能</th><th>时间复杂度</th></tr></thead><tbody><tr><td><code>SET key value</code></td><td>设置键值对</td><td>O(1)</td></tr><tr><td><code>GET key</code></td><td>获取值</td><td>O(1)</td></tr><tr><td><code>INCR key</code></td><td>自增 1</td><td>O(1)</td></tr><tr><td><code>INCRBY key increment</code></td><td>自增指定值</td><td>O(1)</td></tr><tr><td><code>DECR key</code></td><td>自减 1</td><td>O(1)</td></tr><tr><td><code>DECRBY key decrement</code></td><td>自减指定值</td><td>O(1)</td></tr><tr><td><code>APPEND key value</code></td><td>追加字符串</td><td>O(1)</td></tr><tr><td><code>STRLEN key</code></td><td>获取字符串长度</td><td>O(1)</td></tr><tr><td><code>GETRANGE key start end</code></td><td>获取子字符串</td><td>O(1)</td></tr><tr><td><code>SETRANGE key offset value</code></td><td>设置子字符串</td><td>O(1)</td></tr></tbody></table><h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><ul><li>存储用户信息</li><li>计数器</li><li>分布式锁</li><li>会话存储</li><li>缓存</li></ul><h3 id="2-列表（List）"><a href="#2-列表（List）" class="headerlink" title="2. 列表（List）"></a>2. 列表（List）</h3><p>Redis 列表是简单的字符串列表，按照插入顺序排序。你可以在列表的头部或尾部添加元素。</p><h4 id="常用命令及时间复杂度-1"><a href="#常用命令及时间复杂度-1" class="headerlink" title="常用命令及时间复杂度"></a>常用命令及时间复杂度</h4><table><thead><tr><th>命令</th><th>功能</th><th>时间复杂度</th></tr></thead><tbody><tr><td><code>LPUSH key value [value ...]</code></td><td>从左侧插入元素</td><td>O(1) per element</td></tr><tr><td><code>RPUSH key value [value ...]</code></td><td>从右侧插入元素</td><td>O(1) per element</td></tr><tr><td><code>LPOP key</code></td><td>从左侧弹出元素</td><td>O(1)</td></tr><tr><td><code>RPOP key</code></td><td>从右侧弹出元素</td><td>O(1)</td></tr><tr><td><code>LLEN key</code></td><td>获取列表长度</td><td>O(1)</td></tr><tr><td><code>LRANGE key start stop</code></td><td>获取指定范围的元素</td><td>O(S+N)，S 是偏移量，N 是元素数量</td></tr><tr><td><code>LINDEX key index</code></td><td>获取指定索引的元素</td><td>O(N)，N 是索引位置</td></tr><tr><td><code>LSET key index value</code></td><td>设置指定索引的元素</td><td>O(N)，N 是索引位置</td></tr><tr><td><code>LREM key count value</code></td><td>删除指定值的元素</td><td>O(N)</td></tr><tr><td><code>LTRIM key start stop</code></td><td>保留指定范围的元素</td><td>O(N)</td></tr></tbody></table><h4 id="使用场景-1"><a href="#使用场景-1" class="headerlink" title="使用场景"></a>使用场景</h4><ul><li>消息队列</li><li>最新消息列表</li><li>任务队列</li><li>排行榜（简单版）</li></ul><h3 id="3-集合（Set）"><a href="#3-集合（Set）" class="headerlink" title="3. 集合（Set）"></a>3. 集合（Set）</h3><p>Redis 集合是字符串的无序集合，集合中的元素是唯一的，不允许重复。</p><h4 id="常用命令及时间复杂度-2"><a href="#常用命令及时间复杂度-2" class="headerlink" title="常用命令及时间复杂度"></a>常用命令及时间复杂度</h4><table><thead><tr><th>命令</th><th>功能</th><th>时间复杂度</th></tr></thead><tbody><tr><td><code>SADD key member [member ...]</code></td><td>添加元素</td><td>O(1) per member</td></tr><tr><td><code>SREM key member [member ...]</code></td><td>删除元素</td><td>O(1) per member</td></tr><tr><td><code>SMEMBERS key</code></td><td>获取所有元素</td><td>O(N)，N 是集合大小</td></tr><tr><td><code>SISMEMBER key member</code></td><td>检查元素是否存在</td><td>O(1)</td></tr><tr><td><code>SCARD key</code></td><td>获取集合大小</td><td>O(1)</td></tr><tr><td><code>SPOP key [count]</code></td><td>随机弹出元素</td><td>O(1)</td></tr><tr><td><code>SRANDMEMBER key [count]</code></td><td>随机获取元素</td><td>O(1)</td></tr><tr><td><code>SINTER key [key ...]</code></td><td>交集</td><td>O(N)，N 是所有集合的大小之和</td></tr><tr><td><code>SUNION key [key ...]</code></td><td>并集</td><td>O(N)，N 是所有集合的大小之和</td></tr><tr><td><code>SDIFF key [key ...]</code></td><td>差集</td><td>O(N)，N 是所有集合的大小之和</td></tr></tbody></table><h4 id="使用场景-2"><a href="#使用场景-2" class="headerlink" title="使用场景"></a>使用场景</h4><ul><li>标签系统</li><li>去重</li><li>好友&#x2F;关注列表</li><li>抽奖系统</li><li>交集&#x2F;并集&#x2F;差集操作</li></ul><h3 id="4-有序集合（Sorted-Set-ZSet）"><a href="#4-有序集合（Sorted-Set-ZSet）" class="headerlink" title="4. 有序集合（Sorted Set &#x2F; ZSet）"></a>4. 有序集合（Sorted Set &#x2F; ZSet）</h3><p>Redis 有序集合与集合类似，也是唯一元素的集合，但每个元素都关联了一个分数（score），Redis 根据分数对元素进行排序。</p><h4 id="常用命令及时间复杂度-3"><a href="#常用命令及时间复杂度-3" class="headerlink" title="常用命令及时间复杂度"></a>常用命令及时间复杂度</h4><table><thead><tr><th>命令</th><th>功能</th><th>时间复杂度</th></tr></thead><tbody><tr><td><code>ZADD key score member [score member ...]</code></td><td>添加元素及分数</td><td>O(log N) per member</td></tr><tr><td><code>ZREM key member [member ...]</code></td><td>删除元素</td><td>O(log N) per member</td></tr><tr><td><code>ZSCORE key member</code></td><td>获取元素的分数</td><td>O(1)</td></tr><tr><td><code>ZINCRBY key increment member</code></td><td>增加元素的分数</td><td>O(log N)</td></tr><tr><td><code>ZCARD key</code></td><td>获取集合大小</td><td>O(1)</td></tr><tr><td><code>ZRANGE key start stop [WITHSCORES]</code></td><td>获取指定范围的元素（按分数升序）</td><td>O(log N + M)，M 是返回的元素数量</td></tr><tr><td><code>ZREVRANGE key start stop [WITHSCORES]</code></td><td>获取指定范围的元素（按分数降序）</td><td>O(log N + M)</td></tr><tr><td><code>ZRANK key member</code></td><td>获取元素的排名（按分数升序）</td><td>O(log N)</td></tr><tr><td><code>ZREVRANK key member</code></td><td>获取元素的排名（按分数降序）</td><td>O(log N)</td></tr><tr><td><code>ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</code></td><td>按分数范围获取元素</td><td>O(log N + M)</td></tr><tr><td><code>ZCOUNT key min max</code></td><td>统计分数范围内的元素数量</td><td>O(log N)</td></tr></tbody></table><h4 id="使用场景-3"><a href="#使用场景-3" class="headerlink" title="使用场景"></a>使用场景</h4><ul><li>排行榜（如游戏分数、网站访问量）</li><li>带权重的队列</li><li>范围查询</li><li>时间序列数据</li></ul><h3 id="5-哈希表（Hash）"><a href="#5-哈希表（Hash）" class="headerlink" title="5. 哈希表（Hash）"></a>5. 哈希表（Hash）</h3><p>Redis 哈希表是键值对的集合，适合存储对象。每个哈希表可以存储多个字段和值。</p><h4 id="常用命令及时间复杂度-4"><a href="#常用命令及时间复杂度-4" class="headerlink" title="常用命令及时间复杂度"></a>常用命令及时间复杂度</h4><table><thead><tr><th>命令</th><th>功能</th><th>时间复杂度</th></tr></thead><tbody><tr><td><code>HSET key field value [field value ...]</code></td><td>设置字段值</td><td>O(1) per field</td></tr><tr><td><code>HGET key field</code></td><td>获取字段值</td><td>O(1)</td></tr><tr><td><code>HMSET key field value [field value ...]</code></td><td>设置多个字段值</td><td>O(1) per field</td></tr><tr><td><code>HMGET key field [field ...]</code></td><td>获取多个字段值</td><td>O(1) per field</td></tr><tr><td><code>HGETALL key</code></td><td>获取所有字段和值</td><td>O(N)，N 是字段数量</td></tr><tr><td><code>HDEL key field [field ...]</code></td><td>删除字段</td><td>O(1) per field</td></tr><tr><td><code>HEXISTS key field</code></td><td>检查字段是否存在</td><td>O(1)</td></tr><tr><td><code>HLEN key</code></td><td>获取字段数量</td><td>O(1)</td></tr><tr><td><code>HINCRBY key field increment</code></td><td>增加字段的整数值</td><td>O(1)</td></tr><tr><td><code>HINCRBYFLOAT key field increment</code></td><td>增加字段的浮点数值</td><td>O(1)</td></tr><tr><td><code>HKEYS key</code></td><td>获取所有字段名</td><td>O(N)</td></tr><tr><td><code>HVALS key</code></td><td>获取所有字段值</td><td>O(N)</td></tr></tbody></table><h4 id="使用场景-4"><a href="#使用场景-4" class="headerlink" title="使用场景"></a>使用场景</h4><ul><li>存储用户信息</li><li>存储对象</li><li>配置信息</li><li>商品信息</li><li>计数器</li></ul><h3 id="6-位图（Bitmap）"><a href="#6-位图（Bitmap）" class="headerlink" title="6. 位图（Bitmap）"></a>6. 位图（Bitmap）</h3><p>Redis 位图是一种特殊的字符串，它允许你对字符串的单个位进行操作。</p><h4 id="常用命令及时间复杂度-5"><a href="#常用命令及时间复杂度-5" class="headerlink" title="常用命令及时间复杂度"></a>常用命令及时间复杂度</h4><table><thead><tr><th>命令</th><th>功能</th><th>时间复杂度</th></tr></thead><tbody><tr><td><code>SETBIT key offset value</code></td><td>设置指定位置的位</td><td>O(1)</td></tr><tr><td><code>GETBIT key offset</code></td><td>获取指定位置的位</td><td>O(1)</td></tr><tr><td><code>BITCOUNT key [start end]</code></td><td>统计设置为 1 的位的数量</td><td>O(N)</td></tr><tr><td><code>BITOP operation destkey key [key ...]</code></td><td>对多个位图执行位操作</td><td>O(N)</td></tr><tr><td><code>BITPOS key bit [start] [end]</code></td><td>查找第一个设置为指定值的位</td><td>O(N)</td></tr></tbody></table><h4 id="使用场景-5"><a href="#使用场景-5" class="headerlink" title="使用场景"></a>使用场景</h4><ul><li>用户在线状态</li><li>打卡记录</li><li>布隆过滤器</li><li>权限控制</li><li>统计活跃用户</li></ul><h3 id="7-HyperLogLog"><a href="#7-HyperLogLog" class="headerlink" title="7. HyperLogLog"></a>7. HyperLogLog</h3><p>HyperLogLog 是一种概率性数据结构，用于估计集合的基数（元素数量），具有极低的内存消耗。</p><h4 id="常用命令及时间复杂度-6"><a href="#常用命令及时间复杂度-6" class="headerlink" title="常用命令及时间复杂度"></a>常用命令及时间复杂度</h4><table><thead><tr><th>命令</th><th>功能</th><th>时间复杂度</th></tr></thead><tbody><tr><td><code>PFADD key element [element ...]</code></td><td>添加元素</td><td>O(1) per element</td></tr><tr><td><code>PFCOUNT key [key ...]</code></td><td>估计基数</td><td>O(1)</td></tr><tr><td><code>PFMERGE destkey sourcekey [sourcekey ...]</code></td><td>合并多个 HyperLogLog</td><td>O(N)，N 是 HyperLogLog 的数量</td></tr></tbody></table><h4 id="使用场景-6"><a href="#使用场景-6" class="headerlink" title="使用场景"></a>使用场景</h4><ul><li>网站访问量统计（UV）</li><li>独立用户数统计</li><li>搜索词统计</li><li>大数据集的基数估计</li></ul><h3 id="8-地理空间索引（Geospatial-Index）"><a href="#8-地理空间索引（Geospatial-Index）" class="headerlink" title="8. 地理空间索引（Geospatial Index）"></a>8. 地理空间索引（Geospatial Index）</h3><p>Redis 地理空间索引用于存储地理位置信息，并支持基于地理位置的查询。</p><h4 id="常用命令及时间复杂度-7"><a href="#常用命令及时间复杂度-7" class="headerlink" title="常用命令及时间复杂度"></a>常用命令及时间复杂度</h4><table><thead><tr><th>命令</th><th>功能</th><th>时间复杂度</th></tr></thead><tbody><tr><td><code>GEOADD key longitude latitude member [longitude latitude member ...]</code></td><td>添加地理位置</td><td>O(log N) per member</td></tr><tr><td><code>GEODIST key member1 member2 [unit]</code></td><td>计算两个位置之间的距离</td><td>O(log N)</td></tr><tr><td><code>GEOHASH key member [member ...]</code></td><td>获取位置的 Geohash 编码</td><td>O(log N) per member</td></tr><tr><td><code>GEOPOS key member [member ...]</code></td><td>获取位置的坐标</td><td>O(log N) per member</td></tr><tr><td>&#96;GEORADIUS key longitude latitude radius m</td><td>km</td><td>ft</td></tr><tr><td>&#96;GEORADIUSBYMEMBER key member radius m</td><td>km</td><td>ft</td></tr></tbody></table><h4 id="使用场景-7"><a href="#使用场景-7" class="headerlink" title="使用场景"></a>使用场景</h4><ul><li>附近的人&#x2F;地点</li><li>地理位置搜索</li><li>地图应用</li><li>基于位置的服务</li></ul><h2 id="性能优化建议"><a href="#性能优化建议" class="headerlink" title="性能优化建议"></a>性能优化建议</h2><ol><li><p><strong>选择合适的数据结构</strong>：根据具体的使用场景选择最合适的数据结构，以获得最佳性能。</p></li><li><p><strong>合理设置过期时间</strong>：对于缓存数据，设置合理的过期时间，避免内存占用过高。</p></li><li><p><strong>批量操作</strong>：使用批量命令（如 MSET、HMSET 等）减少网络往返时间。</p></li><li><p><strong>管道操作</strong>：使用管道（Pipeline）批量执行命令，提高吞吐量。</p></li><li><p><strong>避免大键</strong>：避免在一个键中存储过多数据，如大型列表或哈希表。</p></li><li><p><strong>使用分片</strong>：对于大规模应用，考虑使用 Redis 集群进行数据分片。</p></li><li><p><strong>监控内存使用</strong>：定期监控 Redis 的内存使用情况，及时发现和解决内存问题。</p></li><li><p><strong>使用合适的序列化方式</strong>：对于复杂对象，选择高效的序列化方式，如 Protocol Buffers 或 MessagePack。</p></li><li><p><strong>优化命令执行</strong>：避免在循环中执行 Redis 命令，尽量使用批量操作。</p></li><li><p><strong>合理使用持久化</strong>：根据业务需求选择合适的持久化方式（RDB 或 AOF）。</p></li></ol><h2 id="数据结构选择指南"><a href="#数据结构选择指南" class="headerlink" title="数据结构选择指南"></a>数据结构选择指南</h2><table><thead><tr><th>场景</th><th>推荐数据结构</th><th>原因</th></tr></thead><tbody><tr><td>简单键值存储</td><td>String</td><td>最基本的数据结构，操作简单高效</td></tr><tr><td>计数器</td><td>String</td><td>INCR&#x2F;DECR 命令原子操作，性能优秀</td></tr><tr><td>消息队列</td><td>List</td><td>LPUSH&#x2F;RPOP 操作，符合队列特性</td></tr><tr><td>最新消息</td><td>List</td><td>LPUSH + LRANGE，保持最新消息</td></tr><tr><td>唯一元素集合</td><td>Set</td><td>自动去重，高效的成员检查</td></tr><tr><td>好友关系</td><td>Set</td><td>支持交集、并集、差集操作</td></tr><tr><td>排行榜</td><td>Sorted Set</td><td>自动排序，支持分数范围查询</td></tr><tr><td>带权重的任务</td><td>Sorted Set</td><td>可以根据权重排序</td></tr><tr><td>存储对象</td><td>Hash</td><td>字段值对，适合存储结构化数据</td></tr><tr><td>用户信息</td><td>Hash</td><td>可以只修改部分字段，节省带宽</td></tr><tr><td>在线状态</td><td>Bitmap</td><td>占用空间小，位操作高效</td></tr><tr><td>访问量统计</td><td>HyperLogLog</td><td>极低内存消耗，适合大数据集</td></tr><tr><td>地理位置</td><td>Geospatial Index</td><td>专门的地理位置查询功能</td></tr></tbody></table><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Redis 提供了丰富多样的数据结构，每种数据结构都有其特定的使用场景和优势。通过合理选择和使用这些数据结构，可以显著提高应用的性能和可扩展性。</p><p>Redis 的数据结构设计体现了其”简单而强大”的理念，通过提供基本但灵活的数据结构，Redis 能够适应各种复杂的应用场景。无论是作为缓存、数据库还是消息中间件，Redis 都能以其高性能、低延迟的特点为应用提供强大的支持。</p><p>掌握 Redis 的数据结构及其使用方法，对于构建高性能、可伸缩的应用系统至关重要。希望本文能帮助你更好地理解和使用 Redis 的数据结构。</p><h2 id="多语言使用示例"><a href="#多语言使用示例" class="headerlink" title="多语言使用示例"></a>多语言使用示例</h2><h3 id="Python-使用示例"><a href="#Python-使用示例" class="headerlink" title="Python 使用示例"></a>Python 使用示例</h3><p>Python 中使用 Redis 通常通过 <code>redis-py</code> 库，这是 Python 中最流行的 Redis 客户端。</p><h4 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install redis</span><br></pre></td></tr></table></figure><h4 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接 Redis</span></span><br><span class="line">r = redis.Redis(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">6379</span>, db=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置字符串</span></span><br><span class="line">r.<span class="built_in">set</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;John&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取字符串</span></span><br><span class="line">name = r.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Name: <span class="subst">&#123;name.decode()&#125;</span>&#x27;</span>)  <span class="comment"># 输出: Name: John</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自增操作</span></span><br><span class="line">r.<span class="built_in">set</span>(<span class="string">&#x27;counter&#x27;</span>, <span class="number">10</span>)</span><br><span class="line">r.incr(<span class="string">&#x27;counter&#x27;</span>)</span><br><span class="line">counter = r.get(<span class="string">&#x27;counter&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Counter: <span class="subst">&#123;counter.decode()&#125;</span>&#x27;</span>)  <span class="comment"># 输出: Counter: 11</span></span><br></pre></td></tr></table></figure><h4 id="列表操作"><a href="#列表操作" class="headerlink" title="列表操作"></a>列表操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清空列表（如果存在）</span></span><br><span class="line">r.delete(<span class="string">&#x27;mylist&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从右侧插入元素</span></span><br><span class="line">r.rpush(<span class="string">&#x27;mylist&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从左侧插入元素</span></span><br><span class="line">r.lpush(<span class="string">&#x27;mylist&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取列表长度</span></span><br><span class="line">length = r.llen(<span class="string">&#x27;mylist&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;List length: <span class="subst">&#123;length&#125;</span>&#x27;</span>)  <span class="comment"># 输出: List length: 6</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取所有元素</span></span><br><span class="line">items = r.lrange(<span class="string">&#x27;mylist&#x27;</span>, <span class="number">0</span>, -<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;List items:&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">    <span class="built_in">print</span>(item.decode())  <span class="comment"># 输出: z y x a b c</span></span><br></pre></td></tr></table></figure><h4 id="集合操作"><a href="#集合操作" class="headerlink" title="集合操作"></a>集合操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清空集合（如果存在）</span></span><br><span class="line">r.delete(<span class="string">&#x27;myset&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加元素</span></span><br><span class="line">r.sadd(<span class="string">&#x27;myset&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取集合大小</span></span><br><span class="line">size = r.scard(<span class="string">&#x27;myset&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Set size: <span class="subst">&#123;size&#125;</span>&#x27;</span>)  <span class="comment"># 输出: Set size: 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查元素是否存在</span></span><br><span class="line">exists = r.sismember(<span class="string">&#x27;myset&#x27;</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Is \&#x27;a\&#x27; exists: <span class="subst">&#123;exists&#125;</span>&#x27;</span>)  <span class="comment"># 输出: Is &#x27;a&#x27; exists: True</span></span><br></pre></td></tr></table></figure><h4 id="有序集合操作"><a href="#有序集合操作" class="headerlink" title="有序集合操作"></a>有序集合操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清空有序集合（如果存在）</span></span><br><span class="line">r.delete(<span class="string">&#x27;myzset&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加元素及分数</span></span><br><span class="line">r.zadd(<span class="string">&#x27;myzset&#x27;</span>, &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;d&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;e&#x27;</span>: <span class="number">5</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按分数降序获取所有元素</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Elements in descending order:&#x27;</span>)</span><br><span class="line">elements = r.zrevrange(<span class="string">&#x27;myzset&#x27;</span>, <span class="number">0</span>, -<span class="number">1</span>, withscores=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> element, score <span class="keyword">in</span> elements:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;element.decode()&#125;</span>: <span class="subst">&#123;score&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="哈希表操作"><a href="#哈希表操作" class="headerlink" title="哈希表操作"></a>哈希表操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清空哈希表（如果存在）</span></span><br><span class="line">r.delete(<span class="string">&#x27;user:1001&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置字段值</span></span><br><span class="line">r.hset(<span class="string">&#x27;user:1001&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;John&#x27;</span>)</span><br><span class="line">r.hset(<span class="string">&#x27;user:1001&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="number">30</span>)</span><br><span class="line">r.hset(<span class="string">&#x27;user:1001&#x27;</span>, <span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;john@example.com&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取所有字段和值</span></span><br><span class="line">all_fields = r.hgetall(<span class="string">&#x27;user:1001&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;All fields and values:&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> field, value <span class="keyword">in</span> all_fields.items():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;field.decode()&#125;</span>: <span class="subst">&#123;value.decode()&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="Java-使用示例"><a href="#Java-使用示例" class="headerlink" title="Java 使用示例"></a>Java 使用示例</h3><p>Java 中使用 Redis 通常通过 <code>Jedis</code> 库，这是 Java 中最流行的 Redis 客户端之一。</p><h4 id="安装依赖-1"><a href="#安装依赖-1" class="headerlink" title="安装依赖"></a>安装依赖</h4><p>Maven 依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="字符串操作-1"><a href="#字符串操作-1" class="headerlink" title="字符串操作"></a>字符串操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisStringExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 连接 Redis</span></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置字符串</span></span><br><span class="line">        jedis.set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> jedis.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Name: &quot;</span> + name);  <span class="comment">// 输出: Name: John</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 自增操作</span></span><br><span class="line">        jedis.set(<span class="string">&quot;counter&quot;</span>, <span class="string">&quot;10&quot;</span>);</span><br><span class="line">        jedis.incr(<span class="string">&quot;counter&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">counter</span> <span class="operator">=</span> jedis.get(<span class="string">&quot;counter&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Counter: &quot;</span> + counter);  <span class="comment">// 输出: Counter: 11</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 关闭连接</span></span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="列表操作-1"><a href="#列表操作-1" class="headerlink" title="列表操作"></a>列表操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisListExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 清空列表（如果存在）</span></span><br><span class="line">        jedis.del(<span class="string">&quot;mylist&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 从右侧插入元素</span></span><br><span class="line">        jedis.rpush(<span class="string">&quot;mylist&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 从左侧插入元素</span></span><br><span class="line">        jedis.lpush(<span class="string">&quot;mylist&quot;</span>, <span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>, <span class="string">&quot;z&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取列表长度</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">length</span> <span class="operator">=</span> jedis.llen(<span class="string">&quot;mylist&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;List length: &quot;</span> + length);  <span class="comment">// 输出: List length: 6</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取所有元素</span></span><br><span class="line">        List&lt;String&gt; items = jedis.lrange(<span class="string">&quot;mylist&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;List items:&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String item : items) &#123;</span><br><span class="line">            System.out.println(item);  <span class="comment">// 输出: z y x a b c</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="集合操作-1"><a href="#集合操作-1" class="headerlink" title="集合操作"></a>集合操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisSetExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 清空集合（如果存在）</span></span><br><span class="line">        jedis.del(<span class="string">&quot;myset&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加元素</span></span><br><span class="line">        jedis.sadd(<span class="string">&quot;myset&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取集合大小</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">size</span> <span class="operator">=</span> jedis.scard(<span class="string">&quot;myset&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Set size: &quot;</span> + size);  <span class="comment">// 输出: Set size: 4</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查元素是否存在</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> jedis.sismember(<span class="string">&quot;myset&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Is &#x27;a&#x27; exists: &quot;</span> + exists);  <span class="comment">// 输出: Is &#x27;a&#x27; exists: True</span></span><br><span class="line">        </span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="有序集合操作-1"><a href="#有序集合操作-1" class="headerlink" title="有序集合操作"></a>有序集合操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisSortedSetExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 清空有序集合（如果存在）</span></span><br><span class="line">        jedis.del(<span class="string">&quot;myzset&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加元素及分数</span></span><br><span class="line">        jedis.zadd(<span class="string">&quot;myzset&quot;</span>, <span class="number">1</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">        jedis.zadd(<span class="string">&quot;myzset&quot;</span>, <span class="number">2</span>, <span class="string">&quot;b&quot;</span>);</span><br><span class="line">        jedis.zadd(<span class="string">&quot;myzset&quot;</span>, <span class="number">3</span>, <span class="string">&quot;c&quot;</span>);</span><br><span class="line">        jedis.zadd(<span class="string">&quot;myzset&quot;</span>, <span class="number">4</span>, <span class="string">&quot;d&quot;</span>);</span><br><span class="line">        jedis.zadd(<span class="string">&quot;myzset&quot;</span>, <span class="number">5</span>, <span class="string">&quot;e&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 按分数降序获取所有元素</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Elements in descending order:&quot;</span>);</span><br><span class="line">        Set&lt;String&gt; elementsDesc = jedis.zrevrange(<span class="string">&quot;myzset&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (String element : elementsDesc) &#123;</span><br><span class="line">            <span class="type">Double</span> <span class="variable">s</span> <span class="operator">=</span> jedis.zscore(<span class="string">&quot;myzset&quot;</span>, element);</span><br><span class="line">            System.out.println(element + <span class="string">&quot;: &quot;</span> + s);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="哈希表操作-1"><a href="#哈希表操作-1" class="headerlink" title="哈希表操作"></a>哈希表操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisHashExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 清空哈希表（如果存在）</span></span><br><span class="line">        jedis.del(<span class="string">&quot;user:1001&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置字段值</span></span><br><span class="line">        jedis.hset(<span class="string">&quot;user:1001&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">        jedis.hset(<span class="string">&quot;user:1001&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;30&quot;</span>);</span><br><span class="line">        jedis.hset(<span class="string">&quot;user:1001&quot;</span>, <span class="string">&quot;email&quot;</span>, <span class="string">&quot;john@example.com&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取所有字段和值</span></span><br><span class="line">        Map&lt;String, String&gt; allFields = jedis.hgetAll(<span class="string">&quot;user:1001&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;All fields and values:&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : allFields.entrySet()) &#123;</span><br><span class="line">            System.out.println(entry.getKey() + <span class="string">&quot;: &quot;</span> + entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="C-使用示例"><a href="#C-使用示例" class="headerlink" title="C# 使用示例"></a>C# 使用示例</h3><p>C# 中使用 Redis 通常通过 <code>StackExchange.Redis</code> 库，这是 C# 中最流行的 Redis 客户端。</p><h4 id="安装依赖-2"><a href="#安装依赖-2" class="headerlink" title="安装依赖"></a>安装依赖</h4><p>NuGet 包：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Install-Package StackExchange.Redis</span><br></pre></td></tr></table></figure><h4 id="字符串操作-2"><a href="#字符串操作-2" class="headerlink" title="字符串操作"></a>字符串操作</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> StackExchange.Redis;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">RedisStringExample</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span> &#123;</span><br><span class="line">        <span class="comment">// 连接 Redis</span></span><br><span class="line">        ConnectionMultiplexer redis = ConnectionMultiplexer.Connect(<span class="string">&quot;localhost:6379&quot;</span>);</span><br><span class="line">        IDatabase db = redis.GetDatabase();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置字符串</span></span><br><span class="line">        db.StringSet(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取字符串</span></span><br><span class="line">        <span class="built_in">string</span> name = db.StringGet(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Name: &quot;</span> + name);  <span class="comment">// 输出: Name: John</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 自增操作</span></span><br><span class="line">        db.StringSet(<span class="string">&quot;counter&quot;</span>, <span class="string">&quot;10&quot;</span>);</span><br><span class="line">        db.StringIncrement(<span class="string">&quot;counter&quot;</span>);</span><br><span class="line">        <span class="built_in">string</span> counter = db.StringGet(<span class="string">&quot;counter&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Counter: &quot;</span> + counter);  <span class="comment">// 输出: Counter: 11</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 关闭连接</span></span><br><span class="line">        redis.Close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="列表操作-2"><a href="#列表操作-2" class="headerlink" title="列表操作"></a>列表操作</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> StackExchange.Redis;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">RedisListExample</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span> &#123;</span><br><span class="line">        ConnectionMultiplexer redis = ConnectionMultiplexer.Connect(<span class="string">&quot;localhost:6379&quot;</span>);</span><br><span class="line">        IDatabase db = redis.GetDatabase();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 清空列表（如果存在）</span></span><br><span class="line">        db.KeyDelete(<span class="string">&quot;mylist&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 从右侧插入元素</span></span><br><span class="line">        db.ListRightPush(<span class="string">&quot;mylist&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">        db.ListRightPush(<span class="string">&quot;mylist&quot;</span>, <span class="string">&quot;b&quot;</span>);</span><br><span class="line">        db.ListRightPush(<span class="string">&quot;mylist&quot;</span>, <span class="string">&quot;c&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 从左侧插入元素</span></span><br><span class="line">        db.ListLeftPush(<span class="string">&quot;mylist&quot;</span>, <span class="string">&quot;x&quot;</span>);</span><br><span class="line">        db.ListLeftPush(<span class="string">&quot;mylist&quot;</span>, <span class="string">&quot;y&quot;</span>);</span><br><span class="line">        db.ListLeftPush(<span class="string">&quot;mylist&quot;</span>, <span class="string">&quot;z&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取列表长度</span></span><br><span class="line">        <span class="built_in">long</span> length = db.ListLength(<span class="string">&quot;mylist&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;List length: &quot;</span> + length);  <span class="comment">// 输出: List length: 6</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取所有元素</span></span><br><span class="line">        RedisValue[] items = db.ListRange(<span class="string">&quot;mylist&quot;</span>, <span class="number">0</span>, <span class="number">-1</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;List items:&quot;</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> items) &#123;</span><br><span class="line">            Console.WriteLine(item);  <span class="comment">// 输出: z y x a b c</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        redis.Close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="集合操作-2"><a href="#集合操作-2" class="headerlink" title="集合操作"></a>集合操作</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> StackExchange.Redis;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">RedisSetExample</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span> &#123;</span><br><span class="line">        ConnectionMultiplexer redis = ConnectionMultiplexer.Connect(<span class="string">&quot;localhost:6379&quot;</span>);</span><br><span class="line">        IDatabase db = redis.GetDatabase();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 清空集合（如果存在）</span></span><br><span class="line">        db.KeyDelete(<span class="string">&quot;myset&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加元素</span></span><br><span class="line">        db.SetAdd(<span class="string">&quot;myset&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">        db.SetAdd(<span class="string">&quot;myset&quot;</span>, <span class="string">&quot;b&quot;</span>);</span><br><span class="line">        db.SetAdd(<span class="string">&quot;myset&quot;</span>, <span class="string">&quot;c&quot;</span>);</span><br><span class="line">        db.SetAdd(<span class="string">&quot;myset&quot;</span>, <span class="string">&quot;d&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取集合大小</span></span><br><span class="line">        <span class="built_in">long</span> size = db.SetLength(<span class="string">&quot;myset&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Set size: &quot;</span> + size);  <span class="comment">// 输出: Set size: 4</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查元素是否存在</span></span><br><span class="line">        <span class="built_in">bool</span> exists = db.SetContains(<span class="string">&quot;myset&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Is &#x27;a&#x27; exists: &quot;</span> + exists);  <span class="comment">// 输出: Is &#x27;a&#x27; exists: True</span></span><br><span class="line">        </span><br><span class="line">        redis.Close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="有序集合操作-2"><a href="#有序集合操作-2" class="headerlink" title="有序集合操作"></a>有序集合操作</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> StackExchange.Redis;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">RedisSortedSetExample</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span> &#123;</span><br><span class="line">        ConnectionMultiplexer redis = ConnectionMultiplexer.Connect(<span class="string">&quot;localhost:6379&quot;</span>);</span><br><span class="line">        IDatabase db = redis.GetDatabase();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 清空有序集合（如果存在）</span></span><br><span class="line">        db.KeyDelete(<span class="string">&quot;myzset&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加元素及分数</span></span><br><span class="line">        db.SortedSetAdd(<span class="string">&quot;myzset&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        db.SortedSetAdd(<span class="string">&quot;myzset&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        db.SortedSetAdd(<span class="string">&quot;myzset&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="number">3</span>);</span><br><span class="line">        db.SortedSetAdd(<span class="string">&quot;myzset&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="number">4</span>);</span><br><span class="line">        db.SortedSetAdd(<span class="string">&quot;myzset&quot;</span>, <span class="string">&quot;e&quot;</span>, <span class="number">5</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 按分数降序获取所有元素</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Elements in descending order:&quot;</span>);</span><br><span class="line">        SortedSetEntry[] elementsDesc = db.SortedSetRangeByRankWithScores(<span class="string">&quot;myzset&quot;</span>, <span class="number">0</span>, <span class="number">-1</span>, Order.Descending);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> entry <span class="keyword">in</span> elementsDesc) &#123;</span><br><span class="line">            Console.WriteLine(entry.Element + <span class="string">&quot;: &quot;</span> + entry.Score);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        redis.Close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="哈希表操作-2"><a href="#哈希表操作-2" class="headerlink" title="哈希表操作"></a>哈希表操作</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> StackExchange.Redis;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">RedisHashExample</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span> &#123;</span><br><span class="line">        ConnectionMultiplexer redis = ConnectionMultiplexer.Connect(<span class="string">&quot;localhost:6379&quot;</span>);</span><br><span class="line">        IDatabase db = redis.GetDatabase();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 清空哈希表（如果存在）</span></span><br><span class="line">        db.KeyDelete(<span class="string">&quot;user:1001&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置字段值</span></span><br><span class="line">        db.HashSet(<span class="string">&quot;user:1001&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">        db.HashSet(<span class="string">&quot;user:1001&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;30&quot;</span>);</span><br><span class="line">        db.HashSet(<span class="string">&quot;user:1001&quot;</span>, <span class="string">&quot;email&quot;</span>, <span class="string">&quot;john@example.com&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取所有字段和值</span></span><br><span class="line">        HashEntry[] allFields = db.HashGetAll(<span class="string">&quot;user:1001&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;All fields and values:&quot;</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> entry <span class="keyword">in</span> allFields) &#123;</span><br><span class="line">            Console.WriteLine(entry.Name + <span class="string">&quot;: &quot;</span> + entry.Value);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        redis.Close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="多语言客户端对比"><a href="#多语言客户端对比" class="headerlink" title="多语言客户端对比"></a>多语言客户端对比</h2><table><thead><tr><th>语言</th><th>推荐客户端</th><th>优势</th></tr></thead><tbody><tr><td>Python</td><td>redis-py</td><td>轻量级，API 友好，支持管道操作</td></tr><tr><td>Java</td><td>Jedis</td><td>简单直接，功能完整，广泛使用</td></tr><tr><td>C#</td><td>StackExchange.Redis</td><td>性能优秀，支持异步操作，线程安全</td></tr></tbody></table><h2 id="客户端选择建议"><a href="#客户端选择建议" class="headerlink" title="客户端选择建议"></a>客户端选择建议</h2><ol><li><p><strong>根据项目语言选择</strong>：选择与项目开发语言匹配的客户端库</p></li><li><p><strong>考虑性能需求</strong>：对于高并发场景，选择性能更好的客户端</p></li><li><p><strong>功能需求</strong>：根据项目需要的功能选择支持相应特性的客户端</p></li><li><p><strong>社区活跃度</strong>：选择社区活跃、维护良好的客户端库</p></li><li><p><strong>文档完善度</strong>：选择文档完善、使用示例丰富的客户端库</p></li></ol><p>通过本文的介绍和示例，相信你已经对 Redis 的数据结构及其在不同编程语言中的使用有了更全面的了解。在实际项目中，根据具体需求选择合适的数据结构和客户端库，将能够充分发挥 Redis 的性能优势，构建高性能、可扩展的应用系统。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Java </tag>
            
            <tag> C# </tag>
            
            <tag> Redis </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 缓存 </tag>
            
            <tag> 性能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C#标准库的介绍和使用</title>
      <link href="/2026/01/21/C-%E6%A0%87%E5%87%86%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
      <url>/2026/01/21/C-%E6%A0%87%E5%87%86%E5%BA%93%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="C-标准库详解"><a href="#C-标准库详解" class="headerlink" title="C# 标准库详解"></a>C# 标准库详解</h1><h2 id="什么是-C-标准库？"><a href="#什么是-C-标准库？" class="headerlink" title="什么是 C# 标准库？"></a>什么是 C# 标准库？</h2><p>C# 标准库是 .NET 平台的核心组成部分，提供了丰富的类和方法，用于开发各种类型的应用程序。它包含在 .NET Framework、.NET Core 和 .NET 5+ 中，为 C# 程序员提供了强大的工具集。</p><h2 id="C-标准库的组成"><a href="#C-标准库的组成" class="headerlink" title="C# 标准库的组成"></a>C# 标准库的组成</h2><p>C# 标准库主要由以下几个部分组成：</p><ol><li><strong>基础类型库</strong>：提供基本数据类型和通用工具</li><li><strong>集合库</strong>：提供各种数据结构</li><li><strong>IO 库</strong>：处理文件和流操作</li><li><strong>网络库</strong>：提供网络通信功能</li><li><strong>多线程库</strong>：支持并发编程</li><li><strong>反射库</strong>：提供类型信息和动态操作</li><li><strong>序列化库</strong>：支持对象的序列化和反序列化</li><li><strong>加密库</strong>：提供安全加密功能</li><li><strong>正则表达式库</strong>：处理字符串模式匹配</li><li><strong>XML 库</strong>：处理 XML 数据</li><li><strong>LINQ</strong>：语言集成查询</li><li><strong>任务并行库</strong>：高级并行编程</li><li><strong>WPF&#x2F;WinForms</strong>：GUI 开发（仅限 Windows）</li></ol><h2 id="常用库的详细介绍"><a href="#常用库的详细介绍" class="headerlink" title="常用库的详细介绍"></a>常用库的详细介绍</h2><h3 id="1-基础类型库"><a href="#1-基础类型库" class="headerlink" title="1. 基础类型库"></a>1. 基础类型库</h3><p>基础类型库位于 <code>System</code> 命名空间，提供了基本数据类型和通用工具类。</p><h4 id="常用类和方法"><a href="#常用类和方法" class="headerlink" title="常用类和方法"></a>常用类和方法</h4><table><thead><tr><th>类&#x2F;方法</th><th>功能</th><th>使用示例</th></tr></thead><tbody><tr><td><code>Object</code></td><td>所有类型的基类</td><td><code>object obj = new object();</code></td></tr><tr><td><code>String</code></td><td>字符串操作</td><td><code>string s = &quot;Hello&quot;;</code></td></tr><tr><td><code>DateTime</code></td><td>日期时间处理</td><td><code>DateTime now = DateTime.Now;</code></td></tr><tr><td><code>Math</code></td><td>数学运算</td><td><code>double pi = Math.PI;</code></td></tr><tr><td><code>Convert</code></td><td>类型转换</td><td><code>int i = Convert.ToInt32(&quot;123&quot;);</code></td></tr><tr><td><code>Console</code></td><td>控制台操作</td><td><code>Console.WriteLine(&quot;Hello World&quot;);</code></td></tr><tr><td><code>Random</code></td><td>随机数生成</td><td><code>Random rnd = new Random();</code></td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span> &#123;</span><br><span class="line">        <span class="comment">// 字符串操作</span></span><br><span class="line">        <span class="built_in">string</span> s = <span class="string">&quot;Hello, World!&quot;</span>;</span><br><span class="line">        Console.WriteLine(s.Length);  <span class="comment">// 13</span></span><br><span class="line">        Console.WriteLine(s.Substring(<span class="number">7</span>));  <span class="comment">// World!</span></span><br><span class="line">        Console.WriteLine(s.ToUpper());  <span class="comment">// HELLO, WORLD!</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 日期时间</span></span><br><span class="line">        DateTime now = DateTime.Now;</span><br><span class="line">        Console.WriteLine(now.ToString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 数学运算</span></span><br><span class="line">        <span class="built_in">double</span> x = <span class="number">3.0</span>, y = <span class="number">4.0</span>;</span><br><span class="line">        <span class="built_in">double</span> hypotenuse = Math.Sqrt(x * x + y * y);</span><br><span class="line">        Console.WriteLine(hypotenuse);  <span class="comment">// 5</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 随机数</span></span><br><span class="line">        Random rnd = <span class="keyword">new</span> Random();</span><br><span class="line">        Console.WriteLine(rnd.Next(<span class="number">1</span>, <span class="number">100</span>));  <span class="comment">// 1-99之间的随机数</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-集合库"><a href="#2-集合库" class="headerlink" title="2. 集合库"></a>2. 集合库</h3><p>集合库位于 <code>System.Collections</code> 和 <code>System.Collections.Generic</code> 命名空间，提供了各种数据结构。</p><h4 id="常用集合类"><a href="#常用集合类" class="headerlink" title="常用集合类"></a>常用集合类</h4><table><thead><tr><th>集合类</th><th>功能</th><th>使用示例</th></tr></thead><tbody><tr><td><code>List&lt;T&gt;</code></td><td>动态数组</td><td><code>List&lt;int&gt; list = new List&lt;int&gt;();</code></td></tr><tr><td><code>Dictionary&lt;K, V&gt;</code></td><td>键值对集合</td><td><code>Dictionary&lt;string, int&gt; dict = new Dictionary&lt;string, int&gt;();</code></td></tr><tr><td><code>HashSet&lt;T&gt;</code></td><td>无序唯一元素集合</td><td><code>HashSet&lt;int&gt; set = new HashSet&lt;int&gt;();</code></td></tr><tr><td><code>Queue&lt;T&gt;</code></td><td>队列（FIFO）</td><td><code>Queue&lt;int&gt; queue = new Queue&lt;int&gt;();</code></td></tr><tr><td><code>Stack&lt;T&gt;</code></td><td>栈（LIFO）</td><td><code>Stack&lt;int&gt; stack = new Stack&lt;int&gt;();</code></td></tr><tr><td><code>LinkedList&lt;T&gt;</code></td><td>双向链表</td><td><code>LinkedList&lt;int&gt; linkedList = new LinkedList&lt;int&gt;();</code></td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span> &#123;</span><br><span class="line">        <span class="comment">// List&lt;T&gt;</span></span><br><span class="line">        List&lt;<span class="built_in">int</span>&gt; numbers = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line">        numbers.Add(<span class="number">10</span>);</span><br><span class="line">        numbers.Add(<span class="number">20</span>);</span><br><span class="line">        numbers.Add(<span class="number">30</span>);</span><br><span class="line">        </span><br><span class="line">        Console.WriteLine(<span class="string">&quot;List elements:&quot;</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="built_in">int</span> num <span class="keyword">in</span> numbers) &#123;</span><br><span class="line">            Console.WriteLine(num);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Dictionary&lt;K, V&gt;</span></span><br><span class="line">        Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; capitals = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;();</span><br><span class="line">        capitals[<span class="string">&quot;China&quot;</span>] = <span class="string">&quot;Beijing&quot;</span>;</span><br><span class="line">        capitals[<span class="string">&quot;USA&quot;</span>] = <span class="string">&quot;Washington&quot;</span>;</span><br><span class="line">        capitals[<span class="string">&quot;Japan&quot;</span>] = <span class="string">&quot;Tokyo&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        Console.WriteLine(<span class="string">&quot;\nDictionary elements:&quot;</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> pair <span class="keyword">in</span> capitals) &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;<span class="subst">&#123;pair.Key&#125;</span>: <span class="subst">&#123;pair.Value&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// HashSet&lt;T&gt;</span></span><br><span class="line">        HashSet&lt;<span class="built_in">int</span>&gt; uniqueNumbers = <span class="keyword">new</span> HashSet&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line">        uniqueNumbers.Add(<span class="number">1</span>);</span><br><span class="line">        uniqueNumbers.Add(<span class="number">2</span>);</span><br><span class="line">        uniqueNumbers.Add(<span class="number">1</span>);  <span class="comment">// 重复元素，不会添加</span></span><br><span class="line">        </span><br><span class="line">        Console.WriteLine(<span class="string">&quot;\nHashSet elements:&quot;</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="built_in">int</span> num <span class="keyword">in</span> uniqueNumbers) &#123;</span><br><span class="line">            Console.WriteLine(num);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-IO-库"><a href="#3-IO-库" class="headerlink" title="3. IO 库"></a>3. IO 库</h3><p>IO 库位于 <code>System.IO</code> 命名空间，提供文件和流操作功能。</p><h4 id="常用类"><a href="#常用类" class="headerlink" title="常用类"></a>常用类</h4><table><thead><tr><th>类</th><th>功能</th><th>使用示例</th></tr></thead><tbody><tr><td><code>File</code></td><td>文件操作静态方法</td><td><code>File.ReadAllText(&quot;file.txt&quot;);</code></td></tr><tr><td><code>Directory</code></td><td>目录操作静态方法</td><td><code>Directory.CreateDirectory(&quot;folder&quot;);</code></td></tr><tr><td><code>Path</code></td><td>路径操作静态方法</td><td><code>Path.Combine(&quot;dir&quot;, &quot;file.txt&quot;);</code></td></tr><tr><td><code>StreamReader</code></td><td>文本文件读取</td><td><code>using (StreamReader sr = new StreamReader(&quot;file.txt&quot;)) &#123; ... &#125;</code></td></tr><tr><td><code>StreamWriter</code></td><td>文本文件写入</td><td><code>using (StreamWriter sw = new StreamWriter(&quot;file.txt&quot;)) &#123; ... &#125;</code></td></tr><tr><td><code>FileStream</code></td><td>字节流操作</td><td><code>using (FileStream fs = new FileStream(&quot;file.bin&quot;, FileMode.Open)) &#123; ... &#125;</code></td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span> &#123;</span><br><span class="line">        <span class="built_in">string</span> filePath = <span class="string">&quot;example.txt&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入文件</span></span><br><span class="line">        File.WriteAllText(filePath, <span class="string">&quot;Hello, C# IO!&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 读取文件</span></span><br><span class="line">        <span class="built_in">string</span> content = File.ReadAllText(filePath);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;File content:&quot;</span>);</span><br><span class="line">        Console.WriteLine(content);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 追加内容</span></span><br><span class="line">        File.AppendAllText(filePath, <span class="string">&quot;\nAppended text.&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 读取所有行</span></span><br><span class="line">        <span class="built_in">string</span>[] lines = File.ReadAllLines(filePath);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;\nFile lines:&quot;</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="built_in">string</span> line <span class="keyword">in</span> lines) &#123;</span><br><span class="line">            Console.WriteLine(line);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 删除文件</span></span><br><span class="line">        File.Delete(filePath);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;\nFile exists: <span class="subst">&#123;File.Exists(filePath)&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-网络库"><a href="#4-网络库" class="headerlink" title="4. 网络库"></a>4. 网络库</h3><p>网络库位于 <code>System.Net</code> 和 <code>System.Net.Sockets</code> 命名空间，提供网络通信功能。</p><h4 id="常用类-1"><a href="#常用类-1" class="headerlink" title="常用类"></a>常用类</h4><table><thead><tr><th>类</th><th>功能</th><th>使用示例</th></tr></thead><tbody><tr><td><code>WebClient</code></td><td>简单的 HTTP 客户端</td><td><code>using (WebClient client = new WebClient()) &#123; ... &#125;</code></td></tr><tr><td><code>HttpClient</code></td><td>现代 HTTP 客户端</td><td><code>using (HttpClient client = new HttpClient()) &#123; ... &#125;</code></td></tr><tr><td><code>TcpClient</code></td><td>TCP 客户端</td><td><code>using (TcpClient client = new TcpClient()) &#123; ... &#125;</code></td></tr><tr><td><code>TcpListener</code></td><td>TCP 服务器</td><td><code>using (TcpListener listener = new TcpListener(port)) &#123; ... &#125;</code></td></tr><tr><td><code>Socket</code></td><td>底层套接字操作</td><td><code>Socket socket = new Socket(AddressFamily.InterNetwork, ...);</code></td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Net.Http;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">Main</span>()</span> &#123;</span><br><span class="line">        <span class="comment">// 使用 HttpClient 发送 HTTP 请求</span></span><br><span class="line">        <span class="keyword">using</span> (HttpClient client = <span class="keyword">new</span> HttpClient()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                HttpResponseMessage response = <span class="keyword">await</span> client.GetAsync(<span class="string">&quot;https://api.github.com/users/octocat&quot;</span>);</span><br><span class="line">                response.EnsureSuccessStatusCode();</span><br><span class="line">                <span class="built_in">string</span> responseBody = <span class="keyword">await</span> response.Content.ReadAsStringAsync();</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;GitHub API response:&quot;</span>);</span><br><span class="line">                Console.WriteLine(responseBody);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (HttpRequestException e) &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">$&quot;Error: <span class="subst">&#123;e.Message&#125;</span>&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-多线程库"><a href="#5-多线程库" class="headerlink" title="5. 多线程库"></a>5. 多线程库</h3><p>多线程库位于 <code>System.Threading</code> 命名空间，提供并发编程功能。</p><h4 id="常用类和方法-1"><a href="#常用类和方法-1" class="headerlink" title="常用类和方法"></a>常用类和方法</h4><table><thead><tr><th>类&#x2F;方法</th><th>功能</th><th>使用示例</th></tr></thead><tbody><tr><td><code>Thread</code></td><td>线程操作</td><td><code>Thread thread = new Thread(Work);</code></td></tr><tr><td><code>Task</code></td><td>异步任务</td><td><code>Task.Run(() =&gt; &#123; ... &#125;);</code></td></tr><tr><td><code>ThreadPool</code></td><td>线程池</td><td><code>ThreadPool.QueueUserWorkItem(Work);</code></td></tr><tr><td><code>Mutex</code></td><td>互斥锁</td><td><code>using (Mutex mutex = new Mutex()) &#123; ... &#125;</code></td></tr><tr><td><code>Monitor</code></td><td>同步锁</td><td><code>lock (obj) &#123; ... &#125;</code></td></tr><tr><td><code>Semaphore</code></td><td>信号量</td><td><code>using (Semaphore semaphore = new Semaphore(1, 1)) &#123; ... &#125;</code></td></tr><tr><td><code>AutoResetEvent</code></td><td>自动重置事件</td><td><code>using (AutoResetEvent evt = new AutoResetEvent(false)) &#123; ... &#125;</code></td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span> &#123;</span><br><span class="line">        <span class="comment">// 使用 Task 并行执行</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Main thread started&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        Task task1 = Task.Run(() =&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">$&quot;Task 1: <span class="subst">&#123;i&#125;</span>&quot;</span>);</span><br><span class="line">                Thread.Sleep(<span class="number">100</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        Task task2 = Task.Run(() =&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">$&quot;Task 2: <span class="subst">&#123;i&#125;</span>&quot;</span>);</span><br><span class="line">                Thread.Sleep(<span class="number">100</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        Task.WaitAll(task1, task2);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Main thread completed&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用 async/await</span></span><br><span class="line">        AsyncExample().Wait();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">AsyncExample</span>()</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;\nAsync example started&quot;</span>);</span><br><span class="line">        <span class="keyword">await</span> Task.Delay(<span class="number">1000</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Async example completed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-反射库"><a href="#6-反射库" class="headerlink" title="6. 反射库"></a>6. 反射库</h3><p>反射库位于 <code>System.Reflection</code> 命名空间，提供类型信息和动态操作功能。</p><h4 id="常用类-2"><a href="#常用类-2" class="headerlink" title="常用类"></a>常用类</h4><table><thead><tr><th>类</th><th>功能</th><th>使用示例</th></tr></thead><tbody><tr><td><code>Type</code></td><td>类型信息</td><td><code>Type type = typeof(string);</code></td></tr><tr><td><code>Assembly</code></td><td>程序集信息</td><td><code>Assembly assembly = Assembly.GetExecutingAssembly();</code></td></tr><tr><td><code>MethodInfo</code></td><td>方法信息</td><td><code>MethodInfo method = type.GetMethod(&quot;ToString&quot;);</code></td></tr><tr><td><code>PropertyInfo</code></td><td>属性信息</td><td><code>PropertyInfo property = type.GetProperty(&quot;Length&quot;);</code></td></tr><tr><td><code>Activator</code></td><td>动态创建实例</td><td><code>object obj = Activator.CreateInstance(type);</code></td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Age &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SayHello</span>()</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Hello, my name is <span class="subst">&#123;Name&#125;</span>!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span> &#123;</span><br><span class="line">        <span class="comment">// 获取类型信息</span></span><br><span class="line">        Type personType = <span class="keyword">typeof</span>(Person);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建实例</span></span><br><span class="line">        <span class="built_in">object</span> personObj = Activator.CreateInstance(personType);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置属性</span></span><br><span class="line">        PropertyInfo nameProperty = personType.GetProperty(<span class="string">&quot;Name&quot;</span>);</span><br><span class="line">        nameProperty.SetValue(personObj, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        PropertyInfo ageProperty = personType.GetProperty(<span class="string">&quot;Age&quot;</span>);</span><br><span class="line">        ageProperty.SetValue(personObj, <span class="number">30</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 调用方法</span></span><br><span class="line">        MethodInfo sayHelloMethod = personType.GetMethod(<span class="string">&quot;SayHello&quot;</span>);</span><br><span class="line">        sayHelloMethod.Invoke(personObj, <span class="literal">null</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取属性值</span></span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Name: <span class="subst">&#123;nameProperty.GetValue(personObj)&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Age: <span class="subst">&#123;ageProperty.GetValue(personObj)&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-序列化库"><a href="#7-序列化库" class="headerlink" title="7. 序列化库"></a>7. 序列化库</h3><p>序列化库位于 <code>System.Runtime.Serialization</code> 和 <code>System.Text.Json</code>（.NET Core 3.0+）命名空间。</p><h4 id="常用类-3"><a href="#常用类-3" class="headerlink" title="常用类"></a>常用类</h4><table><thead><tr><th>类</th><th>功能</th><th>使用示例</th></tr></thead><tbody><tr><td><code>JsonSerializer</code></td><td>JSON 序列化&#x2F;反序列化</td><td><code>JsonSerializer.Serialize(obj);</code></td></tr><tr><td><code>XmlSerializer</code></td><td>XML 序列化&#x2F;反序列化</td><td><code>XmlSerializer serializer = new XmlSerializer(typeof(T));</code></td></tr><tr><td><code>BinaryFormatter</code></td><td>二进制序列化&#x2F;反序列化</td><td><code>BinaryFormatter formatter = new BinaryFormatter();</code></td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Text.Json;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Age &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span> &#123;</span><br><span class="line">        <span class="comment">// 创建对象</span></span><br><span class="line">        Person person = <span class="keyword">new</span> Person &#123; Name = <span class="string">&quot;John&quot;</span>, Age = <span class="number">30</span> &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 序列化为 JSON</span></span><br><span class="line">        <span class="built_in">string</span> json = JsonSerializer.Serialize(person);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Serialized JSON:&quot;</span>);</span><br><span class="line">        Console.WriteLine(json);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 反序列化为对象</span></span><br><span class="line">        Person deserializedPerson = JsonSerializer.Deserialize&lt;Person&gt;(json);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;\nDeserialized object:&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Name: <span class="subst">&#123;deserializedPerson.Name&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Age: <span class="subst">&#123;deserializedPerson.Age&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-正则表达式库"><a href="#8-正则表达式库" class="headerlink" title="8. 正则表达式库"></a>8. 正则表达式库</h3><p>正则表达式库位于 <code>System.Text.RegularExpressions</code> 命名空间。</p><h4 id="常用类-4"><a href="#常用类-4" class="headerlink" title="常用类"></a>常用类</h4><table><thead><tr><th>类</th><th>功能</th><th>使用示例</th></tr></thead><tbody><tr><td><code>Regex</code></td><td>正则表达式操作</td><td><code>Regex regex = new Regex(@&quot;\d+&quot;);</code></td></tr><tr><td><code>Match</code></td><td>匹配结果</td><td><code>Match match = regex.Match(input);</code></td></tr><tr><td><code>MatchCollection</code></td><td>多个匹配结果</td><td><code>MatchCollection matches = regex.Matches(input);</code></td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Text.RegularExpressions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span> &#123;</span><br><span class="line">        <span class="built_in">string</span> input = <span class="string">&quot;Contact: John (555-1234), Jane (555-5678)&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 匹配电话号码</span></span><br><span class="line">        Regex phoneRegex = <span class="keyword">new</span> Regex(<span class="string">@&quot;\d&#123;3&#125;-\d&#123;4&#125;&quot;</span>);</span><br><span class="line">        MatchCollection matches = phoneRegex.Matches(input);</span><br><span class="line">        </span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Found phone numbers:&quot;</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (Match match <span class="keyword">in</span> matches) &#123;</span><br><span class="line">            Console.WriteLine(match.Value);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 替换文本</span></span><br><span class="line">        <span class="built_in">string</span> replaced = phoneRegex.Replace(input, <span class="string">&quot;[REDACTED]&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;\nAfter replacement:&quot;</span>);</span><br><span class="line">        Console.WriteLine(replaced);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证邮箱</span></span><br><span class="line">        <span class="built_in">string</span> email = <span class="string">&quot;user@example.com&quot;</span>;</span><br><span class="line">        Regex emailRegex = <span class="keyword">new</span> Regex(<span class="string">@&quot;^[\w.-]+@[\w.-]+\.\w+$&quot;</span>);</span><br><span class="line">        <span class="built_in">bool</span> isValid = emailRegex.IsMatch(email);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;\nEmail &#x27;<span class="subst">&#123;email&#125;</span>&#x27; is valid: <span class="subst">&#123;isValid&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-LINQ（语言集成查询）"><a href="#9-LINQ（语言集成查询）" class="headerlink" title="9. LINQ（语言集成查询）"></a>9. LINQ（语言集成查询）</h3><p>LINQ 位于 <code>System.Linq</code> 命名空间，提供统一的查询语法。</p><h4 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h4><table><thead><tr><th>方法</th><th>功能</th><th>使用示例</th></tr></thead><tbody><tr><td><code>Where</code></td><td>筛选元素</td><td><code>var result = list.Where(x =&gt; x &gt; 5);</code></td></tr><tr><td><code>Select</code></td><td>投影元素</td><td><code>var result = list.Select(x =&gt; x * 2);</code></td></tr><tr><td><code>OrderBy</code></td><td>排序元素</td><td><code>var result = list.OrderBy(x =&gt; x);</code></td></tr><tr><td><code>GroupBy</code></td><td>分组元素</td><td><code>var result = list.GroupBy(x =&gt; x % 2);</code></td></tr><tr><td><code>First</code></td><td>获取第一个元素</td><td><code>var result = list.First();</code></td></tr><tr><td><code>Last</code></td><td>获取最后一个元素</td><td><code>var result = list.Last();</code></td></tr><tr><td><code>Count</code></td><td>计算元素数量</td><td><code>int count = list.Count();</code></td></tr><tr><td><code>Sum</code></td><td>计算元素总和</td><td><code>int sum = list.Sum();</code></td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span> &#123;</span><br><span class="line">        List&lt;<span class="built_in">int</span>&gt; numbers = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt; &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span> &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 筛选偶数</span></span><br><span class="line">        <span class="keyword">var</span> evenNumbers = numbers.Where(n =&gt; n % <span class="number">2</span> == <span class="number">0</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Even numbers:&quot;</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> num <span class="keyword">in</span> evenNumbers) &#123;</span><br><span class="line">            Console.WriteLine(num);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 投影和排序</span></span><br><span class="line">        <span class="keyword">var</span> squaredNumbers = numbers.Select(n =&gt; n * n).OrderBy(n =&gt; n);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;\nSquared numbers (sorted):&quot;</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> num <span class="keyword">in</span> squaredNumbers) &#123;</span><br><span class="line">            Console.WriteLine(num);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 聚合操作</span></span><br><span class="line">        <span class="built_in">int</span> sum = numbers.Sum();</span><br><span class="line">        <span class="built_in">double</span> average = numbers.Average();</span><br><span class="line">        <span class="built_in">int</span> max = numbers.Max();</span><br><span class="line">        <span class="built_in">int</span> min = numbers.Min();</span><br><span class="line">        </span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;\nSum: <span class="subst">&#123;sum&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Average: <span class="subst">&#123;average&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Max: <span class="subst">&#123;max&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Min: <span class="subst">&#123;min&#125;</span>&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 对象集合查询</span></span><br><span class="line">        List&lt;Person&gt; people = <span class="keyword">new</span> List&lt;Person&gt; &#123;</span><br><span class="line">            <span class="keyword">new</span> Person &#123; Name = <span class="string">&quot;John&quot;</span>, Age = <span class="number">30</span> &#125;,</span><br><span class="line">            <span class="keyword">new</span> Person &#123; Name = <span class="string">&quot;Jane&quot;</span>, Age = <span class="number">25</span> &#125;,</span><br><span class="line">            <span class="keyword">new</span> Person &#123; Name = <span class="string">&quot;Bob&quot;</span>, Age = <span class="number">35</span> &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> adults = people.Where(p =&gt; p.Age &gt;= <span class="number">30</span>).OrderBy(p =&gt; p.Name);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;\nAdults (sorted by name):&quot;</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> person <span class="keyword">in</span> adults) &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;<span class="subst">&#123;person.Name&#125;</span>, <span class="subst">&#123;person.Age&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Age &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C-标准库与-Java-标准库的对比"><a href="#C-标准库与-Java-标准库的对比" class="headerlink" title="C# 标准库与 Java 标准库的对比"></a>C# 标准库与 Java 标准库的对比</h2><h3 id="1-整体架构"><a href="#1-整体架构" class="headerlink" title="1. 整体架构"></a>1. 整体架构</h3><table><thead><tr><th>特性</th><th>C# 标准库</th><th>Java 标准库</th></tr></thead><tbody><tr><td>运行环境</td><td>.NET Framework &#x2F; .NET Core &#x2F; .NET 5+</td><td>JVM</td></tr><tr><td>版本控制</td><td>.NET 版本号（如 .NET 8.0）</td><td>Java SE 版本号（如 Java 21）</td></tr><tr><td>模块化</td><td>.NET Core 开始采用模块化设计</td><td>Java 9+ 引入模块系统</td></tr><tr><td>跨平台</td><td>.NET Core&#x2F;5+ 支持跨平台</td><td>支持跨平台</td></tr><tr><td>性能</td><td>近年来性能显著提升，部分场景超越 Java</td><td>成熟稳定，JIT 优化优秀</td></tr></tbody></table><h3 id="2-核心组件对比"><a href="#2-核心组件对比" class="headerlink" title="2. 核心组件对比"></a>2. 核心组件对比</h3><h4 id="2-1-基础类型"><a href="#2-1-基础类型" class="headerlink" title="2.1 基础类型"></a>2.1 基础类型</h4><table><thead><tr><th>功能</th><th>C#</th><th>Java</th><th>对比</th></tr></thead><tbody><tr><td>字符串</td><td><code>string</code> &#x2F; <code>String</code></td><td><code>String</code></td><td>C# 有 <code>string</code> 别名，更简洁</td></tr><tr><td>日期时间</td><td><code>DateTime</code></td><td><code>LocalDateTime</code>, <code>Date</code></td><td>C# 的 <code>DateTime</code> 更统一</td></tr><tr><td>数学运算</td><td><code>Math</code></td><td><code>Math</code></td><td>功能相似</td></tr><tr><td>控制台</td><td><code>Console</code></td><td><code>System.out</code></td><td>C# 的 <code>Console</code> 功能更丰富</td></tr><tr><td>随机数</td><td><code>Random</code></td><td><code>Random</code></td><td>C# 的 <code>Random</code> 更易用</td></tr></tbody></table><h4 id="2-2-集合框架"><a href="#2-2-集合框架" class="headerlink" title="2.2 集合框架"></a>2.2 集合框架</h4><table><thead><tr><th>集合类型</th><th>C#</th><th>Java</th><th>对比</th></tr></thead><tbody><tr><td>列表</td><td><code>List&lt;T&gt;</code></td><td><code>ArrayList</code>, <code>LinkedList</code></td><td>C# 的 <code>List&lt;T&gt;</code> 更常用</td></tr><tr><td>字典</td><td><code>Dictionary&lt;K, V&gt;</code></td><td><code>HashMap</code>, <code>TreeMap</code></td><td>功能相似，C# 语法更简洁</td></tr><tr><td>集合</td><td><code>HashSet&lt;T&gt;</code></td><td><code>HashSet</code>, <code>TreeSet</code></td><td>功能相似</td></tr><tr><td>队列</td><td><code>Queue&lt;T&gt;</code></td><td><code>Queue</code></td><td>功能相似</td></tr><tr><td>栈</td><td><code>Stack&lt;T&gt;</code></td><td><code>Stack</code></td><td>功能相似</td></tr><tr><td>链表</td><td><code>LinkedList&lt;T&gt;</code></td><td><code>LinkedList</code></td><td>功能相似</td></tr><tr><td>并发集合</td><td><code>ConcurrentDictionary&lt;T&gt;</code>, etc.</td><td><code>ConcurrentHashMap</code>, etc.</td><td>功能相似</td></tr></tbody></table><h4 id="2-3-IO-操作"><a href="#2-3-IO-操作" class="headerlink" title="2.3 IO 操作"></a>2.3 IO 操作</h4><table><thead><tr><th>功能</th><th>C#</th><th>Java</th><th>对比</th></tr></thead><tbody><tr><td>文件操作</td><td><code>File</code>, <code>FileInfo</code></td><td><code>Files</code>, <code>Path</code></td><td>C# 有静态类和实例类两种方式</td></tr><tr><td>目录操作</td><td><code>Directory</code>, <code>DirectoryInfo</code></td><td><code>Files</code>, <code>Paths</code></td><td>功能相似</td></tr><tr><td>流操作</td><td><code>StreamReader</code>, <code>StreamWriter</code></td><td><code>BufferedReader</code>, <code>BufferedWriter</code></td><td>功能相似</td></tr><tr><td>二进制操作</td><td><code>BinaryReader</code>, <code>BinaryWriter</code></td><td><code>DataInputStream</code>, <code>DataOutputStream</code></td><td>功能相似</td></tr></tbody></table><h4 id="2-4-网络编程"><a href="#2-4-网络编程" class="headerlink" title="2.4 网络编程"></a>2.4 网络编程</h4><table><thead><tr><th>功能</th><th>C#</th><th>Java</th><th>对比</th></tr></thead><tbody><tr><td>HTTP 客户端</td><td><code>HttpClient</code></td><td><code>HttpClient</code></td><td>功能相似，C# 的 <code>HttpClient</code> 更现代</td></tr><tr><td>TCP 客户端</td><td><code>TcpClient</code></td><td><code>Socket</code></td><td>C# 的 <code>TcpClient</code> 更高级</td></tr><tr><td>TCP 服务器</td><td><code>TcpListener</code></td><td><code>ServerSocket</code></td><td>C# 的 <code>TcpListener</code> 更易用</td></tr><tr><td>套接字</td><td><code>Socket</code></td><td><code>Socket</code></td><td>功能相似</td></tr></tbody></table><h4 id="2-5-多线程"><a href="#2-5-多线程" class="headerlink" title="2.5 多线程"></a>2.5 多线程</h4><table><thead><tr><th>功能</th><th>C#</th><th>Java</th><th>对比</th></tr></thead><tbody><tr><td>线程</td><td><code>Thread</code></td><td><code>Thread</code></td><td>功能相似</td></tr><tr><td>异步任务</td><td><code>Task</code></td><td><code>CompletableFuture</code></td><td>C# 的 <code>async/await</code> 语法更简洁</td></tr><tr><td>线程池</td><td><code>ThreadPool</code></td><td><code>Executors</code></td><td>Java 的 <code>Executors</code> 提供更多工厂方法</td></tr><tr><td>锁机制</td><td><code>lock</code>, <code>Monitor</code>, <code>Mutex</code></td><td><code>synchronized</code>, <code>ReentrantLock</code></td><td>C# 的 <code>lock</code> 语法更简洁</td></tr><tr><td>并发工具</td><td><code>Semaphore</code>, <code>AutoResetEvent</code></td><td><code>Semaphore</code>, <code>CountDownLatch</code></td><td>功能相似</td></tr></tbody></table><h4 id="2-6-反射"><a href="#2-6-反射" class="headerlink" title="2.6 反射"></a>2.6 反射</h4><table><thead><tr><th>功能</th><th>C#</th><th>Java</th><th>对比</th></tr></thead><tbody><tr><td>类型信息</td><td><code>Type</code></td><td><code>Class</code></td><td>C# 的 <code>Type</code> 更统一</td></tr><tr><td>程序集</td><td><code>Assembly</code></td><td><code>ClassLoader</code>, <code>Module</code></td><td>C# 的 <code>Assembly</code> 概念更清晰</td></tr><tr><td>创建实例</td><td><code>Activator.CreateInstance</code></td><td><code>Class.newInstance</code>, <code>Constructor.newInstance</code></td><td>C# 的方式更简洁</td></tr><tr><td>方法调用</td><td><code>MethodInfo.Invoke</code></td><td><code>Method.invoke</code></td><td>功能相似</td></tr></tbody></table><h4 id="2-7-序列化"><a href="#2-7-序列化" class="headerlink" title="2.7 序列化"></a>2.7 序列化</h4><table><thead><tr><th>功能</th><th>C#</th><th>Java</th><th>对比</th></tr></thead><tbody><tr><td>JSON 序列化</td><td><code>System.Text.Json</code></td><td><code>Jackson</code>, <code>Gson</code></td><td>C# 内置 JSON 支持，Java 常用第三方库</td></tr><tr><td>XML 序列化</td><td><code>XmlSerializer</code></td><td><code>JAXB</code></td><td>功能相似</td></tr><tr><td>二进制序列化</td><td><code>BinaryFormatter</code></td><td><code>ObjectOutputStream</code></td><td>功能相似</td></tr></tbody></table><h4 id="2-8-其他功能"><a href="#2-8-其他功能" class="headerlink" title="2.8 其他功能"></a>2.8 其他功能</h4><table><thead><tr><th>功能</th><th>C#</th><th>Java</th><th>对比</th></tr></thead><tbody><tr><td>正则表达式</td><td><code>Regex</code></td><td><code>Pattern</code>, <code>Matcher</code></td><td>C# 的 <code>Regex</code> 使用更简洁</td></tr><tr><td>LINQ</td><td><code>System.Linq</code></td><td>流 API (<code>Stream</code>)</td><td>C# 的 LINQ 语法更强大，Java 的流 API 更函数式</td></tr><tr><td>异步编程</td><td><code>async/await</code></td><td><code>CompletableFuture</code>, <code>CompletableStage</code></td><td>C# 的 <code>async/await</code> 语法更简洁</td></tr><tr><td>扩展方法</td><td>支持</td><td>不支持（Java 8+ 有默认方法）</td><td>C# 的扩展方法更灵活</td></tr><tr><td>委托和事件</td><td><code>delegate</code>, <code>event</code></td><td>接口 + 匿名内部类，lambda</td><td>C# 的委托和事件语法更简洁</td></tr><tr><td>特性（注解）</td><td><code>Attribute</code></td><td><code>Annotation</code></td><td>功能相似</td></tr></tbody></table><h3 id="3-语法和使用风格对比"><a href="#3-语法和使用风格对比" class="headerlink" title="3. 语法和使用风格对比"></a>3. 语法和使用风格对比</h3><h4 id="3-1-语法风格"><a href="#3-1-语法风格" class="headerlink" title="3.1 语法风格"></a>3.1 语法风格</h4><ul><li><strong>C#</strong>：更注重语法简洁性和表达力，如 <code>var</code> 类型推断、<code>async/await</code> 异步语法、扩展方法等</li><li><strong>Java</strong>：更注重代码的清晰性和一致性，语法相对保守但更严谨</li></ul><h4 id="3-2-异常处理"><a href="#3-2-异常处理" class="headerlink" title="3.2 异常处理"></a>3.2 异常处理</h4><ul><li><strong>C#</strong>：区分检查异常和非检查异常，但语法更简洁</li><li><strong>Java</strong>：强制要求处理检查异常，代码更冗长但更安全</li></ul><h4 id="3-3-泛型实现"><a href="#3-3-泛型实现" class="headerlink" title="3.3 泛型实现"></a>3.3 泛型实现</h4><ul><li><strong>C#</strong>：运行时泛型，保留类型信息</li><li><strong>Java</strong>：类型擦除，运行时不保留类型信息</li></ul><h4 id="3-4-内存管理"><a href="#3-4-内存管理" class="headerlink" title="3.4 内存管理"></a>3.4 内存管理</h4><ul><li><strong>C#</strong>：垃圾回收器，支持析构函数和 <code>IDisposable</code> 接口</li><li><strong>Java</strong>：垃圾回收器，支持 <code>finalize()</code> 方法</li></ul><h4 id="3-5-跨平台支持"><a href="#3-5-跨平台支持" class="headerlink" title="3.5 跨平台支持"></a>3.5 跨平台支持</h4><ul><li><strong>C#</strong>：.NET Core&#x2F;5+ 支持跨平台</li><li><strong>Java</strong>：原生支持跨平台</li></ul><h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><h3 id="1-选择合适的库"><a href="#1-选择合适的库" class="headerlink" title="1. 选择合适的库"></a>1. 选择合适的库</h3><ul><li>根据应用场景选择合适的库组件</li><li>优先使用 .NET Core&#x2F;5+ 中的现代 API</li><li>对于性能敏感的场景，选择更底层的 API</li></ul><h3 id="2-性能优化"><a href="#2-性能优化" class="headerlink" title="2. 性能优化"></a>2. 性能优化</h3><ul><li>使用 <code>async/await</code> 处理 I&#x2F;O 操作</li><li>合理使用缓存减少重复计算</li><li>选择合适的集合类型</li><li>避免不必要的装箱和拆箱</li><li>合理使用并行编程</li></ul><h3 id="3-代码质量"><a href="#3-代码质量" class="headerlink" title="3. 代码质量"></a>3. 代码质量</h3><ul><li>遵循 .NET 设计规范</li><li>使用 <code>using</code> 语句管理资源</li><li>合理处理异常</li><li>编写单元测试</li><li>使用代码分析工具</li></ul><h3 id="4-安全性"><a href="#4-安全性" class="headerlink" title="4. 安全性"></a>4. 安全性</h3><ul><li>避免使用不安全的代码</li><li>注意输入验证</li><li>使用安全的加密算法</li><li>遵循最佳安全实践</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>C# 标准库是一个功能强大、设计优雅的库集合，它为 C# 开发者提供了丰富的工具和功能，涵盖了从基础类型操作到高级网络编程的各个方面。</p><p>与 Java 标准库相比，C# 标准库在以下方面具有优势：</p><ol><li><strong>语法简洁性</strong>：如 <code>var</code> 类型推断、<code>async/await</code> 异步语法等</li><li><strong>统一的 API 设计</strong>：如 <code>DateTime</code> 类的统一设计</li><li><strong>强大的 LINQ</strong>：提供了更灵活的查询语法</li><li><strong>现代的异步编程模型</strong>：<code>async/await</code> 语法更简洁易用</li><li><strong>扩展方法</strong>：允许向现有类型添加方法</li></ol><p>同时，Java 标准库在以下方面具有优势：</p><ol><li><strong>更成熟的生态系统</strong>：第三方库更丰富</li><li><strong>更严格的类型系统</strong>：强制检查异常</li><li><strong>更统一的集合框架</strong>：设计更一致</li><li><strong>更好的跨平台支持</strong>：原生支持跨平台</li></ol><p>无论是 C# 还是 Java，它们的标准库都是各自语言的重要组成部分，掌握它们的使用对于提高开发效率和代码质量至关重要。</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="https://docs.microsoft.com/en-us/dotnet/api/">Microsoft Docs: .NET API Reference</a></li><li><a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/">C# Programming Guide</a></li><li><a href="https://docs.oracle.com/en/java/">Java Platform Standard Edition Documentation</a></li><li><a href="https://www.mindk.com/blog/net-vs-java/">.NET vs Java: A Comprehensive Comparison</a></li><li><a href="https://www.tutorialspoint.com/csharp/csharp_vs_java.htm">C# and Java: Differences and Similarities</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> C# </tag>
            
            <tag> 标准库 </tag>
            
            <tag> .NET </tag>
            
            <tag> 编程 </tag>
            
            <tag> Java对比 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ STL的介绍和使用</title>
      <link href="/2026/01/21/C-STL%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
      <url>/2026/01/21/C-STL%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="C-STL-标准库详解"><a href="#C-STL-标准库详解" class="headerlink" title="C++ STL 标准库详解"></a>C++ STL 标准库详解</h1><h2 id="什么是-STL？"><a href="#什么是-STL？" class="headerlink" title="什么是 STL？"></a>什么是 STL？</h2><p>STL（Standard Template Library，标准模板库）是 C++ 标准库的重要组成部分，它提供了一组通用的模板类和函数，用于实现常见的数据结构和算法。STL 的设计理念是<strong>泛型编程</strong>，通过模板技术实现了数据结构和算法的高度复用。</p><h2 id="STL-的组成部分"><a href="#STL-的组成部分" class="headerlink" title="STL 的组成部分"></a>STL 的组成部分</h2><p>STL 主要由以下六个部分组成：</p><ol><li><strong>容器（Containers）</strong>：存储数据的对象</li><li><strong>迭代器（Iterators）</strong>：用于遍历容器中的元素</li><li><strong>算法（Algorithms）</strong>：操作容器中元素的函数</li><li><strong>函数对象（Functors）</strong>：具有函数行为的对象</li><li><strong>适配器（Adapters）</strong>：修改其他组件接口的组件</li><li><strong>分配器（Allocators）</strong>：负责内存分配和释放</li></ol><h2 id="常用容器"><a href="#常用容器" class="headerlink" title="常用容器"></a>常用容器</h2><h3 id="1-序列容器"><a href="#1-序列容器" class="headerlink" title="1. 序列容器"></a>1. 序列容器</h3><p>序列容器按照线性顺序存储元素，支持随机访问或顺序访问。</p><h4 id="1-1-vector"><a href="#1-1-vector" class="headerlink" title="1.1 vector"></a>1.1 vector</h4><p><code>vector</code> 是最常用的序列容器，它是一个动态数组，支持随机访问。</p><p><strong>常用函数</strong>：</p><table><thead><tr><th>函数</th><th>功能</th><th>时间复杂度</th></tr></thead><tbody><tr><td><code>push_back()</code></td><td>在末尾添加元素</td><td>均摊 O(1)</td></tr><tr><td><code>pop_back()</code></td><td>删除末尾元素</td><td>O(1)</td></tr><tr><td><code>size()</code></td><td>返回元素个数</td><td>O(1)</td></tr><tr><td><code>empty()</code></td><td>检查是否为空</td><td>O(1)</td></tr><tr><td><code>clear()</code></td><td>清空容器</td><td>O(n)</td></tr><tr><td><code>resize()</code></td><td>调整容器大小</td><td>O(n)</td></tr><tr><td><code>reserve()</code></td><td>预留空间</td><td>O(n)</td></tr><tr><td><code>operator[]</code></td><td>随机访问元素</td><td>O(1)</td></tr><tr><td><code>at()</code></td><td>带边界检查的随机访问</td><td>O(1)</td></tr><tr><td><code>begin()</code></td><td>返回起始迭代器</td><td>O(1)</td></tr><tr><td><code>end()</code></td><td>返回结束迭代器</td><td>O(1)</td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建 vector</span></span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; v;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加元素</span></span><br><span class="line">    v.<span class="built_in">push_back</span>(<span class="number">10</span>);</span><br><span class="line">    v.<span class="built_in">push_back</span>(<span class="number">20</span>);</span><br><span class="line">    v.<span class="built_in">push_back</span>(<span class="number">30</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遍历元素</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; v.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">        std::cout &lt;&lt; v[i] &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// 10 20 30</span></span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用迭代器遍历</span></span><br><span class="line">    <span class="keyword">for</span> (std::vector&lt;<span class="type">int</span>&gt;::iterator it = v.<span class="built_in">begin</span>(); it != v.<span class="built_in">end</span>(); ++it) &#123;</span><br><span class="line">        std::cout &lt;&lt; *it &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// 10 20 30</span></span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用范围 for 循环（C++11+）</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : v) &#123;</span><br><span class="line">        std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// 10 20 30</span></span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 访问元素</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;第一个元素: &quot;</span> &lt;&lt; v.<span class="built_in">front</span>() &lt;&lt; std::endl;  <span class="comment">// 10</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;最后一个元素: &quot;</span> &lt;&lt; v.<span class="built_in">back</span>() &lt;&lt; std::endl;  <span class="comment">// 30</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 删除元素</span></span><br><span class="line">    v.<span class="built_in">pop_back</span>();  <span class="comment">// 删除最后一个元素</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查大小</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;大小: &quot;</span> &lt;&lt; v.<span class="built_in">size</span>() &lt;&lt; std::endl;  <span class="comment">// 2</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 清空容器</span></span><br><span class="line">    v.<span class="built_in">clear</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;是否为空: &quot;</span> &lt;&lt; (v.<span class="built_in">empty</span>() ? <span class="string">&quot;是&quot;</span> : <span class="string">&quot;否&quot;</span>) &lt;&lt; std::endl;  <span class="comment">// 是</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-2-list"><a href="#1-2-list" class="headerlink" title="1.2 list"></a>1.2 list</h4><p><code>list</code> 是双向链表，支持快速的插入和删除操作，但不支持随机访问。</p><p><strong>常用函数</strong>：</p><table><thead><tr><th>函数</th><th>功能</th><th>时间复杂度</th></tr></thead><tbody><tr><td><code>push_back()</code></td><td>在末尾添加元素</td><td>O(1)</td></tr><tr><td><code>push_front()</code></td><td>在开头添加元素</td><td>O(1)</td></tr><tr><td><code>pop_back()</code></td><td>删除末尾元素</td><td>O(1)</td></tr><tr><td><code>pop_front()</code></td><td>删除开头元素</td><td>O(1)</td></tr><tr><td><code>insert()</code></td><td>在指定位置插入元素</td><td>O(1)</td></tr><tr><td><code>erase()</code></td><td>删除指定位置的元素</td><td>O(1)</td></tr><tr><td><code>size()</code></td><td>返回元素个数</td><td>O(1)</td></tr><tr><td><code>empty()</code></td><td>检查是否为空</td><td>O(1)</td></tr><tr><td><code>clear()</code></td><td>清空容器</td><td>O(n)</td></tr><tr><td><code>begin()</code></td><td>返回起始迭代器</td><td>O(1)</td></tr><tr><td><code>end()</code></td><td>返回结束迭代器</td><td>O(1)</td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建 list</span></span><br><span class="line">    std::list&lt;<span class="type">int</span>&gt; lst;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加元素</span></span><br><span class="line">    lst.<span class="built_in">push_back</span>(<span class="number">10</span>);</span><br><span class="line">    lst.<span class="built_in">push_back</span>(<span class="number">20</span>);</span><br><span class="line">    lst.<span class="built_in">push_front</span>(<span class="number">5</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遍历元素</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : lst) &#123;</span><br><span class="line">        std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// 5 10 20</span></span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 插入元素</span></span><br><span class="line">    <span class="keyword">auto</span> it = lst.<span class="built_in">begin</span>();</span><br><span class="line">    ++it;  <span class="comment">// 指向 10</span></span><br><span class="line">    lst.<span class="built_in">insert</span>(it, <span class="number">7</span>);  <span class="comment">// 在 5 和 10 之间插入 7</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : lst) &#123;</span><br><span class="line">        std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// 5 7 10 20</span></span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 删除元素</span></span><br><span class="line">    it = lst.<span class="built_in">begin</span>();</span><br><span class="line">    ++it;  <span class="comment">// 指向 7</span></span><br><span class="line">    lst.<span class="built_in">erase</span>(it);  <span class="comment">// 删除 7</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : lst) &#123;</span><br><span class="line">        std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// 5 10 20</span></span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 其他操作</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;大小: &quot;</span> &lt;&lt; lst.<span class="built_in">size</span>() &lt;&lt; std::endl;  <span class="comment">// 3</span></span><br><span class="line">    lst.<span class="built_in">clear</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;是否为空: &quot;</span> &lt;&lt; (lst.<span class="built_in">empty</span>() ? <span class="string">&quot;是&quot;</span> : <span class="string">&quot;否&quot;</span>) &lt;&lt; std::endl;  <span class="comment">// 是</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-3-deque"><a href="#1-3-deque" class="headerlink" title="1.3 deque"></a>1.3 deque</h4><p><code>deque</code> 是双端队列，支持在两端快速插入和删除，也支持随机访问。</p><p><strong>常用函数</strong>：</p><table><thead><tr><th>函数</th><th>功能</th><th>时间复杂度</th></tr></thead><tbody><tr><td><code>push_back()</code></td><td>在末尾添加元素</td><td>O(1)</td></tr><tr><td><code>push_front()</code></td><td>在开头添加元素</td><td>O(1)</td></tr><tr><td><code>pop_back()</code></td><td>删除末尾元素</td><td>O(1)</td></tr><tr><td><code>pop_front()</code></td><td>删除开头元素</td><td>O(1)</td></tr><tr><td><code>size()</code></td><td>返回元素个数</td><td>O(1)</td></tr><tr><td><code>empty()</code></td><td>检查是否为空</td><td>O(1)</td></tr><tr><td><code>clear()</code></td><td>清空容器</td><td>O(n)</td></tr><tr><td><code>operator[]</code></td><td>随机访问元素</td><td>O(1)</td></tr><tr><td><code>at()</code></td><td>带边界检查的随机访问</td><td>O(1)</td></tr><tr><td><code>begin()</code></td><td>返回起始迭代器</td><td>O(1)</td></tr><tr><td><code>end()</code></td><td>返回结束迭代器</td><td>O(1)</td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;deque&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建 deque</span></span><br><span class="line">    std::deque&lt;<span class="type">int</span>&gt; dq;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加元素</span></span><br><span class="line">    dq.<span class="built_in">push_back</span>(<span class="number">10</span>);</span><br><span class="line">    dq.<span class="built_in">push_back</span>(<span class="number">20</span>);</span><br><span class="line">    dq.<span class="built_in">push_front</span>(<span class="number">5</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遍历元素</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : dq) &#123;</span><br><span class="line">        std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// 5 10 20</span></span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 随机访问</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;第一个元素: &quot;</span> &lt;&lt; dq[<span class="number">0</span>] &lt;&lt; std::endl;  <span class="comment">// 5</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;第二个元素: &quot;</span> &lt;&lt; dq[<span class="number">1</span>] &lt;&lt; std::endl;  <span class="comment">// 10</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 删除元素</span></span><br><span class="line">    dq.<span class="built_in">pop_front</span>();</span><br><span class="line">    dq.<span class="built_in">pop_back</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : dq) &#123;</span><br><span class="line">        std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// 10</span></span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-关联容器"><a href="#2-关联容器" class="headerlink" title="2. 关联容器"></a>2. 关联容器</h3><p>关联容器按照键值对存储元素，支持快速查找。</p><h4 id="2-1-map"><a href="#2-1-map" class="headerlink" title="2.1 map"></a>2.1 map</h4><p><code>map</code> 是有序关联容器，存储键值对，按键自动排序，键唯一。</p><p><strong>常用函数</strong>：</p><table><thead><tr><th>函数</th><th>功能</th><th>时间复杂度</th></tr></thead><tbody><tr><td><code>insert()</code></td><td>插入键值对</td><td>O(log n)</td></tr><tr><td><code>erase()</code></td><td>删除元素</td><td>O(log n)</td></tr><tr><td><code>find()</code></td><td>查找键</td><td>O(log n)</td></tr><tr><td><code>count()</code></td><td>统计键的个数</td><td>O(log n)</td></tr><tr><td><code>size()</code></td><td>返回元素个数</td><td>O(1)</td></tr><tr><td><code>empty()</code></td><td>检查是否为空</td><td>O(1)</td></tr><tr><td><code>clear()</code></td><td>清空容器</td><td>O(n)</td></tr><tr><td><code>begin()</code></td><td>返回起始迭代器</td><td>O(1)</td></tr><tr><td><code>end()</code></td><td>返回结束迭代器</td><td>O(1)</td></tr><tr><td><code>operator[]</code></td><td>访问或插入元素</td><td>O(log n)</td></tr><tr><td><code>at()</code></td><td>访问元素（带检查）</td><td>O(log n)</td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建 map</span></span><br><span class="line">    std::map&lt;std::string, <span class="type">int</span>&gt; scores;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 插入元素</span></span><br><span class="line">    scores[<span class="string">&quot;Alice&quot;</span>] = <span class="number">95</span>;</span><br><span class="line">    scores[<span class="string">&quot;Bob&quot;</span>] = <span class="number">88</span>;</span><br><span class="line">    scores.<span class="built_in">insert</span>(&#123;<span class="string">&quot;Charlie&quot;</span>, <span class="number">92</span>&#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遍历元素</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; pair : scores) &#123;</span><br><span class="line">        std::cout &lt;&lt; pair.first &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; pair.second &lt;&lt; std::endl;</span><br><span class="line">        <span class="comment">// Alice: 95</span></span><br><span class="line">        <span class="comment">// Bob: 88</span></span><br><span class="line">        <span class="comment">// Charlie: 92</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查找元素</span></span><br><span class="line">    <span class="keyword">auto</span> it = scores.<span class="built_in">find</span>(<span class="string">&quot;Bob&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (it != scores.<span class="built_in">end</span>()) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Bob&#x27;s score: &quot;</span> &lt;&lt; it-&gt;second &lt;&lt; std::endl;  <span class="comment">// 88</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 删除元素</span></span><br><span class="line">    scores.<span class="built_in">erase</span>(<span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查大小</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Size: &quot;</span> &lt;&lt; scores.<span class="built_in">size</span>() &lt;&lt; std::endl;  <span class="comment">// 2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-2-set"><a href="#2-2-set" class="headerlink" title="2.2 set"></a>2.2 set</h4><p><code>set</code> 是有序关联容器，存储唯一元素，自动排序。</p><p><strong>常用函数</strong>：</p><table><thead><tr><th>函数</th><th>功能</th><th>时间复杂度</th></tr></thead><tbody><tr><td><code>insert()</code></td><td>插入元素</td><td>O(log n)</td></tr><tr><td><code>erase()</code></td><td>删除元素</td><td>O(log n)</td></tr><tr><td><code>find()</code></td><td>查找元素</td><td>O(log n)</td></tr><tr><td><code>count()</code></td><td>统计元素个数</td><td>O(log n)</td></tr><tr><td><code>size()</code></td><td>返回元素个数</td><td>O(1)</td></tr><tr><td><code>empty()</code></td><td>检查是否为空</td><td>O(1)</td></tr><tr><td><code>clear()</code></td><td>清空容器</td><td>O(n)</td></tr><tr><td><code>begin()</code></td><td>返回起始迭代器</td><td>O(1)</td></tr><tr><td><code>end()</code></td><td>返回结束迭代器</td><td>O(1)</td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建 set</span></span><br><span class="line">    std::set&lt;<span class="type">int</span>&gt; s;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 插入元素</span></span><br><span class="line">    s.<span class="built_in">insert</span>(<span class="number">10</span>);</span><br><span class="line">    s.<span class="built_in">insert</span>(<span class="number">20</span>);</span><br><span class="line">    s.<span class="built_in">insert</span>(<span class="number">10</span>);  <span class="comment">// 重复元素，不会插入</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遍历元素</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : s) &#123;</span><br><span class="line">        std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// 10 20</span></span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查找元素</span></span><br><span class="line">    <span class="keyword">auto</span> it = s.<span class="built_in">find</span>(<span class="number">15</span>);</span><br><span class="line">    <span class="keyword">if</span> (it == s.<span class="built_in">end</span>()) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;15 not found&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 删除元素</span></span><br><span class="line">    s.<span class="built_in">erase</span>(<span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : s) &#123;</span><br><span class="line">        std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// 20</span></span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-3-unordered-map"><a href="#2-3-unordered-map" class="headerlink" title="2.3 unordered_map"></a>2.3 unordered_map</h4><p><code>unordered_map</code> 是无序关联容器，使用哈希表实现，查找速度更快。</p><p><strong>常用函数</strong>：与 <code>map</code> 类似，但时间复杂度为平均 O(1)。</p><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建 unordered_map</span></span><br><span class="line">    std::unordered_map&lt;std::string, <span class="type">int</span>&gt; scores;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 插入元素</span></span><br><span class="line">    scores[<span class="string">&quot;Alice&quot;</span>] = <span class="number">95</span>;</span><br><span class="line">    scores[<span class="string">&quot;Bob&quot;</span>] = <span class="number">88</span>;</span><br><span class="line">    scores[<span class="string">&quot;Charlie&quot;</span>] = <span class="number">92</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遍历元素（顺序不确定）</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; pair : scores) &#123;</span><br><span class="line">        std::cout &lt;&lt; pair.first &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; pair.second &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查找元素</span></span><br><span class="line">    <span class="keyword">auto</span> it = scores.<span class="built_in">find</span>(<span class="string">&quot;Bob&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (it != scores.<span class="built_in">end</span>()) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Bob&#x27;s score: &quot;</span> &lt;&lt; it-&gt;second &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-4-unordered-set"><a href="#2-4-unordered-set" class="headerlink" title="2.4 unordered_set"></a>2.4 unordered_set</h4><p><code>unordered_set</code> 是无序关联容器，使用哈希表实现，存储唯一元素。</p><p><strong>常用函数</strong>：与 <code>set</code> 类似，但时间复杂度为平均 O(1)。</p><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_set&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建 unordered_set</span></span><br><span class="line">    std::unordered_set&lt;<span class="type">int</span>&gt; s;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 插入元素</span></span><br><span class="line">    s.<span class="built_in">insert</span>(<span class="number">10</span>);</span><br><span class="line">    s.<span class="built_in">insert</span>(<span class="number">20</span>);</span><br><span class="line">    s.<span class="built_in">insert</span>(<span class="number">10</span>);  <span class="comment">// 重复元素，不会插入</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遍历元素（顺序不确定）</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : s) &#123;</span><br><span class="line">        std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-容器适配器"><a href="#3-容器适配器" class="headerlink" title="3. 容器适配器"></a>3. 容器适配器</h3><p>容器适配器是对现有容器的封装，提供特定的接口。</p><h4 id="3-1-stack"><a href="#3-1-stack" class="headerlink" title="3.1 stack"></a>3.1 stack</h4><p><code>stack</code> 是栈适配器，提供后进先出（LIFO）的操作。</p><p><strong>常用函数</strong>：</p><table><thead><tr><th>函数</th><th>功能</th><th>时间复杂度</th></tr></thead><tbody><tr><td><code>push()</code></td><td>入栈</td><td>O(1)</td></tr><tr><td><code>pop()</code></td><td>出栈</td><td>O(1)</td></tr><tr><td><code>top()</code></td><td>获取栈顶元素</td><td>O(1)</td></tr><tr><td><code>size()</code></td><td>返回元素个数</td><td>O(1)</td></tr><tr><td><code>empty()</code></td><td>检查是否为空</td><td>O(1)</td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建 stack</span></span><br><span class="line">    std::stack&lt;<span class="type">int</span>&gt; st;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 入栈</span></span><br><span class="line">    st.<span class="built_in">push</span>(<span class="number">10</span>);</span><br><span class="line">    st.<span class="built_in">push</span>(<span class="number">20</span>);</span><br><span class="line">    st.<span class="built_in">push</span>(<span class="number">30</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取栈顶元素</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Top: &quot;</span> &lt;&lt; st.<span class="built_in">top</span>() &lt;&lt; std::endl;  <span class="comment">// 30</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 出栈</span></span><br><span class="line">    st.<span class="built_in">pop</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Top after pop: &quot;</span> &lt;&lt; st.<span class="built_in">top</span>() &lt;&lt; std::endl;  <span class="comment">// 20</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查大小</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Size: &quot;</span> &lt;&lt; st.<span class="built_in">size</span>() &lt;&lt; std::endl;  <span class="comment">// 2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-2-queue"><a href="#3-2-queue" class="headerlink" title="3.2 queue"></a>3.2 queue</h4><p><code>queue</code> 是队列适配器，提供先进先出（FIFO）的操作。</p><p><strong>常用函数</strong>：</p><table><thead><tr><th>函数</th><th>功能</th><th>时间复杂度</th></tr></thead><tbody><tr><td><code>push()</code></td><td>入队</td><td>O(1)</td></tr><tr><td><code>pop()</code></td><td>出队</td><td>O(1)</td></tr><tr><td><code>front()</code></td><td>获取队首元素</td><td>O(1)</td></tr><tr><td><code>back()</code></td><td>获取队尾元素</td><td>O(1)</td></tr><tr><td><code>size()</code></td><td>返回元素个数</td><td>O(1)</td></tr><tr><td><code>empty()</code></td><td>检查是否为空</td><td>O(1)</td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建 queue</span></span><br><span class="line">    std::queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 入队</span></span><br><span class="line">    q.<span class="built_in">push</span>(<span class="number">10</span>);</span><br><span class="line">    q.<span class="built_in">push</span>(<span class="number">20</span>);</span><br><span class="line">    q.<span class="built_in">push</span>(<span class="number">30</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取队首和队尾元素</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Front: &quot;</span> &lt;&lt; q.<span class="built_in">front</span>() &lt;&lt; std::endl;  <span class="comment">// 10</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Back: &quot;</span> &lt;&lt; q.<span class="built_in">back</span>() &lt;&lt; std::endl;    <span class="comment">// 30</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 出队</span></span><br><span class="line">    q.<span class="built_in">pop</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Front after pop: &quot;</span> &lt;&lt; q.<span class="built_in">front</span>() &lt;&lt; std::endl;  <span class="comment">// 20</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-3-priority-queue"><a href="#3-3-priority-queue" class="headerlink" title="3.3 priority_queue"></a>3.3 priority_queue</h4><p><code>priority_queue</code> 是优先队列适配器，自动保持最大元素在队首。</p><p><strong>常用函数</strong>：</p><table><thead><tr><th>函数</th><th>功能</th><th>时间复杂度</th></tr></thead><tbody><tr><td><code>push()</code></td><td>入队</td><td>O(log n)</td></tr><tr><td><code>pop()</code></td><td>出队</td><td>O(log n)</td></tr><tr><td><code>top()</code></td><td>获取队首元素</td><td>O(1)</td></tr><tr><td><code>size()</code></td><td>返回元素个数</td><td>O(1)</td></tr><tr><td><code>empty()</code></td><td>检查是否为空</td><td>O(1)</td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建 priority_queue</span></span><br><span class="line">    std::priority_queue&lt;<span class="type">int</span>&gt; pq;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 入队</span></span><br><span class="line">    pq.<span class="built_in">push</span>(<span class="number">30</span>);</span><br><span class="line">    pq.<span class="built_in">push</span>(<span class="number">10</span>);</span><br><span class="line">    pq.<span class="built_in">push</span>(<span class="number">20</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取队首元素（最大值）</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Top: &quot;</span> &lt;&lt; pq.<span class="built_in">top</span>() &lt;&lt; std::endl;  <span class="comment">// 30</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 出队</span></span><br><span class="line">    pq.<span class="built_in">pop</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Top after pop: &quot;</span> &lt;&lt; pq.<span class="built_in">top</span>() &lt;&lt; std::endl;  <span class="comment">// 20</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h2><p>迭代器是连接容器和算法的桥梁，提供了遍历容器元素的统一接口。</p><h3 id="迭代器类型"><a href="#迭代器类型" class="headerlink" title="迭代器类型"></a>迭代器类型</h3><table><thead><tr><th>迭代器类型</th><th>功能</th><th>支持的操作</th></tr></thead><tbody><tr><td>输入迭代器</td><td>只读，单向移动</td><td><code>++</code>, <code>*</code></td></tr><tr><td>输出迭代器</td><td>只写，单向移动</td><td><code>++</code>, <code>*</code></td></tr><tr><td>前向迭代器</td><td>读写，单向移动</td><td><code>++</code>, <code>*</code>, <code>==</code>, <code>!=</code></td></tr><tr><td>双向迭代器</td><td>读写，双向移动</td><td><code>++</code>, <code>--</code>, <code>*</code>, <code>==</code>, <code>!=</code></td></tr><tr><td>随机访问迭代器</td><td>读写，随机访问</td><td><code>++</code>, <code>--</code>, <code>+</code>, <code>-</code>, <code>[]</code>, <code>*</code>, <code>==</code>, <code>!=</code>, <code>&lt;</code>, <code>&gt;</code>, etc.</td></tr></tbody></table><h3 id="常用迭代器操作"><a href="#常用迭代器操作" class="headerlink" title="常用迭代器操作"></a>常用迭代器操作</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 正向迭代器</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Forward: &quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> it = v.<span class="built_in">begin</span>(); it != v.<span class="built_in">end</span>(); ++it) &#123;</span><br><span class="line">        std::cout &lt;&lt; *it &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// 10 20 30 40 50</span></span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 反向迭代器</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Reverse: &quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> it = v.<span class="built_in">rbegin</span>(); it != v.<span class="built_in">rend</span>(); ++it) &#123;</span><br><span class="line">        std::cout &lt;&lt; *it &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// 50 40 30 20 10</span></span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 随机访问</span></span><br><span class="line">    <span class="keyword">auto</span> it = v.<span class="built_in">begin</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;First element: &quot;</span> &lt;&lt; *it &lt;&lt; std::endl;  <span class="comment">// 10</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Third element: &quot;</span> &lt;&lt; *(it + <span class="number">2</span>) &lt;&lt; std::endl;  <span class="comment">// 30</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Last element: &quot;</span> &lt;&lt; *(v.<span class="built_in">end</span>() - <span class="number">1</span>) &lt;&lt; std::endl;  <span class="comment">// 50</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="常用算法"><a href="#常用算法" class="headerlink" title="常用算法"></a>常用算法</h2><p>STL 提供了大量的算法，定义在 <code>&lt;algorithm&gt;</code> 头文件中。</p><h3 id="1-遍历算法"><a href="#1-遍历算法" class="headerlink" title="1. 遍历算法"></a>1. 遍历算法</h3><h4 id="for-each"><a href="#for-each" class="headerlink" title="for_each"></a>for_each</h4><p>对容器中的每个元素执行操作。</p><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用函数</span></span><br><span class="line">    std::for_each(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), print);  <span class="comment">// 1 2 3 4 5</span></span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用 lambda</span></span><br><span class="line">    std::for_each(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), [](<span class="type">int</span> x) &#123;</span><br><span class="line">        std::cout &lt;&lt; x * <span class="number">2</span> &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// 2 4 6 8 10</span></span><br><span class="line">    &#125;);</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-查找算法"><a href="#2-查找算法" class="headerlink" title="2. 查找算法"></a>2. 查找算法</h3><h4 id="find"><a href="#find" class="headerlink" title="find"></a>find</h4><p>查找元素，返回第一个匹配的迭代器。</p><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查找元素</span></span><br><span class="line">    <span class="keyword">auto</span> it = std::<span class="built_in">find</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">30</span>);</span><br><span class="line">    <span class="keyword">if</span> (it != v.<span class="built_in">end</span>()) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Found: &quot;</span> &lt;&lt; *it &lt;&lt; <span class="string">&quot; at position: &quot;</span> &lt;&lt; it - v.<span class="built_in">begin</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Not found&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="find-if"><a href="#find-if" class="headerlink" title="find_if"></a>find_if</h4><p>根据条件查找元素。</p><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">10</span>, <span class="number">25</span>, <span class="number">30</span>, <span class="number">35</span>, <span class="number">40</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查找第一个大于 30 的元素</span></span><br><span class="line">    <span class="keyword">auto</span> it = std::<span class="built_in">find_if</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), [](<span class="type">int</span> x) &#123;</span><br><span class="line">        <span class="keyword">return</span> x &gt; <span class="number">30</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (it != v.<span class="built_in">end</span>()) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Found: &quot;</span> &lt;&lt; *it &lt;&lt; std::endl;  <span class="comment">// 35</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-排序算法"><a href="#3-排序算法" class="headerlink" title="3. 排序算法"></a>3. 排序算法</h3><h4 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h4><p>对元素进行排序。</p><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">6</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 升序排序</span></span><br><span class="line">    std::<span class="built_in">sort</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>());</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Ascending: &quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : v) &#123;</span><br><span class="line">        std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// 1 1 2 3 4 5 6 9</span></span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 降序排序</span></span><br><span class="line">    std::<span class="built_in">sort</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), std::<span class="built_in">greater</span>&lt;<span class="type">int</span>&gt;());</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Descending: &quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : v) &#123;</span><br><span class="line">        std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// 9 6 5 4 3 2 1 1</span></span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 自定义排序</span></span><br><span class="line">    std::<span class="built_in">sort</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), [](<span class="type">int</span> a, <span class="type">int</span> b) &#123;</span><br><span class="line">        <span class="keyword">return</span> a % <span class="number">2</span> &lt; b % <span class="number">2</span>;  <span class="comment">// 偶数在前，奇数在后</span></span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Custom: &quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : v) &#123;</span><br><span class="line">        std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-修改算法"><a href="#4-修改算法" class="headerlink" title="4. 修改算法"></a>4. 修改算法</h3><h4 id="transform"><a href="#transform" class="headerlink" title="transform"></a>transform</h4><p>对元素进行转换。</p><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">result</span><span class="params">(v.size())</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 转换元素（乘以 2）</span></span><br><span class="line">    std::<span class="built_in">transform</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), result.<span class="built_in">begin</span>(), [](<span class="type">int</span> x) &#123;</span><br><span class="line">        <span class="keyword">return</span> x * <span class="number">2</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Original: &quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : v) std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// 1 2 3 4 5</span></span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Transformed: &quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : result) std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// 2 4 6 8 10</span></span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="replace"><a href="#replace" class="headerlink" title="replace"></a>replace</h4><p>替换元素。</p><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 替换所有 2 为 99</span></span><br><span class="line">    std::<span class="built_in">replace</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">2</span>, <span class="number">99</span>);</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;After replace: &quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : v) &#123;</span><br><span class="line">        std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// 1 99 3 99 5</span></span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-数值算法"><a href="#5-数值算法" class="headerlink" title="5. 数值算法"></a>5. 数值算法</h3><p>需要包含 <code>&lt;numeric&gt;</code> 头文件。</p><h4 id="accumulate"><a href="#accumulate" class="headerlink" title="accumulate"></a>accumulate</h4><p>计算元素的累加和。</p><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;numeric&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 计算总和</span></span><br><span class="line">    <span class="type">int</span> sum = std::<span class="built_in">accumulate</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">0</span>);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Sum: &quot;</span> &lt;&lt; sum &lt;&lt; std::endl;  <span class="comment">// 15</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 计算乘积</span></span><br><span class="line">    <span class="type">int</span> product = std::<span class="built_in">accumulate</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">1</span>, [](<span class="type">int</span> a, <span class="type">int</span> b) &#123;</span><br><span class="line">        <span class="keyword">return</span> a * b;</span><br><span class="line">    &#125;);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Product: &quot;</span> &lt;&lt; product &lt;&lt; std::endl;  <span class="comment">// 120</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="函数对象"><a href="#函数对象" class="headerlink" title="函数对象"></a>函数对象</h2><p>函数对象（Functor）是重载了 <code>operator()</code> 的类，具有函数行为。</p><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数对象</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GreaterThan</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">GreaterThan</span>(<span class="type">int</span> v) : <span class="built_in">value</span>(v) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> x)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x &gt; value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用函数对象</span></span><br><span class="line">    <span class="function">GreaterThan <span class="title">gt</span><span class="params">(<span class="number">25</span>)</span></span>;</span><br><span class="line">    <span class="keyword">auto</span> it = std::<span class="built_in">find_if</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), gt);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (it != v.<span class="built_in">end</span>()) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;First element &gt; 25: &quot;</span> &lt;&lt; *it &lt;&lt; std::endl;  <span class="comment">// 30</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="适配器"><a href="#适配器" class="headerlink" title="适配器"></a>适配器</h2><p>适配器用于修改其他组件的接口。</p><h3 id="1-容器适配器"><a href="#1-容器适配器" class="headerlink" title="1. 容器适配器"></a>1. 容器适配器</h3><p>如前所述的 <code>stack</code>、<code>queue</code> 和 <code>priority_queue</code>。</p><h3 id="2-迭代器适配器"><a href="#2-迭代器适配器" class="headerlink" title="2. 迭代器适配器"></a>2. 迭代器适配器</h3><h4 id="reverse-iterator"><a href="#reverse-iterator" class="headerlink" title="reverse_iterator"></a>reverse_iterator</h4><p>反向迭代器，用于反向遍历容器。</p><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用反向迭代器</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Reverse: &quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> it = v.<span class="built_in">rbegin</span>(); it != v.<span class="built_in">rend</span>(); ++it) &#123;</span><br><span class="line">        std::cout &lt;&lt; *it &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// 50 40 30 20 10</span></span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-函数适配器"><a href="#3-函数适配器" class="headerlink" title="3. 函数适配器"></a>3. 函数适配器</h3><p>C++11 后推荐使用 lambda 表达式，函数适配器使用较少。</p><h2 id="分配器"><a href="#分配器" class="headerlink" title="分配器"></a>分配器</h2><p>分配器负责容器的内存管理，通常使用默认分配器即可。</p><p><strong>自定义分配器示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 简单的自定义分配器（仅作示例）</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyAllocator</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">typedef</span> T value_type;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">MyAllocator</span>() <span class="keyword">noexcept</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</span><br><span class="line">    <span class="built_in">MyAllocator</span>(<span class="type">const</span> MyAllocator&lt;U&gt;&amp;) <span class="keyword">noexcept</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">T* <span class="title">allocate</span><span class="params">(std::<span class="type">size_t</span> n)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Allocating &quot;</span> &lt;&lt; n &lt;&lt; <span class="string">&quot; elements&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;T*&gt;(std::<span class="built_in">malloc</span>(n * <span class="built_in">sizeof</span>(T)));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">deallocate</span><span class="params">(T* p, std::<span class="type">size_t</span> n)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Deallocating &quot;</span> &lt;&lt; n &lt;&lt; <span class="string">&quot; elements&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        std::<span class="built_in">free</span>(p);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt;</span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> MyAllocator&lt;T&gt;&amp;, <span class="type">const</span> MyAllocator&lt;U&gt;&amp;) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt;</span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span>!=(<span class="type">const</span> MyAllocator&lt;T&gt;&amp;, <span class="type">const</span> MyAllocator&lt;U&gt;&amp;) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 使用自定义分配器</span></span><br><span class="line">    std::vector&lt;<span class="type">int</span>, MyAllocator&lt;<span class="type">int</span>&gt;&gt; v;</span><br><span class="line">    v.<span class="built_in">push_back</span>(<span class="number">10</span>);</span><br><span class="line">    v.<span class="built_in">push_back</span>(<span class="number">20</span>);</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Size: &quot;</span> &lt;&lt; v.<span class="built_in">size</span>() &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="STL-的最佳实践"><a href="#STL-的最佳实践" class="headerlink" title="STL 的最佳实践"></a>STL 的最佳实践</h2><h3 id="1-容器选择"><a href="#1-容器选择" class="headerlink" title="1. 容器选择"></a>1. 容器选择</h3><table><thead><tr><th>场景</th><th>推荐容器</th><th>理由</th></tr></thead><tbody><tr><td>随机访问，频繁在末尾添加&#x2F;删除</td><td><code>vector</code></td><td>随机访问 O(1)，末尾操作高效</td></tr><tr><td>频繁在中间插入&#x2F;删除</td><td><code>list</code></td><td>插入&#x2F;删除 O(1)</td></tr><tr><td>频繁在两端插入&#x2F;删除</td><td><code>deque</code></td><td>两端操作 O(1)</td></tr><tr><td>键值对，需要排序</td><td><code>map</code></td><td>自动排序，查找 O(log n)</td></tr><tr><td>键值对，不需要排序</td><td><code>unordered_map</code></td><td>查找平均 O(1)</td></tr><tr><td>唯一元素，需要排序</td><td><code>set</code></td><td>自动排序，查找 O(log n)</td></tr><tr><td>唯一元素，不需要排序</td><td><code>unordered_set</code></td><td>查找平均 O(1)</td></tr><tr><td>后进先出操作</td><td><code>stack</code></td><td>符合栈的特性</td></tr><tr><td>先进先出操作</td><td><code>queue</code></td><td>符合队列的特性</td></tr><tr><td>优先级操作</td><td><code>priority_queue</code></td><td>自动保持优先级</td></tr></tbody></table><h3 id="2-性能优化"><a href="#2-性能优化" class="headerlink" title="2. 性能优化"></a>2. 性能优化</h3><ul><li><strong>使用 <code>reserve()</code></strong>：对于 <code>vector</code>，预先分配足够的空间</li><li><strong>避免不必要的复制</strong>：使用移动语义和 <code>emplace_back()</code></li><li><strong>选择合适的容器</strong>：根据操作类型选择最优容器</li><li><strong>使用 <code>unordered_*</code> 容器</strong>：对于频繁查找的场景</li><li><strong>避免在循环中修改容器</strong>：可能导致迭代器失效</li></ul><h3 id="3-常见陷阱"><a href="#3-常见陷阱" class="headerlink" title="3. 常见陷阱"></a>3. 常见陷阱</h3><ul><li><strong>迭代器失效</strong>：修改容器后，迭代器可能失效</li><li><strong>内存泄漏</strong>：容器中的指针需要手动管理</li><li><strong>性能退化</strong>：不正确的容器选择会导致性能问题</li><li><strong>异常安全</strong>：需要考虑异常情况下的资源管理</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>C++ STL 是一个功能强大、设计优雅的标准库，它提供了丰富的容器、算法和工具，极大地提高了开发效率和代码质量。</p><p>STL 的核心优势在于：</p><ol><li><strong>代码复用</strong>：通过模板技术实现泛型编程</li><li><strong>性能优化</strong>：底层实现经过精心优化</li><li><strong>接口统一</strong>：提供了一致的编程接口</li><li><strong>可扩展性</strong>：支持自定义类型和算法</li></ol><p>掌握 STL 的使用，对于编写高效、简洁、可维护的 C++ 代码至关重要。通过合理选择容器、灵活使用算法，可以大大简化开发工作，提高代码质量。</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li>C++ 标准库文档</li><li>《C++ Primer》</li><li>《Effective STL》</li><li>《STL 源码剖析》</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> 标准库 </tag>
            
            <tag> STL </tag>
            
            <tag> 容器 </tag>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>泛型</title>
      <link href="/2026/01/21/%E6%B3%9B%E5%9E%8B/"/>
      <url>/2026/01/21/%E6%B3%9B%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="泛型编程详解"><a href="#泛型编程详解" class="headerlink" title="泛型编程详解"></a>泛型编程详解</h1><h2 id="什么是泛型？"><a href="#什么是泛型？" class="headerlink" title="什么是泛型？"></a>什么是泛型？</h2><p>泛型（Generics）是一种编程范式，它允许在定义函数、类或接口时使用类型参数，而不是具体的类型。这些类型参数在使用时被实际的类型替换，从而实现代码的复用和类型安全。</p><p>简单来说，泛型就是”参数化类型”，将类型作为参数传递给函数、类或接口。</p><h2 id="泛型出现的原因"><a href="#泛型出现的原因" class="headerlink" title="泛型出现的原因"></a>泛型出现的原因</h2><h3 id="1-代码复用"><a href="#1-代码复用" class="headerlink" title="1. 代码复用"></a>1. 代码复用</h3><p>在泛型出现之前，为了支持不同类型，开发者不得不：</p><ul><li>为每种类型编写重复的代码</li><li>使用类型转换（如C中的void*）</li><li>牺牲类型安全</li></ul><h3 id="2-类型安全"><a href="#2-类型安全" class="headerlink" title="2. 类型安全"></a>2. 类型安全</h3><p>使用泛型可以在编译时检测类型错误，而不是在运行时才发现。</p><h3 id="3-性能优化"><a href="#3-性能优化" class="headerlink" title="3. 性能优化"></a>3. 性能优化</h3><p>泛型避免了运行时的类型转换，提高了代码执行效率。</p><h3 id="4-抽象层次提升"><a href="#4-抽象层次提升" class="headerlink" title="4. 抽象层次提升"></a>4. 抽象层次提升</h3><p>泛型允许开发者编写更抽象、更通用的代码，关注算法和逻辑本身，而不是具体的类型。</p><h2 id="泛型的应用领域和使用场景"><a href="#泛型的应用领域和使用场景" class="headerlink" title="泛型的应用领域和使用场景"></a>泛型的应用领域和使用场景</h2><h3 id="1-集合框架"><a href="#1-集合框架" class="headerlink" title="1. 集合框架"></a>1. 集合框架</h3><ul><li><strong>容器类</strong>：如List、Map、Set等，存储不同类型的元素</li><li><strong>数据结构</strong>：如栈、队列、树等，支持不同类型的数据</li></ul><h3 id="2-算法实现"><a href="#2-算法实现" class="headerlink" title="2. 算法实现"></a>2. 算法实现</h3><ul><li><strong>排序算法</strong>：适用于不同类型的元素比较</li><li><strong>搜索算法</strong>：适用于不同类型的元素查找</li><li><strong>遍历操作</strong>：适用于不同类型集合的遍历</li></ul><h3 id="3-业务逻辑抽象"><a href="#3-业务逻辑抽象" class="headerlink" title="3. 业务逻辑抽象"></a>3. 业务逻辑抽象</h3><ul><li><strong>DAO层</strong>：数据访问对象的通用实现</li><li><strong>服务层</strong>：业务逻辑的通用处理</li><li><strong>工具类</strong>：通用的工具方法</li></ul><h3 id="4-框架设计"><a href="#4-框架设计" class="headerlink" title="4. 框架设计"></a>4. 框架设计</h3><ul><li><strong>依赖注入</strong>：支持不同类型的依赖注入</li><li><strong>模板方法</strong>：通过泛型实现更灵活的模板方法</li><li><strong>策略模式</strong>：通过泛型实现更通用的策略</li></ul><h3 id="5-其他场景"><a href="#5-其他场景" class="headerlink" title="5. 其他场景"></a>5. 其他场景</h3><ul><li><strong>网络编程</strong>：处理不同类型的消息</li><li><strong>并发编程</strong>：线程安全的泛型容器</li><li><strong>GUI编程</strong>：通用的组件和事件处理</li></ul><h2 id="各语言中的泛型实现"><a href="#各语言中的泛型实现" class="headerlink" title="各语言中的泛型实现"></a>各语言中的泛型实现</h2><h3 id="C-泛型实现"><a href="#C-泛型实现" class="headerlink" title="C++ 泛型实现"></a>C++ 泛型实现</h3><p>C++ 中的泛型通过<strong>模板</strong>（Templates）实现，是最强大、最灵活的泛型系统之一。</p><h4 id="1-函数模板"><a href="#1-函数模板" class="headerlink" title="1. 函数模板"></a>1. 函数模板</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数模板</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">T <span class="title">max</span><span class="params">(T a, T b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 自动推导类型</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">max</span>(<span class="number">10</span>, <span class="number">20</span>) &lt;&lt; std::endl;           <span class="comment">// int</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">max</span>(<span class="number">3.14</span>, <span class="number">2.71</span>) &lt;&lt; std::endl;       <span class="comment">// double</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">max</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;z&#x27;</span>) &lt;&lt; std::endl;         <span class="comment">// char</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 显式指定类型</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">max</span>&lt;<span class="type">int</span>&gt;(<span class="number">10</span>, <span class="number">20.5</span>) &lt;&lt; std::endl;    <span class="comment">// 强制转换为int</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-类模板"><a href="#2-类模板" class="headerlink" title="2. 类模板"></a>2. 类模板</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 类模板</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Stack</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T* data;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">    <span class="type">int</span> capacity;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Stack</span>(<span class="type">int</span> cap = <span class="number">10</span>) : <span class="built_in">capacity</span>(cap), <span class="built_in">size</span>(<span class="number">0</span>) &#123;</span><br><span class="line">        data = <span class="keyword">new</span> T[capacity];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">Stack</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span>[] data;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (size &lt; capacity) &#123;</span><br><span class="line">            data[size++] = value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">T <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> data[--size];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">T</span>(); <span class="comment">// 返回默认构造值</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 整数栈</span></span><br><span class="line">    Stack&lt;<span class="type">int</span>&gt; intStack;</span><br><span class="line">    intStack.<span class="built_in">push</span>(<span class="number">10</span>);</span><br><span class="line">    intStack.<span class="built_in">push</span>(<span class="number">20</span>);</span><br><span class="line">    std::cout &lt;&lt; intStack.<span class="built_in">pop</span>() &lt;&lt; std::endl; <span class="comment">// 20</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 字符串栈</span></span><br><span class="line">    Stack&lt;std::string&gt; stringStack;</span><br><span class="line">    stringStack.<span class="built_in">push</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">    stringStack.<span class="built_in">push</span>(<span class="string">&quot;World&quot;</span>);</span><br><span class="line">    std::cout &lt;&lt; stringStack.<span class="built_in">pop</span>() &lt;&lt; std::endl; <span class="comment">// World</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-模板特化"><a href="#3-模板特化" class="headerlink" title="3. 模板特化"></a>3. 模板特化</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 主模板</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;General template&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 特化版本</span></span><br><span class="line"><span class="keyword">template</span> &lt;&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>&lt;<span class="type">int</span>&gt; &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Specialized for int&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    MyClass&lt;<span class="type">double</span>&gt; d;</span><br><span class="line">    d.<span class="built_in">print</span>(); <span class="comment">// General template</span></span><br><span class="line">    </span><br><span class="line">    MyClass&lt;<span class="type">int</span>&gt; i;</span><br><span class="line">    i.<span class="built_in">print</span>(); <span class="comment">// Specialized for int</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-可变参数模板（C-11-）"><a href="#4-可变参数模板（C-11-）" class="headerlink" title="4. 可变参数模板（C++11+）"></a>4. 可变参数模板（C++11+）</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 递归终止条件</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; value &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可变参数模板</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Args&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(T first, Args... rest)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; first &lt;&lt; <span class="string">&quot;, &quot;</span>;</span><br><span class="line">    <span class="built_in">print</span>(rest...); <span class="comment">// 递归调用</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">1</span>, <span class="number">2.5</span>, <span class="string">&quot;Hello&quot;</span>, <span class="string">&#x27;c&#x27;</span>);</span><br><span class="line">    <span class="comment">// 输出: 1, 2.5, Hello, c</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Java-泛型实现"><a href="#Java-泛型实现" class="headerlink" title="Java 泛型实现"></a>Java 泛型实现</h3><p>Java 中的泛型通过<strong>类型擦除</strong>（Type Erasure）实现，在编译时擦除类型信息，运行时不存在泛型类型。</p><h4 id="1-泛型类"><a href="#1-泛型类" class="headerlink" title="1. 泛型类"></a>1. 泛型类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 泛型类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Box</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> T value;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(T value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建整数类型的Box</span></span><br><span class="line">        Box&lt;Integer&gt; integerBox = <span class="keyword">new</span> <span class="title class_">Box</span>&lt;&gt;();</span><br><span class="line">        integerBox.setValue(<span class="number">10</span>);</span><br><span class="line">        System.out.println(integerBox.getValue());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建字符串类型的Box</span></span><br><span class="line">        Box&lt;String&gt; stringBox = <span class="keyword">new</span> <span class="title class_">Box</span>&lt;&gt;();</span><br><span class="line">        stringBox.setValue(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">        System.out.println(stringBox.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-泛型方法"><a href="#2-泛型方法" class="headerlink" title="2. 泛型方法"></a>2. 泛型方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="comment">// 泛型方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">printArray</span><span class="params">(T[] array)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (T element : array) &#123;</span><br><span class="line">            System.out.print(element + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Integer[] intArray = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">        String[] stringArray = &#123;<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;World&quot;</span>&#125;;</span><br><span class="line">        </span><br><span class="line">        printArray(intArray);   <span class="comment">// 自动推导类型为Integer</span></span><br><span class="line">        printArray(stringArray); <span class="comment">// 自动推导类型为String</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-泛型接口"><a href="#3-泛型接口" class="headerlink" title="3. 泛型接口"></a>3. 泛型接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 泛型接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Generator</span>&lt;T&gt; &#123;</span><br><span class="line">    T <span class="title function_">generate</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现泛型接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NumberGenerator</span> <span class="keyword">implements</span> <span class="title class_">Generator</span>&lt;Integer&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">generate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StringGenerator</span> <span class="keyword">implements</span> <span class="title class_">Generator</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> String[] strings = &#123;<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;World&quot;</span>, <span class="string">&quot;Java&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> strings[index++ % strings.length];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Generator&lt;Integer&gt; numberGen = <span class="keyword">new</span> <span class="title class_">NumberGenerator</span>();</span><br><span class="line">        System.out.println(numberGen.generate()); <span class="comment">// 0</span></span><br><span class="line">        System.out.println(numberGen.generate()); <span class="comment">// 1</span></span><br><span class="line">        </span><br><span class="line">        Generator&lt;String&gt; stringGen = <span class="keyword">new</span> <span class="title class_">StringGenerator</span>();</span><br><span class="line">        System.out.println(stringGen.generate()); <span class="comment">// Hello</span></span><br><span class="line">        System.out.println(stringGen.generate()); <span class="comment">// World</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-通配符"><a href="#4-通配符" class="headerlink" title="4. 通配符"></a>4. 通配符</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="comment">// 上界通配符：只能接受Number或其子类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printNumbers</span><span class="params">(List&lt;? extends Number&gt; numbers)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Number number : numbers) &#123;</span><br><span class="line">            System.out.print(number + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 下界通配符：只能接受Integer或其父类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">addIntegers</span><span class="params">(List&lt;? <span class="built_in">super</span> Integer&gt; list)</span> &#123;</span><br><span class="line">        list.add(<span class="number">10</span>);</span><br><span class="line">        list.add(<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; integers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        integers.add(<span class="number">1</span>);</span><br><span class="line">        integers.add(<span class="number">2</span>);</span><br><span class="line">        printNumbers(integers);</span><br><span class="line">        </span><br><span class="line">        List&lt;Double&gt; doubles = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        doubles.add(<span class="number">1.5</span>);</span><br><span class="line">        doubles.add(<span class="number">2.5</span>);</span><br><span class="line">        printNumbers(doubles);</span><br><span class="line">        </span><br><span class="line">        List&lt;Object&gt; objects = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        addIntegers(objects);</span><br><span class="line">        System.out.println(objects); <span class="comment">// [10, 20]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Python-泛型实现"><a href="#Python-泛型实现" class="headerlink" title="Python 泛型实现"></a>Python 泛型实现</h3><p>Python 是动态类型语言，传统上通过<strong>鸭子类型</strong>实现泛型。Python 3.5+ 引入了<strong>类型提示</strong>（Type Hints），支持静态类型检查。</p><h4 id="1-传统鸭子类型（隐式泛型）"><a href="#1-传统鸭子类型（隐式泛型）" class="headerlink" title="1. 传统鸭子类型（隐式泛型）"></a>1. 传统鸭子类型（隐式泛型）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 传统Python风格：鸭子类型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_items</span>(<span class="params">items</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;处理任意可迭代对象&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        <span class="built_in">print</span>(item)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_max</span>(<span class="params">items</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;找到任意可比较对象的最大值&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> items:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    max_item = items[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items[<span class="number">1</span>:]:</span><br><span class="line">        <span class="keyword">if</span> item &gt; max_item:</span><br><span class="line">            max_item = item</span><br><span class="line">    <span class="keyword">return</span> max_item</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用示例</span></span><br><span class="line">process_items([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])          <span class="comment"># 整数列表</span></span><br><span class="line">process_items([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>])    <span class="comment"># 字符串列表</span></span><br><span class="line">process_items(&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;)          <span class="comment"># 集合</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(find_max([<span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>]))        <span class="comment"># 5</span></span><br><span class="line"><span class="built_in">print</span>(find_max([<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;cherry&quot;</span>]))  <span class="comment"># cherry</span></span><br></pre></td></tr></table></figure><h4 id="2-类型提示（显式泛型）"><a href="#2-类型提示（显式泛型）" class="headerlink" title="2. 类型提示（显式泛型）"></a>2. 类型提示（显式泛型）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypeVar, <span class="type">List</span>, Iterable, <span class="type">Generic</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义类型变量</span></span><br><span class="line">T = TypeVar(<span class="string">&#x27;T&#x27;</span>)</span><br><span class="line">C = TypeVar(<span class="string">&#x27;C&#x27;</span>, bound=<span class="string">&#x27;Comparable&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义泛型函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_items</span>(<span class="params">items: Iterable[T]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;处理任意可迭代对象&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        <span class="built_in">print</span>(item)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_max</span>(<span class="params">items: <span class="type">List</span>[C]</span>) -&gt; C:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;找到任意可比较对象的最大值&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> items:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    max_item = items[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items[<span class="number">1</span>:]:</span><br><span class="line">        <span class="keyword">if</span> item &gt; max_item:</span><br><span class="line">            max_item = item</span><br><span class="line">    <span class="keyword">return</span> max_item</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义泛型类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Stack</span>(<span class="type">Generic</span>[T]):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.items: <span class="type">List</span>[T] = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">push</span>(<span class="params">self, item: T</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="variable language_">self</span>.items.append(item)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pop</span>(<span class="params">self</span>) -&gt; T:</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.items.pop()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_empty</span>(<span class="params">self</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.items) == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用示例</span></span><br><span class="line">process_items([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">process_items([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(find_max([<span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用泛型类</span></span><br><span class="line">int_stack = Stack[<span class="built_in">int</span>]()</span><br><span class="line">int_stack.push(<span class="number">10</span>)</span><br><span class="line">int_stack.push(<span class="number">20</span>)</span><br><span class="line"><span class="built_in">print</span>(int_stack.pop())  <span class="comment"># 20</span></span><br><span class="line"></span><br><span class="line">string_stack = Stack[<span class="built_in">str</span>]()</span><br><span class="line">string_stack.push(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">string_stack.push(<span class="string">&quot;World&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(string_stack.pop())  <span class="comment"># World</span></span><br></pre></td></tr></table></figure><h4 id="3-泛型约束"><a href="#3-泛型约束" class="headerlink" title="3. 泛型约束"></a>3. 泛型约束</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypeVar, <span class="type">Generic</span>, <span class="type">List</span>, <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义带约束的类型变量</span></span><br><span class="line">T = TypeVar(<span class="string">&#x27;T&#x27;</span>, <span class="built_in">int</span>, <span class="built_in">float</span>, <span class="built_in">complex</span>)  <span class="comment"># 只接受数值类型</span></span><br><span class="line">U = TypeVar(<span class="string">&#x27;U&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NumericContainer</span>(<span class="type">Generic</span>[T]):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.items: <span class="type">List</span>[T] = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, item: T</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="variable language_">self</span>.items.append(item)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sum</span>(<span class="params">self</span>) -&gt; T:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(<span class="variable language_">self</span>.items)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用示例</span></span><br><span class="line">num_container = NumericContainer[<span class="built_in">int</span>]()</span><br><span class="line">num_container.add(<span class="number">1</span>)</span><br><span class="line">num_container.add(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(num_container.<span class="built_in">sum</span>())  <span class="comment"># 3</span></span><br><span class="line"></span><br><span class="line">float_container = NumericContainer[<span class="built_in">float</span>]()</span><br><span class="line">float_container.add(<span class="number">1.5</span>)</span><br><span class="line">float_container.add(<span class="number">2.5</span>)</span><br><span class="line"><span class="built_in">print</span>(float_container.<span class="built_in">sum</span>())  <span class="comment"># 4.0</span></span><br></pre></td></tr></table></figure><h3 id="C-泛型实现-1"><a href="#C-泛型实现-1" class="headerlink" title="C# 泛型实现"></a>C# 泛型实现</h3><p>C# 中的泛型是一种<strong>真正的泛型</strong>，在运行时保留类型信息，提供了类型安全和性能优化。</p><h4 id="1-泛型类-1"><a href="#1-泛型类-1" class="headerlink" title="1. 泛型类"></a>1. 泛型类</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 泛型类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">GenericList</span>&lt;<span class="title">T</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; items = <span class="keyword">new</span> List&lt;T&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Add</span>(<span class="params">T item</span>)</span> &#123;</span><br><span class="line">        items.Add(item);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">Get</span>(<span class="params"><span class="built_in">int</span> index</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items[index];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Count &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> items.Count; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建整数类型的列表</span></span><br><span class="line">        GenericList&lt;<span class="built_in">int</span>&gt; intList = <span class="keyword">new</span> GenericList&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line">        intList.Add(<span class="number">10</span>);</span><br><span class="line">        intList.Add(<span class="number">20</span>);</span><br><span class="line">        Console.WriteLine(intList.Get(<span class="number">0</span>)); <span class="comment">// 10</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建字符串类型的列表</span></span><br><span class="line">        GenericList&lt;<span class="built_in">string</span>&gt; stringList = <span class="keyword">new</span> GenericList&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line">        stringList.Add(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">        stringList.Add(<span class="string">&quot;World&quot;</span>);</span><br><span class="line">        Console.WriteLine(stringList.Get(<span class="number">1</span>)); <span class="comment">// World</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-泛型方法-1"><a href="#2-泛型方法-1" class="headerlink" title="2. 泛型方法"></a>2. 泛型方法</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="comment">// 泛型方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Swap</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="keyword">ref</span> T a, <span class="keyword">ref</span> T b</span>)</span> &#123;</span><br><span class="line">        T temp = a;</span><br><span class="line">        a = b;</span><br><span class="line">        b = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 带约束的泛型方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> T <span class="title">Max</span>&lt;<span class="title">T</span>&gt;(<span class="params">T a, T b</span>) <span class="keyword">where</span> T : IComparable&lt;T&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a.CompareTo(b) &gt; <span class="number">0</span> ? a : b;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">int</span> x = <span class="number">10</span>, y = <span class="number">20</span>;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Before swap: x=<span class="subst">&#123;x&#125;</span>, y=<span class="subst">&#123;y&#125;</span>&quot;</span>);</span><br><span class="line">        Swap(<span class="keyword">ref</span> x, <span class="keyword">ref</span> y);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;After swap: x=<span class="subst">&#123;x&#125;</span>, y=<span class="subst">&#123;y&#125;</span>&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">string</span> s1 = <span class="string">&quot;apple&quot;</span>, s2 = <span class="string">&quot;banana&quot;</span>;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Max of <span class="subst">&#123;s1&#125;</span> and <span class="subst">&#123;s2&#125;</span> is <span class="subst">&#123;Max(s1, s2)&#125;</span>&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">int</span> a = <span class="number">5</span>, b = <span class="number">10</span>;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Max of <span class="subst">&#123;a&#125;</span> and <span class="subst">&#123;b&#125;</span> is <span class="subst">&#123;Max(a, b)&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-泛型接口-1"><a href="#3-泛型接口-1" class="headerlink" title="3. 泛型接口"></a>3. 泛型接口</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 泛型接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title">IRepository</span>&lt;<span class="title">T</span>&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Add</span>(<span class="params">T item</span>)</span>;</span><br><span class="line">    <span class="function">T <span class="title">GetById</span>(<span class="params"><span class="built_in">int</span> id</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params">T item</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Delete</span>(<span class="params"><span class="built_in">int</span> id</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现泛型接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">User</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">UserRepository</span> : <span class="title">IRepository</span>&lt;<span class="title">User</span>&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Add</span>(<span class="params">User item</span>)</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Adding user: <span class="subst">&#123;item.Name&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">GetById</span>(<span class="params"><span class="built_in">int</span> id</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User &#123; Id = id, Name = <span class="string">&quot;User &quot;</span> + id &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params">User item</span>)</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Updating user: <span class="subst">&#123;item.Name&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Delete</span>(<span class="params"><span class="built_in">int</span> id</span>)</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Deleting user with id: <span class="subst">&#123;id&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span> &#123;</span><br><span class="line">        IRepository&lt;User&gt; repository = <span class="keyword">new</span> UserRepository();</span><br><span class="line">        repository.Add(<span class="keyword">new</span> User &#123; Id = <span class="number">1</span>, Name = <span class="string">&quot;John&quot;</span> &#125;);</span><br><span class="line">        User user = repository.GetById(<span class="number">1</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Retrieved user: <span class="subst">&#123;user.Name&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-泛型约束"><a href="#4-泛型约束" class="headerlink" title="4. 泛型约束"></a>4. 泛型约束</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义泛型约束</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">GenericClass</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span> : <span class="keyword">class</span>, <span class="title">new</span>() &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">CreateInstance</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> T();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">MyClass</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SayHello</span>()</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Hello from MyClass&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span> &#123;</span><br><span class="line">        GenericClass&lt;MyClass&gt; genericClass = <span class="keyword">new</span> GenericClass&lt;MyClass&gt;();</span><br><span class="line">        MyClass instance = genericClass.CreateInstance();</span><br><span class="line">        instance.SayHello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="泛型在各语言中的特点比较"><a href="#泛型在各语言中的特点比较" class="headerlink" title="泛型在各语言中的特点比较"></a>泛型在各语言中的特点比较</h2><table><thead><tr><th>特性</th><th>C++ 模板</th><th>Java 泛型</th><th>Python 类型提示</th><th>C# 泛型</th></tr></thead><tbody><tr><td>实现方式</td><td>模板实例化</td><td>类型擦除</td><td>鸭子类型+类型提示</td><td>运行时泛型</td></tr><tr><td>编译时检查</td><td>强类型检查</td><td>编译时检查，运行时擦除</td><td>可选的静态检查</td><td>强类型检查</td></tr><tr><td>灵活性</td><td>极高（支持模板特化、SFINAE等）</td><td>中等（受类型擦除限制）</td><td>极高（动态类型）</td><td>高（支持约束和反射）</td></tr><tr><td>性能</td><td>优秀（编译期实例化）</td><td>良好（避免装箱拆箱）</td><td>良好（动态类型开销）</td><td>优秀（JIT优化）</td></tr><tr><td>语法复杂度</td><td>较高</td><td>中等</td><td>简单</td><td>中等</td></tr><tr><td>运行时类型信息</td><td>无（模板在编译期展开）</td><td>有限（类型擦除）</td><td>丰富（动态类型）</td><td>丰富（运行时泛型）</td></tr><tr><td>约束能力</td><td>编译期约束（SFINAE）</td><td>上界约束、下界约束</td><td>类型变量约束</td><td>多种约束（where子句）</td></tr></tbody></table><h2 id="泛型的最佳实践"><a href="#泛型的最佳实践" class="headerlink" title="泛型的最佳实践"></a>泛型的最佳实践</h2><h3 id="1-明确泛型参数的含义"><a href="#1-明确泛型参数的含义" class="headerlink" title="1. 明确泛型参数的含义"></a>1. 明确泛型参数的含义</h3><ul><li>使用有意义的类型参数名（如T、E、K、V等）</li><li>为泛型参数添加适当的约束</li><li>提供清晰的文档说明</li></ul><h3 id="2-合理使用泛型约束"><a href="#2-合理使用泛型约束" class="headerlink" title="2. 合理使用泛型约束"></a>2. 合理使用泛型约束</h3><ul><li>只添加必要的约束</li><li>优先使用接口约束而非具体类型</li><li>考虑约束的性能影响</li></ul><h3 id="3-注意类型擦除的影响（Java）"><a href="#3-注意类型擦除的影响（Java）" class="headerlink" title="3. 注意类型擦除的影响（Java）"></a>3. 注意类型擦除的影响（Java）</h3><ul><li>避免在运行时依赖泛型类型信息</li><li>对于需要运行时类型信息的场景，使用通配符或类型令牌</li></ul><h3 id="4-注意模板膨胀（C-）"><a href="#4-注意模板膨胀（C-）" class="headerlink" title="4. 注意模板膨胀（C++）"></a>4. 注意模板膨胀（C++）</h3><ul><li>避免过度使用模板导致代码膨胀</li><li>考虑使用特化减少代码重复</li><li>注意编译时间的影响</li></ul><h3 id="5-平衡泛型和具体实现"><a href="#5-平衡泛型和具体实现" class="headerlink" title="5. 平衡泛型和具体实现"></a>5. 平衡泛型和具体实现</h3><ul><li>对于简单场景，直接使用具体类型可能更清晰</li><li>对于复杂场景，泛型可以提供更好的抽象</li><li>考虑代码可读性和维护性</li></ul><h2 id="泛型的未来发展"><a href="#泛型的未来发展" class="headerlink" title="泛型的未来发展"></a>泛型的未来发展</h2><h3 id="1-更强大的类型系统"><a href="#1-更强大的类型系统" class="headerlink" title="1. 更强大的类型系统"></a>1. 更强大的类型系统</h3><ul><li><strong>类型推断</strong>：更智能的类型推断能力</li><li><strong>高阶泛型</strong>：支持泛型的泛型</li><li><strong>类型级编程</strong>：更强大的类型级计算</li></ul><h3 id="2-更好的工具支持"><a href="#2-更好的工具支持" class="headerlink" title="2. 更好的工具支持"></a>2. 更好的工具支持</h3><ul><li><strong>IDE 集成</strong>：更好的泛型代码提示和重构</li><li><strong>静态分析</strong>：更准确的泛型代码分析</li><li><strong>测试工具</strong>：专门的泛型代码测试工具</li></ul><h3 id="3-跨语言泛型"><a href="#3-跨语言泛型" class="headerlink" title="3. 跨语言泛型"></a>3. 跨语言泛型</h3><ul><li><strong>语言互操作</strong>：不同语言间泛型的互操作</li><li><strong>中间表示</strong>：统一的泛型中间表示</li><li><strong>标准库</strong>：跨语言的泛型标准库</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>泛型是现代编程语言中不可或缺的特性，它通过参数化类型，解决了代码复用、类型安全和性能优化等问题。泛型在集合框架、算法实现、业务逻辑抽象和框架设计等领域有着广泛的应用。</p><p>不同语言的泛型实现各有特点：</p><ul><li><strong>C++</strong>：通过模板实现，最强大、最灵活</li><li><strong>Java</strong>：通过类型擦除实现，平衡了安全性和灵活性</li><li><strong>Python</strong>：通过鸭子类型和类型提示实现，最简洁、最动态</li><li><strong>C#</strong>：通过运行时泛型实现，提供了类型安全和运行时支持</li></ul><p>掌握泛型的使用，对于编写高质量、可维护的代码至关重要。在实际开发中，应根据具体语言的特性和项目需求，合理使用泛型，以达到最佳的代码设计效果。</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> Python </tag>
            
            <tag> Java </tag>
            
            <tag> C# </tag>
            
            <tag> 泛型 </tag>
            
            <tag> 编程范式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>回调函数</title>
      <link href="/2026/01/20/%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0/"/>
      <url>/2026/01/20/%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="回调函数详解"><a href="#回调函数详解" class="headerlink" title="回调函数详解"></a>回调函数详解</h1><h2 id="什么是回调函数？"><a href="#什么是回调函数？" class="headerlink" title="什么是回调函数？"></a>什么是回调函数？</h2><p>回调函数（Callback Function）是一种特殊的函数，它被作为参数传递给另一个函数，并且在适当的时候被调用执行。简单来说，就是你定义一个函数，然后把它交给别人，让别人在需要的时候调用它。</p><p>回调函数的核心思想是：<strong>将函数的调用权交给其他代码</strong>，实现了控制反转（Inversion of Control）的设计模式。</p><h2 id="回调函数的基本原理"><a href="#回调函数的基本原理" class="headerlink" title="回调函数的基本原理"></a>回调函数的基本原理</h2><ol><li><strong>定义回调函数</strong>：创建一个符合特定签名的函数</li><li><strong>注册回调函数</strong>：将回调函数作为参数传递给另一个函数</li><li><strong>触发回调</strong>：在适当的时机，调用注册的回调函数</li><li><strong>执行回调</strong>：回调函数被执行，完成特定任务</li></ol><h2 id="各语言实现回调函数的方式"><a href="#各语言实现回调函数的方式" class="headerlink" title="各语言实现回调函数的方式"></a>各语言实现回调函数的方式</h2><h3 id="C-实现回调函数"><a href="#C-实现回调函数" class="headerlink" title="C++ 实现回调函数"></a>C++ 实现回调函数</h3><p>C++ 中实现回调函数有多种方式：</p><h4 id="1-函数指针"><a href="#1-函数指针" class="headerlink" title="1. 函数指针"></a>1. 函数指针</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 回调函数类型定义</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*CallbackFunc)</span><span class="params">(<span class="type">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册回调的函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">registerCallback</span><span class="params">(CallbackFunc callback)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 在适当的时候调用回调</span></span><br><span class="line">    <span class="built_in">callback</span>(<span class="number">42</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的回调函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">myCallback</span><span class="params">(<span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Callback called with value: &quot;</span> &lt;&lt; value &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">registerCallback</span>(myCallback);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-仿函数（Functor）"><a href="#2-仿函数（Functor）" class="headerlink" title="2. 仿函数（Functor）"></a>2. 仿函数（Functor）</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Callback</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Functor callback called with value: &quot;</span> &lt;&lt; value &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">registerCallback</span><span class="params">(<span class="type">const</span> Callback&amp; callback)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">callback</span>(<span class="number">42</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Callback callback;</span><br><span class="line">    <span class="built_in">registerCallback</span>(callback);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-Lambda-表达式（C-11-）"><a href="#3-Lambda-表达式（C-11-）" class="headerlink" title="3. Lambda 表达式（C++11+）"></a>3. Lambda 表达式（C++11+）</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">registerCallback</span><span class="params">(<span class="type">const</span> std::function&lt;<span class="type">void</span>(<span class="type">int</span>)&gt;&amp; callback)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">callback</span>(<span class="number">42</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">registerCallback</span>([](<span class="type">int</span> value) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Lambda callback called with value: &quot;</span> &lt;&lt; value &lt;&lt; std::endl;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Java-实现回调函数"><a href="#Java-实现回调函数" class="headerlink" title="Java 实现回调函数"></a>Java 实现回调函数</h3><p>Java 中实现回调主要通过接口：</p><h4 id="1-接口回调"><a href="#1-接口回调" class="headerlink" title="1. 接口回调"></a>1. 接口回调</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 回调接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Callback</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onCallback</span><span class="params">(<span class="type">int</span> value)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册回调的类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CallbackRegistry</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerCallback</span><span class="params">(Callback callback)</span> &#123;</span><br><span class="line">        <span class="comment">// 在适当的时候调用回调</span></span><br><span class="line">        callback.onCallback(<span class="number">42</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现回调接口的类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyCallback</span> <span class="keyword">implements</span> <span class="title class_">Callback</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCallback</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Callback called with value: &quot;</span> + value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CallbackRegistry</span> <span class="variable">registry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CallbackRegistry</span>();</span><br><span class="line">        registry.registerCallback(<span class="keyword">new</span> <span class="title class_">MyCallback</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用匿名内部类</span></span><br><span class="line">        registry.registerCallback(<span class="keyword">new</span> <span class="title class_">Callback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCallback</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Anonymous callback called with value: &quot;</span> + value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Java 8+ 使用 Lambda 表达式</span></span><br><span class="line">        registry.registerCallback(value -&gt; System.out.println(<span class="string">&quot;Lambda callback called with value: &quot;</span> + value));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Python-实现回调函数"><a href="#Python-实现回调函数" class="headerlink" title="Python 实现回调函数"></a>Python 实现回调函数</h3><p>Python 中函数是一等公民，实现回调非常简单：</p><h4 id="1-函数作为参数"><a href="#1-函数作为参数" class="headerlink" title="1. 函数作为参数"></a>1. 函数作为参数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">register_callback</span>(<span class="params">callback</span>):</span><br><span class="line">    <span class="comment"># 在适当的时候调用回调</span></span><br><span class="line">    callback(<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_callback</span>(<span class="params">value</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Callback called with value: <span class="subst">&#123;value&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用示例</span></span><br><span class="line">register_callback(my_callback)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 lambda 表达式</span></span><br><span class="line">register_callback(<span class="keyword">lambda</span> value: <span class="built_in">print</span>(<span class="string">f&quot;Lambda callback called with value: <span class="subst">&#123;value&#125;</span>&quot;</span>))</span><br></pre></td></tr></table></figure><h4 id="2-类方法作为回调"><a href="#2-类方法作为回调" class="headerlink" title="2. 类方法作为回调"></a>2. 类方法作为回调</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CallbackHandler</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">callback_method</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Method callback called with value: <span class="subst">&#123;value&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register_callback</span>(<span class="params">callback</span>):</span><br><span class="line">    callback(<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用示例</span></span><br><span class="line">handler = CallbackHandler()</span><br><span class="line">register_callback(handler.callback_method)</span><br></pre></td></tr></table></figure><h3 id="JavaScript-实现回调函数"><a href="#JavaScript-实现回调函数" class="headerlink" title="JavaScript 实现回调函数"></a>JavaScript 实现回调函数</h3><p>JavaScript 中函数也是一等公民，实现回调非常灵活：</p><h4 id="1-函数作为参数-1"><a href="#1-函数作为参数-1" class="headerlink" title="1. 函数作为参数"></a>1. 函数作为参数</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">registerCallback</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="comment">// 在适当的时候调用回调</span></span><br><span class="line">    <span class="title function_">callback</span>(<span class="number">42</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myCallback</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Callback called with value: <span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用示例</span></span><br><span class="line"><span class="title function_">registerCallback</span>(myCallback);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用箭头函数</span></span><br><span class="line"><span class="title function_">registerCallback</span>(<span class="function"><span class="params">value</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Arrow function callback called with value: <span class="subst">$&#123;value&#125;</span>`</span>));</span><br></pre></td></tr></table></figure><h4 id="2-异步回调"><a href="#2-异步回调" class="headerlink" title="2. 异步回调"></a>2. 异步回调</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 异步操作中的回调</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> data = &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;Test&#x27;</span> &#125;;</span><br><span class="line">        <span class="title function_">callback</span>(data);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetchData</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Fetched data:&#x27;</span>, data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="C-实现回调函数-1"><a href="#C-实现回调函数-1" class="headerlink" title="C# 实现回调函数"></a>C# 实现回调函数</h3><p>C# 中实现回调的方式：</p><h4 id="1-委托（Delegate）"><a href="#1-委托（Delegate）" class="headerlink" title="1. 委托（Delegate）"></a>1. 委托（Delegate）</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义委托</span></span><br><span class="line"><span class="function"><span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">CallbackDelegate</span>(<span class="params"><span class="built_in">int</span> <span class="keyword">value</span></span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">CallbackRegistry</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RegisterCallback</span>(<span class="params">CallbackDelegate callback</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 在适当的时候调用回调</span></span><br><span class="line">        callback(<span class="number">42</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MyCallback</span>(<span class="params"><span class="built_in">int</span> <span class="keyword">value</span></span>)</span> &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Callback called with value: <span class="subst">&#123;<span class="keyword">value</span>&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span> &#123;</span><br><span class="line">        CallbackRegistry registry = <span class="keyword">new</span> CallbackRegistry();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用方法作为回调</span></span><br><span class="line">        registry.RegisterCallback(MyCallback);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用匿名方法</span></span><br><span class="line">        registry.RegisterCallback(<span class="built_in">delegate</span>(<span class="built_in">int</span> <span class="keyword">value</span>) &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;Anonymous callback called with value: <span class="subst">&#123;<span class="keyword">value</span>&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用 Lambda 表达式</span></span><br><span class="line">        registry.RegisterCallback(<span class="keyword">value</span> =&gt; &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;Lambda callback called with value: <span class="subst">&#123;<span class="keyword">value</span>&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-事件（Event）"><a href="#2-事件（Event）" class="headerlink" title="2. 事件（Event）"></a>2. 事件（Event）</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">EventPublisher</span> &#123;</span><br><span class="line">    <span class="comment">// 定义事件</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> Action&lt;<span class="built_in">int</span>&gt; CallbackEvent;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TriggerEvent</span>()</span> &#123;</span><br><span class="line">        <span class="comment">// 触发事件（调用回调）</span></span><br><span class="line">        CallbackEvent?.Invoke(<span class="number">42</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span> &#123;</span><br><span class="line">        EventPublisher publisher = <span class="keyword">new</span> EventPublisher();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 订阅事件</span></span><br><span class="line">        publisher.CallbackEvent += <span class="keyword">value</span> =&gt; &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;Event callback called with value: <span class="subst">&#123;<span class="keyword">value</span>&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 触发事件</span></span><br><span class="line">        publisher.TriggerEvent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="回调函数的应用场景"><a href="#回调函数的应用场景" class="headerlink" title="回调函数的应用场景"></a>回调函数的应用场景</h2><h3 id="1-异步操作"><a href="#1-异步操作" class="headerlink" title="1. 异步操作"></a>1. 异步操作</h3><ul><li><strong>网络请求</strong>：HTTP 请求完成后的回调处理</li><li><strong>文件 I&#x2F;O</strong>：文件读写完成后的回调</li><li><strong>数据库操作</strong>：数据库查询完成后的回调</li><li><strong>定时器</strong>：定时任务执行后的回调</li></ul><h3 id="2-事件处理"><a href="#2-事件处理" class="headerlink" title="2. 事件处理"></a>2. 事件处理</h3><ul><li><strong>GUI 编程</strong>：按钮点击、鼠标移动等事件的回调处理</li><li><strong>游戏开发</strong>：键盘输入、碰撞检测等事件的回调</li><li><strong>消息队列</strong>：消息到达后的回调处理</li></ul><h3 id="3-业务逻辑扩展"><a href="#3-业务逻辑扩展" class="headerlink" title="3. 业务逻辑扩展"></a>3. 业务逻辑扩展</h3><ul><li><strong>插件系统</strong>：通过回调函数实现插件的扩展点</li><li><strong>框架设计</strong>：框架通过回调函数允许用户自定义行为</li><li><strong>模板方法模式</strong>：父类定义算法骨架，子类通过回调实现具体步骤</li></ul><h3 id="4-回调链和控制流"><a href="#4-回调链和控制流" class="headerlink" title="4. 回调链和控制流"></a>4. 回调链和控制流</h3><ul><li><strong>中间件</strong>：HTTP 服务器中的中间件链</li><li><strong>管道模式</strong>：数据处理管道中的各个处理步骤</li><li><strong>Promise&#x2F;Async-Await</strong>：异步操作的链式调用（现代语言中的高级回调形式）</li></ul><h3 id="5-其他场景"><a href="#5-其他场景" class="headerlink" title="5. 其他场景"></a>5. 其他场景</h3><ul><li><strong>排序算法</strong>：自定义比较函数</li><li><strong>遍历操作</strong>：集合遍历中的元素处理回调</li><li><strong>错误处理</strong>：异常处理的回调函数</li><li><strong>性能监控</strong>：代码执行前后的计时回调</li></ul><h2 id="回调函数的优缺点"><a href="#回调函数的优缺点" class="headerlink" title="回调函数的优缺点"></a>回调函数的优缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul><li><strong>灵活性</strong>：允许动态改变函数行为</li><li><strong>解耦合</strong>：将调用者和被调用者分离</li><li><strong>可扩展性</strong>：便于添加新的功能模块</li><li><strong>异步处理</strong>：适合处理异步操作</li></ul><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ul><li><strong>回调地狱</strong>：多层嵌套回调导致代码可读性差</li><li><strong>错误处理复杂</strong>：异步回调中的错误处理比较困难</li><li><strong>内存泄漏</strong>：不当使用可能导致内存泄漏</li><li><strong>调试困难</strong>：回调执行流程不易追踪</li></ul><h2 id="现代替代方案"><a href="#现代替代方案" class="headerlink" title="现代替代方案"></a>现代替代方案</h2><p>为了解决回调函数的一些问题，现代编程语言提供了更高级的异步编程模型：</p><ul><li><strong>Promise</strong>：JavaScript、Python 等语言中的 Promise 对象</li><li><strong>Async&#x2F;Await</strong>：更简洁的异步编程语法</li><li><strong>Future</strong>：Java、C++ 等语言中的 Future 类</li><li><strong>Coroutine</strong>：协程，比回调更优雅的异步处理方式</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>回调函数是一种强大的编程模式，它通过将函数作为参数传递，实现了代码的灵活性和解耦合。虽然在处理复杂异步操作时可能会遇到一些问题，但通过合理使用和结合现代编程模型，回调函数仍然是软件开发中不可或缺的工具。</p><p>不同编程语言实现回调函数的方式各有特色，但核心思想都是相同的：将函数的调用权交给其他代码，在适当的时候执行特定的逻辑。掌握回调函数的使用，对于理解和设计灵活的软件系统非常重要。</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> Python </tag>
            
            <tag> 回调函数 </tag>
            
            <tag> 函数指针 </tag>
            
            <tag> Java </tag>
            
            <tag> JavaScript </tag>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot3常用注解介绍</title>
      <link href="/2025/09/27/SpringBoot3%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3%E4%BB%8B%E7%BB%8D/"/>
      <url>/2025/09/27/SpringBoot3%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<p>SpringBoot作为Java生态中最流行的微服务框架，其强大的自动配置和快速开发能力很大程度上得益于各种注解的使用。本文将按照不同的使用场景，详细解析SpringBoot3中最常用的注解，帮助你在开发中更加熟练地运用这些工具。</p><h2 id="核心注解：框架基础与应用配置"><a href="#核心注解：框架基础与应用配置" class="headerlink" title="核心注解：框架基础与应用配置"></a>核心注解：框架基础与应用配置</h2><h3 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h3><p>这是SpringBoot应用的核心注解，通常标注在主类上，它是一个组合注解，包含了<code>@Configuration</code>、<code>@EnableAutoConfiguration</code>和<code>@ComponentScan</code>三个注解的功能。</p><p><strong>功能</strong>：标记一个主配置类，触发Spring Boot的自动配置机制并扫描组件。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(MyApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h3><p>用于定义配置类，替代传统的XML配置文件。</p><p><strong>功能</strong>：表明该类是一个配置类，其中包含一个或多个<code>@Bean</code>注解的方法，这些方法返回的对象会被注册到Spring容器中。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 配置并返回数据源</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HikariDataSource</span>(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="@EnableAutoConfiguration"></a>@EnableAutoConfiguration</h3><p>开启Spring Boot的自动配置功能。</p><p><strong>功能</strong>：让Spring Boot根据项目中依赖的jar包自动配置项目所需的组件。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoConfigApplication</span> &#123;</span><br><span class="line">    <span class="comment">// 应用代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ComponentScan"><a href="#ComponentScan" class="headerlink" title="@ComponentScan"></a>@ComponentScan</h3><p>指定Spring容器扫描组件的包路径。</p><p><strong>功能</strong>：扫描指定包及其子包中的带有<code>@Component</code>、<code>@Service</code>、<code>@Repository</code>、<code>@Controller</code>等注解的类，并将它们注册为Spring容器中的Bean。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.example.controller&quot;, &quot;com.example.service&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScanConfig</span> &#123;</span><br><span class="line">    <span class="comment">// 配置代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Bean"><a href="#Bean" class="headerlink" title="@Bean"></a>@Bean</h3><p>用于方法上，表示将该方法的返回值注册为Spring容器中的一个Bean。</p><p><strong>功能</strong>：在配置类中定义Bean，相当于XML配置中的<code>&lt;bean&gt;</code>标签。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean(name = &quot;customBean&quot;)</span></span><br><span class="line">    <span class="meta">@Scope(&quot;singleton&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> MyBean <span class="title function_">myBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyBean</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="组件层注解：分层架构的核心"><a href="#组件层注解：分层架构的核心" class="headerlink" title="组件层注解：分层架构的核心"></a>组件层注解：分层架构的核心</h2><h3 id="Component"><a href="#Component" class="headerlink" title="@Component"></a>@Component</h3><p>Spring框架中的通用组件注解，用于标识一个类为Spring管理的Bean。</p><p><strong>功能</strong>：将普通POJO类实例化到Spring容器中，是所有受Spring管理组件的通用形式。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonComponent</span> &#123;</span><br><span class="line">    <span class="comment">// 组件代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>它和<code>@Bean</code>很像，但<code>@Component</code>是一种作用在类上的注解，用于将类实例化到Spring容器中，为了方便和配置类中的<code>@Bean</code>作区分，所以这里使用的是<code>@Component</code>。同时使用场景也有所不同：</p><ol><li><code>@Component</code>：主要用于开发者自己编写的类 ，这些类位于被Spring组件扫描覆盖的包中，可以被自动检测和注册。</li><li><code>@Bean</code>：主要被用于：<br>a. 需要将第三方库中的类 注册为Bean（无法在第三方类上添加<code>@Component</code>注解）<br>b. 需要自定义Bean的创建逻辑 （如设置复杂属性、调用特定初始化方法等）<br>c. 需要根据条件动态创建不同类型的Bean</li></ol></blockquote><h3 id="Service"><a href="#Service" class="headerlink" title="@Service"></a>@Service</h3><p>标注在业务逻辑层（Service层）的类上，表示这是一个业务服务类。</p><p><strong>功能</strong>：标识一个类为业务逻辑层组件，继承自<code>@Component</code>，主要用于业务逻辑处理。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// 业务逻辑实现</span></span><br><span class="line">        <span class="keyword">return</span> userRepository.findById(id).orElse(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Repository"><a href="#Repository" class="headerlink" title="@Repository"></a>@Repository</h3><p>标注在数据访问层（DAO层）的类上，表示这是一个数据访问组件。</p><p><strong>功能</strong>：标识一个类为数据访问层组件，继承自<code>@Component</code>，同时还提供了异常转换功能。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUser</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// 数据访问逻辑</span></span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.queryForObject(<span class="string">&quot;SELECT * FROM users WHERE id = ?&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;id&#125;, userRowMapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Controller"><a href="#Controller" class="headerlink" title="@Controller"></a>@Controller</h3><p>标注在控制器类上，用于处理HTTP请求。</p><p><strong>功能</strong>：标识一个类为Spring MVC控制器，处理用户请求并返回视图或数据。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">listUsers</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;users&quot;</span>, userService.getAllUsers());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;user/list&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="RestController"><a href="#RestController" class="headerlink" title="@RestController"></a>@RestController</h3><p><code>@Controller</code>和<code>@ResponseBody</code>的组合注解，用于创建RESTful Web服务。</p><p><strong>功能</strong>：标识一个类为REST控制器，所有方法的返回值直接作为HTTP响应体，而不是视图名称。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRestController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getAllUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findAllUsers();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Web层注解：处理HTTP请求与响应"><a href="#Web层注解：处理HTTP请求与响应" class="headerlink" title="Web层注解：处理HTTP请求与响应"></a>Web层注解：处理HTTP请求与响应</h2><h3 id="RequestMapping"><a href="#RequestMapping" class="headerlink" title="@RequestMapping"></a>@RequestMapping</h3><p>用于映射Web请求到控制器方法。</p><p><strong>功能</strong>：指定控制器或方法处理的HTTP请求路径和请求方法。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/products&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(method = RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">getAllProducts</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> productService.findAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这一个注解的自定义能力比较强，可以自己定义该方法的访问方式，同时不同的方式也有其对应的简写，比如<code>@RequestMapping(method = RequestMethod.GET)</code>可以简写成<code>@GetMapping</code>，<code>@RequestMapping(method = RequestMethod.POST)</code>可以简写成<code>@PostMapping</code>，以此类推。</p></blockquote><h3 id="HTTP方法专用注解"><a href="#HTTP方法专用注解" class="headerlink" title="HTTP方法专用注解"></a>HTTP方法专用注解</h3><p>Spring提供了一系列HTTP方法专用的注解，简化了<code>@RequestMapping</code>的使用：</p><h4 id="GetMapping"><a href="#GetMapping" class="headerlink" title="@GetMapping"></a>@GetMapping</h4><p>处理HTTP GET请求，是<code>@RequestMapping(method = RequestMethod.GET)</code>的简写。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userService.findById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="PostMapping"><a href="#PostMapping" class="headerlink" title="@PostMapping"></a>@PostMapping</h4><p>处理HTTP POST请求，是<code>@RequestMapping(method = RequestMethod.POST)</code>的简写。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">createUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">savedUser</span> <span class="operator">=</span> userService.save(user);</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(savedUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="PutMapping"><a href="#PutMapping" class="headerlink" title="@PutMapping"></a>@PutMapping</h4><p>处理HTTP PUT请求，是<code>@RequestMapping(method = RequestMethod.PUT)</code>的简写。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">updateUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">    user.setId(id);</span><br><span class="line">    <span class="type">User</span> <span class="variable">updatedUser</span> <span class="operator">=</span> userService.update(user);</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(updatedUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="DeleteMapping"><a href="#DeleteMapping" class="headerlink" title="@DeleteMapping"></a>@DeleteMapping</h4><p>处理HTTP DELETE请求，是<code>@RequestMapping(method = RequestMethod.DELETE)</code>的简写。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    userService.deleteById(id);</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.noContent().build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="请求参数绑定注解"><a href="#请求参数绑定注解" class="headerlink" title="请求参数绑定注解"></a>请求参数绑定注解</h3><h4 id="PathVariable"><a href="#PathVariable" class="headerlink" title="@PathVariable"></a>@PathVariable</h4><p>用于<strong>绑定URL路径中的变量</strong>到方法参数。</p><p><strong>功能</strong>：从请求URL中提取参数值并绑定到方法参数上。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/users/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long userId)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userService.findById(userId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="RequestParam"><a href="#RequestParam" class="headerlink" title="@RequestParam"></a>@RequestParam</h4><p>用于<strong>绑定HTTP请求参数</strong>到方法参数。</p><p><strong>功能</strong>：从HTTP请求中提取查询参数值并绑定到方法参数上。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/products&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">getProducts</span><span class="params">(<span class="meta">@RequestParam(required = false)</span> String category,</span></span><br><span class="line"><span class="params">                                 <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> <span class="type">int</span> limit)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> productService.findByCategory(category, limit);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="RequestBody"><a href="#RequestBody" class="headerlink" title="@RequestBody"></a>@RequestBody</h4><p>用于<strong>绑定HTTP请求体</strong>到方法参数。</p><p><strong>功能</strong>：将HTTP请求体中的JSON或XML数据转换为Java对象。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">createUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">savedUser</span> <span class="operator">=</span> userService.save(user);</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED).body(savedUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="RequestHeader"><a href="#RequestHeader" class="headerlink" title="@RequestHeader"></a>@RequestHeader</h4><p>用于<strong>绑定HTTP请求头</strong>到方法参数。</p><p><strong>功能</strong>：从HTTP请求头中提取值并绑定到方法参数上。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/auth&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getAuthInfo</span><span class="params">(<span class="meta">@RequestHeader(&quot;Authorization&quot;)</span> String authorization)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Authorization header: &quot;</span> + authorization;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="响应处理注解"><a href="#响应处理注解" class="headerlink" title="响应处理注解"></a>响应处理注解</h3><h4 id="ResponseBody"><a href="#ResponseBody" class="headerlink" title="@ResponseBody"></a>@ResponseBody</h4><p>将方法返回值直接作为HTTP响应体返回，而不是视图名称。</p><p><strong>功能</strong>：在控制器方法上使用，表示该方法的返回值直接作为HTTP响应体。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/data&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; data = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        data.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ResponseStatus"><a href="#ResponseStatus" class="headerlink" title="@ResponseStatus"></a>@ResponseStatus</h4><p>指定方法返回的HTTP状态码。</p><p><strong>功能</strong>：设置HTTP响应的状态码。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/users/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ResponseStatus(HttpStatus.NO_CONTENT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    userService.deleteById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="数据访问层注解：数据库操作与事务管理"><a href="#数据访问层注解：数据库操作与事务管理" class="headerlink" title="数据访问层注解：数据库操作与事务管理"></a>数据访问层注解：数据库操作与事务管理</h2><h3 id="Transactional"><a href="#Transactional" class="headerlink" title="@Transactional"></a>@Transactional</h3><p>用于声明事务管理，可应用于类或方法。</p><p><strong>功能</strong>：指定方法或类中的所有方法在事务中执行，自动管理事务的提交和回滚。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">createOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="comment">// 事务操作</span></span><br><span class="line">        <span class="keyword">return</span> orderRepository.save(order);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Spring-Data-JPA注解"><a href="#Spring-Data-JPA注解" class="headerlink" title="Spring Data JPA注解"></a>Spring Data JPA注解</h3><h4 id="Entity"><a href="#Entity" class="headerlink" title="@Entity"></a>@Entity</h4><p>标注在实体类上，表示这是一个JPA实体，映射到数据库表。</p><p><strong>功能</strong>：将Java类映射到数据库表。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(nullable = false, unique = true)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 其他属性和方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="RepositoryRestResource"><a href="#RepositoryRestResource" class="headerlink" title="@RepositoryRestResource"></a>@RepositoryRestResource</h4><p>用于将Spring Data JPA仓库自动暴露为RESTful API。</p><p><strong>功能</strong>：简化RESTful API的开发，自动为JPA仓库创建CRUD端点。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RepositoryRestResource(path = &quot;users&quot;, collectionResourceRel = &quot;users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;User, Long&gt; &#123;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">findByLastName</span><span class="params">(String lastName)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="MyBatis注解"><a href="#MyBatis注解" class="headerlink" title="MyBatis注解"></a>MyBatis注解</h3><h4 id="Mapper"><a href="#Mapper" class="headerlink" title="@Mapper"></a>@Mapper</h4><p>用于标识MyBatis的Mapper接口。</p><p><strong>功能</strong>：标记一个接口为MyBatis的映射器，MyBatis会自动创建该接口的实现。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM users WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">findById</span><span class="params">(Long id)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Insert(&quot;INSERT INTO users(username, password) VALUES(#&#123;username&#125;, #&#123;password&#125;)&quot;)</span></span><br><span class="line">    <span class="meta">@Options(useGeneratedKeys = true, keyProperty = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="配置相关注解：自定义配置与属性绑定"><a href="#配置相关注解：自定义配置与属性绑定" class="headerlink" title="配置相关注解：自定义配置与属性绑定"></a>配置相关注解：自定义配置与属性绑定</h2><h3 id="Value"><a href="#Value" class="headerlink" title="@Value"></a>@Value</h3><p>用于注入配置文件中的属性值。</p><p><strong>功能</strong>：将配置文件中的属性值注入到Bean的字段中。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appName;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.version:1.0.0&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appVersion;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ConfigurationProperties"><a href="#ConfigurationProperties" class="headerlink" title="@ConfigurationProperties"></a>@ConfigurationProperties</h3><p>用于将配置文件中的属性批量绑定到Bean的字段中。</p><p><strong>功能</strong>：自动将具有相同前缀的配置属性绑定到Bean的属性上。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;app&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String version;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="keyword">private</span> Server server;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Getters and setters</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Server</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> String host;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Getters and setters</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置文件<code>application.yml</code>:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">app:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">MySpringBootApp</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2.0</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">A</span> <span class="string">Spring</span> <span class="string">Boot</span> <span class="string">application</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure><h3 id="EnableConfigurationProperties"><a href="#EnableConfigurationProperties" class="headerlink" title="@EnableConfigurationProperties"></a>@EnableConfigurationProperties</h3><p>用于启用<code>@ConfigurationProperties</code>注解的类。</p><p><strong>功能</strong>：让Spring Boot处理被<code>@ConfigurationProperties</code>注解的Bean。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(AppProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="comment">// 使用AppProperties</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Profile"><a href="#Profile" class="headerlink" title="@Profile"></a>@Profile</h3><p>用于指定配置类或Bean在特定的环境下生效。</p><p><strong>功能</strong>：根据当前激活的环境配置，选择性地创建Bean。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatabaseConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Profile(&quot;development&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">devDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 开发环境数据源配置</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmbeddedDatabaseBuilder</span>().build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Profile(&quot;production&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">prodDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 生产环境数据源配置</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HikariDataSource</span>(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Spring-Security注解：安全与认证授权"><a href="#Spring-Security注解：安全与认证授权" class="headerlink" title="Spring Security注解：安全与认证授权"></a>Spring Security注解：安全与认证授权</h2><h3 id="EnableWebSecurity"><a href="#EnableWebSecurity" class="headerlink" title="@EnableWebSecurity"></a>@EnableWebSecurity</h3><p>用于启用Spring Security的Web安全支持。</p><p><strong>功能</strong>：开启Spring Security的Web安全功能，并提供自定义安全配置的入口。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSecurityConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">filterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">            .authorizeHttpRequests(authorize -&gt; authorize</span><br><span class="line">                .requestMatchers(<span class="string">&quot;/public/**&quot;</span>).permitAll()</span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">            )</span><br><span class="line">            .formLogin(withDefaults());</span><br><span class="line">        <span class="keyword">return</span> http.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="PreAuthorize-PostAuthorize"><a href="#PreAuthorize-PostAuthorize" class="headerlink" title="@PreAuthorize, @PostAuthorize"></a>@PreAuthorize, @PostAuthorize</h3><p>用于方法级别的权限控制。</p><p><strong>功能</strong>：在方法执行前（<code>@PreAuthorize</code>）或执行后（<code>@PostAuthorize</code>）进行权限检查。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasRole(&#x27;ADMIN&#x27;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        userRepository.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostAuthorize(&quot;returnObject.owner == authentication.name&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.findById(id).orElse(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Secured"><a href="#Secured" class="headerlink" title="@Secured"></a>@Secured</h3><p>用于方法级别的安全访问控制，指定访问方法所需的角色。</p><p><strong>功能</strong>：限制只有特定角色的用户才能访问标注的方法。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminService</span> &#123;</span><br><span class="line">    <span class="meta">@Secured(&#123;&quot;ROLE_ADMIN&quot;, &quot;ROLE_SUPERADMIN&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">performAdminTask</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 管理员任务逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="条件注解：条件化Bean注册"><a href="#条件注解：条件化Bean注册" class="headerlink" title="条件注解：条件化Bean注册"></a>条件注解：条件化Bean注册</h2><h3 id="ConditionalOnProperty"><a href="#ConditionalOnProperty" class="headerlink" title="@ConditionalOnProperty"></a>@ConditionalOnProperty</h3><p>根据配置属性的存在和值来决定是否注册Bean。</p><p><strong>功能</strong>：当配置文件中存在特定属性且值匹配时，才注册Bean。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeatureConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnProperty(name = &quot;feature.enabled&quot;, havingValue = &quot;true&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> FeatureService <span class="title function_">featureService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FeatureServiceImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ConditionalOnBean-ConditionalOnMissingBean"><a href="#ConditionalOnBean-ConditionalOnMissingBean" class="headerlink" title="@ConditionalOnBean, @ConditionalOnMissingBean"></a>@ConditionalOnBean, @ConditionalOnMissingBean</h3><p>根据容器中是否存在指定的Bean来决定是否注册Bean。</p><p><strong>功能</strong>：<code>@ConditionalOnBean</code>在容器中存在指定Bean时注册Bean；<code>@ConditionalOnMissingBean</code>在容器中不存在指定Bean时注册Bean。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(DataSource.class)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">defaultDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 默认数据源配置</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmbeddedDatabaseBuilder</span>().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ConditionalOnClass-ConditionalOnMissingClass"><a href="#ConditionalOnClass-ConditionalOnMissingClass" class="headerlink" title="@ConditionalOnClass, @ConditionalOnMissingClass"></a>@ConditionalOnClass, @ConditionalOnMissingClass</h3><p>根据类路径中是否存在指定的类来决定是否注册Bean。</p><p><strong>功能</strong>：<code>@ConditionalOnClass</code>在类路径中存在指定类时注册Bean；<code>@ConditionalOnMissingClass</code>在类路径中不存在指定类时注册Bean。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OptionalFeatureConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnClass(name = &quot;com.example.OptionalLibrary&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> OptionalFeature <span class="title function_">optionalFeature</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OptionalFeatureImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="事件与异步处理注解"><a href="#事件与异步处理注解" class="headerlink" title="事件与异步处理注解"></a>事件与异步处理注解</h2><h3 id="EventListener"><a href="#EventListener" class="headerlink" title="@EventListener"></a>@EventListener</h3><p>用于监听Spring事件。</p><p><strong>功能</strong>：标记一个方法为事件监听器，当容器中发布特定事件时，该方法会被调用。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserEventListener</span> &#123;</span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleUserCreatedEvent</span><span class="params">(UserCreatedEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// 处理用户创建事件</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> event.getUser();</span><br><span class="line">        <span class="comment">// 发送欢迎邮件等操作</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Async"><a href="#Async" class="headerlink" title="@Async"></a>@Async</h3><p>用于标记方法为异步方法。</p><p><strong>功能</strong>：使方法在独立的线程中执行，不阻塞调用线程。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailService</span> &#123;</span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;Boolean&gt; <span class="title function_">sendEmail</span><span class="params">(String to, String subject, String content)</span> &#123;</span><br><span class="line">        <span class="comment">// 发送邮件的逻辑</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">return</span> CompletableFuture.completedFuture(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用异步功能</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsyncConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Executor <span class="title function_">taskExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ThreadPoolTaskExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolTaskExecutor</span>();</span><br><span class="line">        executor.setCorePoolSize(<span class="number">5</span>);</span><br><span class="line">        executor.setMaxPoolSize(<span class="number">10</span>);</span><br><span class="line">        executor.setQueueCapacity(<span class="number">500</span>);</span><br><span class="line">        executor.setThreadNamePrefix(<span class="string">&quot;Async-&quot;</span>);</span><br><span class="line">        executor.initialize();</span><br><span class="line">        <span class="keyword">return</span> executor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="测试相关注解"><a href="#测试相关注解" class="headerlink" title="测试相关注解"></a>测试相关注解</h2><h3 id="SpringBootTest"><a href="#SpringBootTest" class="headerlink" title="@SpringBootTest"></a>@SpringBootTest</h3><p>用于Spring Boot应用的集成测试。</p><p><strong>功能</strong>：加载完整的Spring应用上下文，用于集成测试。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceIntegrationTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">whenFindById_thenReturnUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 测试逻辑</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.findById(<span class="number">1L</span>);</span><br><span class="line">        assertNotNull(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="MockBean"><a href="#MockBean" class="headerlink" title="@MockBean"></a>@MockBean</h3><p>用于在测试中替换Spring容器中的Bean为Mockito mock对象。</p><p><strong>功能</strong>：创建一个Mock对象并注入到Spring应用上下文中，用于单元测试。</p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserControllerTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserController userController;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@MockBean</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">whenGetUserById_thenReturnUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 配置mock行为</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">mockUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        mockUser.setId(<span class="number">1L</span>);</span><br><span class="line">        mockUser.setUsername(<span class="string">&quot;testuser&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">when</span>(userService.findById(<span class="number">1L</span>)).thenReturn(mockUser);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 执行测试</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">result</span> <span class="operator">=</span> userController.getUserById(<span class="number">1L</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证结果</span></span><br><span class="line">        assertEquals(<span class="string">&quot;testuser&quot;</span>, result.getUsername());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文按照不同的使用场景，为您详细介绍了SpringBoot3中最常用的注解。从核心配置到Web层处理，从数据访问到安全控制，这些注解构成了SpringBoot开发的基础。</p><p>熟练掌握这些注解的使用，可以帮助您更高效地开发SpringBoot应用，编写出更加简洁、优雅的代码。当然，SpringBoot的注解体系非常丰富，本文只是介绍了最常用的部分，更多的注解和用法还需要在实际开发中不断探索和学习。</p>]]></content>
      
      
      
        <tags>
            
            <tag> SpringBoot, Java, 注解 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python包与模块</title>
      <link href="/2025/09/17/Python%E5%8C%85%E4%B8%8E%E6%A8%A1%E5%9D%97%E8%AF%A6%E8%A7%A3%EF%BC%9A%E7%BB%84%E7%BB%87%E4%BB%A3%E7%A0%81%E7%9A%84%E8%89%BA%E6%9C%AF/"/>
      <url>/2025/09/17/Python%E5%8C%85%E4%B8%8E%E6%A8%A1%E5%9D%97%E8%AF%A6%E8%A7%A3%EF%BC%9A%E7%BB%84%E7%BB%87%E4%BB%A3%E7%A0%81%E7%9A%84%E8%89%BA%E6%9C%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="Python包与模块详解：组织代码的艺术"><a href="#Python包与模块详解：组织代码的艺术" class="headerlink" title="Python包与模块详解：组织代码的艺术"></a>Python包与模块详解：组织代码的艺术</h1><p>在Python编程中，随着代码量的增加，合理组织代码变得至关重要。Python通过包（Package）和模块（Module）提供了良好的代码组织机制，使代码更加模块化、可维护和可重用。本文将深入探讨Python包与模块的概念、使用方法以及最佳实践。</p><h2 id="模块（Module）：Python代码的基本组织单元"><a href="#模块（Module）：Python代码的基本组织单元" class="headerlink" title="模块（Module）：Python代码的基本组织单元"></a>模块（Module）：Python代码的基本组织单元</h2><h3 id="模块的概念"><a href="#模块的概念" class="headerlink" title="模块的概念"></a>模块的概念</h3><p>模块是一个包含Python定义和语句的文件，文件名就是模块名加上<code>.py</code>后缀。模块可以定义函数、类和变量，也可以包含可执行的代码。使用模块的主要目的是：</p><ul><li>代码重用：编写一次，可以在多个程序中使用</li><li>逻辑分组：将相关的代码组织在一起，提高可读性和可维护性</li><li>避免命名冲突：不同模块中的相同名称不会相互干扰</li></ul><h3 id="模块的创建"><a href="#模块的创建" class="headerlink" title="模块的创建"></a>模块的创建</h3><p>创建一个模块非常简单，只需要创建一个以<code>.py</code>为后缀的文件，并在其中编写Python代码即可。例如，创建一个名为<code>my_module.py</code>的文件：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># my_module.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义变量</span></span><br><span class="line">PI = <span class="number">3.14159</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">greet</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;打印问候信息&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;Hello, <span class="subst">&#123;name&#125;</span>!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Calculator</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;简单的计算器类&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, a, b</span>):</span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">subtract</span>(<span class="params">self, a, b</span>):</span><br><span class="line">        <span class="keyword">return</span> a - b</span><br></pre></td></tr></table></figure><h3 id="模块的导入与使用"><a href="#模块的导入与使用" class="headerlink" title="模块的导入与使用"></a>模块的导入与使用</h3><p>Python提供了多种导入模块的方式，每种方式适用于不同的场景：</p><h4 id="导入与使用"><a href="#导入与使用" class="headerlink" title="导入与使用"></a>导入与使用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入整个模块</span></span><br><span class="line"><span class="keyword">import</span> my_module</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用模块中的变量</span></span><br><span class="line"><span class="built_in">print</span>(my_module.PI)  <span class="comment"># 输出: 3.14159</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用模块中的函数</span></span><br><span class="line"><span class="built_in">print</span>(my_module.greet(<span class="string">&quot;Python&quot;</span>))  <span class="comment"># 输出: Hello, Python!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用模块中的类</span></span><br><span class="line">calc = my_module.Calculator()</span><br><span class="line"><span class="built_in">print</span>(calc.add(<span class="number">5</span>, <span class="number">3</span>))  <span class="comment"># 输出: 8</span></span><br></pre></td></tr></table></figure><h4 id="导入模块中的特定内容"><a href="#导入模块中的特定内容" class="headerlink" title="导入模块中的特定内容"></a>导入模块中的特定内容</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入模块中的特定内容</span></span><br><span class="line"><span class="keyword">from</span> my_module <span class="keyword">import</span> PI, greet</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接使用导入的内容，不需要模块名前缀</span></span><br><span class="line"><span class="built_in">print</span>(PI)  <span class="comment"># 输出: 3.14159</span></span><br><span class="line"><span class="built_in">print</span>(greet(<span class="string">&quot;Python&quot;</span>))  <span class="comment"># 输出: Hello, Python!</span></span><br></pre></td></tr></table></figure><h4 id="导入模块中的所有内容（不推荐）"><a href="#导入模块中的所有内容（不推荐）" class="headerlink" title="导入模块中的所有内容（不推荐）"></a>导入模块中的所有内容（不推荐）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入模块中的所有内容</span></span><br><span class="line"><span class="keyword">from</span> my_module <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接使用所有内容</span></span><br><span class="line"><span class="built_in">print</span>(PI)  <span class="comment"># 输出: 3.14159</span></span><br><span class="line"><span class="built_in">print</span>(greet(<span class="string">&quot;Python&quot;</span>))  <span class="comment"># 输出: Hello, Python!</span></span><br><span class="line">calc = Calculator()</span><br><span class="line"><span class="built_in">print</span>(calc.add(<span class="number">5</span>, <span class="number">3</span>))  <span class="comment"># 输出: 8</span></span><br></pre></td></tr></table></figure><p><strong>注意</strong>：使用<code>from module import *</code>可能会导致命名冲突，除非你非常确定不会发生冲突，否则一般不推荐使用这种方式。</p><h4 id="导入模块并使用别名"><a href="#导入模块并使用别名" class="headerlink" title="导入模块并使用别名"></a>导入模块并使用别名</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入模块并使用别名</span></span><br><span class="line"><span class="keyword">import</span> my_module <span class="keyword">as</span> mm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用别名访问模块内容</span></span><br><span class="line"><span class="built_in">print</span>(mm.PI)  <span class="comment"># 输出: 3.14159</span></span><br><span class="line"><span class="built_in">print</span>(mm.greet(<span class="string">&quot;Python&quot;</span>))  <span class="comment"># 输出: Hello, Python!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入特定内容并使用别名</span></span><br><span class="line"><span class="keyword">from</span> my_module <span class="keyword">import</span> Calculator <span class="keyword">as</span> Calc</span><br><span class="line"></span><br><span class="line">calc = Calc()</span><br><span class="line"><span class="built_in">print</span>(calc.add(<span class="number">5</span>, <span class="number">3</span>))  <span class="comment"># 输出: 8</span></span><br></pre></td></tr></table></figure><h2 id="包（Package）：模块的组织层次"><a href="#包（Package）：模块的组织层次" class="headerlink" title="包（Package）：模块的组织层次"></a>包（Package）：模块的组织层次</h2><h3 id="包的概念"><a href="#包的概念" class="headerlink" title="包的概念"></a>包的概念</h3><p>包是一种通过使用”点模块名”来组织Python模块名称空间的方式。在物理上，包就是一个包含<code>__init__.py</code>文件的目录；在逻辑上，包是一组相关模块的集合。包的主要目的是：</p><ul><li>将<strong>相关模块组织在一起，形成命名空间</strong></li><li>避免模块名称冲突</li><li>支持模块的层次结构，便于大型项目的管理</li></ul><h3 id="包的结构"><a href="#包的结构" class="headerlink" title="包的结构"></a>包的结构</h3><p>一个典型的包结构如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">my_package/</span><br><span class="line">├── __init__.py</span><br><span class="line">├── module1.py</span><br><span class="line">├── module2.py</span><br><span class="line">└── subpackage/</span><br><span class="line">    ├── __init__.py</span><br><span class="line">    └── module3.py</span><br></pre></td></tr></table></figure><p>其中，<code>__init__.py</code>文件是一个空文件或包含包初始化代码的文件，它的存在表明该目录是一个Python包。在Python 3.3及以上版本中，<code>__init__.py</code>文件是可选的，但为了保持向后兼容性和明确性，通常建议保留该文件。</p><h3 id="包的创建"><a href="#包的创建" class="headerlink" title="包的创建"></a>包的创建</h3><p>创建一个包需要以下步骤：</p><ol><li>创建一个目录作为包的根目录</li><li>在该目录中创建<code>__init__.py</code>文件</li><li>在该目录中创建所需的模块文件或子包</li></ol><p>例如，创建一个名为<code>my_package</code>的包：</p><ol><li>创建<code>my_package</code>目录</li><li>在<code>my_package</code>目录中创建<code>__init__.py</code>文件（可以是空文件）</li><li>在<code>my_package</code>目录中创建<code>module1.py</code>和<code>module2.py</code>文件</li><li>创建<code>my_package/subpackage</code>目录和其中的<code>__init__.py</code>和<code>module3.py</code>文件</li></ol><h3 id="包的导入与使用"><a href="#包的导入与使用" class="headerlink" title="包的导入与使用"></a>包的导入与使用</h3><p>与模块类似，Python也提供了多种导入包的方式：</p><h4 id="导入包中的模块"><a href="#导入包中的模块" class="headerlink" title="导入包中的模块"></a>导入包中的模块</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入包中的模块</span></span><br><span class="line"><span class="keyword">import</span> my_package.module1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用模块中的内容</span></span><br><span class="line"><span class="built_in">print</span>(my_package.module1.function1())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入模块并使用别名</span></span><br><span class="line"><span class="keyword">import</span> my_package.module1 <span class="keyword">as</span> m1</span><br><span class="line"><span class="built_in">print</span>(m1.function1())</span><br></pre></td></tr></table></figure><h4 id="从包中导入模块"><a href="#从包中导入模块" class="headerlink" title="从包中导入模块"></a>从包中导入模块</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从包中导入模块</span></span><br><span class="line"><span class="keyword">from</span> my_package <span class="keyword">import</span> module2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用模块中的内容</span></span><br><span class="line"><span class="built_in">print</span>(module2.function2())</span><br></pre></td></tr></table></figure><h4 id="从包中的模块导入特定内容"><a href="#从包中的模块导入特定内容" class="headerlink" title="从包中的模块导入特定内容"></a>从包中的模块导入特定内容</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从包中的模块导入特定内容</span></span><br><span class="line"><span class="keyword">from</span> my_package.module1 <span class="keyword">import</span> function1, Class1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接使用导入的内容</span></span><br><span class="line"><span class="built_in">print</span>(function1())</span><br><span class="line">obj = Class1()</span><br><span class="line"><span class="built_in">print</span>(obj.method1())</span><br></pre></td></tr></table></figure><h4 id="导入子包中的模块"><a href="#导入子包中的模块" class="headerlink" title="导入子包中的模块"></a>导入子包中的模块</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入子包中的模块</span></span><br><span class="line"><span class="keyword">from</span> my_package.subpackage <span class="keyword">import</span> module3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line"><span class="keyword">import</span> my_package.subpackage.module3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用模块中的内容</span></span><br><span class="line"><span class="built_in">print</span>(module3.function3())</span><br></pre></td></tr></table></figure><h3 id="init-py文件的作用"><a href="#init-py文件的作用" class="headerlink" title="__init__.py文件的作用"></a><code>__init__.py</code>文件的作用</h3><p><code>__init__.py</code>文件在包的导入过程中扮演着重要角色：</p><ol><li>标识目录为Python包</li><li>可以在导入包时执行一些初始化代码</li><li>可以定义包级别的变量和函数</li><li>可以通过<code>__all__</code>列表控制<code>from package import *</code>导入的内容</li></ol><p>例如，可以在<code>my_package/__init__.py</code>中添加以下代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># my_package/__init__.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 包级别的变量</span></span><br><span class="line">__version__ = <span class="string">&quot;1.0.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 控制 from my_package import * 导入的内容</span></span><br><span class="line">__all__ = [<span class="string">&quot;module1&quot;</span>, <span class="string">&quot;module2&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在导入包时执行的初始化代码</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Initializing my_package...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入模块中的内容，使其在包级别可用</span></span><br><span class="line"><span class="keyword">from</span> .module1 <span class="keyword">import</span> function1</span><br><span class="line"><span class="keyword">from</span> .module2 <span class="keyword">import</span> Class2</span><br></pre></td></tr></table></figure><p>这样，当导入<code>my_package</code>时，就可以直接访问<code>function1</code>和<code>Class2</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> my_package</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(my_package.__version__)  <span class="comment"># 输出: 1.0.0</span></span><br><span class="line"><span class="built_in">print</span>(my_package.function1())  <span class="comment"># 直接使用从module1导入的function1</span></span><br><span class="line">obj = my_package.Class2()  <span class="comment"># 直接使用从module2导入的Class2</span></span><br></pre></td></tr></table></figure><h2 id="模块搜索路径"><a href="#模块搜索路径" class="headerlink" title="模块搜索路径"></a>模块搜索路径</h2><p>模块搜索路径是Python中一个非常重要但常被忽略的概念，理解它可以帮助你解决绝大多数导入错误问题。当你执行<code>import module_name</code>时，Python解释器需要知道去哪里寻找这个模块，这就涉及到模块搜索路径机制。</p><h3 id="Python的模块搜索顺序"><a href="#Python的模块搜索顺序" class="headerlink" title="Python的模块搜索顺序"></a>Python的模块搜索顺序</h3><p>当你导入一个模块时，Python会按照以下顺序在<code>sys.path</code>列表中的目录里查找模块文件：</p><ol><li><strong>当前执行脚本所在的目录</strong>：这是Python搜索的第一个位置，也是最常见的导入成功或失败的原因</li><li><strong>PYTHONPATH环境变量中列出的目录</strong>：这是一个用户可配置的环境变量，可以包含多个目录路径</li><li><strong>标准库目录</strong>：包含Python内置的标准库模块</li><li><strong>任何.pth文件中列出的目录</strong>：这些是Python安装目录下的特殊配置文件，每行一个目录路径</li><li><strong>第三方库安装目录</strong>：通常是<code>site-packages</code>目录，用于存放通过pip安装的第三方库</li></ol><h3 id="查看当前的搜索路径"><a href="#查看当前的搜索路径" class="headerlink" title="查看当前的搜索路径"></a>查看当前的搜索路径</h3><p>你可以通过以下代码查看当前Python解释器使用的完整搜索路径列表：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># 打印所有搜索路径</span></span><br><span class="line">sys.path</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按顺序打印每个搜索路径</span></span><br><span class="line"><span class="keyword">for</span> path <span class="keyword">in</span> sys.path:</span><br><span class="line">    <span class="built_in">print</span>(path)</span><br></pre></td></tr></table></figure><p>执行这段代码可以帮助你确认你的模块所在目录是否在搜索路径中，这是排查导入错误的第一步。</p><h3 id="添加自定义目录到搜索路径"><a href="#添加自定义目录到搜索路径" class="headerlink" title="添加自定义目录到搜索路径"></a>添加自定义目录到搜索路径</h3><p>如果你的模块不在默认搜索路径中，可以通过以下几种方法将其添加到搜索路径：</p><h4 id="临时添加（运行时）"><a href="#临时添加（运行时）" class="headerlink" title="临时添加（运行时）"></a>临时添加（运行时）</h4><p>这是最常用的方法，只在当前Python会话中有效：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># 添加自定义目录到搜索路径末尾</span></span><br><span class="line">sys.path.append(<span class="string">&quot;/path/to/your/directory&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者添加到搜索路径开头（优先搜索）</span></span><br><span class="line">sys.path.insert(<span class="number">0</span>, <span class="string">&quot;/path/to/your/directory&quot;</span>)</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：使用<code>append()</code>会将目录添加到搜索路径的末尾，而使用<code>insert(0, ...)</code>会添加到开头，使其成为优先搜索的位置。</p><h4 id="设置PYTHONPATH环境变量"><a href="#设置PYTHONPATH环境变量" class="headerlink" title="设置PYTHONPATH环境变量"></a>设置PYTHONPATH环境变量</h4><p>这是一种持久化的方法，适用于需要在<strong>多个项目中使用同一组模块</strong>的情况：</p><p><strong>Windows系统</strong>：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 临时设置（当前命令行会话）</span><br><span class="line"><span class="built_in">set</span> PYTHONPATH=C:\<span class="built_in">path</span>\to\your\directory;<span class="variable">%PYTHONPATH%</span></span><br><span class="line"></span><br><span class="line"># 永久设置（通过系统属性）</span><br><span class="line"># <span class="number">1</span>. 右键&quot;此电脑&quot; &gt; &quot;属性&quot; &gt; &quot;高级系统设置&quot; &gt; &quot;环境变量&quot;</span><br><span class="line"># <span class="number">2</span>. 在&quot;系统变量&quot;中点击&quot;新建&quot;，设置变量名为PYTHONPATH，变量值为你的目录路径</span><br></pre></td></tr></table></figure><p><strong>Linux&#x2F;Mac系统</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 临时设置（当前终端会话）</span></span><br><span class="line"><span class="built_in">export</span> PYTHONPATH=/path/to/your/directory:<span class="variable">$PYTHONPATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 永久设置（添加到~/.bashrc或~/.bash_profile）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export PYTHONPATH=/path/to/your/directory:$PYTHONPATH&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><h4 id="使用-pth文件"><a href="#使用-pth文件" class="headerlink" title="使用.pth文件"></a>使用.pth文件</h4><p>这是另一种<strong>持久化方法</strong>，特别适合<strong>需要为所有Python项目添加搜索路径</strong>的情况：</p><ol><li>找到Python安装目录下的<code>site-packages</code>文件夹</li><li>在该文件夹中创建一个扩展名为<code>.pth</code>的文本文件</li><li>在文件中添加一行或多行目录路径（每行一个路径）</li></ol><p>例如，创建一个<code>my_packages.pth</code>文件，内容如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/path/to/your/directory1</span><br><span class="line">/path/to/your/directory2</span><br></pre></td></tr></table></figure><h3 id="常见导入错误及解决方案"><a href="#常见导入错误及解决方案" class="headerlink" title="常见导入错误及解决方案"></a>常见导入错误及解决方案</h3><p>以下是一些常见的导入错误及其解决方法：</p><h4 id="ModuleNotFoundError-No-module-named-‘module-name’"><a href="#ModuleNotFoundError-No-module-named-‘module-name’" class="headerlink" title="ModuleNotFoundError: No module named ‘module_name’"></a>ModuleNotFoundError: No module named ‘module_name’</h4><p><strong>错误原因</strong>：Python解释器在搜索路径中找不到指定的模块。</p><p><strong>解决方案</strong>：</p><ul><li>确认模块名称拼写正确</li><li>确认模块所在目录在<code>sys.path</code>中</li><li>确认安装了所需的第三方模块（使用<code>pip install module_name</code>）</li><li>检查是否存在命名冲突（例如，你的脚本名称与要导入的模块名称相同）</li></ul><h4 id="ImportError-attempted-relative-import-with-no-known-parent-package"><a href="#ImportError-attempted-relative-import-with-no-known-parent-package" class="headerlink" title="ImportError: attempted relative import with no known parent package"></a>ImportError: attempted relative import with no known parent package</h4><p><strong>错误原因</strong>：在直接运行的脚本中使用了相对导入（如<code>from . import module</code>）。</p><p><strong>解决方案</strong>：</p><ul><li>将脚本作为包的一部分运行（使用<code>-m</code>选项）：<code>python -m package.module</code></li><li>将相对导入改为绝对导入</li><li>在脚本开头添加代码将当前目录添加到搜索路径</li></ul><h4 id="导入成功但无法访问模块内容"><a href="#导入成功但无法访问模块内容" class="headerlink" title="导入成功但无法访问模块内容"></a>导入成功但无法访问模块内容</h4><p><strong>错误原因</strong>：可能是模块导入了，但其中的某些属性或函数不存在或名称错误。</p><p><strong>解决方案</strong>：</p><ul><li>检查模块中是否确实定义了你尝试访问的属性或函数</li><li>检查导入语句是否正确（例如，是否使用了正确的导入方式）</li></ul><h3 id="相对导入与绝对导入"><a href="#相对导入与绝对导入" class="headerlink" title="相对导入与绝对导入"></a>相对导入与绝对导入</h3><p>在包内部导入模块时，Python支持两种导入方式：</p><h4 id="绝对导入"><a href="#绝对导入" class="headerlink" title="绝对导入"></a>绝对导入</h4><p>使用完整的包路径导入模块：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从my_package包中导入module1模块</span></span><br><span class="line"><span class="keyword">from</span> my_package <span class="keyword">import</span> module1</span><br><span class="line"><span class="comment"># 从my_package.subpackage包中导入module3模块</span></span><br><span class="line"><span class="keyword">from</span> my_package.subpackage <span class="keyword">import</span> module3</span><br></pre></td></tr></table></figure><h4 id="相对导入"><a href="#相对导入" class="headerlink" title="相对导入"></a>相对导入</h4><p>使用点号（<code>.</code>）表示当前包，双点号（<code>..</code>）表示父包：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从当前包中导入module1模块</span></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> module1</span><br><span class="line"><span class="comment"># 从当前包的子包中导入module3模块</span></span><br><span class="line"><span class="keyword">from</span> .subpackage <span class="keyword">import</span> module3</span><br><span class="line"><span class="comment"># 从父包中导入module2模块</span></span><br><span class="line"><span class="keyword">from</span> .. <span class="keyword">import</span> module2</span><br><span class="line"><span class="comment"># 从父包的另一个子包中导入module4模块</span></span><br><span class="line"><span class="keyword">from</span> ..other_subpackage <span class="keyword">import</span> module4</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：相对导入只<strong>能在作为包一部分运行的模块中使用</strong>，不能在直接执行的脚本中使用。</p><h3 id="虚拟环境与模块搜索路径"><a href="#虚拟环境与模块搜索路径" class="headerlink" title="虚拟环境与模块搜索路径"></a>虚拟环境与模块搜索路径</h3><p>虚拟环境是一种隔离Python环境的机制，它会修改模块搜索路径，使每个虚拟环境都有自己独立的第三方库目录。这对于避免不同项目之间的依赖冲突非常有用。</p><p>当你激活一个虚拟环境时：</p><ol><li>Python解释器会优先使用虚拟环境中的Python版本</li><li>模块搜索路径会被修改，优先搜索虚拟环境的<code>site-packages</code>目录</li><li><code>pip</code>命令会安装包到虚拟环境的<code>site-packages</code>目录中</li></ol><p>通过理解和掌握Python的模块搜索路径机制，你将能够更加灵活地组织和管理你的代码，避免常见的导入错误，提高开发效率。</p><h2 id="模块和包的区别"><a href="#模块和包的区别" class="headerlink" title="模块和包的区别"></a>模块和包的区别</h2><p>虽然模块和包都是Python中组织代码的方式，但它们之间有一些重要的区别：</p><table><thead><tr><th>特性</th><th>模块</th><th>包</th></tr></thead><tbody><tr><td>物理形式</td><td>单个<code>.py</code>文件</td><td>包含<code>__init__.py</code>的目录</td></tr><tr><td>逻辑形式</td><td>代码的基本组织单元</td><td>相关模块的集合</td></tr><tr><td>导入方式</td><td><code>import module</code></td><td><code>import package.module</code> 或 <code>from package import module</code></td></tr><tr><td>主要用途</td><td>封装函数、类和变量</td><td>组织和分组相关模块</td></tr><tr><td>命名空间</td><td>单一命名空间</td><td>层次化命名空间</td></tr></tbody></table><h2 id="使用第三方模块"><a href="#使用第三方模块" class="headerlink" title="使用第三方模块"></a>使用第三方模块</h2><p>Python拥有丰富的第三方模块生态系统，使用这些模块可以极大地提高开发效率。以下是使用第三方模块的基本步骤：</p><h3 id="使用pip安装第三方模块"><a href="#使用pip安装第三方模块" class="headerlink" title="使用pip安装第三方模块"></a>使用pip安装第三方模块</h3><p><code>pip</code>是Python的包管理工具，用于安装和管理第三方模块。你可以使用以下命令安装第三方模块：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装特定模块</span></span><br><span class="line">pip install module_name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装特定版本的模块</span></span><br><span class="line">pip install module_name==x.y.z</span><br><span class="line"></span><br><span class="line"><span class="comment"># 升级模块</span></span><br><span class="line">pip install --upgrade module_name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载模块</span></span><br><span class="line">pip uninstall module_name</span><br></pre></td></tr></table></figure><h3 id="导入和使用第三方模块"><a href="#导入和使用第三方模块" class="headerlink" title="导入和使用第三方模块"></a>导入和使用第三方模块</h3><p>安装完成后，你可以像使用标准库模块一样导入和使用第三方模块：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入并使用第三方模块</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&quot;https://www.python.org&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(response.status_code)  <span class="comment"># 输出: 200 (表示请求成功)</span></span><br></pre></td></tr></table></figure><h3 id="管理项目依赖"><a href="#管理项目依赖" class="headerlink" title="管理项目依赖"></a>管理项目依赖</h3><p>在开发项目时，通常需要管理多个依赖项。你可以使用<code>requirements.txt</code>文件记录项目依赖：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成requirements.txt文件</span></span><br><span class="line">pip freeze &gt; requirements.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装requirements.txt中的所有依赖</span></span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure><p><code>requirements.txt</code>文件的内容通常如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">requests==2.28.1</span><br><span class="line">numpy==1.23.4</span><br><span class="line">pandas==1.5.1</span><br></pre></td></tr></table></figure><h2 id="发布自己的包"><a href="#发布自己的包" class="headerlink" title="发布自己的包"></a>发布自己的包</h2><p>如果你创建了一个有用的包，想要分享给其他开发者使用，可以按照以下步骤将其发布到Python Package Index (PyPI)：</p><h3 id="准备发布环境"><a href="#准备发布环境" class="headerlink" title="准备发布环境"></a>准备发布环境</h3><p>首先，你需要安装必要的工具：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install setuptools wheel twine</span><br></pre></td></tr></table></figure><h3 id="创建项目结构"><a href="#创建项目结构" class="headerlink" title="创建项目结构"></a>创建项目结构</h3><p>一个典型的可发布包的结构如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">my_package/</span><br><span class="line">├── my_package/</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── module1.py</span><br><span class="line">│   └── module2.py</span><br><span class="line">├── setup.py</span><br><span class="line">├── README.md</span><br><span class="line">├── LICENSE</span><br><span class="line">└── tests/</span><br></pre></td></tr></table></figure><h3 id="创建setup-py文件"><a href="#创建setup-py文件" class="headerlink" title="创建setup.py文件"></a>创建setup.py文件</h3><p><code>setup.py</code>是包的配置文件，用于定义包的元数据和依赖项：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># setup.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> setuptools <span class="keyword">import</span> setup, find_packages</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;README.md&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> fh:</span><br><span class="line">    long_description = fh.read()</span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    name=<span class="string">&quot;my_package&quot;</span>,  <span class="comment"># 包的名称，必须唯一</span></span><br><span class="line">    version=<span class="string">&quot;0.1.0&quot;</span>,  <span class="comment"># 版本号</span></span><br><span class="line">    author=<span class="string">&quot;Your Name&quot;</span>,  <span class="comment"># 作者</span></span><br><span class="line">    author_email=<span class="string">&quot;your.email@example.com&quot;</span>,  <span class="comment"># 作者邮箱</span></span><br><span class="line">    description=<span class="string">&quot;A brief description of your package&quot;</span>,  <span class="comment"># 简短描述</span></span><br><span class="line">    long_description=long_description,  <span class="comment"># 详细描述</span></span><br><span class="line">    long_description_content_type=<span class="string">&quot;text/markdown&quot;</span>,  <span class="comment"># 详细描述格式</span></span><br><span class="line">    url=<span class="string">&quot;https://github.com/your_username/my_package&quot;</span>,  <span class="comment"># 项目URL</span></span><br><span class="line">    packages=find_packages(),  <span class="comment"># 自动发现所有包</span></span><br><span class="line">    classifiers=[  <span class="comment"># 包的分类标签</span></span><br><span class="line">        <span class="string">&quot;Programming Language :: Python :: 3&quot;</span>,</span><br><span class="line">        <span class="string">&quot;License :: OSI Approved :: MIT License&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Operating System :: OS Independent&quot;</span>,</span><br><span class="line">    ],</span><br><span class="line">    python_requires=<span class="string">&#x27;&gt;=3.6&#x27;</span>,  <span class="comment"># 所需的Python版本</span></span><br><span class="line">    install_requires=[  <span class="comment"># 依赖项</span></span><br><span class="line">        <span class="comment"># &quot;requests&gt;=2.28.0&quot;,</span></span><br><span class="line">    ],</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="创建README-md和LICENSE文件"><a href="#创建README-md和LICENSE文件" class="headerlink" title="创建README.md和LICENSE文件"></a>创建README.md和LICENSE文件</h3><p><code>README.md</code>文件用于描述你的包的功能和使用方法，而<code>LICENSE</code>文件则包含包的许可证信息。</p><h3 id="构建包"><a href="#构建包" class="headerlink" title="构建包"></a>构建包</h3><p>在项目根目录下执行以下命令构建包：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py sdist bdist_wheel</span><br></pre></td></tr></table></figure><p>这将在<code>dist</code>目录下生成源代码分发包（.tar.gz文件）和wheel分发包（.whl文件）。</p><h3 id="上传包到PyPI"><a href="#上传包到PyPI" class="headerlink" title="上传包到PyPI"></a>上传包到PyPI</h3><p>首先，你需要在<a href="https://pypi.org/">PyPI</a>上注册一个账号。然后，使用<code>twine</code>工具上传你的包：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 上传到测试PyPI（可选，用于测试）</span></span><br><span class="line">twine upload --repository testpypi dist/*</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传到正式PyPI</span></span><br><span class="line">twine upload dist/*</span><br></pre></td></tr></table></figure><p>上传成功后，其他开发者就可以通过<code>pip install your_package_name</code>命令安装你的包了。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python3 数据结构</title>
      <link href="/2025/09/16/Python3-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
      <url>/2025/09/16/Python3-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h1 id="Python3-数据结构详解：从基础到进阶"><a href="#Python3-数据结构详解：从基础到进阶" class="headerlink" title="Python3 数据结构详解：从基础到进阶"></a>Python3 数据结构详解：从基础到进阶</h1><p>数据结构是程序的骨架，掌握Python中的数据结构对于编写高效、清晰的代码至关重要。本文将详细介绍Python中最常用的四大数据结构：列表（数组）、元组、集合和字典，包括它们的基本概念、常用操作、进阶技巧以及使用场景。</p><h2 id="一、列表（List）：Python的动态数组"><a href="#一、列表（List）：Python的动态数组" class="headerlink" title="一、列表（List）：Python的动态数组"></a>一、列表（List）：Python的动态数组</h2><h3 id="1-1-基本概念与特点"><a href="#1-1-基本概念与特点" class="headerlink" title="1.1 基本概念与特点"></a>1.1 基本概念与特点</h3><p>列表是Python中最常用的数据结构之一，相当于其他编程语言中的动态数组。它具有以下特点：</p><ul><li>有序的元素集合</li><li>可以存储任意类型的元素（混合类型也支持）</li><li>可变（元素可以被修改、添加和删除）</li><li>使用方括号 <code>[]</code> 表示</li></ul><h3 id="1-2-创建与基本操作"><a href="#1-2-创建与基本操作" class="headerlink" title="1.2 创建与基本操作"></a>1.2 创建与基本操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建列表的多种方式</span></span><br><span class="line">empty_list = []</span><br><span class="line">numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">mixed_list = [<span class="number">1</span>, <span class="string">&quot;hello&quot;</span>, <span class="number">3.14</span>, <span class="literal">True</span>]</span><br><span class="line">list_from_range = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line">list_from_string = <span class="built_in">list</span>(<span class="string">&quot;python&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问元素（通过索引）</span></span><br><span class="line">first_element = numbers[<span class="number">0</span>]  <span class="comment"># 1</span></span><br><span class="line">last_element = numbers[-<span class="number">1</span>]  <span class="comment"># 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 切片操作</span></span><br><span class="line">sublist = numbers[<span class="number">1</span>:<span class="number">4</span>]  <span class="comment"># [2, 3, 4]</span></span><br><span class="line">every_other = numbers[::<span class="number">2</span>]  <span class="comment"># [1, 3, 5]</span></span><br><span class="line">reversed_list = numbers[::-<span class="number">1</span>]  <span class="comment"># [5, 4, 3, 2, 1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改元素</span></span><br><span class="line">numbers[<span class="number">0</span>] = <span class="number">10</span></span><br><span class="line"><span class="built_in">print</span>(numbers)  <span class="comment"># [10, 2, 3, 4, 5]</span></span><br></pre></td></tr></table></figure><h3 id="1-3-常用函数与方法"><a href="#1-3-常用函数与方法" class="headerlink" title="1.3 常用函数与方法"></a>1.3 常用函数与方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 增加元素</span></span><br><span class="line">numbers.append(<span class="number">6</span>)  <span class="comment"># [10, 2, 3, 4, 5, 6]</span></span><br><span class="line">numbers.insert(<span class="number">1</span>, <span class="number">11</span>)  <span class="comment"># [10, 11, 2, 3, 4, 5, 6]</span></span><br><span class="line">numbers.extend([<span class="number">7</span>, <span class="number">8</span>])  <span class="comment"># [10, 11, 2, 3, 4, 5, 6, 7, 8]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除元素</span></span><br><span class="line">numbers.remove(<span class="number">11</span>)  <span class="comment"># [10, 2, 3, 4, 5, 6, 7, 8]</span></span><br><span class="line">popped = numbers.pop()  <span class="comment"># 8, numbers变为[10, 2, 3, 4, 5, 6, 7]</span></span><br><span class="line">popped_at = numbers.pop(<span class="number">0</span>)  <span class="comment"># 10, numbers变为[2, 3, 4, 5, 6, 7]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找与统计</span></span><br><span class="line">index = numbers.index(<span class="number">4</span>)  <span class="comment"># 2</span></span><br><span class="line">count = numbers.count(<span class="number">2</span>)  <span class="comment"># 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 排序与反转</span></span><br><span class="line">numbers.sort()  <span class="comment"># [2, 3, 4, 5, 6, 7]</span></span><br><span class="line">numbers.sort(reverse=<span class="literal">True</span>)  <span class="comment"># [7, 6, 5, 4, 3, 2]</span></span><br><span class="line">numbers.reverse()  <span class="comment"># [2, 3, 4, 5, 6, 7]（再次反转）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他操作</span></span><br><span class="line">length = <span class="built_in">len</span>(numbers)  <span class="comment"># 6</span></span><br><span class="line">sum_of_numbers = <span class="built_in">sum</span>(numbers)  <span class="comment"># 27</span></span><br><span class="line">max_number = <span class="built_in">max</span>(numbers)  <span class="comment"># 7</span></span><br><span class="line">min_number = <span class="built_in">min</span>(numbers)  <span class="comment"># 2</span></span><br></pre></td></tr></table></figure><h3 id="1-4-进阶用法"><a href="#1-4-进阶用法" class="headerlink" title="1.4 进阶用法"></a>1.4 进阶用法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列表推导式</span></span><br><span class="line">squares = [x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]  <span class="comment"># [0, 1, 4, 9, 16, 25, 36, 49, 64, 81]</span></span><br><span class="line">even_squares = [x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>) <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span>]  <span class="comment"># [0, 4, 16, 36, 64]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 嵌套列表推导式</span></span><br><span class="line">matrix = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]]</span><br><span class="line">flattened = [num <span class="keyword">for</span> row <span class="keyword">in</span> matrix <span class="keyword">for</span> num <span class="keyword">in</span> row]  <span class="comment"># [1, 2, 3, 4, 5, 6, 7, 8, 9]</span></span><br><span class="line">transposed = [[row[i] <span class="keyword">for</span> row <span class="keyword">in</span> matrix] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]  <span class="comment"># [[1, 4, 7], [2, 5, 8], [3, 6, 9]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成器表达式（内存更高效）</span></span><br><span class="line">square_generator = (x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表复制技巧</span></span><br><span class="line">shallow_copy = numbers.copy()</span><br><span class="line">shallow_copy2 = numbers[:]</span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line">deep_copy = copy.deepcopy(matrix)  <span class="comment"># 深拷贝，适用于嵌套列表</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表作为栈和队列</span></span><br><span class="line">stack = []</span><br><span class="line">stack.append(<span class="number">1</span>)  <span class="comment"># 入栈</span></span><br><span class="line">stack.append(<span class="number">2</span>)</span><br><span class="line">stack.pop()  <span class="comment"># 出栈，返回2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line">queue = deque([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">queue.append(<span class="number">4</span>)  <span class="comment"># 入队</span></span><br><span class="line">queue.popleft()  <span class="comment"># 出队，返回1</span></span><br></pre></td></tr></table></figure><h3 id="1-5-列表函数功能总结"><a href="#1-5-列表函数功能总结" class="headerlink" title="1.5 列表函数功能总结"></a>1.5 列表函数功能总结</h3><table><thead><tr><th>函数&#x2F;方法</th><th>功能描述</th><th>示例</th></tr></thead><tbody><tr><td><code>append()</code></td><td>在列表末尾添加元素</td><td><code>list.append(5)</code></td></tr><tr><td><code>insert()</code></td><td>在指定位置插入元素</td><td><code>list.insert(2, &#39;x&#39;)</code></td></tr><tr><td><code>extend()</code></td><td>扩展列表，添加多个元素</td><td><code>list.extend([4, 5, 6])</code></td></tr><tr><td><code>remove()</code></td><td>删除指定值的第一个匹配项</td><td><code>list.remove(&#39;x&#39;)</code></td></tr><tr><td><code>pop()</code></td><td>删除并返回指定索引的元素（默认最后一个）</td><td><code>list.pop()</code> 或 <code>list.pop(0)</code></td></tr><tr><td><code>clear()</code></td><td>清空列表</td><td><code>list.clear()</code></td></tr><tr><td><code>index()</code></td><td>返回指定值的第一个匹配项的索引</td><td><code>list.index(&#39;x&#39;)</code></td></tr><tr><td><code>count()</code></td><td>计算指定值在列表中出现的次数</td><td><code>list.count(&#39;x&#39;)</code></td></tr><tr><td><code>sort()</code></td><td>对列表进行排序</td><td><code>list.sort()</code> 或 <code>list.sort(reverse=True)</code></td></tr><tr><td><code>reverse()</code></td><td>反转列表元素顺序</td><td><code>list.reverse()</code></td></tr><tr><td><code>copy()</code></td><td>创建列表的浅拷贝</td><td><code>new_list = list.copy()</code></td></tr><tr><td><code>len()</code></td><td>返回列表长度</td><td><code>length = len(list)</code></td></tr><tr><td><code>sum()</code></td><td>计算列表元素总和（数值型）</td><td><code>total = sum(list)</code></td></tr><tr><td><code>max()</code></td><td>返回列表中的最大值</td><td><code>maximum = max(list)</code></td></tr><tr><td><code>min()</code></td><td>返回列表中的最小值</td><td><code>minimum = min(list)</code></td></tr></tbody></table><h2 id="二、元组（Tuple）：不可变的有序集合"><a href="#二、元组（Tuple）：不可变的有序集合" class="headerlink" title="二、元组（Tuple）：不可变的有序集合"></a>二、元组（Tuple）：不可变的有序集合</h2><h3 id="2-1-基本概念与特点"><a href="#2-1-基本概念与特点" class="headerlink" title="2.1 基本概念与特点"></a>2.1 基本概念与特点</h3><p>元组是另一种有序的数据结构，与列表类似，但具有不可变性。它的特点包括：</p><ul><li>有序的元素集合</li><li>可以存储任意类型的元素</li><li>不可变（创建后不能修改、添加或删除元素）</li><li>使用圆括号 <code>()</code> 表示（单个元素的元组需要加逗号，如 <code>(1,)</code>）</li></ul><h3 id="2-2-创建与基本操作"><a href="#2-2-创建与基本操作" class="headerlink" title="2.2 创建与基本操作"></a>2.2 创建与基本操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建元组的多种方式</span></span><br><span class="line">empty_tuple = ()</span><br><span class="line">single_element_tuple = (<span class="number">1</span>,)</span><br><span class="line">numbers_tuple = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">mixed_tuple = (<span class="number">1</span>, <span class="string">&quot;hello&quot;</span>, <span class="number">3.14</span>, <span class="literal">True</span>)</span><br><span class="line">tuple_from_list = <span class="built_in">tuple</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">tuple_from_string = <span class="built_in">tuple</span>(<span class="string">&quot;python&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问元素（与列表相同）</span></span><br><span class="line">first_element = numbers_tuple[<span class="number">0</span>]  <span class="comment"># 1</span></span><br><span class="line">last_element = numbers_tuple[-<span class="number">1</span>]  <span class="comment"># 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 切片操作（与列表相同）</span></span><br><span class="line">sublist = numbers_tuple[<span class="number">1</span>:<span class="number">4</span>]  <span class="comment"># (2, 3, 4)</span></span><br><span class="line">every_other = numbers_tuple[::<span class="number">2</span>]  <span class="comment"># (1, 3, 5)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 元组解包</span></span><br><span class="line">a, b, c, d, e = numbers_tuple</span><br><span class="line"><span class="built_in">print</span>(a, b, c)  <span class="comment"># 1 2 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 扩展解包（Python 3.0+）</span></span><br><span class="line">first, *middle, last = numbers_tuple</span><br><span class="line"><span class="built_in">print</span>(first, middle, last)  <span class="comment"># 1 [2, 3, 4] 5</span></span><br></pre></td></tr></table></figure><h3 id="2-3-常用函数与方法"><a href="#2-3-常用函数与方法" class="headerlink" title="2.3 常用函数与方法"></a>2.3 常用函数与方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 元组的方法较少，因为它不可变（如果是做常量，那就很合适）</span></span><br><span class="line">length = <span class="built_in">len</span>(numbers_tuple)  <span class="comment"># 5</span></span><br><span class="line">sum_of_numbers = <span class="built_in">sum</span>(numbers_tuple)  <span class="comment"># 15</span></span><br><span class="line">max_number = <span class="built_in">max</span>(numbers_tuple)  <span class="comment"># 5</span></span><br><span class="line">min_number = <span class="built_in">min</span>(numbers_tuple)  <span class="comment"># 1</span></span><br><span class="line">count = numbers_tuple.count(<span class="number">2</span>)  <span class="comment"># 1</span></span><br><span class="line">index = numbers_tuple.index(<span class="number">3</span>)  <span class="comment"># 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接和重复</span></span><br><span class="line">tuple1 = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">tuple2 = (<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">concatenated = tuple1 + tuple2  <span class="comment"># (1, 2, 3, 4, 5, 6)</span></span><br><span class="line">repeated = tuple1 * <span class="number">2</span>  <span class="comment"># (1, 2, 3, 1, 2, 3)</span></span><br></pre></td></tr></table></figure><h3 id="2-4-进阶用法"><a href="#2-4-进阶用法" class="headerlink" title="2.4 进阶用法"></a>2.4 进阶用法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 元组作为字典键（因为它是不可变的）</span></span><br><span class="line">student_grades = &#123;</span><br><span class="line">    (<span class="string">&quot;John&quot;</span>, <span class="string">&quot;Doe&quot;</span>): <span class="number">85</span>,</span><br><span class="line">    (<span class="string">&quot;Jane&quot;</span>, <span class="string">&quot;Smith&quot;</span>): <span class="number">92</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 交换变量值</span></span><br><span class="line">a, b = <span class="number">5</span>, <span class="number">10</span></span><br><span class="line">a, b = b, a  <span class="comment"># 交换a和b的值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 命名元组（collections模块）</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line">Point = namedtuple(<span class="string">&quot;Point&quot;</span>, [<span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>])</span><br><span class="line">p = Point(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line"><span class="built_in">print</span>(p.x, p.y)  <span class="comment"># 10 20</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 函数返回多个值（实际上是返回元组）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_min_max</span>(<span class="params">numbers</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(numbers), <span class="built_in">max</span>(numbers)</span><br><span class="line"></span><br><span class="line">min_val, max_val = get_min_max([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br></pre></td></tr></table></figure><h3 id="2-5-元组函数功能总结"><a href="#2-5-元组函数功能总结" class="headerlink" title="2.5 元组函数功能总结"></a>2.5 元组函数功能总结</h3><table><thead><tr><th>函数&#x2F;方法</th><th>功能描述</th><th>示例</th></tr></thead><tbody><tr><td><code>count()</code></td><td>计算指定值在元组中出现的次数</td><td><code>tuple.count(&#39;x&#39;)</code></td></tr><tr><td><code>index()</code></td><td>返回指定值的第一个匹配项的索引</td><td><code>tuple.index(&#39;x&#39;)</code></td></tr><tr><td><code>len()</code></td><td>返回元组长度</td><td><code>length = len(tuple)</code></td></tr><tr><td><code>sum()</code></td><td>计算元组元素总和（数值型）</td><td><code>total = sum(tuple)</code></td></tr><tr><td><code>max()</code></td><td>返回元组中的最大值</td><td><code>maximum = max(tuple)</code></td></tr><tr><td><code>min()</code></td><td>返回元组中的最小值</td><td><code>minimum = min(tuple)</code></td></tr><tr><td><code>+</code> 运算符</td><td>连接元组</td><td><code>tuple3 = tuple1 + tuple2</code></td></tr><tr><td><code>*</code> 运算符</td><td>重复元组元素</td><td><code>tuple2 = tuple1 * 3</code></td></tr><tr><td><code>tuple()</code></td><td>转换其他序列为元组</td><td><code>new_tuple = tuple(list)</code></td></tr></tbody></table><h2 id="三、集合（Set）：无序的唯一元素集合"><a href="#三、集合（Set）：无序的唯一元素集合" class="headerlink" title="三、集合（Set）：无序的唯一元素集合"></a>三、集合（Set）：无序的唯一元素集合</h2><h3 id="3-1-基本概念与特点"><a href="#3-1-基本概念与特点" class="headerlink" title="3.1 基本概念与特点"></a>3.1 基本概念与特点</h3><p>集合是一个无序的、不重复的元素集合。它的特点包括：</p><ul><li>无序性（不能通过索引访问元素）</li><li>唯一性（自动去除重复元素）</li><li>元素必须是可哈希的（不可变类型）</li><li>使用花括号 <code>&#123;&#125;</code> 表示（但空集合需要用 <code>set()</code> 创建）</li></ul><h3 id="3-2-创建与基本操作"><a href="#3-2-创建与基本操作" class="headerlink" title="3.2 创建与基本操作"></a>3.2 创建与基本操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建集合的多种方式</span></span><br><span class="line">empty_set = <span class="built_in">set</span>()</span><br><span class="line">numbers_set = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line">set_with_duplicates = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>&#125;  <span class="comment"># &#123;1, 2, 3&#125;</span></span><br><span class="line">set_from_list = <span class="built_in">set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line">set_from_string = <span class="built_in">set</span>(<span class="string">&quot;python&quot;</span>)  <span class="comment"># &#123;&#x27;p&#x27;, &#x27;y&#x27;, &#x27;t&#x27;, &#x27;h&#x27;, &#x27;o&#x27;, &#x27;n&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查元素是否存在</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">3</span> <span class="keyword">in</span> numbers_set)  <span class="comment"># True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">6</span> <span class="keyword">not</span> <span class="keyword">in</span> numbers_set)  <span class="comment"># True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历集合（顺序不确定）</span></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> numbers_set:</span><br><span class="line">    <span class="built_in">print</span>(num)</span><br></pre></td></tr></table></figure><h3 id="3-3-常用函数与方法"><a href="#3-3-常用函数与方法" class="headerlink" title="3.3 常用函数与方法"></a>3.3 常用函数与方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加元素</span></span><br><span class="line">numbers_set.add(<span class="number">6</span>)  <span class="comment"># &#123;1, 2, 3, 4, 5, 6&#125;</span></span><br><span class="line">numbers_set.update([<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>])  <span class="comment"># &#123;1, 2, 3, 4, 5, 6, 7, 8, 9&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除元素</span></span><br><span class="line">numbers_set.remove(<span class="number">9</span>)  <span class="comment"># &#123;1, 2, 3, 4, 5, 6, 7, 8&#125;，元素不存在会抛出KeyError</span></span><br><span class="line">numbers_set.discard(<span class="number">8</span>)  <span class="comment"># &#123;1, 2, 3, 4, 5, 6, 7&#125;，元素不存在不会抛出错误</span></span><br><span class="line">popped = numbers_set.pop()  <span class="comment"># 随机删除并返回一个元素</span></span><br><span class="line">numbers_set.clear()  <span class="comment"># 清空集合</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 集合大小</span></span><br><span class="line">length = <span class="built_in">len</span>(numbers_set)  <span class="comment"># 7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 集合运算</span></span><br><span class="line">s1 = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line">s2 = &#123;<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 交集</span></span><br><span class="line">intersection = s1 &amp; s2  <span class="comment"># &#123;4, 5&#125;</span></span><br><span class="line">intersection2 = s1.intersection(s2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 并集</span></span><br><span class="line">union = s1 | s2  <span class="comment"># &#123;1, 2, 3, 4, 5, 6, 7, 8&#125;</span></span><br><span class="line">union2 = s1.union(s2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 差集</span></span><br><span class="line">difference = s1 - s2  <span class="comment"># &#123;1, 2, 3&#125;</span></span><br><span class="line">difference2 = s1.difference(s2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对称差集（并集减去交集）</span></span><br><span class="line">symmetric_diff = s1 ^ s2  <span class="comment"># &#123;1, 2, 3, 6, 7, 8&#125;</span></span><br><span class="line">symmetric_diff2 = s1.symmetric_difference(s2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 子集和超集检查</span></span><br><span class="line">is_subset = &#123;<span class="number">1</span>, <span class="number">2</span>&#125;.issubset(s1)  <span class="comment"># True</span></span><br><span class="line">is_superset = s1.issuperset(&#123;<span class="number">1</span>, <span class="number">2</span>&#125;)  <span class="comment"># True</span></span><br></pre></td></tr></table></figure><h3 id="3-4-进阶用法"><a href="#3-4-进阶用法" class="headerlink" title="3.4 进阶用法"></a>3.4 进阶用法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 集合推导式</span></span><br><span class="line">squares = &#123;x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)&#125;</span><br><span class="line"><span class="comment"># &#123;0, 1, 4, 9, 16, 25, 36, 49, 64, 81&#125;</span></span><br><span class="line"></span><br><span class="line">even_numbers = &#123;x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>) <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span>&#125;</span><br><span class="line"><span class="comment"># &#123;0, 2, 4, 6, 8&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 冻结集合（不可变集合，可以作为字典键）</span></span><br><span class="line">frozen = <span class="built_in">frozenset</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">d = &#123;frozen: <span class="string">&quot;value&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 去除列表中的重复元素</span></span><br><span class="line">duplicated_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">unique_list = <span class="built_in">list</span>(<span class="built_in">set</span>(duplicated_list))  <span class="comment"># [1, 2, 3, 4, 5]（顺序可能不同）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 高效的成员检查</span></span><br><span class="line"><span class="comment"># 对于大集合，检查元素是否存在比列表更高效</span></span><br><span class="line">large_set = <span class="built_in">set</span>(<span class="built_in">range</span>(<span class="number">100000</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="number">99999</span> <span class="keyword">in</span> large_set)  <span class="comment"># 快速返回True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 集合与字典的结合使用</span></span><br><span class="line">word_counts = &#123;&#125;</span><br><span class="line">words = [<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;apple&quot;</span>, <span class="string">&quot;orange&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;apple&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> words:</span><br><span class="line">    word_counts[word] = word_counts.get(word, <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line"><span class="comment"># &#123;&#x27;apple&#x27;: 3, &#x27;banana&#x27;: 2, &#x27;orange&#x27;: 1&#125;</span></span><br></pre></td></tr></table></figure><h3 id="3-5-集合函数功能总结"><a href="#3-5-集合函数功能总结" class="headerlink" title="3.5 集合函数功能总结"></a>3.5 集合函数功能总结</h3><table><thead><tr><th>函数&#x2F;方法</th><th>功能描述</th><th>示例</th></tr></thead><tbody><tr><td><code>add()</code></td><td>向集合添加元素</td><td><code>set.add(5)</code></td></tr><tr><td><code>update()</code></td><td>扩展集合，添加多个元素</td><td><code>set.update([4, 5, 6])</code></td></tr><tr><td><code>remove()</code></td><td>删除元素，不存在则抛出异常</td><td><code>set.remove(5)</code></td></tr><tr><td><code>discard()</code></td><td>删除元素，不存在则忽略</td><td><code>set.discard(5)</code></td></tr><tr><td><code>pop()</code></td><td>随机删除并返回一个元素</td><td><code>item = set.pop()</code></td></tr><tr><td><code>clear()</code></td><td>清空集合</td><td><code>set.clear()</code></td></tr><tr><td><code>len()</code></td><td>返回集合大小</td><td><code>size = len(set)</code></td></tr><tr><td><code>in</code> 运算符</td><td>检查元素是否在集合中</td><td><code>if 5 in set:</code></td></tr><tr><td><code>&amp;</code> 或 <code>intersection()</code></td><td>交集运算</td><td><code>set3 = set1 &amp; set2</code> 或 <code>set3 = set1.intersection(set2)</code></td></tr><tr><td>&#96;</td><td><code>或</code>union()&#96;</td><td>并集运算</td></tr><tr><td><code>-</code> 或 <code>difference()</code></td><td>差集运算</td><td><code>set3 = set1 - set2</code> 或 <code>set3 = set1.difference(set2)</code></td></tr><tr><td><code>^</code> 或 <code>symmetric_difference()</code></td><td>对称差集运算</td><td><code>set3 = set1 ^ set2</code> 或 <code>set3 = set1.symmetric_difference(set2)</code></td></tr><tr><td><code>issubset()</code></td><td>检查是否为子集</td><td><code>set1.issubset(set2)</code></td></tr><tr><td><code>issuperset()</code></td><td>检查是否为超集</td><td><code>set1.issuperset(set2)</code></td></tr><tr><td><code>isdisjoint()</code></td><td>检查是否不相交（无共同元素）</td><td><code>set1.isdisjoint(set2)</code></td></tr><tr><td><code>set()</code></td><td>创建集合或转换其他序列为集合</td><td><code>new_set = set(list)</code></td></tr><tr><td><code>frozenset()</code></td><td>创建不可变集合</td><td><code>frozen = frozenset([1, 2, 3])</code></td></tr></tbody></table><h2 id="四、字典（Dictionary）：键值对的映射"><a href="#四、字典（Dictionary）：键值对的映射" class="headerlink" title="四、字典（Dictionary）：键值对的映射"></a>四、字典（Dictionary）：键值对的映射</h2><h3 id="4-1-基本概念与特点"><a href="#4-1-基本概念与特点" class="headerlink" title="4.1 基本概念与特点"></a>4.1 基本概念与特点</h3><p>字典是Python中另一个非常重要的数据结构，它是键值对的集合。它的特点包括：</p><ul><li>无序性（Python 3.7+保证插入顺序）</li><li>键的唯一性（相同的键会被覆盖）</li><li>键必须是可哈希的（不可变类型）</li><li>值可以是任意类型</li><li>使用花括号 <code>&#123;&#125;</code> 和冒号 <code>:</code> 表示，如 <code>&#123;key1: value1, key2: value2&#125;</code></li></ul><h3 id="4-2-创建与基本操作"><a href="#4-2-创建与基本操作" class="headerlink" title="4.2 创建与基本操作"></a>4.2 创建与基本操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建字典的多种方式</span></span><br><span class="line">empty_dict = &#123;&#125;</span><br><span class="line">student = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;John&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">20</span>, <span class="string">&quot;major&quot;</span>: <span class="string">&quot;Computer Science&quot;</span>&#125;</span><br><span class="line">dict_from_tuples = <span class="built_in">dict</span>([(<span class="string">&quot;a&quot;</span>, <span class="number">1</span>), (<span class="string">&quot;b&quot;</span>, <span class="number">2</span>), (<span class="string">&quot;c&quot;</span>, <span class="number">3</span>)])</span><br><span class="line">dict_with_kwargs = <span class="built_in">dict</span>(a=<span class="number">1</span>, b=<span class="number">2</span>, c=<span class="number">3</span>)</span><br><span class="line">keys = [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>]</span><br><span class="line">values = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">dict_from_zip = <span class="built_in">dict</span>(<span class="built_in">zip</span>(keys, values))  <span class="comment"># &#123;&#x27;a&#x27;: 1, &#x27;b&#x27;: 2, &#x27;c&#x27;: 3&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问值</span></span><br><span class="line">name = student[<span class="string">&quot;name&quot;</span>]  <span class="comment"># &quot;John&quot;</span></span><br><span class="line">age = student.get(<span class="string">&quot;age&quot;</span>)  <span class="comment"># 20</span></span><br><span class="line">unknown = student.get(<span class="string">&quot;address&quot;</span>, <span class="string">&quot;Not available&quot;</span>)  <span class="comment"># 使用默认值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改和添加键值对</span></span><br><span class="line">student[<span class="string">&quot;age&quot;</span>] = <span class="number">21</span>  <span class="comment"># 修改已有键的值</span></span><br><span class="line">student[<span class="string">&quot;address&quot;</span>] = <span class="string">&quot;123 Main St&quot;</span>  <span class="comment"># 添加新的键值对</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除键值对</span></span><br><span class="line"><span class="keyword">del</span> student[<span class="string">&quot;address&quot;</span>]</span><br><span class="line">age = student.pop(<span class="string">&quot;age&quot;</span>)  <span class="comment"># 21，同时删除该键值对</span></span><br><span class="line">last_item = student.popitem()  <span class="comment"># (&#x27;major&#x27;, &#x27;Computer Science&#x27;)，删除并返回最后一个键值对</span></span><br><span class="line">student.clear()  <span class="comment"># 清空字典</span></span><br></pre></td></tr></table></figure><h3 id="4-3-常用函数与方法"><a href="#4-3-常用函数与方法" class="headerlink" title="4.3 常用函数与方法"></a>4.3 常用函数与方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 字典大小</span></span><br><span class="line">length = <span class="built_in">len</span>(student)  <span class="comment"># 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问键、值和键值对</span></span><br><span class="line">student = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;John&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">20</span>, <span class="string">&quot;major&quot;</span>: <span class="string">&quot;Computer Science&quot;</span>&#125;</span><br><span class="line">keys = student.keys()  <span class="comment"># dict_keys([&#x27;name&#x27;, &#x27;age&#x27;, &#x27;major&#x27;])</span></span><br><span class="line">values = student.values()  <span class="comment"># dict_values([&#x27;John&#x27;, 20, &#x27;Computer Science&#x27;])</span></span><br><span class="line">items = student.items()  <span class="comment"># dict_items([(&#x27;name&#x27;, &#x27;John&#x27;), (&#x27;age&#x27;, 20), (&#x27;major&#x27;, &#x27;Computer Science&#x27;)])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历字典</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> student:</span><br><span class="line">    <span class="built_in">print</span>(key, student[key])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> student.items():</span><br><span class="line">    <span class="built_in">print</span>(key, value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字典更新</span></span><br><span class="line">dict1 = &#123;<span class="string">&quot;a&quot;</span>: <span class="number">1</span>, <span class="string">&quot;b&quot;</span>: <span class="number">2</span>&#125;</span><br><span class="line">dict2 = &#123;<span class="string">&quot;b&quot;</span>: <span class="number">3</span>, <span class="string">&quot;c&quot;</span>: <span class="number">4</span>&#125;</span><br><span class="line">dict1.update(dict2)  <span class="comment"># dict1变为 &#123;&#x27;a&#x27;: 1, &#x27;b&#x27;: 3, &#x27;c&#x27;: 4&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 字典复制</span></span><br><span class="line">shallow_copy = student.copy()</span><br><span class="line">shallow_copy2 = <span class="built_in">dict</span>(student)</span><br></pre></td></tr></table></figure><h3 id="4-4-进阶用法"><a href="#4-4-进阶用法" class="headerlink" title="4.4 进阶用法"></a>4.4 进阶用法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 字典推导式</span></span><br><span class="line">squares = &#123;x: x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)&#125;  <span class="comment"># &#123;0: 0, 1: 1, 2: 4, 3: 9, 4: 16&#125;</span></span><br><span class="line"></span><br><span class="line">even_squares = &#123;x: x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>) <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span>&#125;</span><br><span class="line"><span class="comment"># &#123;0: 0, 2: 4, 4: 16, 6: 36, 8: 64&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 嵌套字典</span></span><br><span class="line">students = &#123;</span><br><span class="line">    <span class="string">&quot;student1&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;John&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">20</span>&#125;,</span><br><span class="line">    <span class="string">&quot;student2&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Jane&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">21</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(students[<span class="string">&quot;student1&quot;</span>][<span class="string">&quot;name&quot;</span>])  <span class="comment"># &quot;John&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 字典的默认值处理</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用默认字典统计单词频率</span></span><br><span class="line">word_counts = defaultdict(<span class="built_in">int</span>)</span><br><span class="line">words = [<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;apple&quot;</span>, <span class="string">&quot;orange&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;apple&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> words:</span><br><span class="line">    word_counts[word] += <span class="number">1</span></span><br><span class="line"><span class="comment"># defaultdict(&lt;class &#x27;int&#x27;&gt;, &#123;&#x27;apple&#x27;: 3, &#x27;banana&#x27;: 2, &#x27;orange&#x27;: 1&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分组数据</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line">students = [</span><br><span class="line">    (<span class="string">&quot;CS&quot;</span>, <span class="string">&quot;John&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;CS&quot;</span>, <span class="string">&quot;Jane&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;Math&quot;</span>, <span class="string">&quot;Bob&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;Physics&quot;</span>, <span class="string">&quot;Alice&quot;</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">dept_students = defaultdict(<span class="built_in">list</span>)</span><br><span class="line"><span class="keyword">for</span> dept, name <span class="keyword">in</span> students:</span><br><span class="line">    dept_students[dept].append(name)</span><br><span class="line"><span class="comment"># defaultdict(&lt;class &#x27;list&#x27;&gt;, &#123;&#x27;CS&#x27;: [&#x27;John&#x27;, &#x27;Jane&#x27;], &#x27;Math&#x27;: [&#x27;Bob&#x27;], &#x27;Physics&#x27;: [&#x27;Alice&#x27;]&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 有序字典（Python 3.7+前需要，3.7+后普通字典也保持插入顺序）</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"></span><br><span class="line">ordered = OrderedDict()</span><br><span class="line">ordered[<span class="string">&quot;a&quot;</span>] = <span class="number">1</span></span><br><span class="line">ordered[<span class="string">&quot;b&quot;</span>] = <span class="number">2</span></span><br><span class="line">ordered[<span class="string">&quot;c&quot;</span>] = <span class="number">3</span></span><br></pre></td></tr></table></figure><h3 id="4-5-字典函数功能总结"><a href="#4-5-字典函数功能总结" class="headerlink" title="4.5 字典函数功能总结"></a>4.5 字典函数功能总结</h3><table><thead><tr><th>函数&#x2F;方法</th><th>功能描述</th><th>示例</th></tr></thead><tbody><tr><td><code>get(key, default=None)</code></td><td>获取键对应的值，不存在则返回默认值</td><td><code>value = dict.get(&#39;key&#39;, &#39;default&#39;)</code></td></tr><tr><td><code>keys()</code></td><td>返回所有键的视图</td><td><code>keys = dict.keys()</code></td></tr><tr><td><code>values()</code></td><td>返回所有值的视图</td><td><code>values = dict.values()</code></td></tr><tr><td><code>items()</code></td><td>返回所有键值对的视图</td><td><code>items = dict.items()</code></td></tr><tr><td><code>update(other_dict)</code></td><td>用另一个字典更新当前字典</td><td><code>dict.update(&#123;&quot;key&quot;: &quot;value&quot;&#125;)</code></td></tr><tr><td><code>pop(key, default=None)</code></td><td>删除并返回指定键的值</td><td><code>value = dict.pop(&#39;key&#39;)</code></td></tr><tr><td><code>popitem()</code></td><td>删除并返回最后一个键值对</td><td><code>item = dict.popitem()</code></td></tr><tr><td><code>clear()</code></td><td>清空字典</td><td><code>dict.clear()</code></td></tr><tr><td><code>copy()</code></td><td>创建字典的浅拷贝</td><td><code>new_dict = dict.copy()</code></td></tr><tr><td><code>len()</code></td><td>返回字典中键值对的数量</td><td><code>size = len(dict)</code></td></tr><tr><td><code>in</code> 运算符</td><td>检查键是否在字典中</td><td><code>if &#39;key&#39; in dict:</code></td></tr><tr><td><code>del</code> 语句</td><td>删除指定的键值对</td><td><code>del dict[&#39;key&#39;]</code></td></tr><tr><td><code>dict()</code></td><td>创建字典或转换其他序列为字典</td><td><code>new_dict = dict([(1, &#39;a&#39;), (2, &#39;b&#39;)])</code></td></tr><tr><td><code>zip()</code> 与 <code>dict()</code> 结合</td><td>从两个序列创建字典</td><td><code>new_dict = dict(zip(keys, values))</code></td></tr></tbody></table><h2 id="五、Python中的其他有用数据结构"><a href="#五、Python中的其他有用数据结构" class="headerlink" title="五、Python中的其他有用数据结构"></a>五、Python中的其他有用数据结构</h2><p>除了以上四种基本数据结构外，Python的<code>collections</code>模块还提供了一些特殊的容器数据类型，它们是内置数据结构的扩展。</p><h3 id="5-1-命名元组（namedtuple）"><a href="#5-1-命名元组（namedtuple）" class="headerlink" title="5.1 命名元组（namedtuple）"></a>5.1 命名元组（namedtuple）</h3><p>命名元组为元组中的元素提供了命名访问，兼具元组的不可变性和字典的可读性。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个命名元组类型</span></span><br><span class="line">Person = namedtuple(<span class="string">&quot;Person&quot;</span>, [<span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;job&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建命名元组实例</span></span><br><span class="line">john = Person(<span class="string">&quot;John&quot;</span>, <span class="number">30</span>, <span class="string">&quot;Developer&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过名称访问元素</span></span><br><span class="line"><span class="built_in">print</span>(john.name)  <span class="comment"># &quot;John&quot;</span></span><br><span class="line"><span class="built_in">print</span>(john.age)  <span class="comment"># 30</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换为字典</span></span><br><span class="line">john_dict = john._asdict()</span><br><span class="line"><span class="comment"># &#123;&#x27;name&#x27;: &#x27;John&#x27;, &#x27;age&#x27;: 30, &#x27;job&#x27;: &#x27;Developer&#x27;&#125;</span></span><br></pre></td></tr></table></figure><h3 id="5-2-双端队列（deque）"><a href="#5-2-双端队列（deque）" class="headerlink" title="5.2 双端队列（deque）"></a>5.2 双端队列（deque）</h3><p>双端队列是一种可以在两端高效添加和删除元素的数据结构，适用于实现队列和栈。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建双端队列</span></span><br><span class="line">queue = deque([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在两端添加元素</span></span><br><span class="line">queue.append(<span class="number">4</span>)  <span class="comment"># 右端添加</span></span><br><span class="line">queue.appendleft(<span class="number">0</span>)  <span class="comment"># 左端添加</span></span><br><span class="line"><span class="comment"># deque([0, 1, 2, 3, 4])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在两端删除元素</span></span><br><span class="line">queue.pop()  <span class="comment"># 右端删除，返回4</span></span><br><span class="line">queue.popleft()  <span class="comment"># 左端删除，返回0</span></span><br><span class="line"><span class="comment"># deque([1, 2, 3])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 限制双端队列大小</span></span><br><span class="line">limited_queue = deque(maxlen=<span class="number">3</span>)</span><br><span class="line">limited_queue.append(<span class="number">1</span>)</span><br><span class="line">limited_queue.append(<span class="number">2</span>)</span><br><span class="line">limited_queue.append(<span class="number">3</span>)</span><br><span class="line">limited_queue.append(<span class="number">4</span>)  <span class="comment"># 自动移除最左端的元素</span></span><br><span class="line"><span class="comment"># deque([2, 3, 4], maxlen=3)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 旋转元素</span></span><br><span class="line">queue.rotate(<span class="number">1</span>)  <span class="comment"># 向右旋转1位</span></span><br><span class="line"><span class="comment"># deque([3, 1, 2])</span></span><br><span class="line">queue.rotate(-<span class="number">1</span>)  <span class="comment"># 向左旋转1位</span></span><br><span class="line"><span class="comment"># deque([1, 2, 3])</span></span><br></pre></td></tr></table></figure><h3 id="5-3-计数器（Counter）"><a href="#5-3-计数器（Counter）" class="headerlink" title="5.3 计数器（Counter）"></a>5.3 计数器（Counter）</h3><p>计数器用于统计可哈希对象的出现次数，非常适合频率统计。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建计数器</span></span><br><span class="line">words = [<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;apple&quot;</span>, <span class="string">&quot;orange&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;apple&quot;</span>]</span><br><span class="line">word_counter = Counter(words)</span><br><span class="line"><span class="comment"># Counter(&#123;&#x27;apple&#x27;: 3, &#x27;banana&#x27;: 2, &#x27;orange&#x27;: 1&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问计数</span></span><br><span class="line"><span class="built_in">print</span>(word_counter[<span class="string">&quot;apple&quot;</span>])  <span class="comment"># 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加计数</span></span><br><span class="line">word_counter[<span class="string">&quot;apple&quot;</span>] += <span class="number">1</span></span><br><span class="line"><span class="comment"># Counter(&#123;&#x27;apple&#x27;: 4, &#x27;banana&#x27;: 2, &#x27;orange&#x27;: 1&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取最常见的元素</span></span><br><span class="line">top_two = word_counter.most_common(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># [(&#x27;apple&#x27;, 4), (&#x27;banana&#x27;, 2)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计数器运算</span></span><br><span class="line">counter1 = Counter(&#123;<span class="string">&quot;a&quot;</span>: <span class="number">3</span>, <span class="string">&quot;b&quot;</span>: <span class="number">2</span>&#125;)</span><br><span class="line">counter2 = Counter(&#123;<span class="string">&quot;b&quot;</span>: <span class="number">1</span>, <span class="string">&quot;c&quot;</span>: <span class="number">3</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加法</span></span><br><span class="line">counter_sum = counter1 + counter2</span><br><span class="line"><span class="comment"># Counter(&#123;&#x27;a&#x27;: 3, &#x27;b&#x27;: 3, &#x27;c&#x27;: 3&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 减法（只保留正数计数）</span></span><br><span class="line">counter_diff = counter1 - counter2</span><br><span class="line"><span class="comment"># Counter(&#123;&#x27;a&#x27;: 3, &#x27;b&#x27;: 1&#125;)</span></span><br></pre></td></tr></table></figure><h3 id="5-4-默认字典（defaultdict）"><a href="#5-4-默认字典（defaultdict）" class="headerlink" title="5.4 默认字典（defaultdict）"></a>5.4 默认字典（defaultdict）</h3><p>默认字典在访问不存在的键时会自动创建默认值，避免了KeyError异常。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建默认字典（指定默认值类型为列表）</span></span><br><span class="line">word_lists = defaultdict(<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接向不存在的键添加元素</span></span><br><span class="line">word_lists[<span class="string">&quot;fruits&quot;</span>].append(<span class="string">&quot;apple&quot;</span>)</span><br><span class="line">word_lists[<span class="string">&quot;fruits&quot;</span>].append(<span class="string">&quot;banana&quot;</span>)</span><br><span class="line">word_lists[<span class="string">&quot;vegetables&quot;</span>].append(<span class="string">&quot;carrot&quot;</span>)</span><br><span class="line"><span class="comment"># defaultdict(&lt;class &#x27;list&#x27;&gt;, &#123;&#x27;fruits&#x27;: [&#x27;apple&#x27;, &#x27;banana&#x27;], &#x27;vegetables&#x27;: [&#x27;carrot&#x27;]&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用自定义默认值函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">default_value</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;count&quot;</span>: <span class="number">0</span>, <span class="string">&quot;items&quot;</span>: []&#125;</span><br><span class="line"></span><br><span class="line">complex_dict = defaultdict(default_value)</span><br><span class="line">complex_dict[<span class="string">&quot;A&quot;</span>][<span class="string">&quot;count&quot;</span>] += <span class="number">1</span></span><br><span class="line">complex_dict[<span class="string">&quot;A&quot;</span>][<span class="string">&quot;items&quot;</span>].append(<span class="string">&quot;item1&quot;</span>)</span><br><span class="line"><span class="comment"># defaultdict(&lt;function default_value at 0x...&gt;, &#123;&#x27;A&#x27;: &#123;&#x27;count&#x27;: 1, &#x27;items&#x27;: [&#x27;item1&#x27;]&#125;&#125;)</span></span><br></pre></td></tr></table></figure><h3 id="5-5-collections模块扩展数据结构函数功能总结"><a href="#5-5-collections模块扩展数据结构函数功能总结" class="headerlink" title="5.5 collections模块扩展数据结构函数功能总结"></a>5.5 collections模块扩展数据结构函数功能总结</h3><h4 id="5-5-1-命名元组（namedtuple）"><a href="#5-5-1-命名元组（namedtuple）" class="headerlink" title="5.5.1 命名元组（namedtuple）"></a>5.5.1 命名元组（namedtuple）</h4><table><thead><tr><th>函数&#x2F;方法</th><th>功能描述</th><th>示例</th></tr></thead><tbody><tr><td><code>namedtuple(typename, field_names)</code></td><td>创建命名元组类</td><td><code>Point = namedtuple(&quot;Point&quot;, [&quot;x&quot;, &quot;y&quot;]) or namedtuple(&quot;Point&quot;, &quot;x y&quot;)</code></td></tr><tr><td><code>_asdict()</code></td><td>转换命名元组为有序字典</td><td><code>point_dict = point._asdict()</code></td></tr><tr><td><code>_fields</code></td><td>返回字段名的元组</td><td><code>fields = Point._fields</code></td></tr><tr><td><code>_replace(**kwargs)</code></td><td>创建并返回修改指定字段的新实例</td><td><code>new_point = point._replace(x=100)</code></td></tr><tr><td><code>_make(iterable)</code></td><td>从可迭代对象创建新的命名元组实例</td><td><code>new_point = Point._make([10, 20])</code></td></tr></tbody></table><h4 id="5-5-2-双端队列（deque）"><a href="#5-5-2-双端队列（deque）" class="headerlink" title="5.5.2 双端队列（deque）"></a>5.5.2 双端队列（deque）</h4><table><thead><tr><th>函数&#x2F;方法</th><th>功能描述</th><th>示例</th></tr></thead><tbody><tr><td><code>append(x)</code></td><td>在右端添加元素</td><td><code>deque.append(5)</code></td></tr><tr><td><code>appendleft(x)</code></td><td>在左端添加元素</td><td><code>deque.appendleft(0)</code></td></tr><tr><td><code>pop()</code></td><td>移除并返回右端元素</td><td><code>item = deque.pop()</code></td></tr><tr><td><code>popleft()</code></td><td>移除并返回左端元素</td><td><code>item = deque.popleft()</code></td></tr><tr><td><code>extend(iterable)</code></td><td>在右端扩展元素</td><td><code>deque.extend([6, 7, 8])</code></td></tr><tr><td><code>extendleft(iterable)</code></td><td>在左端扩展元素（逆序）</td><td><code>deque.extendleft([-2, -1])</code></td></tr><tr><td><code>rotate(n=1)</code></td><td>向右旋转n步（负数向左旋转）</td><td><code>deque.rotate(1)</code> 或 <code>deque.rotate(-1)</code></td></tr><tr><td><code>clear()</code></td><td>清空双端队列</td><td><code>deque.clear()</code></td></tr><tr><td><code>count(x)</code></td><td>计算元素出现次数</td><td><code>count = deque.count(5)</code></td></tr><tr><td><code>remove(value)</code></td><td>移除第一个匹配的元素</td><td><code>deque.remove(5)</code></td></tr><tr><td><code>maxlen</code></td><td>双端队列的最大长度（只读属性）</td><td><code>max_length = deque.maxlen</code></td></tr></tbody></table><h4 id="5-5-3-计数器（Counter）"><a href="#5-5-3-计数器（Counter）" class="headerlink" title="5.5.3 计数器（Counter）"></a>5.5.3 计数器（Counter）</h4><table><thead><tr><th>函数&#x2F;方法</th><th>功能描述</th><th>示例</th></tr></thead><tbody><tr><td><code>Counter(iterable)</code></td><td>创建计数器对象</td><td><code>counter = Counter([1, 2, 1, 3, 2, 1])</code></td></tr><tr><td><code>most_common(n=None)</code></td><td>返回n个最常见的元素及其计数</td><td><code>top_3 = counter.most_common(3)</code></td></tr><tr><td><code>elements()</code></td><td>返回迭代器，包含所有元素（按计数重复）</td><td><code>elements = list(counter.elements())</code></td></tr><tr><td><code>update(iterable)</code></td><td>更新计数器，增加元素计数</td><td><code>counter.update([1, 4, 5])</code></td></tr><tr><td><code>subtract(iterable)</code></td><td>减少元素计数</td><td><code>counter.subtract([1, 2])</code></td></tr><tr><td><code>clear()</code></td><td>清空计数器</td><td><code>counter.clear()</code></td></tr><tr><td><code>+</code> 运算符</td><td>合并计数器（只保留正数计数）</td><td><code>counter3 = counter1 + counter2</code></td></tr><tr><td><code>-</code> 运算符</td><td>计数器差集（只保留正数计数）</td><td><code>counter3 = counter1 - counter2</code></td></tr><tr><td><code>&amp;</code> 运算符</td><td>计数器交集（保留最小计数）</td><td><code>counter3 = counter1 &amp; counter2</code></td></tr><tr><td>&#96;</td><td>&#96; 运算符</td><td>计数器并集（保留最大计数）</td></tr></tbody></table><h4 id="5-5-4-默认字典（defaultdict）"><a href="#5-5-4-默认字典（defaultdict）" class="headerlink" title="5.5.4 默认字典（defaultdict）"></a>5.5.4 默认字典（defaultdict）</h4><table><thead><tr><th>函数&#x2F;方法</th><th>功能描述</th><th>示例</th></tr></thead><tbody><tr><td><code>defaultdict(default_factory)</code></td><td>创建默认字典，指定默认值工厂函数</td><td><code>dd = defaultdict(list)</code> 或 <code>dd = defaultdict(lambda: 0)</code></td></tr><tr><td>访问不存在的键</td><td>自动创建并返回默认值</td><td><code>value = dd[&#39;new_key&#39;]</code>（自动创建）</td></tr><tr><td>所有普通字典方法</td><td>与普通字典相同的方法</td><td><code>dd.keys()</code>, <code>dd.values()</code>, <code>dd.items()</code>, <code>dd.update()</code>, 等</td></tr></tbody></table><h2 id="六、数据结构的选择指南"><a href="#六、数据结构的选择指南" class="headerlink" title="六、数据结构的选择指南"></a>六、数据结构的选择指南</h2><p>在实际编程中，选择合适的数据结构对于提高代码效率至关重要。以下是一些常见场景下的数据结构选择建议：</p><table><thead><tr><th>使用场景</th><th>推荐数据结构</th><th>理由</th></tr></thead><tbody><tr><td>存储有序的、需要频繁修改的元素集合</td><td>列表（List）</td><td>支持索引访问和高效的尾部添加&#x2F;删除</td></tr><tr><td>存储不可变的数据，或作为字典键</td><td>元组（Tuple）</td><td>不可变性提供了哈希能力和数据安全性</td></tr><tr><td>存储唯一元素，需要快速的成员检查</td><td>集合（Set）</td><td>O(1)时间复杂度的成员检查和去重功能</td></tr><tr><td>存储键值对，需要快速的查找</td><td>字典（Dictionary）</td><td>O(1)时间复杂度的键查找</td></tr><tr><td>实现队列或需要高效的两端操作</td><td>双端队列（deque）</td><td>两端操作的时间复杂度为O(1)</td></tr><tr><td>统计频率或计数</td><td>计数器（Counter）</td><td>专门为计数设计的高效数据结构</td></tr><tr><td>分组数据</td><td>默认字典（defaultdict）</td><td>避免了手动检查键是否存在的代码</td></tr></tbody></table><h2 id="七、总结"><a href="#七、总结" class="headerlink" title="七、总结"></a>七、总结</h2><p>Python提供了丰富的数据结构，每种数据结构都有其特定的用途和优势。掌握这些数据结构的基本概念、操作方法和适用场景，对于编写高效、清晰的Python代码至关重要。在实际开发中，我们应该根据具体需求选择合适的数据结构，并且不要忘记Python的<code>collections</code>模块中那些强大的扩展数据结构，它们往往能帮助我们更优雅地解决问题。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>进程、线程和协程</title>
      <link href="/2025/09/15/%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%8D%8F%E7%A8%8B/"/>
      <url>/2025/09/15/%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%8D%8F%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="进程、线程和协程：深入理解并发编程的基石"><a href="#进程、线程和协程：深入理解并发编程的基石" class="headerlink" title="进程、线程和协程：深入理解并发编程的基石"></a>进程、线程和协程：深入理解并发编程的基石</h2><p>在现代计算机系统和编程领域，进程、线程和协程是实现并发和并行计算的核心概念。它们既有密切的联系，又有本质的区别。</p><h2 id="一、基本概念解析"><a href="#一、基本概念解析" class="headerlink" title="一、基本概念解析"></a>一、基本概念解析</h2><h3 id="1-1-进程（Process）"><a href="#1-1-进程（Process）" class="headerlink" title="1.1 进程（Process）"></a>1.1 进程（Process）</h3><p>进程是程序在执行过程中的实例，是<strong>操作系统进行资源分配和调度的基本单位</strong>。它不仅包含了程序的代码和数据，还包括了程序执行所需的各种资源和状态信息。每个进程都拥有独立的内存空间、文件描述符和系统资源，这些资源在进程创建时被分配，并在进程终止时被回收。</p><blockquote><p>这里特别注意，进程才是操作系统进行资源分配和调度的基本单位，不是线程！！</p></blockquote><h4 id="1-1-1-进程的组成"><a href="#1-1-1-进程的组成" class="headerlink" title="1.1.1 进程的组成"></a>1.1.1 进程的组成</h4><p>一个完整的进程通常由以下几个部分组成：</p><ul><li><strong>程序（Program）</strong>：进程执行的代码，通常是存储在磁盘上的可执行文件</li><li><strong>数据（Data）</strong>：程序运行过程中使用和产生的数据</li><li><strong>进程控制块（Process Control Block, PCB）</strong>：操作系统用来管理和控制进程的核心数据结构</li><li><strong>内存空间</strong>：进程独占的虚拟地址空间，包括代码区、数据区、堆区和栈区等</li><li><strong>系统资源</strong>：如文件描述符、I&#x2F;O设备、信号处理器等</li></ul><h4 id="1-1-2-进程控制块（PCB）的结构"><a href="#1-1-2-进程控制块（PCB）的结构" class="headerlink" title="1.1.2 进程控制块（PCB）的结构"></a>1.1.2 进程控制块（PCB）的结构</h4><p>进程控制块（PCB）是操作系统中最重要的数据结构之一，它包含了进程的全部信息，是进程存在的唯一标志。每当创建一个新进程时，操作系统会为其分配一个PCB；当进程终止时，其PCB也会被释放。</p><p>典型的PCB包含以下信息：</p><ol><li><p><strong>进程标识符（Process ID, PID）</strong>：每个进程唯一的数字标识符，用于在系统中区分不同的进程</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> pid;  <span class="comment">// 进程ID</span></span><br><span class="line"><span class="type">int</span> ppid; <span class="comment">// 父进程ID</span></span><br></pre></td></tr></table></figure></li><li><p><strong>进程状态（Process State）</strong>：描述进程当前所处的状态，如运行态、就绪态、阻塞态、挂起态等</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> &#123;</span> RUNNING, READY, BLOCKED, SUSPENDED &#125; state;</span><br></pre></td></tr></table></figure></li><li><p><strong>程序计数器（Program Counter, PC）</strong>：记录进程下一条要执行的指令的地址</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> *program_counter;</span><br></pre></td></tr></table></figure></li><li><p><strong>寄存器集合</strong>：保存进程执行过程中CPU寄存器的值，包括通用寄存器、栈指针、基址指针等</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> general_registers[<span class="number">16</span>];</span><br><span class="line">    <span class="type">void</span> *stack_pointer;</span><br><span class="line">    <span class="type">void</span> *base_pointer;</span><br><span class="line">    <span class="comment">// 其他寄存器...</span></span><br><span class="line">&#125; registers;</span><br></pre></td></tr></table></figure></li><li><p><strong>内存管理信息</strong>：包括进程的内存映射表、页表等，用于管理进程的虚拟地址空间</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">void</span> *page_table;  <span class="comment">// 页表指针</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> virtual_memory_size;  <span class="comment">// 虚拟内存大小</span></span><br><span class="line">    <span class="comment">// 其他内存管理信息...</span></span><br><span class="line">&#125; memory_info;</span><br></pre></td></tr></table></figure></li><li><p><strong>资源使用情况</strong>：记录进程使用的CPU时间、内存大小、I&#x2F;O设备等资源信息</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> cpu_time_used;  <span class="comment">// 已使用的CPU时间</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> memory_used;    <span class="comment">// 已使用的内存</span></span><br><span class="line">    <span class="comment">// 其他资源信息...</span></span><br><span class="line">&#125; resource_usage;</span><br></pre></td></tr></table></figure></li><li><p><strong>文件描述符表</strong>：记录进程打开的文件和设备</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> file_descriptors[MAX_FILES];  <span class="comment">// 文件描述符数组</span></span><br></pre></td></tr></table></figure></li><li><p><strong>进程优先级</strong>：决定进程在CPU调度中的优先级</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> priority;  <span class="comment">// 进程优先级</span></span><br></pre></td></tr></table></figure></li><li><p><strong>进程间通信信息</strong>：如信号、消息队列、管道等信息</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> signals_pending;  <span class="comment">// 待处理的信号</span></span><br><span class="line">    <span class="comment">// 其他IPC信息...</span></span><br><span class="line">&#125; ipc_info;</span><br></pre></td></tr></table></figure></li><li><p><strong>记账信息</strong>：用于系统计费和性能统计</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">time_t</span> start_time;  <span class="comment">// 进程开始时间</span></span><br><span class="line">    <span class="comment">// 其他记账信息...</span></span><br><span class="line">&#125; accounting_info;</span><br></pre></td></tr></table></figure></li></ol><h4 id="1-1-3-进程的生命周期"><a href="#1-1-3-进程的生命周期" class="headerlink" title="1.1.3 进程的生命周期"></a>1.1.3 进程的生命周期</h4><p>进程具有完整的生命周期，包括以下几个阶段：</p><ul><li><strong>创建（Creation）</strong>：通过系统调用（如<code>fork()</code>、<code>CreateProcess()</code>）创建新进程</li><li><strong>就绪（Ready）</strong>：进程已获得除CPU外的所有必要资源，等待CPU分配</li><li><strong>运行（Running）</strong>：进程正在占用CPU执行指令</li><li><strong>阻塞（Blocked&#x2F;Waiting）</strong>：进程等待某事件发生（如I&#x2F;O完成）而暂停执行</li><li><strong>终止（Termination）</strong>：进程执行完毕或出错，系统回收其资源</li><li><strong>挂起（Suspended）</strong>：进程被暂时换出内存，存放到外存中</li></ul><h4 id="1-1-4-进程的主要特点"><a href="#1-1-4-进程的主要特点" class="headerlink" title="1.1.4 进程的主要特点"></a>1.1.4 进程的主要特点</h4><ul><li><strong>独立性</strong>：每个进程都有自己独立的地址空间和资源，进程之间相互隔离，一个进程的崩溃不会直接影响其他进程</li><li><strong>并发性</strong>：多个进程可以同时运行，操作系统通过进程调度实现CPU的分时共享</li><li><strong>动态性</strong>：进程有创建、执行、暂停和终止等完整的生命周期，其状态会动态变化</li><li><strong>资源消耗大</strong>：进程切换和创建需要较多的系统资源和时间，因为涉及到完整的上下文切换（包括内存映射、寄存器状态等）</li><li><strong>保护机制</strong>：操作系统通过各种保护机制确保进程之间不会相互干扰，如内存保护、资源隔离等</li></ul><p><strong>示例：</strong><br>当你在电脑上打开一个浏览器、一个编辑器和一个音乐播放器时，每个应用程序都是一个独立的进程。操作系统会为每个进程分配独立的内存空间，它们之间不能直接访问彼此的内存。如果浏览器出现故障崩溃，编辑器和音乐播放器通常不会受到影响，仍然可以正常运行。</p><h3 id="1-2-线程（Thread）"><a href="#1-2-线程（Thread）" class="headerlink" title="1.2 线程（Thread）"></a>1.2 线程（Thread）</h3><p>线程是进程内的一个执行单元，是<strong>CPU调度的基本单位</strong>。一个进程可以包含多个线程，这些线程共享进程的内存空间和资源（如代码段、数据段、堆、文件描述符等），但有各自独立的程序计数器、栈和寄存器集合。</p><h4 id="1-2-1-线程的组成"><a href="#1-2-1-线程的组成" class="headerlink" title="1.2.1 线程的组成"></a>1.2.1 线程的组成</h4><p>一个完整的线程通常由以下几个部分组成：</p><ul><li><strong>线程ID（Thread ID, TID）</strong>：线程的唯一标识符</li><li><strong>程序计数器（Program Counter）</strong>：记录线程下一条要执行的指令的地址</li><li><strong>寄存器集合</strong>：保存线程执行时的CPU寄存器状态</li><li><strong>线程栈（Thread Stack）</strong>：线程私有的栈空间，用于存储局部变量和函数调用信息</li><li><strong>线程局部存储（Thread Local Storage, TLS）</strong>：线程私有的数据存储区域</li><li><strong>线程状态</strong>：描述线程当前所处的状态（如运行、就绪、阻塞等）</li><li><strong>优先级</strong>：决定线程在CPU调度中的优先级</li></ul><h4 id="1-2-2-线程控制块（TCB）的结构"><a href="#1-2-2-线程控制块（TCB）的结构" class="headerlink" title="1.2.2 线程控制块（TCB）的结构"></a>1.2.2 线程控制块（TCB）的结构</h4><p>与进程类似，线程也有自己的控制块，称为线程控制块（Thread Control Block, TCB）。TCB是操作系统用于管理和控制线程的核心数据结构，包含了线程的全部信息。</p><p>典型的TCB包含以下信息：</p><ol><li><p><strong>线程标识符（Thread ID, TID）</strong>：每个线程唯一的数字标识符</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">pthread_t</span> thread_id;  <span class="comment">// POSIX线程ID</span></span><br></pre></td></tr></table></figure></li><li><p><strong>线程状态</strong>：描述线程当前所处的状态，如运行态、就绪态、阻塞态等</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> &#123;</span> RUNNING, READY, BLOCKED &#125; state;</span><br></pre></td></tr></table></figure></li><li><p><strong>程序计数器</strong>：记录线程下一条要执行的指令的地址</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> *program_counter;</span><br></pre></td></tr></table></figure></li><li><p><strong>寄存器集合</strong>：保存线程执行过程中CPU寄存器的值</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> general_registers[<span class="number">16</span>];</span><br><span class="line">    <span class="type">void</span> *stack_pointer;</span><br><span class="line">    <span class="type">void</span> *base_pointer;</span><br><span class="line">    <span class="comment">// 其他寄存器...</span></span><br><span class="line">&#125; registers;</span><br></pre></td></tr></table></figure></li><li><p><strong>线程栈指针</strong>：指向线程私有的栈空间</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> *stack_start;</span><br><span class="line"><span class="type">void</span> *stack_end;</span><br></pre></td></tr></table></figure></li><li><p><strong>线程优先级</strong>：决定线程在CPU调度中的优先级</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> priority;</span><br></pre></td></tr></table></figure></li><li><p><strong>所属进程的指针</strong>：指向线程所属的进程控制块</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">process</span> *<span class="title">process_ptr</span>;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>线程局部存储信息</strong>：管理线程私有的数据</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> *thread_local_storage;</span><br></pre></td></tr></table></figure></li><li><p><strong>同步原语信息</strong>：如锁、信号量等与线程同步相关的信息</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> holding_locks[MAX_LOCKS];</span><br><span class="line">    <span class="comment">// 其他同步信息...</span></span><br><span class="line">&#125; sync_info;</span><br></pre></td></tr></table></figure></li></ol><h4 id="1-2-3-线程的实现模型"><a href="#1-2-3-线程的实现模型" class="headerlink" title="1.2.3 线程的实现模型"></a>1.2.3 线程的实现模型</h4><p>线程的实现主要有三种模型：</p><ol><li><p><strong>用户级线程（User-Level Threads, ULT）</strong></p><ul><li>由用户空间的线程库实现，操作系统内核看不到用户级线程</li><li>线程的创建、调度、销毁等操作都在用户空间完成，不需要内核干预</li><li>优点：线程切换开销小，不需要陷入内核；可以在不支持线程的操作系统上实现</li><li>缺点：一个线程阻塞会导致整个进程阻塞；不能利用多核CPU</li></ul></li><li><p><strong>内核级线程（Kernel-Level Threads, KLT）</strong></p><ul><li>由操作系统内核直接支持和管理</li><li>线程的创建、调度、销毁等操作都通过系统调用由内核完成</li><li>优点：一个线程阻塞不会影响其他线程；可以利用多核CPU</li><li>缺点：线程切换需要陷入内核，开销较大</li></ul></li><li><p><strong>混合级线程（Hybrid Threads）</strong></p><ul><li>结合了用户级线程和内核级线程的优点</li><li>用户级线程在应用程序中管理，内核级线程由操作系统管理</li><li>用户级线程与内核级线程之间通过”多对多”、”一对一”或”多对一”的方式映射</li><li>现代操作系统（如Linux、Windows）通常采用这种模型</li></ul></li></ol><h4 id="1-2-4-线程的状态转换"><a href="#1-2-4-线程的状态转换" class="headerlink" title="1.2.4 线程的状态转换"></a>1.2.4 线程的状态转换</h4><p>线程具有与进程类似的状态，但状态转换更加频繁：</p><ul><li><strong>新建（New）</strong>：线程被创建但尚未开始执行</li><li><strong>就绪（Ready）</strong>：线程已获得除CPU外的所有必要资源，等待CPU分配</li><li><strong>运行（Running）</strong>：线程正在占用CPU执行指令</li><li><strong>阻塞（Blocked&#x2F;Waiting）</strong>：线程等待某事件发生（如I&#x2F;O完成、锁释放等）而暂停执行</li><li><strong>终止（Terminated）</strong>：线程执行完毕或出错，资源被回收</li></ul><h4 id="1-2-5-线程的主要特点"><a href="#1-2-5-线程的主要特点" class="headerlink" title="1.2.5 线程的主要特点"></a>1.2.5 线程的主要特点</h4><ul><li><strong>轻量级</strong>：线程创建和切换的开销比进程小得多，因为线程共享进程的地址空间，无需切换页表和内存映射</li><li><strong>共享性</strong>：同一进程内的线程共享进程的内存空间和资源（如代码段、数据段、堆、文件描述符等）</li><li><strong>并发性</strong>：一个进程内的多个线程可以并发执行，提高程序的执行效率</li><li><strong>通信便捷</strong>：同一进程内的线程之间可以通过共享内存直接通信，比进程间通信更简单高效</li><li><strong>资源利用率高</strong>：多个线程可以充分利用CPU资源，特别是在多核处理器上</li><li><strong>独立性有限</strong>：同一进程内的线程共享内存空间，一个线程的错误可能会影响其他线程，甚至导致整个进程崩溃</li></ul><h4 id="1-2-6-线程与进程的比较"><a href="#1-2-6-线程与进程的比较" class="headerlink" title="1.2.6 线程与进程的比较"></a>1.2.6 线程与进程的比较</h4><table><thead><tr><th>特性</th><th>进程</th><th>线程</th></tr></thead><tbody><tr><td>资源分配单位</td><td>是</td><td>否（共享进程资源）</td></tr><tr><td>CPU调度单位</td><td>否（线程是CPU调度的基本单位）</td><td>是</td></tr><tr><td>地址空间</td><td>独立</td><td>共享进程的地址空间</td></tr><tr><td>创建和切换开销</td><td>大</td><td>小</td></tr><tr><td>通信方式</td><td>进程间通信（IPC）</td><td>共享内存</td></tr><tr><td>安全性</td><td>高（相互隔离）</td><td>低（共享内存）</td></tr></tbody></table><p><strong>应用场景示例</strong><br>一个Web服务器进程通常会创建多个线程来处理同时到来的多个客户端请求。每个线程独立处理一个客户端的请求，但它们共享服务器进程的资源，如数据库连接池、缓存等。这样可以提高服务器的并发处理能力，同时避免创建多个进程带来的高开销。</p><h4 id="1-2-7-线程的实际应用"><a href="#1-2-7-线程的实际应用" class="headerlink" title="1.2.7 线程的实际应用"></a>1.2.7 线程的实际应用</h4><p>在实际编程中，我们可以通过各种编程语言提供的线程库来创建和管理线程。以下是一些常见编程语言中创建线程的示例：</p><p><strong>C++（使用std::thread）：</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">threadFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Thread function executing&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建线程</span></span><br><span class="line">    <span class="function">std::thread <span class="title">t</span><span class="params">(threadFunction)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 主线程继续执行</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Main function executing&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 等待线程执行完毕</span></span><br><span class="line">    t.<span class="built_in">join</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Java：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建线程</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread is running&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 启动线程</span></span><br><span class="line">        thread.start();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 主线程继续执行</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Main thread is running&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 等待线程执行完毕</span></span><br><span class="line">            thread.join();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Python（使用threading模块）：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">thread_function</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Thread <span class="subst">&#123;name&#125;</span>: starting&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Thread <span class="subst">&#123;name&#125;</span>: finishing&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 创建线程</span></span><br><span class="line">    thread = threading.Thread(target=thread_function, args=(<span class="string">&quot;A&quot;</span>,))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 启动线程</span></span><br><span class="line">    thread.start()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 主线程继续执行</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Main: starting&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Main: finishing&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 等待线程执行完毕</span></span><br><span class="line">    thread.join()</span><br></pre></td></tr></table></figure><h3 id="1-3-协程（Coroutine）"><a href="#1-3-协程（Coroutine）" class="headerlink" title="1.3 协程（Coroutine）"></a>1.3 协程（Coroutine）</h3><p>协程是一种用户态的轻量级线程，也被称为微线程（Microthread）或纤程（Fiber）。协程的调度<strong>完全由用户程序控制，而非操作系统内核</strong>，实现了在<strong>单个线程内的多任务协作式调度</strong>。</p><h4 id="1-3-1-协程的组成"><a href="#1-3-1-协程的组成" class="headerlink" title="1.3.1 协程的组成"></a>1.3.1 协程的组成</h4><p>协程主要由以下几个部分组成：</p><ul><li><strong>程序代码</strong>：协程执行的具体逻辑</li><li><strong>局部变量</strong>：协程运行过程中使用的变量</li><li><strong>程序计数器</strong>：记录协程当前执行位置的指针</li><li><strong>栈帧</strong>：存储协程的执行上下文和返回地址</li><li><strong>状态信息</strong>：标记协程当前的运行状态</li><li><strong>调度器</strong>：负责协程间的切换和管理（通常由用户级库实现）</li></ul><h4 id="1-3-2-协程的实现机制"><a href="#1-3-2-协程的实现机制" class="headerlink" title="1.3.2 协程的实现机制"></a>1.3.2 协程的实现机制</h4><p>在不同的编程语言中，协程有多种实现方式：</p><ol><li><p><strong>基于生成器（Generator-based）</strong><br>通过生成器函数实现简单的协程功能，如Python早期版本的<code>yield</code>机制</p></li><li><p><strong>基于状态机（State Machine-based）</strong><br>使用状态变量显式管理协程的执行状态</p></li><li><p><strong>基于栈（Stack-based）</strong><br>为每个协程分配独立的栈空间，支持更复杂的函数调用层次</p></li><li><p><strong>基于编译器转换（Compiler Transformation-based）</strong><br>通过编译器将协程代码转换为状态机形式，如C++20的协程实现</p></li></ol><h4 id="1-3-3-协程的状态转换"><a href="#1-3-3-协程的状态转换" class="headerlink" title="1.3.3 协程的状态转换"></a>1.3.3 协程的状态转换</h4><p>协程通常具有以下几种状态：</p><ul><li><strong>创建（Created）</strong>：协程对象已创建但尚未开始执行</li><li><strong>就绪（Ready）</strong>：协程可以开始执行，但当前未被调度</li><li><strong>运行（Running）</strong>：协程正在执行</li><li><strong>挂起（Suspended）</strong>：协程暂时停止执行，等待唤醒</li><li><strong>完成（Completed）</strong>：协程执行完毕</li><li><strong>异常（Exceptional）</strong>：协程执行过程中发生异常</li></ul><p>协程的状态转换完全由用户程序控制，通过显式的挂起（yield）和恢复（resume）操作实现。</p><h4 id="1-3-4-协程的主要特点"><a href="#1-3-4-协程的主要特点" class="headerlink" title="1.3.4 协程的主要特点"></a>1.3.4 协程的主要特点</h4><ul><li><p><strong>用户态调度</strong>：协程的创建、切换和销毁完全由用户程序控制，不需要内核干预，避免了内核态和用户态切换的开销</p></li><li><p><strong>极高的执行效率</strong>：协程切换的开销非常小，仅涉及上下文保存和恢复，接近普通函数调用的开销</p></li><li><p><strong>非抢占式调度</strong>：协程不会被强制中断，只有在显式调用yield等函数时才会主动让出执行权，避免了线程安全问题</p></li><li><p><strong>共享内存</strong>：同一线程内的协程共享该线程的内存空间，通信效率高，但需要注意数据访问的同步问题</p></li><li><p><strong>高并发潜力</strong>：单线程内可以创建成千上万个协程，适合处理大量I&#x2F;O密集型任务</p></li></ul><h4 id="1-3-5-协程与线程的区别"><a href="#1-3-5-协程与线程的区别" class="headerlink" title="1.3.5 协程与线程的区别"></a>1.3.5 协程与线程的区别</h4><table><thead><tr><th><strong>特性</strong></th><th><strong>协程</strong></th><th><strong>线程</strong></th></tr></thead><tbody><tr><td><strong>调度方式</strong></td><td>用户态非抢占式</td><td>内核态抢占式</td></tr><tr><td><strong>切换开销</strong></td><td>极小（~几十纳秒）</td><td>较大（~几微秒到几毫秒）</td></tr><tr><td><strong>创建数量</strong></td><td>可创建成千上万个</td><td>通常最多创建数千个</td></tr><tr><td><strong>内存占用</strong></td><td>较小（几KB到几十KB）</td><td>较大（几MB）</td></tr><tr><td><strong>并发模型</strong></td><td>协作式多任务</td><td>抢占式多任务</td></tr><tr><td><strong>阻塞影响</strong></td><td>阻塞会导致整个线程阻塞</td><td>单个线程阻塞不影响其他线程</td></tr></tbody></table><h4 id="1-3-6-多语言协程实现示例"><a href="#1-3-6-多语言协程实现示例" class="headerlink" title="1.3.6 多语言协程实现示例"></a>1.3.6 多语言协程实现示例</h4><p><strong>Python（使用async&#x2F;await）：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">say_after</span>(<span class="params">delay, what</span>):</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(delay)  <span class="comment"># 协程挂起，等待指定时间</span></span><br><span class="line">    <span class="built_in">print</span>(what)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 并发执行两个协程</span></span><br><span class="line">    task1 = asyncio.create_task(say_after(<span class="number">1</span>, <span class="string">&quot;Hello&quot;</span>))</span><br><span class="line">    task2 = asyncio.create_task(say_after(<span class="number">2</span>, <span class="string">&quot;World&quot;</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;started at&quot;</span>, asyncio.current_time())</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 等待两个任务完成</span></span><br><span class="line">    <span class="keyword">await</span> task1</span><br><span class="line">    <span class="keyword">await</span> task2</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;finished at&quot;</span>, asyncio.current_time())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行主协程</span></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure><p><strong>JavaScript（使用async&#x2F;await）：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params">url</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(url); <span class="comment">// 协程挂起，等待网络请求完成</span></span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 并发执行多个异步操作</span></span><br><span class="line">        <span class="keyword">const</span> [userData, productData] = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">            <span class="title function_">fetchData</span>(<span class="string">&#x27;/api/users&#x27;</span>),</span><br><span class="line">            <span class="title function_">fetchData</span>(<span class="string">&#x27;/api/products&#x27;</span>)</span><br><span class="line">        ]);</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;用户数据:&#x27;</span>, userData);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;产品数据:&#x27;</span>, productData);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;请求失败:&#x27;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>();</span><br></pre></td></tr></table></figure><p><strong>C++20（使用协程支持库）：</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;coroutine&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 简单的协程返回类型</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Task</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">promise_type</span> &#123;</span><br><span class="line">        <span class="function">Task <span class="title">get_return_object</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line">        <span class="function">std::suspend_never <span class="title">initial_suspend</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line">        <span class="function">std::suspend_never <span class="title">final_suspend</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">return_void</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">unhandled_exception</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模拟异步操作的协程函数</span></span><br><span class="line"><span class="function">Task <span class="title">asyncOperation</span><span class="params">(<span class="type">int</span> id, <span class="type">int</span> delay)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Operation &quot;</span> &lt;&lt; id &lt;&lt; <span class="string">&quot; started\n&quot;</span>;</span><br><span class="line">    <span class="keyword">co_await</span> std::suspend_always&#123;&#125;; <span class="comment">// 挂起协程</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Operation &quot;</span> &lt;&lt; id &lt;&lt; <span class="string">&quot; resumed after delay\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> task1 = <span class="built_in">asyncOperation</span>(<span class="number">1</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">auto</span> task2 = <span class="built_in">asyncOperation</span>(<span class="number">2</span>, <span class="number">200</span>);</span><br><span class="line">    <span class="comment">// 在实际应用中，需要一个调度器来管理协程的恢复</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Go（使用goroutine和channel）：</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Go语言中的goroutine是一种特殊的协程实现</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(id <span class="type">int</span>, jobs &lt;-<span class="keyword">chan</span> <span class="type">int</span>, results <span class="keyword">chan</span>&lt;- <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> j := <span class="keyword">range</span> jobs &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;worker&quot;</span>, id, <span class="string">&quot;processing job&quot;</span>, j)</span><br><span class="line">        time.Sleep(time.Second) <span class="comment">// 模拟工作</span></span><br><span class="line">        results &lt;- j * <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    jobs := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">100</span>)</span><br><span class="line">    results := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">100</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 启动3个worker协程</span></span><br><span class="line">    <span class="keyword">for</span> w := <span class="number">1</span>; w &lt;= <span class="number">3</span>; w++ &#123;</span><br><span class="line">        <span class="keyword">go</span> worker(w, jobs, results)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发送9个任务</span></span><br><span class="line">    <span class="keyword">for</span> j := <span class="number">1</span>; j &lt;= <span class="number">9</span>; j++ &#123;</span><br><span class="line">        jobs &lt;- j</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(jobs)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 收集所有结果</span></span><br><span class="line">    <span class="keyword">for</span> a := <span class="number">1</span>; a &lt;= <span class="number">9</span>; a++ &#123;</span><br><span class="line">        &lt;-results</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="二、进程、线程和协程的关联"><a href="#二、进程、线程和协程的关联" class="headerlink" title="二、进程、线程和协程的关联"></a>二、进程、线程和协程的关联</h2><p>进程、线程和协程之间存在着密切的关联，它们共同构成了现代操作系统和编程语言中并发编程的基础。</p><h3 id="2-1-层次结构关系"><a href="#2-1-层次结构关系" class="headerlink" title="2.1 层次结构关系"></a>2.1 层次结构关系</h3><ul><li><strong>进程包含线程</strong>：一个进程可以包含多个线程，线程是进程内的执行单元</li><li><strong>线程包含协程</strong>：一个线程可以运行多个协程，协程是线程内的更轻量级的执行单元</li><li><strong>资源共享关系</strong>：进程间资源独立，同一进程内的线程共享进程资源，同一线程内的协程共享线程资源</li></ul><h3 id="2-2-调度关系"><a href="#2-2-调度关系" class="headerlink" title="2.2 调度关系"></a>2.2 调度关系</h3><ul><li><strong>操作系统调度进程和线程</strong>：进程和线程的调度由操作系统内核负责，属于抢占式调度</li><li><strong>用户程序调度协程</strong>：协程的调度由用户程序控制，属于非抢占式调度</li><li><strong>多级调度</strong>：现代系统中，通常是操作系统调度进程和线程，而在用户程序内部再调度协程</li></ul><h3 id="2-3-协作关系"><a href="#2-3-协作关系" class="headerlink" title="2.3 协作关系"></a>2.3 协作关系</h3><ul><li><strong>进程间协作</strong>：通过进程间通信（IPC）机制，如管道、消息队列、共享内存等</li><li><strong>线程间协作</strong>：通过锁、信号量、条件变量等同步原语</li><li><strong>协程间协作</strong>：通过yield、await等机制主动让出执行权</li></ul><h2 id="三、进程、线程和协程的区别"><a href="#三、进程、线程和协程的区别" class="headerlink" title="三、进程、线程和协程的区别"></a>三、进程、线程和协程的区别</h2><p>虽然进程、线程和协程都是实现并发的机制，但它们在多个方面存在着本质的区别。</p><h3 id="3-1-调度层面的区别"><a href="#3-1-调度层面的区别" class="headerlink" title="3.1 调度层面的区别"></a>3.1 调度层面的区别</h3><table><thead><tr><th>特性</th><th>进程</th><th>线程</th><th>协程</th></tr></thead><tbody><tr><td>调度者</td><td>操作系统内核</td><td>操作系统内核</td><td>用户程序</td></tr><tr><td>调度方式</td><td>抢占式</td><td>抢占式</td><td>非抢占式</td></tr><tr><td>切换开销</td><td>大（涉及上下文切换、内存映射等）</td><td>中（共享内存空间，只需切换寄存器和栈）</td><td>小（基本是函数调用级别）</td></tr><tr><td>切换时机</td><td>由操作系统决定，可能在任意时刻发生</td><td>由操作系统决定，可能在任意时刻发生</td><td>由用户程序显式控制，只有在特定点切换</td></tr></tbody></table><h3 id="3-2-资源层面的区别"><a href="#3-2-资源层面的区别" class="headerlink" title="3.2 资源层面的区别"></a>3.2 资源层面的区别</h3><table><thead><tr><th>特性</th><th>进程</th><th>线程</th><th>协程</th></tr></thead><tbody><tr><td>内存空间</td><td>独立的地址空间</td><td>共享进程的地址空间</td><td>共享线程的内存空间</td></tr><tr><td>系统资源</td><td>独立的文件描述符、信号处理等</td><td>共享进程的系统资源</td><td>共享线程的资源</td></tr><tr><td>创建开销</td><td>大</td><td>中</td><td>小</td></tr><tr><td>数量限制</td><td>较少（受系统资源限制）</td><td>较多（比进程多，但仍有限制）</td><td>极多（理论上可以创建上百万个）</td></tr></tbody></table><h3 id="3-3-通信机制的区别"><a href="#3-3-通信机制的区别" class="headerlink" title="3.3 通信机制的区别"></a>3.3 通信机制的区别</h3><table><thead><tr><th>特性</th><th>进程</th><th>线程</th><th>协程</th></tr></thead><tbody><tr><td>通信方式</td><td>IPC机制（管道、消息队列、共享内存等）</td><td>共享变量（需要同步机制）</td><td>直接共享变量（通常不需要同步机制）</td></tr><tr><td>通信效率</td><td>低</td><td>中</td><td>高</td></tr><tr><td>同步复杂度</td><td>较高</td><td>中</td><td>低（通常不需要显式同步）</td></tr></tbody></table><h3 id="3-4-适用场景的区别"><a href="#3-4-适用场景的区别" class="headerlink" title="3.4 适用场景的区别"></a>3.4 适用场景的区别</h3><table><thead><tr><th>场景</th><th>最适合的机制</th><th>原因</th></tr></thead><tbody><tr><td>CPU密集型任务</td><td>多线程或多进程</td><td>需要充分利用多核CPU</td></tr><tr><td>I&#x2F;O密集型任务（如网络请求、文件操作）</td><td>协程或多线程</td><td>协程在大量I&#x2F;O操作时效率更高，资源消耗更少</td></tr><tr><td>独立性要求高的任务</td><td>多进程</td><td>进程间相互隔离，一个进程崩溃不会影响其他进程</td></tr><tr><td>内存消耗敏感的场景</td><td>协程</td><td>协程占用内存极小，可以创建大量协程</td></tr><tr><td>实时性要求高的场景</td><td>多线程或协程</td><td>线程切换比进程快，协程切换更快</td></tr></tbody></table><h2 id="四、深入理解：从实例看三者的运作机制"><a href="#四、深入理解：从实例看三者的运作机制" class="headerlink" title="四、深入理解：从实例看三者的运作机制"></a>四、深入理解：从实例看三者的运作机制</h2><p>为了更好地理解进程、线程和协程的区别，我们通过一个简单的类比来形象地说明它们的运作方式。</p><h3 id="4-1-类比：工厂、车间和工人"><a href="#4-1-类比：工厂、车间和工人" class="headerlink" title="4.1 类比：工厂、车间和工人"></a>4.1 类比：工厂、车间和工人</h3><ul><li><strong>进程</strong>：就像一个独立的工厂，有自己的厂房、设备和资源</li><li><strong>线程</strong>：就像工厂里的车间，可以同时生产不同的产品，但共享工厂的资源</li><li><strong>协程</strong>：就像车间里的工人，在同一个车间内工作，可以协作完成任务，但一次只能有一个工人在工作</li></ul><h3 id="4-2-实际代码示例"><a href="#4-2-实际代码示例" class="headerlink" title="4.2 实际代码示例"></a>4.2 实际代码示例</h3><h4 id="4-2-1-多进程示例（Python）"><a href="#4-2-1-多进程示例（Python）" class="headerlink" title="4.2.1 多进程示例（Python）"></a>4.2.1 多进程示例（Python）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Process <span class="subst">&#123;name&#125;</span> is running&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Process <span class="subst">&#123;name&#125;</span> is done&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    processes = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        p = multiprocessing.Process(target=task, args=(<span class="string">f&#x27;P<span class="subst">&#123;i&#125;</span>&#x27;</span>,))</span><br><span class="line">        processes.append(p)</span><br><span class="line">        p.start()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> processes:</span><br><span class="line">        p.join()</span><br></pre></td></tr></table></figure><h4 id="4-2-2-多线程示例（Python）"><a href="#4-2-2-多线程示例（Python）" class="headerlink" title="4.2.2 多线程示例（Python）"></a>4.2.2 多线程示例（Python）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Thread <span class="subst">&#123;name&#125;</span> is running&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Thread <span class="subst">&#123;name&#125;</span> is done&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    threads = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        t = threading.Thread(target=task, args=(<span class="string">f&#x27;T<span class="subst">&#123;i&#125;</span>&#x27;</span>,))</span><br><span class="line">        threads.append(t)</span><br><span class="line">        t.start()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">        t.join()</span><br></pre></td></tr></table></figure><h4 id="4-2-3-协程示例（Python）"><a href="#4-2-3-协程示例（Python）" class="headerlink" title="4.2.3 协程示例（Python）"></a>4.2.3 协程示例（Python）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Coroutine <span class="subst">&#123;name&#125;</span> is running&#x27;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)  <span class="comment"># 模拟I/O操作</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Coroutine <span class="subst">&#123;name&#125;</span> is done&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 创建协程任务</span></span><br><span class="line">    tasks = [task(<span class="string">f&#x27;C<span class="subst">&#123;i&#125;</span>&#x27;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">    <span class="comment"># 并发执行协程</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.gather(*tasks)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    asyncio.run(main())</span><br></pre></td></tr></table></figure><h2 id="五、总结：如何选择合适的并发模型"><a href="#五、总结：如何选择合适的并发模型" class="headerlink" title="五、总结：如何选择合适的并发模型"></a>五、总结：如何选择合适的并发模型</h2><p>在实际开发中，选择进程、线程还是协程来实现并发，取决于多种因素。以下是一些指导原则：</p><h3 id="5-1-考虑任务类型"><a href="#5-1-考虑任务类型" class="headerlink" title="5.1 考虑任务类型"></a>5.1 考虑任务类型</h3><ul><li><strong>CPU密集型任务</strong>：如果你的任务主要是进行计算，需要充分利用多核CPU，那么多进程或多线程可能是更好的选择。在Python中，由于GIL（全局解释器锁）的存在，多线程在CPU密集型任务上可能无法充分利用多核，此时多进程可能更合适。</li><li><strong>I&#x2F;O密集型任务</strong>：如果你的任务主要是等待I&#x2F;O操作（如网络请求、文件读写等），那么协程可能是最高效的选择，因为协程可以在I&#x2F;O等待时切换到其他任务，充分利用CPU时间。</li></ul><h3 id="5-2-考虑资源限制"><a href="#5-2-考虑资源限制" class="headerlink" title="5.2 考虑资源限制"></a>5.2 考虑资源限制</h3><ul><li><strong>内存限制</strong>：如果你的应用需要创建大量的并发执行单元，协程是最佳选择，因为每个协程占用的内存非常小。</li><li><strong>系统资源</strong>：进程创建和切换的开销较大，因此在系统资源有限的情况下，应谨慎使用多进程。</li></ul><h3 id="5-3-考虑程序复杂度"><a href="#5-3-考虑程序复杂度" class="headerlink" title="5.3 考虑程序复杂度"></a>5.3 考虑程序复杂度</h3><ul><li><strong>并发控制复杂度</strong>：多线程和多进程需要处理复杂的同步和互斥问题，容易出现死锁等问题。而协程由于是非抢占式调度，通常不需要复杂的同步机制。</li><li><strong>调试难度</strong>：多线程和多进程程序的调试通常比协程程序更困难，因为线程和进程的切换由操作系统控制，执行流更难预测。</li></ul><h3 id="5-4-混合使用的趋势"><a href="#5-4-混合使用的趋势" class="headerlink" title="5.4 混合使用的趋势"></a>5.4 混合使用的趋势</h3><p>在实际项目中，常常会混合使用进程、线程和协程，以充分发挥它们各自的优势。例如：</p><ul><li>使用多进程来利用多核CPU</li><li>在每个进程中使用多线程来处理不同类型的任务</li><li>在线程中使用协程来高效处理大量I&#x2F;O操作</li></ul><h2 id="六、结语"><a href="#六、结语" class="headerlink" title="六、结语"></a>六、结语</h2><p>进程、线程和协程是现代计算机系统和编程中实现并发的三种重要机制。它们各有优缺点，适用于不同的场景。理解它们的概念、关联和区别，对于设计高效、可靠的并发程序至关重要。</p><p>随着硬件的发展和编程语言的演进，我们有了越来越多的并发编程工具和模型。选择合适的并发模型不仅需要考虑技术因素，还需要考虑应用场景、性能要求和开发维护成本等多个方面。</p><p>希望本文能够帮助你更深入地理解进程、线程和协程，在实际开发中做出更明智的选择。如果你有任何疑问或想法，欢迎在评论区讨论分享！</p>]]></content>
      
      
      
        <tags>
            
            <tag> 操作系统 </tag>
            
            <tag> 并发编程 </tag>
            
            <tag> 多线程 </tag>
            
            <tag> 协程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerfile基本介绍与使用</title>
      <link href="/2025/09/11/Dockerfile%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/"/>
      <url>/2025/09/11/Dockerfile%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><p>在现代软件开发和部署中，容器化技术已经成为一种标准实践。Docker作为最流行的容器化平台，其核心功能之一就是通过Dockerfile来定义和构建容器镜像。本文将详细介绍Dockerfile的基本概念、编写规则、运行方法以及如何将构建的镜像上传到仓库。</p><h2 id="Dockerfile的基本介绍"><a href="#Dockerfile的基本介绍" class="headerlink" title="Dockerfile的基本介绍"></a>Dockerfile的基本介绍</h2><h3 id="什么是Dockerfile"><a href="#什么是Dockerfile" class="headerlink" title="什么是Dockerfile"></a>什么是Dockerfile</h3><p>Dockerfile是一个包含用于自动构建Docker镜像的脚本命令的文本文件。它由一系列指令和参数组成，这些指令告诉Docker如何构建一个特定的镜像。使用Dockerfile，开发者可以将应用程序及其依赖环境的构建过程自动化、标准化和可复制化。</p><h3 id="Dockerfile的作用和优势"><a href="#Dockerfile的作用和优势" class="headerlink" title="Dockerfile的作用和优势"></a>Dockerfile的作用和优势</h3><ul><li><strong>自动化构建</strong>：通过Dockerfile，开发者可以自动化构建镜像的过程，无需手动执行每一步操作</li><li><strong>版本控制</strong>：Dockerfile可以像代码一样进行版本控制，便于追踪和管理镜像的变更</li><li><strong>一致性</strong>：确保在不同环境中构建的镜像完全一致，避免”在我的机器上可以运行”的问题</li><li><strong>可扩展性</strong>：通过Dockerfile的层叠特性，可以基于已有镜像快速构建新的镜像</li><li><strong>文档化</strong>：Dockerfile本身就是构建过程的文档，清晰地展示了镜像的构建步骤和依赖</li></ul><h2 id="Dockerfile文件编写的规则规范"><a href="#Dockerfile文件编写的规则规范" class="headerlink" title="Dockerfile文件编写的规则规范"></a>Dockerfile文件编写的规则规范</h2><h3 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h3><p>Dockerfile的基本结构包括：</p><ul><li><strong>注释</strong>：以<code>#</code>开头的行表示注释</li><li><strong>指令</strong>：每个指令都以大写字母开头，后跟参数</li><li><strong>顺序</strong>：Dockerfile中的指令按照从上到下的顺序执行</li></ul><h3 id="常用指令"><a href="#常用指令" class="headerlink" title="常用指令"></a>常用指令</h3><h4 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h4><p>指定基础镜像，是Dockerfile的第一个指令（除了注释外）。</p><blockquote><p>这里的基础镜像可以认为是构建镜像的底座，后续的指令都基于这个基础镜像进行构建。</p></blockquote><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">20.04</span>  <span class="comment"># 使用Ubuntu 20.04作为基础镜像</span></span><br><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.9</span>-alpine  <span class="comment"># 使用Python 3.9的Alpine版本作为基础镜像（更轻量级）</span></span><br></pre></td></tr></table></figure><h4 id="MAINTAINER（已弃用，推荐使用LABEL）"><a href="#MAINTAINER（已弃用，推荐使用LABEL）" class="headerlink" title="MAINTAINER（已弃用，推荐使用LABEL）"></a>MAINTAINER（已弃用，推荐使用LABEL）</h4><p>指定镜像的维护者信息。</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">MAINTAINER</span> John Doe &lt;john.doe@example.com&gt;</span><br><span class="line"><span class="comment"># 推荐使用LABEL</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> maintainer=<span class="string">&quot;John Doe &lt;john.doe@example.com&gt;&quot;</span></span></span><br></pre></td></tr></table></figure><h4 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h4><p>在镜像构建过程中执行命令，用于安装软件包、配置环境等。</p><blockquote><p>这里的RUN指令可以认为是在容器中执行的命令，<strong>每次执行都会创建一个新的层</strong>，所以应该尽量合并多个命令，减少镜像的层数。</p></blockquote><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y \</span></span><br><span class="line"><span class="language-bash">    nginx \</span></span><br><span class="line"><span class="language-bash">    curl &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">rm</span> -rf /var/lib/apt/lists/*  <span class="comment"># 清理apt缓存以减小镜像体积</span></span></span><br></pre></td></tr></table></figure><h4 id="COPY和ADD"><a href="#COPY和ADD" class="headerlink" title="COPY和ADD"></a>COPY和ADD</h4><p>将文件从构建上下文复制到镜像中。</p><blockquote><p>COPY仅支持简单的文件复制，而ADD还支持从URL下载和自动解压压缩文件。</p></blockquote><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . /app  <span class="comment"># 将当前目录下的所有文件复制到镜像的/app目录</span></span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> https://example.com/file.tar.gz /tmp  <span class="comment"># 从URL下载文件并复制到镜像的/tmp目录</span></span></span><br></pre></td></tr></table></figure><h4 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h4><p>设置工作目录，后续的RUN、CMD、ENTRYPOINT、COPY和ADD指令都将在这个目录下执行。</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app  <span class="comment"># 设置工作目录为/app</span></span></span><br></pre></td></tr></table></figure><h4 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h4><p>设置环境变量，可以在容器运行时保持。</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> NODE_ENV=production \</span><br><span class="line">    PORT=<span class="number">3000</span>  <span class="comment"># 设置环境变量</span></span><br></pre></td></tr></table></figure><h4 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h4><p>声明容器运行时监听的端口，但<strong>这只是一个声明，并不会自动映射到主机</strong>。</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span> <span class="number">443</span>  <span class="comment"># 声明容器监听80和443端口</span></span><br></pre></td></tr></table></figure><h4 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h4><p>指定容器启动时默认执行的命令。</p><blockquote><p>一个Dockerfile中只能有一个CMD指令，如果有多个，只有最后一个生效。</p></blockquote><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;nginx&quot;</span>, <span class="string">&quot;-g&quot;</span>, <span class="string">&quot;daemon off;&quot;</span>]  <span class="comment"># 使用exec格式运行nginx</span></span></span><br></pre></td></tr></table></figure><h4 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h4><p>设置容器启动时运行的命令，与CMD不同，ENTRYPOINT不会被<code>docker run</code>命令行参数覆盖（除非使用<code>--entrypoint</code>选项）。</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;app.jar&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;--spring.profiles.active=prod&quot;</span>]  <span class="comment"># 作为ENTRYPOINT的默认参数</span></span></span><br></pre></td></tr></table></figure><h3 id="编写Dockerfile的最佳实践"><a href="#编写Dockerfile的最佳实践" class="headerlink" title="编写Dockerfile的最佳实践"></a>编写Dockerfile的最佳实践</h3><ul><li><strong>使用官方基础镜像</strong>：官方镜像通常更安全、更优化</li><li><strong>最小化镜像层数</strong>：合并相关的RUN指令，使用<code>\</code>和<code>&amp;&amp;</code>来连接命令</li><li><strong>清理不需要的文件</strong>：在每个RUN指令结束前清理缓存和临时文件</li><li><strong>使用.dockerignore文件</strong>：排除不需要复制到构建上下文的文件</li><li><strong>使用多阶段构建</strong>：特别是对于编译型语言，可以大大减小最终镜像的体积</li><li><strong>设置合理的WORKDIR和ENV</strong>：使容器运行环境更加清晰和可配置</li></ul><h2 id="Dockerfile运行"><a href="#Dockerfile运行" class="headerlink" title="Dockerfile运行"></a>Dockerfile运行</h2><h3 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h3><p>使用<code>docker build</code>命令根据Dockerfile构建镜像：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本语法：docker build -t 镜像名称:标签 构建上下文路径</span></span><br><span class="line">docker build -t myapp:latest .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定Dockerfile路径</span></span><br><span class="line"><span class="comment"># docker build -t myapp:latest -f ./docker/Dockerfile .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建时传递参数</span></span><br><span class="line"><span class="comment"># docker build -t myapp:latest --build-arg VERSION=1.0 .</span></span><br></pre></td></tr></table></figure><p>参数说明：</p><ul><li><code>-t</code>：指定镜像的名称和标签</li><li><code>-f</code>：指定Dockerfile的路径（默认查找当前目录下的Dockerfile）</li><li><code>--build-arg</code>：传递构建时变量</li><li><code>.</code>：表示构建上下文为当前目录</li></ul><h3 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a>运行容器</h3><p>使用<code>docker run</code>命令基于构建好的镜像运行容器：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本语法：docker run [选项] 镜像名称 [命令] [参数]</span></span><br><span class="line">docker run -d -p 80:80 --name myapp-container myapp:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 交互式运行</span></span><br><span class="line"><span class="comment"># docker run -it --name myapp-container myapp:latest /bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 挂载数据卷</span></span><br><span class="line"><span class="comment"># docker run -d -p 80:80 -v /host/path:/container/path myapp:latest</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置环境变量</span></span><br><span class="line"><span class="comment"># docker run -d -p 80:80 -e ENV_VAR=value myapp:latest</span></span><br></pre></td></tr></table></figure><p>参数说明：</p><ul><li><code>-d</code>：后台运行容器</li><li><code>-p</code>：映射主机端口到容器端口，格式为<code>主机端口:容器端口</code></li><li><code>--name</code>：指定容器名称</li><li><code>-it</code>：以交互式终端模式运行</li><li><code>-v</code>：挂载数据卷</li><li><code>-e</code>：设置环境变量</li></ul><h3 id="查看构建历史"><a href="#查看构建历史" class="headerlink" title="查看构建历史"></a>查看构建历史</h3><p>使用<code>docker history</code>命令查看镜像的构建历史：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">history</span> myapp:latest</span><br></pre></td></tr></table></figure><p>这可以帮助你了解镜像的各层是如何构建的，以及每一层的大小，有助于优化Dockerfile。</p><h2 id="上传到私人仓库以及Hub仓库"><a href="#上传到私人仓库以及Hub仓库" class="headerlink" title="上传到私人仓库以及Hub仓库"></a>上传到私人仓库以及Hub仓库</h2><h3 id="上传到Docker-Hub仓库"><a href="#上传到Docker-Hub仓库" class="headerlink" title="上传到Docker Hub仓库"></a>上传到Docker Hub仓库</h3><p>Docker Hub是Docker官方的公共镜像仓库，你可以将自己的镜像上传到Docker Hub，供他人使用或在多环境中部署。</p><h4 id="上传到Docker-Hub账号"><a href="#上传到Docker-Hub账号" class="headerlink" title="上传到Docker Hub账号"></a>上传到Docker Hub账号</h4><p>首先，你需要在<a href="https://hub.docker.com/">Docker Hub官网</a>注册一个账号。</p><h4 id="登录Docker-Hub"><a href="#登录Docker-Hub" class="headerlink" title="登录Docker Hub"></a>登录Docker Hub</h4><p>使用<code>docker login</code>命令登录到Docker Hub：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login</span><br></pre></td></tr></table></figure><p>按照提示输入你的Docker Hub用户名和密码。</p><h4 id="标记镜像"><a href="#标记镜像" class="headerlink" title="标记镜像"></a>标记镜像</h4><p>在推送镜像之前，需要为镜像添加一个包含Docker Hub用户名的标签：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 格式：docker tag 原镜像名称:标签 Docker Hub用户名/镜像名称:标签</span></span><br><span class="line">docker tag myapp:latest yourusername/myapp:latest</span><br></pre></td></tr></table></figure><h4 id="推送镜像"><a href="#推送镜像" class="headerlink" title="推送镜像"></a>推送镜像</h4><p>使用<code>docker push</code>命令将镜像推送到Docker Hub：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 格式：docker push Docker Hub用户名/镜像名称:标签</span></span><br><span class="line">docker push yourusername/myapp:latest</span><br></pre></td></tr></table></figure><h3 id="私有仓库"><a href="#私有仓库" class="headerlink" title="私有仓库"></a>私有仓库</h3><p>在企业环境中，通常会使用私有Docker仓库来存储和管理镜像。下面介绍如何将镜像上传到私有仓库。</p><h4 id="标记镜像-1"><a href="#标记镜像-1" class="headerlink" title="标记镜像"></a>标记镜像</h4><p>为镜像添加包含私有仓库地址的标签：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 格式：docker tag 原镜像名称:标签 私有仓库地址/镜像名称:标签</span></span><br><span class="line">docker tag myapp:latest registry.example.com/myapp:latest</span><br></pre></td></tr></table></figure><h4 id="登录私有仓库"><a href="#登录私有仓库" class="headerlink" title="登录私有仓库"></a>登录私有仓库</h4><p>如果私有仓库需要认证，使用<code>docker login</code>命令登录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login registry.example.com</span><br></pre></td></tr></table></figure><h4 id="推送镜像-1"><a href="#推送镜像-1" class="headerlink" title="推送镜像"></a>推送镜像</h4><p>使用<code>docker push</code>命令将镜像推送到私有仓库：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 格式：docker push 私有仓库地址/镜像名称:标签</span></span><br><span class="line">docker push registry.example.com/myapp:latest</span><br></pre></td></tr></table></figure><h3 id="从仓库拉取镜像"><a href="#从仓库拉取镜像" class="headerlink" title="从仓库拉取镜像"></a>从仓库拉取镜像</h3><p>无论是从Docker Hub还是私有仓库，拉取镜像的命令都是相同的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从Docker Hub拉取</span></span><br><span class="line">docker pull yourusername/myapp:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从私有仓库拉取</span></span><br><span class="line">docker pull registry.example.com/myapp:latest</span><br></pre></td></tr></table></figure><h2 id="简单的应用范例"><a href="#简单的应用范例" class="headerlink" title="简单的应用范例"></a>简单的应用范例</h2><p>下面通过一个简单的Node.js应用示例，展示如何使用Dockerfile构建和部署应用。</p><h3 id="创建Node-js应用"><a href="#创建Node-js应用" class="headerlink" title="创建Node.js应用"></a>创建Node.js应用</h3><p>首先，创建一个简单的Node.js应用：</p><ol><li>创建项目目录并进入：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> node-app &amp;&amp; <span class="built_in">cd</span> node-app</span><br></pre></td></tr></table></figure><ol start="2"><li>创建<code>package.json</code>文件：</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node-app&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A simple Node.js app&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;app.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node app.js&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;express&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.17.1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>创建<code>app.js</code>文件：</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> port = process.<span class="property">env</span>.<span class="property">PORT</span> || <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;Hello Docker!&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`App running on port <span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="4"><li>创建<code>.dockerignore</code>文件：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">node_modules</span><br><span class="line">npm-debug.log</span><br><span class="line">Dockerfile</span><br><span class="line">.dockerignore</span><br><span class="line">.git</span><br><span class="line">.gitignore</span><br></pre></td></tr></table></figure><h3 id="创建Dockerfile"><a href="#创建Dockerfile" class="headerlink" title="创建Dockerfile"></a>创建Dockerfile</h3><p>在项目根目录创建<code>Dockerfile</code>文件：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用官方Node.js镜像作为基础镜像</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">16</span>-alpine</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置工作目录</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制package.json和package-lock.json（如果存在）</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> package*.json ./</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install --production</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制应用程序代码</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置环境变量</span></span><br><span class="line"><span class="keyword">ENV</span> NODE_ENV=production</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动应用</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;npm&quot;</span>, <span class="string">&quot;start&quot;</span>]</span></span><br></pre></td></tr></table></figure><h3 id="构建和运行镜像"><a href="#构建和运行镜像" class="headerlink" title="构建和运行镜像"></a>构建和运行镜像</h3><ol><li>构建镜像：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t node-app:latest .</span><br></pre></td></tr></table></figure><ol start="2"><li>运行容器：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3000:3000 --name node-app-container node-app:latest</span><br></pre></td></tr></table></figure><ol start="3"><li>验证应用是否正常运行：</li></ol><p>打开浏览器访问<code>http://localhost:3000</code>，应该能看到”Hello Docker!”的消息。或者使用curl命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:3000</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Dockerfile是Docker生态系统中的重要组成部分，它提供了一种标准化、自动化的方式来构建Docker镜像。</p><p>掌握Dockerfile的编写和使用，对于提高开发效率、确保环境一致性、简化部署流程都具有重要意义。希望本文能帮助你快速上手Dockerfile，并在实际项目中应用这些知识。</p><p>在使用Dockerfile的过程中，记得遵循最佳实践，不断优化你的Dockerfile，以构建更小、更安全、更高效的Docker镜像。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Dockerfile </tag>
            
            <tag> 容器化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++指针</title>
      <link href="/2025/09/10/C-%E6%8C%87%E9%92%88/"/>
      <url>/2025/09/10/C-%E6%8C%87%E9%92%88/</url>
      
        <content type="html"><![CDATA[<h2 id="指针的介绍"><a href="#指针的介绍" class="headerlink" title="指针的介绍"></a>指针的介绍</h2><p>C++指针是一种特殊的变量，其本质是内存地址的“容器”——它不直接存储数据值，而是记录某块内存空间的起始位置；通过解引用操作符**（*）**可以访问或修改该地址上的实际数据。这一特性使指针能直接与计算机内存交互，成为动态内存管理（如通过new分配、delete释放资源）、高效操作复杂数据结构（如链表、树的节点链接）以及优化程序性能的核心工具。</p><h2 id="指针的引入"><a href="#指针的引入" class="headerlink" title="指针的引入"></a>指针的引入</h2><p>函数一般是只能返回一个值，即使我们函数里面可以写多个return，但只要执行到一个return，函数就会结束。而数组虽能返回多个值（数组里面包含多个元素），但是数组内元素的数据类型是一致的，对于不同的数据类型，也不能做到返回多个值。</p><p>因此为了解决这一问题，可以使用指针，使用指针可以想返回几个值就返回几个值，想要返回什么类型就返回什么类型。</p><p>在程序设计过程中，存入数据还是取出数据都需要与内存单元打交道，计算机通过地址编码来表示内存单元。</p><p>指针类型就是为了处理计算机地址数据的，计算机将内存划分为若干个存储空间大小的单元，每个单元大小就是一个字节，即计算机将内存换分为一个一个的字节，然后为每一个字节分配唯一的编码，这个编码即为这个字节的地址。</p><p>指针就是用来表示这些地址的，即指针型数据不是什么字符型数据，而存的是我们内存中的地址编码。</p><p>指针可以提高程序的效率，更重要的是能使一个函数访问另一个函数的局部变量，指针是两个函数进行数据交换必不可少的工具。</p><h3 id="地址与指针的概念"><a href="#地址与指针的概念" class="headerlink" title="地址与指针的概念"></a>地址与指针的概念</h3><p>在计算机系统中，内存是由大量的存储单元组成的，每个存储单元都有一个唯一的编号，这个编号就是内存地址。内存地址的作用类似于日常生活中家庭的门牌号，通过它可以准确找到对应的存储位置。</p><p><strong>在32位系统中</strong>，内存地址通常用32位二进制数表示，这意味着系统最多可以寻址4GB的内存空间；而在64位系统中，内存地址由64位二进制数表示，理论上可以支持更大的内存空间（约18EB）。</p><p>指针本质上就是一个用于存储内存地址的变量。与普通变量不同，指针变量中存储的不是具体的数据值，而是某块内存空间的地址。通过这个地址，程序可以间接地访问或修改该地址对应的内存单元中的数据。</p><p>在C++中，指针的定义需要指明其指向的数据类型。例如：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> *p;  <span class="comment">// 定义一个指向整型数据的指针变量p</span></span><br><span class="line"><span class="type">char</span> *q; <span class="comment">// 定义一个指向字符型数据的指针变量q</span></span><br></pre></td></tr></table></figure><p>这里的<code>*</code>符号表示这是一个指针变量，而<code>int</code>和<code>char</code>则指定了该指针可以指向的数据类型。指针的类型决定了通过该指针访问内存时的寻址范围和数据解释方式。</p><p>需要注意的是，指针变量在定义后如果没有初始化，它的值是不确定的（通常称为野指针），直接使用这样的指针可能会导致程序崩溃或产生不可预期的结果。因此，在使用指针前，应该始终确保它指向了有效的内存空间。</p><h2 id="指针的定义形式和含义"><a href="#指针的定义形式和含义" class="headerlink" title="指针的定义形式和含义"></a>指针的定义形式和含义</h2><p>在C++中，指针的定义遵循一定的语法规则，正确理解这些语法对于掌握指针的使用至关重要。</p><h3 id="指针定义的基本语法"><a href="#指针定义的基本语法" class="headerlink" title="指针定义的基本语法"></a>指针定义的基本语法</h3><p>指针定义的基本形式为：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">数据类型 *指针变量名;</span><br></pre></td></tr></table></figure><p>其中：</p><ul><li><code>数据类型</code>：表示该指针可以指向的数据类型，也称为指针的基类型</li><li><code>*</code>：星号是一个指针声明符，表明这是一个指针变量</li><li><code>指针变量名</code>：遵循标识符命名规则的变量名称</li></ul><p>需要注意的是，在C++中，星号<code>*</code>实际上是与变量名绑定的，而不是与数据类型绑定的。这意味着在同一行定义多个指针时，每个指针变量前都需要添加星号：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> *p1, *p2;  <span class="comment">// 正确：p1和p2都是指向int类型的指针</span></span><br><span class="line"><span class="type">int</span>* p3, p4;   <span class="comment">// 错误：p3是指向int类型的指针，但p4是普通int变量</span></span><br></pre></td></tr></table></figure><h3 id="不同类型指针的定义示例"><a href="#不同类型指针的定义示例" class="headerlink" title="不同类型指针的定义示例"></a>不同类型指针的定义示例</h3><p>以下是一些常见数据类型的指针定义示例：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> *p_int;       <span class="comment">// 指向整型数据的指针</span></span><br><span class="line"><span class="type">char</span> *p_char;     <span class="comment">// 指向字符型数据的指针</span></span><br><span class="line"><span class="type">float</span> *p_float;   <span class="comment">// 指向浮点型数据的指针</span></span><br><span class="line"><span class="type">double</span> *p_double; <span class="comment">// 指向双精度浮点型数据的指针</span></span><br><span class="line"><span class="built_in">int</span> (*p_array)[<span class="number">5</span>]; <span class="comment">// 指向包含5个int元素的数组的指针</span></span><br><span class="line"><span class="built_in">int</span> (*p_func)(<span class="type">int</span>, <span class="type">int</span>); <span class="comment">// 指向返回int、接受两个int参数的函数的指针</span></span><br></pre></td></tr></table></figure><h3 id="指针的类型含义"><a href="#指针的类型含义" class="headerlink" title="指针的类型含义"></a>指针的类型含义</h3><p>指针的基类型决定了通过该指针访问内存时的行为：</p><ol><li><p><strong>寻址范围</strong>：指针的类型决定了从指针指向的地址开始，一次可以访问的内存字节数。例如，<code>char*</code>指针一次访问1个字节，<code>int*</code>指针（在32位系统中）通常一次访问4个字节。</p></li><li><p><strong>指针运算</strong>：当对指针进行加减运算时，指针移动的字节数等于基类型的大小。例如，<code>int*</code>指针加1，实际地址值增加4（假设int占4字节）。</p></li><li><p><strong>数据解释</strong>：通过指针访问内存时，系统会根据指针的类型来解释读取到的二进制数据。同样的二进制数据，用<code>int*</code>和<code>float*</code>访问可能会得到完全不同的数值。</p></li></ol><h3 id="指针的占用内存大小"><a href="#指针的占用内存大小" class="headerlink" title="指针的占用内存大小"></a>指针的占用内存大小</h3><p>在相同的编译环境下，无论指针指向的数据类型是什么，指针变量本身占用的内存大小是相同的。这是因为所有指针存储的都是内存地址，而地址的长度由系统的寻址能力决定：</p><ul><li>在32位系统中，指针变量通常占用4个字节</li><li>在64位系统中，指针变量通常占用8个字节</li></ul><p>可以通过<code>sizeof</code>运算符来验证这一点：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cout &lt;&lt; <span class="string">&quot;sizeof(int*) = &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">int</span>*) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;sizeof(char*) = &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">char</span>*) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;sizeof(double*) = &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">double</span>*) &lt;&lt; endl;</span><br></pre></td></tr></table></figure><p>在同一系统中，以上三个输出结果应该是相同的。</p><h3 id="特殊指针类型"><a href="#特殊指针类型" class="headerlink" title="特殊指针类型"></a>特殊指针类型</h3><p>C++中还有一些特殊的指针类型，它们具有特定的含义和用途：</p><ol><li><p><strong>空指针（nullptr）</strong>：表示不指向任何有效内存地址的指针。在C++11及以后的标准中，推荐使用关键字<code>nullptr</code>来表示空指针，而不是使用<code>NULL</code>宏。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> *p = <span class="literal">nullptr</span>; <span class="comment">// 正确：使用nullptr初始化指针</span></span><br></pre></td></tr></table></figure></li><li><p><strong>const指针</strong>：指针本身的值不能被修改（即不能改变指针的指向）。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">10</span>, b = <span class="number">20</span>;</span><br><span class="line"><span class="type">int</span> *<span class="type">const</span> p = &amp;a; <span class="comment">// p是一个const指针，始终指向a</span></span><br><span class="line"><span class="comment">// p = &amp;b;  // 错误：不能改变const指针的指向</span></span><br><span class="line">*p = <span class="number">30</span>;   <span class="comment">// 正确：可以通过const指针修改所指对象的值</span></span><br></pre></td></tr></table></figure></li><li><p><strong>指向const的指针</strong>：指针所指向的对象的值不能通过该指针修改。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> *p = &amp;a; <span class="comment">// p是一个指向const的指针</span></span><br><span class="line"><span class="comment">// *p = 20;  // 错误：不能通过p修改a的值</span></span><br><span class="line"><span class="type">int</span> b = <span class="number">20</span>;</span><br><span class="line">p = &amp;b;    <span class="comment">// 正确：可以改变p的指向</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="指针的特殊用法"><a href="#指针的特殊用法" class="headerlink" title="指针的特殊用法"></a>指针的特殊用法</h2><p>指针在C++中有许多特殊而强大的用法，这些用法使得指针成为C++中灵活而高效的工具。下面介绍几种常见的指针特殊用法。</p><h3 id="1-指针与数组"><a href="#1-指针与数组" class="headerlink" title="1. 指针与数组"></a>1. 指针与数组</h3><p>在C++中，指针和数组有着密切的关系。数组名实际上是一个指向数组首元素的常量指针。这意味着我们可以使用指针来访问数组元素：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> arr[<span class="number">5</span>] = &#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>&#125;;</span><br><span class="line"><span class="type">int</span> *p = arr;  <span class="comment">// 等价于 int *p = &amp;arr[0];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用指针访问数组元素</span></span><br><span class="line">cout &lt;&lt; *p &lt;&lt; endl;      <span class="comment">// 输出：10，访问arr[0]</span></span><br><span class="line">cout &lt;&lt; *(p + <span class="number">1</span>) &lt;&lt; endl; <span class="comment">// 输出：20，访问arr[1]</span></span><br><span class="line">cout &lt;&lt; *(p + <span class="number">2</span>) &lt;&lt; endl; <span class="comment">// 输出：30，访问arr[2]</span></span><br></pre></td></tr></table></figure><p>需要注意的是，当指针进行加减运算时，指针移动的字节数等于其基类型的大小。例如，对于<code>int*</code>指针，加1操作会使指针地址增加4字节（假设int占4字节）。</p><h3 id="2-指针数组"><a href="#2-指针数组" class="headerlink" title="2. 指针数组"></a>2. 指针数组</h3><p>指针数组是一个数组，其每个元素都是一个指针。指针数组常用于存储多个字符串或多个数组的地址：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 存储多个字符串的指针数组</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *names[] = &#123;<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Charlie&quot;</span>, <span class="string">&quot;David&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问指针数组中的元素</span></span><br><span class="line">cout &lt;&lt; names[<span class="number">0</span>] &lt;&lt; endl; <span class="comment">// 输出：Alice</span></span><br><span class="line">cout &lt;&lt; names[<span class="number">1</span>] &lt;&lt; endl; <span class="comment">// 输出：Bob</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储多个整型数组地址的指针数组</span></span><br><span class="line"><span class="type">int</span> arr1[] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line"><span class="type">int</span> arr2[] = &#123;<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;;</span><br><span class="line"><span class="type">int</span> arr3[] = &#123;<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;;</span><br><span class="line"><span class="type">int</span> *arrays[] = &#123;arr1, arr2, arr3&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过指针数组访问各个数组的元素</span></span><br><span class="line">cout &lt;&lt; arrays[<span class="number">0</span>][<span class="number">1</span>] &lt;&lt; endl; <span class="comment">// 输出：2，访问arr1[1]</span></span><br><span class="line">cout &lt;&lt; arrays[<span class="number">2</span>][<span class="number">2</span>] &lt;&lt; endl; <span class="comment">// 输出：9，访问arr3[2]</span></span><br></pre></td></tr></table></figure><h3 id="3-多级指针"><a href="#3-多级指针" class="headerlink" title="3. 多级指针"></a>3. 多级指针</h3><p>多级指针是指向指针的指针。在某些复杂的数据结构中，我们可能需要使用多级指针来间接访问数据：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> *p = &amp;a;     <span class="comment">// 一级指针，指向a</span></span><br><span class="line"><span class="type">int</span> **pp = &amp;p;   <span class="comment">// 二级指针，指向p</span></span><br><span class="line"><span class="type">int</span> ***ppp = &amp;pp; <span class="comment">// 三级指针，指向pp</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过多级指针访问a的值</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;a = &quot;</span> &lt;&lt; a &lt;&lt; endl;       <span class="comment">// 直接访问，输出：10</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;*p = &quot;</span> &lt;&lt; *p &lt;&lt; endl;     <span class="comment">// 通过一级指针访问，输出：10</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;**pp = &quot;</span> &lt;&lt; **pp &lt;&lt; endl; <span class="comment">// 通过二级指针访问，输出：10</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;***ppp = &quot;</span> &lt;&lt; ***ppp &lt;&lt; endl; <span class="comment">// 通过三级指针访问，输出：10</span></span><br></pre></td></tr></table></figure><p>在实际编程中，二级指针较为常见，而三级及以上的指针则较少使用，因为它们会使代码变得复杂难懂。</p><h3 id="4-void指针"><a href="#4-void指针" class="headerlink" title="4. void指针"></a>4. void指针</h3><p><code>void*</code>指针是一种特殊类型的指针，可以指向任何类型的数据，但不能直接通过它访问所指向的数据（需要先进行类型转换）：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> *vp;</span><br><span class="line"><span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="type">char</span> c = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line"></span><br><span class="line">vp = &amp;a;  <span class="comment">// void指针指向整型变量</span></span><br><span class="line"><span class="comment">// cout &lt;&lt; *vp &lt;&lt; endl;  // 错误：不能直接解引用void指针</span></span><br><span class="line">cout &lt;&lt; *((<span class="type">int</span>*)vp) &lt;&lt; endl; <span class="comment">// 正确：先将void指针转换为int指针，再解引用，输出：10</span></span><br><span class="line"></span><br><span class="line">vp = &amp;c;  <span class="comment">// void指针指向字符型变量</span></span><br><span class="line">cout &lt;&lt; *((<span class="type">char</span>*)vp) &lt;&lt; endl; <span class="comment">// 正确：先将void指针转换为char指针，再解引用，输出：A</span></span><br></pre></td></tr></table></figure><p>void指针常用于函数参数和返回值，以实现通用的数据处理功能。例如，C语言中的<code>malloc</code>函数返回的就是<code>void*</code>类型的指针。</p><h3 id="5-野指针和悬空指针"><a href="#5-野指针和悬空指针" class="headerlink" title="5. 野指针和悬空指针"></a>5. 野指针和悬空指针</h3><ul><li><p><strong>野指针</strong>：未初始化的指针，其指向的内存地址是不确定的。使用野指针可能会导致程序崩溃或数据损坏。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> *p; <span class="comment">// 野指针，未初始化</span></span><br><span class="line"><span class="comment">// *p = 10; // 危险：可能导致程序崩溃或数据损坏</span></span><br></pre></td></tr></table></figure></li><li><p><strong>悬空指针</strong>：指针曾经指向有效的内存，但该内存已被释放（例如通过<code>delete</code>操作）。使用悬空指针同样危险。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> *p = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">delete</span> p;  <span class="comment">// 释放p指向的内存，但p本身并未置空</span></span><br><span class="line"><span class="comment">// *p = 20; // 危险：p现在是悬空指针，指向已释放的内存</span></span><br></pre></td></tr></table></figure></li></ul><p>为了避免野指针和悬空指针的问题，应该始终：</p><ol><li>指针定义后立即初始化（即使初始化为<code>nullptr</code>）</li><li>指针释放内存后将其设为<code>nullptr</code></li></ol><h3 id="6-指针与函数"><a href="#6-指针与函数" class="headerlink" title="6. 指针与函数"></a>6. 指针与函数</h3><p>指针在函数中的应用主要包括：</p><ul><li><p><strong>函数参数传递</strong>：通过指针传递参数，可以在函数内部修改实参的值</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">int</span> *a, <span class="type">int</span> *b)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> temp = *a;</span><br><span class="line">    *a = *b;</span><br><span class="line">    *b = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">10</span>, y = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">swap</span>(&amp;x, &amp;y);  <span class="comment">// 通过指针传递参数</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;x = &quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;, y = &quot;</span> &lt;&lt; y &lt;&lt; endl; <span class="comment">// 输出：x = 20, y = 10</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>函数返回指针</strong>：函数可以返回指针，但需要确保返回的指针指向的内存是有效的（不是局部变量的地址）</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> *<span class="title">createArray</span><span class="params">(<span class="type">int</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> *arr = <span class="keyword">new</span> <span class="type">int</span>[size];  <span class="comment">// 在堆上分配内存</span></span><br><span class="line">    <span class="keyword">return</span> arr;  <span class="comment">// 返回指向堆内存的指针</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>函数指针</strong>：指向函数的指针，可以用于实现回调函数等功能</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">subtract</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">int</span> (*operation)(<span class="type">int</span>, <span class="type">int</span>);  <span class="comment">// 声明一个函数指针</span></span><br><span class="line">    </span><br><span class="line">    operation = add;  <span class="comment">// 函数指针指向add函数</span></span><br><span class="line">    cout &lt;&lt; <span class="built_in">operation</span>(<span class="number">5</span>, <span class="number">3</span>) &lt;&lt; endl;  <span class="comment">// 调用add函数，输出：8</span></span><br><span class="line">    </span><br><span class="line">    operation = subtract;  <span class="comment">// 函数指针指向subtract函数</span></span><br><span class="line">    cout &lt;&lt; <span class="built_in">operation</span>(<span class="number">5</span>, <span class="number">3</span>) &lt;&lt; endl;  <span class="comment">// 调用subtract函数，输出：2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="7-智能指针（C-11及以后）"><a href="#7-智能指针（C-11及以后）" class="headerlink" title="7. 智能指针（C++11及以后）"></a>7. 智能指针（C++11及以后）</h3><p>为了解决手动内存管理容易导致的内存泄漏问题，C++11引入了智能指针，它可以自动管理动态分配的内存：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// unique_ptr：独占所有权的智能指针</span></span><br><span class="line">    <span class="function">std::unique_ptr&lt;<span class="type">int</span>&gt; <span class="title">up1</span><span class="params">(<span class="keyword">new</span> <span class="type">int</span>(<span class="number">10</span>))</span></span>;</span><br><span class="line">    <span class="comment">// std::unique_ptr&lt;int&gt; up2 = up1;  // 错误：unique_ptr不允许拷贝</span></span><br><span class="line">    std::unique_ptr&lt;<span class="type">int</span>&gt; up2 = std::<span class="built_in">move</span>(up1);  <span class="comment">// 正确：可以通过move转移所有权</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// shared_ptr：共享所有权的智能指针</span></span><br><span class="line">    <span class="function">std::shared_ptr&lt;<span class="type">int</span>&gt; <span class="title">sp1</span><span class="params">(<span class="keyword">new</span> <span class="type">int</span>(<span class="number">20</span>))</span></span>;</span><br><span class="line">    std::shared_ptr&lt;<span class="type">int</span>&gt; sp2 = sp1;  <span class="comment">// 正确：shared_ptr允许多个指针共享同一块内存</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// weak_ptr：不增加引用计数的共享指针，用于解决shared_ptr的循环引用问题</span></span><br><span class="line">    std::weak_ptr&lt;<span class="type">int</span>&gt; wp = sp1;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>智能指针是现代C++中推荐的内存管理方式，可以大大减少内存泄漏和悬空指针的问题。</p><h2 id="指针使用的注意事项"><a href="#指针使用的注意事项" class="headerlink" title="指针使用的注意事项"></a>指针使用的注意事项</h2><ul><li>始终初始化指针（即使初始化为nullptr）</li><li>避免使用未初始化的指针（野指针）</li><li>释放内存后将指针设为nullptr，避免悬空指针</li><li>注意指针的作用域和生命周期</li><li>理解指针运算的含义，避免越界访问</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>C++指针是一种强大而灵活的工具，它允许程序直接与内存交互，是C++语言的核心特性之一。</p><ul><li>C++11引入了智能指针（<strong>unique_ptr</strong>、<strong>shared_ptr</strong>和<strong>weak_ptr</strong>），它们可以自动管理动态分配的内存，大大减少了内存泄漏和悬空指针的问题</li><li>在现代C++编程中，推荐优先使用智能指针而非原始指针进行内存管理</li></ul><p>总之，掌握指针的使用是学习C++的重要环节。指针既可以提高程序的效率和灵活性，也可能带来安全隐患和难以调试的错误。因此，在使用指针时，我们应该始终保持谨慎，遵循良好的编程实践，确保代码的安全性和可靠性。随着对指针理解的深入，我们将能够更加灵活地运用C++语言的强大功能，编写出高效、优雅的程序。</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux设置Systemctl服务</title>
      <link href="/2025/09/02/Linux%E8%AE%BE%E7%BD%AESystemctl%E6%9C%8D%E5%8A%A1/"/>
      <url>/2025/09/02/Linux%E8%AE%BE%E7%BD%AESystemctl%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="一、什么是Systemctl"><a href="#一、什么是Systemctl" class="headerlink" title="一、什么是Systemctl"></a>一、什么是Systemctl</h2><h3 id="1-1-Systemctl简介"><a href="#1-1-Systemctl简介" class="headerlink" title="1.1 Systemctl简介"></a>1.1 Systemctl简介</h3><p><code>Systemctl</code>是Linux系统中用于管理<code>systemd</code>系统和服务管理器的主要命令行工具。它允许用户查看、启动、停止、重启、启用和禁用系统服务，以及检查服务状态等。</p><h3 id="1-2-Systemd与Systemctl的关系"><a href="#1-2-Systemd与Systemctl的关系" class="headerlink" title="1.2 Systemd与Systemctl的关系"></a>1.2 Systemd与Systemctl的关系</h3><p><code>Systemd</code>是Linux系统的初始化系统和服务管理器，负责启动系统、管理后台进程和服务。</p><p>而<code>Systemctl</code>则是与<code>systemd</code>交互的命令行接口工具，用户通过<code>Systemctl</code>命令来控制和管理<code>systemd</code>服务。</p><p>简单来说，<code>systemd</code>是底层的服务管理系统，<code>Systemctl</code>是用户操作这个系统的工具。</p><h3 id="1-3-为什么需要使用Systemctl管理服务"><a href="#1-3-为什么需要使用Systemctl管理服务" class="headerlink" title="1.3 为什么需要使用Systemctl管理服务"></a>1.3 为什么需要使用Systemctl管理服务</h3><ul><li><strong>统一管理</strong>：<code>Systemctl</code>提供了统一的接口来管理各种系统服务，取代了传统的SysV init脚本。</li><li><strong>服务依赖</strong>：<code>Systemctl</code>可以轻松处理服务之间的依赖关系，确保服务按正确顺序启动。</li><li><strong>状态监控</strong>：实时查看服务运行状态，快速定位问题。</li><li><strong>开机自启</strong>：便捷设置服务开机自启动或禁用自启动。</li><li><strong>资源管理</strong>：通过cgroups对服务进行资源限制和管理。</li><li><strong>日志管理</strong>：<code>Systemctl</code>可以查看服务的日志，帮助定位问题。</li></ul><p>对于日常工作而言，掌握<code>Systemctl</code>可以帮助我们更高效地管理和维护Linux系统服务，确保服务稳定运行。</p><h2 id="二、服务文件基础"><a href="#二、服务文件基础" class="headerlink" title="二、服务文件基础"></a>二、服务文件基础</h2><h3 id="2-1-服务文件的位置与命名规则"><a href="#2-1-服务文件的位置与命名规则" class="headerlink" title="2.1 服务文件的位置与命名规则"></a>2.1 服务文件的位置与命名规则</h3><p><code>Systemd</code>服务文件主要存放在两个目录：</p><ul><li><strong>&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;</strong>：<strong>用户自定义服务</strong>文件通常放在这个目录</li><li><strong>&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;</strong>：<strong>系统自带服务</strong>文件存放在这里</li></ul><p>服务文件的命名必须以<code>.service</code>为后缀，例如<code>myapp.service</code>。文件名应简洁明了，能反映服务的功能。</p><blockquote><p>在启动服务时，输入的服务名称为文件名去掉后缀的部分，例如<code>myapp.service</code>的服务名称为<code>myapp</code>。当然也可以加上<code>.service</code>。</p></blockquote><h3 id="2-2-服务文件的基本结构"><a href="#2-2-服务文件的基本结构" class="headerlink" title="2.2 服务文件的基本结构"></a>2.2 服务文件的基本结构</h3><blockquote><p>这一块内容读者可以随机打开一个服务文件，查看其内容，对着下述的基本结构说明来辅助理解，同时尝试自己来添加服务。一般都会包含<code>[Unit]</code>、<code>[Service]</code>、<code>[install]</code>三部分。</p></blockquote><p>一个标准的Systemd服务文件由三个主要部分组成：</p><ul><li><code>[Unit]</code>：包含服务的描述、依赖关系等<strong>元数据</strong></li><li><code>[Service]</code>：定义服务的运行方式、启动命令等<strong>核心配置</strong></li><li><code>[Install]</code>：指定服务<strong>安装信息</strong>，如开机自启设置</li></ul><h3 id="2-3-核心配置项解释"><a href="#2-3-核心配置项解释" class="headerlink" title="2.3 核心配置项解释"></a>2.3 核心配置项解释</h3><h4 id="2-3-1-Unit-部分"><a href="#2-3-1-Unit-部分" class="headerlink" title="2.3.1 [Unit]部分"></a>2.3.1 [Unit]部分</h4><ul><li><code>Description</code>：服务的简短描述</li><li><code>Documentation</code>：服务文档的URL</li><li><code>After</code>：指定服务应在哪些服务之后启动</li><li><code>Requires</code>：指定服务依赖的其他服务，若依赖服务启动失败，当前服务也不会启动</li><li><code>Wants</code>：指定服务希望依赖的其他服务，若依赖服务启动失败，当前服务仍会尝试启动</li></ul><p>示例：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=My Python Application</span><br><span class="line"><span class="attr">Documentation</span>=https://example.com/docs</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"><span class="attr">Requires</span>=mysql.service</span><br><span class="line"><span class="attr">Wants</span>=redis.service</span><br></pre></td></tr></table></figure><h4 id="2-3-2-Service-部分"><a href="#2-3-2-Service-部分" class="headerlink" title="2.3.2 [Service]部分"></a>2.3.2 [Service]部分</h4><ul><li><code>Type</code>：服务的类型，常见值：<ul><li><code>simple</code>（默认）：服务启动后立即进入后台运行</li><li><code>forking</code>：服务启动后会创建子进程，父进程退出</li><li><code>oneshot</code>：服务一次性运行完成后退出</li></ul></li><li><code>ExecStart</code>：启动服务的命令</li><li><code>ExecStop</code>：停止服务的命令</li><li><code>Restart</code>：指定服务何时应自动重启（如<code>always</code>、<code>on-failure</code>等）</li><li><code>User</code>：指定运行服务的用户</li><li><code>WorkingDirectory</code>：服务的工作目录</li><li><code>Environment</code>：设置环境变量</li></ul><blockquote><p>这里的关键点就是<code>ExecStart</code>和<code>ExecStop</code>这两个参数。决定了你实际服务的启动和停止。</p><p>例如，你可以使用<code>ExecStart=/usr/bin/python3 /path/to/myapp.py</code>来启动一个Python应用，使用<code>ExecStop=/bin/kill -TERM $MAINPID</code>来停止它。</p><p>其中，<code>$MAINPID</code>是一个环境变量，它会被<code>systemd</code>替换为服务的主进程ID。</p></blockquote><p>示例：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/bin/python3 /path/to/myapp.py</span><br><span class="line"><span class="attr">ExecStop</span>=/bin/kill -TERM <span class="variable">$MAINPID</span></span><br><span class="line"><span class="attr">Restart</span>=<span class="literal">on</span>-failure</span><br><span class="line"><span class="attr">User</span>=www-data</span><br><span class="line"><span class="attr">WorkingDirectory</span>=/path/to/</span><br><span class="line"><span class="attr">Environment</span>=PYTHONPATH=/path/to/lib</span><br></pre></td></tr></table></figure><h4 id="2-3-3-Install-部分"><a href="#2-3-3-Install-部分" class="headerlink" title="2.3.3 [Install]部分"></a>2.3.3 [Install]部分</h4><ul><li><code>WantedBy</code>：指定服务被启用时应链接到哪个target（通常是<code>multi-user.target</code>）</li><li><code>Alias</code>：服务的别名</li></ul><p>示例：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br><span class="line"><span class="attr">Alias</span>=myapp</span><br></pre></td></tr></table></figure><p>理解这些配置项是创建和管理Systemd服务的基础。在实际使用中，我们可以根据服务的特性调整这些配置。</p><h2 id="三、创建简单服务示例"><a href="#三、创建简单服务示例" class="headerlink" title="三、创建简单服务示例"></a>三、创建简单服务示例</h2><h3 id="3-1-示例场景介绍"><a href="#3-1-示例场景介绍" class="headerlink" title="3.1 示例场景介绍"></a>3.1 示例场景介绍</h3><p>假设我们有一个简单的Python脚本，它实现了一个基础的Web服务器，用于提供静态文件服务。我们希望将这个脚本作为系统服务运行，以便在系统启动时自动启动，并能通过Systemctl进行管理。</p><p>示例Python脚本（<code>simple_server.py</code>）内容：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> http.server</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义端口</span></span><br><span class="line">PORT = <span class="number">8000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建请求处理器</span></span><br><span class="line">Handler = http.server.SimpleHTTPRequestHandler</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建TCP服务器</span></span><br><span class="line"><span class="keyword">with</span> socketserver.TCPServer((<span class="string">&quot;&quot;</span>, PORT), Handler) <span class="keyword">as</span> httpd:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;服务启动在端口 <span class="subst">&#123;PORT&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># 启动服务器</span></span><br><span class="line">    httpd.serve_forever()</span><br></pre></td></tr></table></figure><h3 id="3-2-编写服务文件"><a href="#3-2-编写服务文件" class="headerlink" title="3.2 编写服务文件"></a>3.2 编写服务文件</h3><p>我们将创建一个名为<code>simple-server.service</code>的服务文件，存放在<code>/etc/systemd/system/</code>目录下。</p><p>完整服务文件内容：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Simple Python Web Server</span><br><span class="line"><span class="attr">Documentation</span>=https://example.com/docs</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/bin/python3 /path/to/simple_server.py</span><br><span class="line"><span class="attr">ExecStop</span>=/bin/kill -TERM <span class="variable">$MAINPID</span></span><br><span class="line"><span class="attr">Restart</span>=<span class="literal">on</span>-failure</span><br><span class="line"><span class="attr">User</span>=www-data</span><br><span class="line"><span class="attr">WorkingDirectory</span>=/path/to/webroot</span><br><span class="line"><span class="attr">Environment</span>=PYTHONUNBUFFERED=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br><span class="line"><span class="attr">Alias</span>=simple-server</span><br></pre></td></tr></table></figure><h3 id="3-3-服务文件各参数详解"><a href="#3-3-服务文件各参数详解" class="headerlink" title="3.3 服务文件各参数详解"></a>3.3 服务文件各参数详解</h3><h4 id="3-3-1-Unit-部分"><a href="#3-3-1-Unit-部分" class="headerlink" title="3.3.1 [Unit]部分"></a>3.3.1 [Unit]部分</h4><ul><li><code>Description</code>：服务的简短描述，这里描述为”Simple Python Web Server”</li><li><code>Documentation</code>：服务文档的URL，可以指向项目文档或说明</li><li><code>After=network.target</code>：指定服务应在网络服务启动后启动，确保网络可用</li></ul><h4 id="3-3-2-Service-部分"><a href="#3-3-2-Service-部分" class="headerlink" title="3.3.2 [Service]部分"></a>3.3.2 [Service]部分</h4><ul><li><code>Type=simple</code>：服务类型为simple，表示服务启动后立即进入后台运行</li><li><code>ExecStart=/usr/bin/python3 /path/to/simple_server.py</code>：启动服务的命令，指定Python解释器和脚本路径</li><li><code>ExecStop=/bin/kill -TERM $MAINPID</code>：停止服务的命令，使用kill命令发送TERM信号给主进程</li><li><code>Restart=on-failure</code>：指定服务在失败时自动重启</li><li><code>User=www-data</code>：指定运行服务的用户为www-data（Web服务器常用用户）</li><li><code>WorkingDirectory=/path/to/webroot</code>：服务的工作目录，这里设置为Web根目录</li><li><code>Environment=PYTHONUNBUFFERED=1</code>：设置环境变量，确保Python输出不缓冲</li></ul><h4 id="3-3-3-Install-部分"><a href="#3-3-3-Install-部分" class="headerlink" title="3.3.3 [Install]部分"></a>3.3.3 [Install]部分</h4><ul><li><code>WantedBy=multi-user.target</code>：指定服务被启用时链接到multi-user.target，这是默认的运行级别</li><li><code>Alias=simple-server</code>：服务的别名，方便用户通过别名管理服务</li></ul><h4 id="3-3-4-服务文件部署步骤"><a href="#3-3-4-服务文件部署步骤" class="headerlink" title="3.3.4 服务文件部署步骤"></a>3.3.4 服务文件部署步骤</h4><ol><li>将Python脚本放置在指定目录，例如<code>/opt/scripts/simple_server.py</code></li><li>赋予脚本执行权限：<code>chmod +x /opt/scripts/simple_server.py</code></li><li>创建服务文件：<code>sudo nano /etc/systemd/system/simple-server.service</code>，并粘贴上面的服务文件内容</li><li>重新加载Systemd配置：<code>sudo systemctl daemon-reload</code></li><li>启用服务：<code>sudo systemctl enable simple-server</code></li><li>启动服务：<code>sudo systemctl start simple-server</code></li></ol><p>通过以上步骤，我们就成功创建并启动了一个简单的Python Web服务器服务。</p><h2 id="四、服务管理命令"><a href="#四、服务管理命令" class="headerlink" title="四、服务管理命令"></a>四、服务管理命令</h2><p>Systemctl提供了一系列命令来管理服务，下面介绍最常用的几个命令：</p><h3 id="4-1-启用服务"><a href="#4-1-启用服务" class="headerlink" title="4.1 启用服务"></a>4.1 启用服务</h3><p>启用服务是指设置服务在系统开机时自动启动。启用服务后，即使系统重启，服务也会自动运行。</p><p><strong>命令格式</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> [服务名称]</span><br></pre></td></tr></table></figure><p><strong>示例</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> simple-server</span><br></pre></td></tr></table></figure><h3 id="4-2-启动-停止服务"><a href="#4-2-启动-停止服务" class="headerlink" title="4.2 启动&#x2F;停止服务"></a>4.2 启动&#x2F;停止服务</h3><p>启动服务用于手动启动一个服务，停止服务用于手动停止一个正在运行的服务。</p><p><strong>命令格式</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl start [服务名称]  <span class="comment"># 启动服务</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl stop [服务名称]   <span class="comment"># 停止服务</span></span><br></pre></td></tr></table></figure><p><strong>示例</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl start simple-server  <span class="comment"># 启动我们创建的Python Web服务器服务</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl stop simple-server   <span class="comment"># 停止服务</span></span><br></pre></td></tr></table></figure><h3 id="4-3-重启服务"><a href="#4-3-重启服务" class="headerlink" title="4.3 重启服务"></a>4.3 重启服务</h3><p>当服务配置发生变化或服务出现异常时，可以使用重启命令重新启动服务。</p><p><strong>命令格式</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl restart [服务名称]</span><br></pre></td></tr></table></figure><p><strong>示例</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl restart simple-server</span><br></pre></td></tr></table></figure><h3 id="4-4-查看服务状态"><a href="#4-4-查看服务状态" class="headerlink" title="4.4 查看服务状态"></a>4.4 查看服务状态</h3><p>查看服务状态可以了解服务是否正在运行、是否启动成功、以及服务的详细信息。</p><p><strong>命令格式</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status [服务名称]</span><br></pre></td></tr></table></figure><p><strong>示例</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status simple-server</span><br></pre></td></tr></table></figure><p><strong>输出说明</strong>：</p><ul><li><code>active (running)</code>：服务正在运行</li><li><code>inactive (dead)</code>：服务未运行</li><li><code>failed</code>：服务启动失败</li><li>输出中还包含服务的启动时间、主进程ID、以及最近的日志信息</li></ul><h3 id="4-5-查看服务日志"><a href="#4-5-查看服务日志" class="headerlink" title="4.5 查看服务日志"></a>4.5 查看服务日志</h3><p>查看服务日志可以帮助我们排查服务启动或运行过程中遇到的问题。</p><p><strong>命令格式</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> journalctl -u [服务名称]</span><br></pre></td></tr></table></figure><p><strong>常用选项</strong>：</p><ul><li><code>-f</code>：实时跟踪日志输出</li><li><code>-n [数字]</code>：显示最近的[数字]行日志</li><li><code>--since &quot;YYYY-MM-DD HH:MM:SS&quot;</code>：显示指定时间之后的日志</li></ul><p><strong>示例</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> journalctl -u simple-server  <span class="comment"># 查看服务的所有日志</span></span><br><span class="line"><span class="built_in">sudo</span> journalctl -u simple-server -f  <span class="comment"># 实时跟踪服务日志</span></span><br><span class="line"><span class="built_in">sudo</span> journalctl -u simple-server -n 50  <span class="comment"># 查看最近50行日志</span></span><br><span class="line"><span class="built_in">sudo</span> journalctl -u simple-server --since <span class="string">&quot;2023-10-01 00:00:00&quot;</span>  <span class="comment"># 查看10月1日之后的日志</span></span><br></pre></td></tr></table></figure><h3 id="4-6-禁用服务"><a href="#4-6-禁用服务" class="headerlink" title="4.6 禁用服务"></a>4.6 禁用服务</h3><p>禁用服务是指取消服务的开机自启动设置，但不会影响当前正在运行的服务。</p><p><strong>命令格式</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">disable</span> [服务名称]</span><br></pre></td></tr></table></figure><p><strong>示例</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">disable</span> simple-server</span><br></pre></td></tr></table></figure><h3 id="4-7-其他常用命令"><a href="#4-7-其他常用命令" class="headerlink" title="4.7 其他常用命令"></a>4.7 其他常用命令</h3><ul><li><p><strong>重新加载服务配置</strong>：当修改了服务文件后，需要重新加载Systemd配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload</span><br></pre></td></tr></table></figure></li><li><p><strong>查看服务是否启用</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl is-enabled [服务名称]</span><br></pre></td></tr></table></figure></li><li><p><strong>列出所有服务</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl list-units --<span class="built_in">type</span>=service</span><br></pre></td></tr></table></figure></li></ul><p>通过以上命令，我们可以全面地管理和监控Systemd服务。在日常工作中，这些命令是使用Systemctl管理服务的基础。</p><h2 id="五、常见问题与解决"><a href="#五、常见问题与解决" class="headerlink" title="五、常见问题与解决"></a>五、常见问题与解决</h2><p>在使用Systemctl管理服务的过程中，可能会遇到各种问题。以下是一些常见问题及解决方法。</p><h3 id="服务启动失败的排查方法"><a href="#服务启动失败的排查方法" class="headerlink" title="服务启动失败的排查方法"></a>服务启动失败的排查方法</h3><p>当服务启动失败时，可以按照以下步骤进行排查：</p><ol><li><p><strong>查看服务状态</strong>：首先使用<code>systemctl status [服务名]</code>命令查看服务的当前状态和错误信息。这通常会显示服务启动失败的直接原因。</p></li><li><p><strong>检查配置文件语法</strong>：使用<code>systemctl daemon-reload</code>命令重新加载配置文件，如果配置文件有语法错误，会在此步骤报错。</p></li><li><p><strong>查看详细日志</strong>：通过<code>journalctl -u [服务名]</code>命令查看服务的详细日志，寻找错误提示。</p></li><li><p><strong>测试执行命令</strong>：如果服务是执行某个脚本或程序，可以尝试直接在命令行执行该命令，看是否能正常运行。</p></li><li><p><strong>检查依赖服务</strong>：使用<code>systemctl list-dependencies [服务名]</code>查看服务的依赖关系，确保所有依赖服务都已正常启动。</p></li></ol><h3 id="权限问题处理"><a href="#权限问题处理" class="headerlink" title="权限问题处理"></a>权限问题处理</h3><p>权限问题是服务启动失败的常见原因之一：</p><ol><li><p><strong>文件权限</strong>：确保服务文件和相关脚本具有正确的权限。通常服务文件应具有<code>644</code>权限，可执行脚本应具有<code>755</code>权限。</p></li><li><p><strong>用户权限</strong>：服务中指定的运行用户（通过<code>User=</code>和<code>Group=</code>配置）应具有访问相关文件和目录的权限。</p></li><li><p><strong>SELinux&#x2F;AppArmor限制</strong>：如果系统启用了SELinux或AppArmor，可能会限制服务的某些操作。可以通过查看相关日志或临时禁用这些安全机制来确认是否是权限问题。</p></li><li><p><strong>文件上下文</strong>：对于SELinux，确保文件具有正确的安全上下文。可以使用<code>chcon</code>或<code>restorecon</code>命令修复文件上下文。</p></li></ol><h3 id="路径问题解决"><a href="#路径问题解决" class="headerlink" title="路径问题解决"></a>路径问题解决</h3><p>路径问题也是常见的服务启动障碍：</p><ol><li><p><strong>使用绝对路径</strong>：在服务文件中，特别是<code>ExecStart=</code>、<code>ExecStop=</code>等指令中，应使用程序和文件的绝对路径，避免依赖环境变量。</p></li><li><p><strong>检查工作目录</strong>：如果服务需要在特定目录下运行，可以通过<code>WorkingDirectory=</code>配置指定工作目录。</p></li><li><p><strong>环境变量</strong>：如果程序依赖特定的环境变量，可以在服务文件中通过<code>Environment=</code>或<code>EnvironmentFile=</code>配置设置环境变量。</p></li><li><p><strong>路径不存在</strong>：确保服务文件中引用的所有路径（包括程序路径、配置文件路径、日志文件路径等）都存在。</p></li></ol><h3 id="日志查看技巧"><a href="#日志查看技巧" class="headerlink" title="日志查看技巧"></a>日志查看技巧</h3><p>有效查看日志对于排查问题至关重要：</p><ol><li><p><strong>实时查看日志</strong>：使用<code>journalctl -u [服务名] -f</code>命令实时查看服务的日志输出。</p></li><li><p><strong>查看特定时间范围的日志</strong>：使用<code>journalctl -u [服务名] --since &quot;2025-07-01 10:00:00&quot; --until &quot;2025-07-01 11:00:00&quot;</code>查看特定时间段的日志。</p></li><li><p><strong>过滤错误日志</strong>：使用<code>journalctl -u [服务名] -p err</code>只查看错误级别的日志。</p></li><li><p><strong>查看引导以来的日志</strong>：使用<code>journalctl -u [服务名] -b</code>查看当前引导以来的服务日志。</p></li><li><p><strong>导出日志</strong>：如果需要保存日志供后续分析，可以使用<code>journalctl -u [服务名] --output=short-precise &gt; service.log</code>将日志导出到文件。</p></li></ol><h2 id="七、总结"><a href="#七、总结" class="headerlink" title="七、总结"></a>七、总结</h2><p>从基础概念出发，我们理解了Systemctl作为管理Systemd的命令行工具的重要性，以及其统一管理、服务依赖等五大核心优势。在服务文件学习中，我们详细了解了服务文件的两个主要存放位置（&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;和&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;）、.service后缀命名规则，以及[Unit]、[Service]、[Install]三个核心部分的配置项含义与用法。</p><p>通过Python Web服务器的实例，我们亲身体验了创建服务文件、部署和管理服务的完整流程，掌握了从编写脚本到启用、启动服务的全步骤操作。在命令管理部分，我们系统学习了启用（enable）、启动&#x2F;停止（start&#x2F;stop）、重启（restart）、查看状态（status）、查看日志（journalctl -u）、禁用（disable）等常用命令，以及daemon-reload等实用操作。</p><p>最后，针对常见问题，我们总结了服务启动失败排查的五步流程、权限问题处理技巧、路径问题解决方法和日志查看的多种实用技巧，为实际应用中可能遇到的问题提供了有效的解决方案。</p><p>本文内容通俗易懂，示例丰富，符合科普性质，无论是Linux初学者还是系统管理员，都能通过本文快速掌握Systemctl服务管理的核心技能，提升Linux系统管理效率。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pydantic使用指南</title>
      <link href="/2025/09/02/Pydantic%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
      <url>/2025/09/02/Pydantic%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h2 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h2><blockquote><p>以下Pydantic使用的版本为2.0.0，不同版本的Pydantic可能会有一些差异，特别是在一些新的功能和废弃的功能上，建议查看官方文档。</p></blockquote><h3 id="1-1-什么是Pydantic"><a href="#1-1-什么是Pydantic" class="headerlink" title="1.1 什么是Pydantic"></a>1.1 什么是Pydantic</h3><p>Pydantic是Python中最广泛使用的基于Python类型提示的数据验证和设置管理库，它遵循纯正的Python 3.9+标准，能帮助开发者轻松验证数据、管理配置并减少样板代码。该库快速且可扩展，能与代码分析器、集成开发环境良好配合，便于进行数据验证工作。</p><h3 id="1-2-为什么选择Pydantic"><a href="#1-2-为什么选择Pydantic" class="headerlink" title="1.2 为什么选择Pydantic"></a>1.2 为什么选择Pydantic</h3><ul><li><strong>由类型提示驱动</strong>：用Pydantic的时候，模式验证和序列化都靠类型注解来控制。就不用学太多东西，也不用写很多代码，还能和IDE以及静态分析工具完美配合。</li><li><strong>速度快</strong>：Pydantic的核心验证逻辑是用Rust写的，所以它是Python里最快的数据验证库之一。</li><li><strong>支持JSON Schema</strong>：Pydantic模型能生成JSON Schema，这样就能轻松和其他工具集成。</li><li><strong>严格模式和宽松模式</strong>：Pydantic有两种模式可以选。严格模式下，数据不会被转换；宽松模式下，Pydantic会在合适的时候把数据转换成正确的类型。</li><li><strong>支持多种标准库类型</strong>：Pydantic能验证很多标准库的类型，像数据类、类型字典这些都不在话下。</li><li><strong>可自定义</strong>：Pydantic允许自定义验证器和序列化器，用各种方式来改变数据处理的方法。</li><li><strong>生态系统强大</strong>：PyPI上大概有8000个包都在用Pydantic，像FastAPI、huggingface、Django Ninja、SQLModel和LangChain这些流行的库也都在用。</li><li><strong>经过实战检验</strong>：Pydantic每个月的下载量超过3.6亿次，FAANG所有公司，还有纳斯达克25家最大企业里的20家都在用它。</li></ul><blockquote><p>以上内容是摘自官网的，不过也确实很好用，在项目中用的比较多😄，特别是用Fast API做后端的时候，会帮你规范接收的JSON数据，多了一个校验层，减少了很多的错误。</p></blockquote><h3 id="1-3-应用场景"><a href="#1-3-应用场景" class="headerlink" title="1.3 应用场景"></a>1.3 应用场景</h3><ul><li><strong>API请求和响应验证</strong>：这个也是我实际工作中用的比较多的，用Fast API作为后端接收数据时，会使用Pydantic来验证客户端发送的请求数据和服务器返回的响应数据。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建FastAPI应用实例</span></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义Pydantic模型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    is_offer: <span class="built_in">bool</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建路由，使用Pydantic模型进行请求体验证</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>):</span><br><span class="line">    <span class="comment"># 这里可以处理item，例如保存到数据库</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item_name&quot;</span>: item.name, <span class="string">&quot;item_price&quot;</span>: item.price, <span class="string">&quot;is_offer&quot;</span>: item.is_offer&#125;</span><br></pre></td></tr></table></figure><p>这个示例中的流程如下：</p><ol><li>导入FastAPI和BaseModel</li><li>创建FastAPI应用实例</li><li>定义与之前相同的Item模型</li><li>创建POST路由，使用Item模型验证请求体</li><li>在路由处理函数中，直接使用验证后的item数据</li></ol><blockquote><p>当客户端发送POST请求到<code>/items/</code>端点时，FastAPI获取的数据会先通过Pydantic模型进行验证，如果不符合会返回详细的错误信息，这里的错误信息是Pydantic提供的，不是FastAPI提供的，Fast API作为后端获取客户端发来的数据。这也侧面说明Pydantic可以在很多场景下使用，不仅限于Fast API。</p></blockquote><ul><li><strong>配置管理</strong>：管理应用程序的配置，确保配置数据的正确性。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"><span class="keyword">from</span> pydantic_settings <span class="keyword">import</span> SettingsConfigDict</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Settings</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="comment"># 应用基本信息</span></span><br><span class="line">    app_name: <span class="built_in">str</span> = <span class="string">&quot;Awesome API&quot;</span></span><br><span class="line">    app_version: <span class="built_in">str</span> = <span class="string">&quot;1.0.0&quot;</span></span><br><span class="line">    debug: <span class="built_in">bool</span> = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 管理员信息</span></span><br><span class="line">    admin_email: <span class="built_in">str</span></span><br><span class="line">    admin_phone: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数据库配置</span></span><br><span class="line">    db_host: <span class="built_in">str</span> = <span class="string">&quot;localhost&quot;</span></span><br><span class="line">    db_port: <span class="built_in">int</span> = <span class="number">5432</span></span><br><span class="line">    db_username: <span class="built_in">str</span> = <span class="string">&quot;postgres&quot;</span></span><br><span class="line">    db_password: <span class="built_in">str</span> = Field(..., description=<span class="string">&quot;数据库密码，不应硬编码&quot;</span>)</span><br><span class="line">    db_name: <span class="built_in">str</span> = <span class="string">&quot;myapp&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># API配置</span></span><br><span class="line">    items_per_user: <span class="built_in">int</span> = <span class="number">50</span></span><br><span class="line">    api_key: <span class="built_in">str</span> = Field(..., description=<span class="string">&quot;API密钥，不应硬编码&quot;</span>)</span><br><span class="line">    jwt_secret: <span class="built_in">str</span> = Field(..., description=<span class="string">&quot;JWT密钥，不应硬编码&quot;</span>)</span><br><span class="line">    jwt_expiry_minutes: <span class="built_in">int</span> = <span class="number">30</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Pydantic v2 配置方式</span></span><br><span class="line">    model_config = SettingsConfigDict(</span><br><span class="line">        env_file=<span class="string">&quot;.env&quot;</span>,  <span class="comment"># 从.env文件加载环境变量</span></span><br><span class="line">        case_sensitive=<span class="literal">True</span>,  <span class="comment"># 区分大小写</span></span><br><span class="line">        env_prefix=<span class="string">&quot;APP_&quot;</span>,  <span class="comment"># 环境变量前缀</span></span><br><span class="line">        extra=<span class="string">&quot;forbid&quot;</span>  <span class="comment"># 禁止未知字段</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建配置实例</span></span><br><span class="line"><span class="comment"># 注意：敏感信息如密码、密钥等不应硬编码</span></span><br><span class="line"><span class="comment"># 应该通过环境变量或.env文件提供</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    settings = Settings()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;应用名称: <span class="subst">&#123;settings.app_name&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;数据库连接: postgresql://<span class="subst">&#123;settings.db_username&#125;</span>:*****@<span class="subst">&#123;settings.db_host&#125;</span>:<span class="subst">&#123;settings.db_port&#125;</span>/<span class="subst">&#123;settings.db_name&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;配置加载失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">配置加载失败: 4 validation errors for Settings</span></span><br><span class="line"><span class="string">admin_email</span></span><br><span class="line"><span class="string">  Field required [type=missing, input_value=&#123;&#125;, input_type=dict]</span></span><br><span class="line"><span class="string">    For further information visit https://errors.pydantic.dev/2.11/v/missing</span></span><br><span class="line"><span class="string">db_password</span></span><br><span class="line"><span class="string">  Field required [type=missing, input_value=&#123;&#125;, input_type=dict]</span></span><br><span class="line"><span class="string">    For further information visit https://errors.pydantic.dev/2.11/v/missing</span></span><br><span class="line"><span class="string">api_key</span></span><br><span class="line"><span class="string">  Field required [type=missing, input_value=&#123;&#125;, input_type=dict]</span></span><br><span class="line"><span class="string">    For further information visit https://errors.pydantic.dev/2.11/v/missing</span></span><br><span class="line"><span class="string">jwt_secret</span></span><br><span class="line"><span class="string">  Field required [type=missing, input_value=&#123;&#125;, input_type=dict]</span></span><br><span class="line"><span class="string">    For further information visit https://errors.pydantic.dev/2.11/v/missing</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>不难发现，Pydantic的配置管理功能非常强大，能够帮助我们更好的管理应用的配置，减少错误的发生。本质上还是做了数据的校验，只是校验的内容是配置项。配合其他库使用，会更加方便。</p></blockquote><p>比如，你可以将这些配置与上面举例的FastAPI结合使用，例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI(title=settings.app_name, version=settings.app_version)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">root</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;app_name&quot;</span>: settings.app_name, <span class="string">&quot;version&quot;</span>: settings.app_version&#125;</span><br></pre></td></tr></table></figure><p>这样可以使你的应用配置更加规范和灵活，同时提高代码的可维护性和安全性。</p><blockquote><p>在实际工程中可以单独开一个文件夹来存放用<code>Pydantic</code>规范好的数据模型，更好做数据类型的统一管理。</p></blockquote><ul><li><strong>数据序列化和反序列化</strong>：将数据在不同格式之间转换，如JSON和Python对象之间的转换。Pydantic 提供了丰富的序列化功能，具体如下：<ol><li><strong>转换为 Python 字典（包含相关 Python 对象）</strong>：可将模型转换为由相关 Python 对象组成的 Python 字典。</li><li><strong>转换为可 JSON 序列化的 Python 字典</strong>：能把模型转换为仅由“可转换为 JSON 的”类型组成的 Python 字典。</li><li><strong>转换为 JSON 字符串</strong>：支持将模型直接转换为 JSON 字符串。</li></ol></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="built_in">id</span>: <span class="built_in">int</span></span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    signup_date: datetime</span><br><span class="line">    tags: <span class="type">List</span>[<span class="built_in">str</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 反序列化：JSON转Python对象</span></span><br><span class="line"><span class="comment"># 从JSON字符串创建模型实例</span></span><br><span class="line">user_data = <span class="string">&#x27;&#123;&quot;id&quot;: 1, &quot;name&quot;: &quot;John Doe&quot;, &quot;signup_date&quot;: &quot;2023-01-01T12:00:00&quot;, &quot;tags&quot;: [&quot;premium&quot;, &quot;active&quot;]&#125;&#x27;</span></span><br><span class="line">user = User.model_validate_json(user_data)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;反序列化结果:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(user)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;用户ID: <span class="subst">&#123;user.<span class="built_in">id</span>&#125;</span>, 名称: <span class="subst">&#123;user.name&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;注册日期类型: <span class="subst">&#123;<span class="built_in">type</span>(user.signup_date)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 序列化功能展示</span></span><br><span class="line">user_dict = user.model_dump()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n转换为包含Python对象的字典:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(user_dict)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;字典中的日期类型: <span class="subst">&#123;<span class="built_in">type</span>(user_dict[<span class="string">&#x27;signup_date&#x27;</span>])&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">json_compatible_dict = user.model_dump(exclude_unset=<span class="literal">True</span>, by_alias=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n转换为可JSON序列化的字典:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(json_compatible_dict)</span><br><span class="line"></span><br><span class="line">user_json = user.model_dump_json()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n转换为JSON字符串:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(user_json)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 高级用法：自定义JSON编码器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomUser</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="built_in">id</span>: <span class="built_in">int</span></span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    signup_date: datetime</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Config</span>:</span><br><span class="line">        json_encoders = &#123;</span><br><span class="line">            datetime: <span class="keyword">lambda</span> v: v.strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>),</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">custom_user = CustomUser(<span class="built_in">id</span>=<span class="number">2</span>, name=<span class="string">&quot;Jane Smith&quot;</span>, signup_date=datetime.now())</span><br><span class="line">custom_json = custom_user.model_dump_json(indent=<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n自定义JSON编码器结果:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(custom_json)</span><br></pre></td></tr></table></figure><p>这些功能使得Pydantic成为处理数据验证和序列化的强大工具，特别适合在API开发、配置管理和数据交换场景中使用。</p><blockquote><p>序列化和反序列化的功能在实际工程中用的比较多，比如在Web应用中，客户端发送的请求数据是JSON格式的，服务器端需要将JSON格式的数据转换为Python对象进行处理，处理完成后再转换为JSON格式返回给客户端。</p></blockquote><ul><li><strong>数值校验</strong>：对数值类型的字段进行校验，确保输入的数值在指定的范围内。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, field_validator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Model</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    value: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @field_validator(<span class="params"><span class="string">&#x27;value&#x27;</span>, mode=<span class="string">&#x27;before&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cast_ints</span>(<span class="params">cls, value: <span class="type">Any</span></span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(value, <span class="built_in">int</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;这是数字&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;这是字符串&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(Model(value=<span class="string">&#x27;a&#x27;</span>))</span><br><span class="line"><span class="comment">#&gt; value=&#x27;这是字符串&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(Model(value=<span class="number">1</span>))</span><br><span class="line"><span class="comment">#&gt; value=&#x27;这是数字&#x27;</span></span><br></pre></td></tr></table></figure><p>这个示例更贴近实际应用场景，特别是在用户注册、表单提交等需要严格数据验证的场景中非常有用。通过Pydantic，我们可以轻松实现复杂的验证逻辑，同时保持代码的清晰和可维护性。</p><blockquote><p>特意给了个奇怪的示例，其实是想说，既然我可以用这个来做判断，就可以做转换🤭，如果我把”这是字符串”和”这是数字”转换成对应的异常信息返回、或者是类型转换代码，是不是可以做到统一输入了，即使收到的数据类型不同也不会影响后续的代码运行结果。</p></blockquote><ul><li><strong>数据清洗和转换</strong>：清理和转换输入数据，使其符合预期格式。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Data</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    value: <span class="built_in">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据清洗和转换，将字符串转换为整数</span></span><br><span class="line">data = Data(value=<span class="string">&quot;42&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(data.value)</span><br></pre></td></tr></table></figure><blockquote><p>当然Pydantic本身也具备自动转换数据类型的能力，上面这个例子就是把字符串”42”转换为整数42。Pydantic很强大，有很多潜在的能力等待大家发掘，具体可以看看Pydantic官网，这里就不把全部特性都放出来了，篇幅很大。</p></blockquote><h2 id="二、安装与基础配置"><a href="#二、安装与基础配置" class="headerlink" title="二、安装与基础配置"></a>二、安装与基础配置</h2><h3 id="2-1-安装Pydantic"><a href="#2-1-安装Pydantic" class="headerlink" title="2.1 安装Pydantic"></a>2.1 安装Pydantic</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pydantic</span><br></pre></td></tr></table></figure><p><code>Pydantic</code>也支持<code>conda</code>安装，命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install pydantic -c conda-forge</span><br></pre></td></tr></table></figure><p><strong>Pydantic具有以下可选依赖项：</strong></p><ul><li>email：由emailValidator程序包提供的电子邮件验证。</li><li>timezone：由tzdata程序包提供的IANA时区数据库的备用选项。<br>要与Pydantic一起安装可选的依赖项：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以只安装email验证器</span></span><br><span class="line">pip install <span class="string">&#x27;pydantic[email]&#x27;</span></span><br><span class="line"><span class="comment"># 也可以都安装，自己选择即可</span></span><br><span class="line">pip install <span class="string">&#x27;pydantic[email,timezone]&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="三、核心功能与优势"><a href="#三、核心功能与优势" class="headerlink" title="三、核心功能与优势"></a>三、核心功能与优势</h2><p>最后就把Pydantic的核心功能和优势总结一下，上面的应用场景其实都有涉及，大家看完下面的功能会有更清晰的认识。</p><h3 id="3-1-数据验证"><a href="#3-1-数据验证" class="headerlink" title="3.1 数据验证"></a>3.1 数据验证</h3><p>Pydantic 提供了强大而灵活的数据验证机制，确保输入数据符合预期格式和约束。</p><ul><li><strong>内置验证器</strong>：提供了丰富的预定义验证器，如 <code>EmailStr</code>（邮箱验证）、<code>UrlStr</code>（URL验证）、<code>constr</code>（字符串约束）、<code>conint</code>（整数约束）等，覆盖了大多数常见验证场景。</li><li><strong>自定义验证器</strong>：通过 <code>@validator</code> 装饰器可以轻松创建自定义验证逻辑，支持字段级和模型级验证，还可以访问其他字段的值进行联合验证。</li><li><strong>验证错误处理</strong>：验证失败时会生成结构化的<code>ValidationError</code>对象，包含详细的错误信息（字段、错误类型、错误消息），便于定位和处理问题。</li></ul><p>示例代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, EmailStr, field_validator, ValidationError</span><br><span class="line"><span class="keyword">from</span> pydantic_core.core_schema <span class="keyword">import</span> FieldValidationInfo</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    email: EmailStr</span><br><span class="line">    age: <span class="built_in">int</span></span><br><span class="line">    password: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @field_validator(<span class="params"><span class="string">&#x27;age&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">age_must_be_adult</span>(<span class="params">cls, v</span>):</span><br><span class="line">        <span class="keyword">if</span> v &lt; <span class="number">18</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;必须是成年人&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"><span class="meta">    @field_validator(<span class="params"><span class="string">&#x27;password&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">password_must_be_strong</span>(<span class="params">cls, v</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(v) &lt; <span class="number">8</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;密码长度必须至少为8位&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">any</span>(c.isupper() <span class="keyword">for</span> c <span class="keyword">in</span> v):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;密码必须包含至少一个大写字母&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证失败示例</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    User(email=<span class="string">&#x27;invalid-email&#x27;</span>, age=<span class="number">16</span>, password=<span class="string">&#x27;weak&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> ValidationError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(e.json())</span><br></pre></td></tr></table></figure><h3 id="3-2-类型提示与自动转换"><a href="#3-2-类型提示与自动转换" class="headerlink" title="3.2 类型提示与自动转换"></a>3.2 类型提示与自动转换</h3><p>Pydantic 充分利用 Python 的类型提示系统，提供静态类型检查和运行时类型转换的双重保障。</p><ul><li><strong>支持的类型</strong>：全面支持 Python 内置类型（<code>int</code>, <code>float</code>, <code>str</code>, <code>bool</code> 等）、标准库类型（<code>datetime</code>, <code>date</code>, <code>UUID</code> 等）以及自定义类型。</li><li><strong>自动类型转换</strong>：智能地将输入数据转换为声明的类型，例如将字符串形式的数字转换为整数，将ISO格式的字符串转换为 <code>datetime</code> 对象。</li><li><strong>复杂类型处理</strong>：优雅处理嵌套列表、字典、集合等复杂数据结构，支持递归类型定义和类型参数化。</li></ul><p>示例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Event</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="built_in">id</span>: <span class="built_in">int</span></span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    start_time: datetime  <span class="comment"># 自动将字符串转换为datetime</span></span><br><span class="line">    participants: <span class="type">List</span>[<span class="built_in">str</span>]  <span class="comment"># 支持列表类型</span></span><br><span class="line">    metadata: <span class="type">Optional</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]] = <span class="literal">None</span>  <span class="comment"># 支持可选字段和字典类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 类型转换示例</span></span><br><span class="line">event = Event(</span><br><span class="line">    <span class="built_in">id</span>=<span class="string">&#x27;123&#x27;</span>,  <span class="comment"># 字符串自动转换为整数</span></span><br><span class="line">    name=<span class="string">&#x27;技术研讨会&#x27;</span>,</span><br><span class="line">    start_time=<span class="string">&#x27;2023-12-01T10:00:00&#x27;</span>,  <span class="comment"># 字符串自动转换为datetime</span></span><br><span class="line">    participants=[<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>],</span><br><span class="line">    metadata=&#123;<span class="string">&#x27;location&#x27;</span>: <span class="string">&#x27;线上&#x27;</span>, <span class="string">&#x27;organizer&#x27;</span>: <span class="string">&#x27;技术部&#x27;</span>&#125;</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(event.model_dump())</span><br></pre></td></tr></table></figure><h3 id="3-3-模型定义与管理"><a href="#3-3-模型定义与管理" class="headerlink" title="3.3 模型定义与管理"></a>3.3 模型定义与管理</h3><p>Pydantic 模型是数据结构和业务逻辑的核心载体，支持多种高级特性。</p><ul><li><strong>基础模型</strong>：通过继承 <code>BaseModel</code> 创建，字段使用类型注解定义，支持默认值、可选字段和字段校验器。</li><li><strong>嵌套模型</strong>：模型字段可以是另一个模型类型，实现数据结构的层级化和模块化，便于处理复杂数据。</li><li><strong>继承模型</strong>：支持模型间的继承，子类模型自动继承父类的字段和验证器，也可以覆盖或扩展父类行为。</li><li><strong>泛型模型</strong>：支持泛型类型，提高代码复用性，适用于处理不同类型但结构相似的数据。</li></ul><p>示例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, TypeVar, <span class="type">Generic</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 基础模型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    age: <span class="built_in">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 嵌套模型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Address</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    city: <span class="built_in">str</span></span><br><span class="line">    street: <span class="built_in">str</span></span><br><span class="line">    zip_code: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Contact</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    person: Person  <span class="comment"># 嵌套Person模型</span></span><br><span class="line">    address: Address  <span class="comment"># 嵌套Address模型</span></span><br><span class="line">    phone: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 继承模型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span>(<span class="title class_ inherited__">Person</span>):</span><br><span class="line">    employee_id: <span class="built_in">str</span></span><br><span class="line">    department: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 泛型模型</span></span><br><span class="line">data_type = TypeVar(<span class="string">&#x27;data_type&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PaginatedResponse</span>(BaseModel, <span class="type">Generic</span>[data_type]):</span><br><span class="line">    total: <span class="built_in">int</span></span><br><span class="line">    page: <span class="built_in">int</span></span><br><span class="line">    page_size: <span class="built_in">int</span></span><br><span class="line">    items: <span class="type">List</span>[data_type]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用泛型模型</span></span><br><span class="line">users = [Person(name=<span class="string">&#x27;张三&#x27;</span>, age=<span class="number">30</span>), Person(name=<span class="string">&#x27;李四&#x27;</span>, age=<span class="number">25</span>)]</span><br><span class="line">response = PaginatedResponse[Person](total=<span class="number">2</span>, page=<span class="number">1</span>, page_size=<span class="number">10</span>, items=users)</span><br><span class="line"><span class="comment"># 输出模型内容</span></span><br><span class="line"><span class="built_in">print</span>(response.model_dump())</span><br></pre></td></tr></table></figure><h3 id="3-4-与其他库的兼容性"><a href="#3-4-与其他库的兼容性" class="headerlink" title="3.4 与其他库的兼容性"></a>3.4 与其他库的兼容性</h3><p>Pydantic 设计为与其他流行 Python 库无缝集成，增强开发体验和效率。</p><ul><li><strong>与FastAPI集成</strong>：FastAPI 原生支持 Pydantic 模型，自动用于请求参数验证和响应格式化，大幅减少重复代码。</li><li><strong>与Django&#x2F;Flask集成</strong>：可作为表单验证和API数据处理的补充，在保持框架原生体验的同时提升数据验证能力。</li><li><strong>与Pandas&#x2F;Numpy集成</strong>：支持与数据科学库的数据结构互转，方便在数据处理管道中进行数据验证和清洗。</li></ul><p>示例（与FastAPI集成）：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    is_offer: <span class="built_in">bool</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&#x27;/items/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;item_name&#x27;</span>: item.name, <span class="string">&#x27;item_price&#x27;</span>: item.price&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hydra使用指南</title>
      <link href="/2025/09/02/Hydra%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
      <url>/2025/09/02/Hydra%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>Hydra是一款开源Python框架，专为简化科研项目及其他复杂应用的开发而设计。其核心优势在于支持动态构建分层配置体系——既可通过组合方式创建层级结构，又能借助配置文件和命令行进行灵活调整。该名称源自其“多头并进”的特性：就像水蛇分叉般能同时运行多个相似任务，完美诠释了“众手齐发力”的开发理念。</p><h2 id="主要功能"><a href="#主要功能" class="headerlink" title="主要功能"></a>主要功能</h2><ol><li>支持多源组合的层次化配置管理：可从多个来源（文件、环境变量、命令行等）加载并组合配置，形成层次化的配置结构</li><li>命令行参数配置覆盖：支持通过命令行参数直接指定或覆盖配置值，提供灵活的配置方式</li><li>动态命令行补全：提供智能的命令行选项补全功能，提升开发体验和效率</li><li>本地与远程执行支持：支持在本地运行应用程序，或配置并启动远程执行环境</li><li>多参数作业并行执行：支持通过单个命令运行具有不同参数组合的多个作业，实现高效的参数空间探索</li></ol><h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><h3 id="模块安装"><a href="#模块安装" class="headerlink" title="模块安装"></a>模块安装</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install hydra-core --upgrade</span><br></pre></td></tr></table></figure><blockquote><p>这里安装的时候要注意一下！！因为导入的包是hydra，所以会下意识的安装hydra，而不是hydra-core，导致安装不成功。（因为我自己去安装的时候有出现这个问题）</p></blockquote><h3 id="简单案例"><a href="#简单案例" class="headerlink" title="简单案例"></a>简单案例</h3><h4 id="1-基本用法（命令行参数）"><a href="#1-基本用法（命令行参数）" class="headerlink" title="1. 基本用法（命令行参数）"></a>1. 基本用法（命令行参数）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> omegaconf <span class="keyword">import</span> DictConfig, OmegaConf</span><br><span class="line"><span class="keyword">import</span> hydra</span><br><span class="line"></span><br><span class="line"><span class="meta">@hydra.main(<span class="params">version_base=<span class="literal">None</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_app</span>(<span class="params">cfg: DictConfig</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(OmegaConf.to_yaml(cfg))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    my_app()</span><br></pre></td></tr></table></figure><p>在本示例中，Hydra创建一个空的<code>cfg</code>对象，并将其传递给带有<code>@hydra.main</code>注解的函数。</p><p>你可以通过命令行添加配置值，<code>+</code>表示该字段是新的。</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python my_app.py +db.driver=mysql +db.user=omry +db.password=secret</span><br></pre></td></tr></table></figure><p>当你在命令行中输入上述命令时，Hydra会将<code>db.driver</code>、<code>db.user</code>和<code>db.password</code>添加到<code>cfg</code>对象中。</p><p>你可以在Python代码中使用<code>cfg</code>对象来访问这些配置值。例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">my_app</span>(<span class="params">cfg: DictConfig</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(cfg.db.driver)</span><br><span class="line">    <span class="built_in">print</span>(cfg.db.user)</span><br><span class="line">    <span class="built_in">print</span>(cfg.db.password)</span><br></pre></td></tr></table></figure><p>在本示例中，<code>my_app</code>函数接收一个<code>DictConfig</code>对象作为参数，该对象包含了从命令行添加的配置值。通过<code>cfg.db.driver</code>、<code>cfg.db.user</code>和<code>cfg.db.password</code>，你可以访问到相应的配置值。</p><h4 id="2-配置文件（config-yaml）"><a href="#2-配置文件（config-yaml）" class="headerlink" title="2. 配置文件（config.yaml）"></a>2. 配置文件（config.yaml）</h4><p>你也可以在配置文件中定义默认值。例如，在文件夹<code>conf</code>下创建一个<code>config.yaml</code>文件：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">db:</span></span><br><span class="line">  <span class="attr">driver:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">omry</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">secret</span></span><br></pre></td></tr></table></figure><p>然后，在Python代码中使用<code>@hydra.main</code>注解时，指定配置文件的路径：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@hydra.main(<span class="params">version_base=<span class="literal">None</span>, config_path=<span class="string">&quot;./conf&quot;</span>, config_name=<span class="string">&quot;config&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_app</span>(<span class="params">cfg: DictConfig</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(OmegaConf.to_yaml(cfg))</span><br></pre></td></tr></table></figure><p>当你启动应用的时候，Hydra会自动加载<code>conf</code>文件夹下的<code>config.yaml</code>文件。</p><blockquote><p><code>config_path</code>是配置文件的路径，<code>config_name</code>是配置文件的名称。注意：这里的<code>config_path</code>是相对于Python文件的路径，所以这里是<code>./conf</code>，如果是绝对路径，就不需要加<code>./</code>了。</p></blockquote><p>您可以从命令行覆盖已加载配置中的值，<strong>不用加<code>+</code>作为前缀，直接写键值对即可</strong>。</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python my_app.py db.driver=postgresql</span><br></pre></td></tr></table></figure><p>在本示例中，<code>db.driver</code>的值被覆盖为<code>postgresql</code>。</p><p>你可以在命令行中添加多个配置值，它们会被合并到<code>cfg</code>对象中。</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python my_app.py db.driver=postgresql db.user=postgres</span><br></pre></td></tr></table></figure><p>在本示例中，<code>db.driver</code>的值被覆盖为<code>postgresql</code>，<code>db.user</code>的值被设置为<code>postgres</code>。</p><p>如果配置中已存在某个配置值，则使用++来覆盖该值，否则添加该值。例如：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 覆盖存在的配置值</span><br><span class="line">$ python my_app.py ++db.password=<span class="number">1234</span></span><br><span class="line"></span><br><span class="line"># 添加一个新的配置值</span><br><span class="line">$ python my_app.py ++db.timeout=<span class="number">5</span></span><br></pre></td></tr></table></figure><h4 id="3-配置对象"><a href="#3-配置对象" class="headerlink" title="3.配置对象"></a>3.配置对象</h4><p>上面两个小节主要展示了<code>hydra</code>的使用方式，一个是在命令行中读取，一个是在配置文件中读取。</p><p>下面这个小节主要展示了<code>hydra</code>的配置对象的这一特点。即可以通过对象的方式来访问配置文件中的值。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">node:</span>                         <span class="comment"># yaml的配置是分层的</span></span><br><span class="line">  <span class="attr">loompa:</span> <span class="number">10</span>                  <span class="comment"># 简单值</span></span><br><span class="line">  <span class="attr">zippity:</span> <span class="string">$&#123;node.loompa&#125;</span>     <span class="comment"># 插值，这里是引用node.loompa的值</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">do:</span> <span class="string">&quot;oompa $&#123;node.loompa&#125;&quot;</span>  <span class="comment"># 字符串插值，这里是引用node.loompa的值</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">waldo:</span> <span class="string">???</span>                  <span class="comment"># 缺失值</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> omegaconf <span class="keyword">import</span> DictConfig, OmegaConf</span><br><span class="line"><span class="keyword">import</span> hydra</span><br><span class="line"></span><br><span class="line"><span class="meta">@hydra.main(<span class="params">version_base=<span class="literal">None</span>, config_path=<span class="string">&quot;.&quot;</span>, config_name=<span class="string">&quot;config&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_app</span>(<span class="params">cfg: DictConfig</span>):</span><br><span class="line">    <span class="keyword">assert</span> cfg.node.loompa == <span class="number">10</span>          <span class="comment"># 属性方式访问</span></span><br><span class="line">    <span class="keyword">assert</span> cfg[<span class="string">&quot;node&quot;</span>][<span class="string">&quot;loompa&quot;</span>] == <span class="number">10</span>    <span class="comment"># 字典方式访问</span></span><br><span class="line">    <span class="keyword">assert</span> cfg.node.zippity == <span class="number">10</span>         <span class="comment"># 插值方式访问</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">isinstance</span>(cfg.node.zippity, <span class="built_in">int</span>)  <span class="comment"># 插值方式访问的值是int类型</span></span><br><span class="line">    <span class="keyword">assert</span> cfg.node.do == <span class="string">&quot;oompa 10&quot;</span>      <span class="comment"># 字符串插值方式访问</span></span><br><span class="line">    cfg.node.waldo                        <span class="comment"># 缺失值访问，会报错</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    my_app()</span><br></pre></td></tr></table></figure><blockquote><p>运行上面的代码报错是很正常的，因为<code>waldo</code>是一个缺失值，没有在配置文件中定义，所以会报错。要正确跑通只需要把<code>cfg.node.waldo</code>注释掉即可。</p></blockquote><p>通过上面的例子可以了解到，<code>hydra</code>可以通过对象的方式对配置文件的键值对进行封装，从而可以通过使用对象访问属性的方式来获取配置值。</p><h4 id="4-配置组文件"><a href="#4-配置组文件" class="headerlink" title="4.配置组文件"></a>4.配置组文件</h4><p>假如你想在PostgreSQL和MySQL这俩数据库上给应用程序做个基准测试，这时候就可以用配置组。</p><p>配置组，就是一个有一堆有效选项的命名组。要是你选了个不存在的配置选项，就会报错，报错信息里还会把有效的选项都列出来。</p><p>要创建配置组，请创建一个目录（例如db），用于存放每个数据库配置选项的文件。由于我们预期会有多个配置组，因此我们将所有配置文件主动移动到conf目录中。</p><p>示例的文件树如下:</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">├─ conf</span><br><span class="line">│  └─ db</span><br><span class="line">│      ├─ mysql.yaml</span><br><span class="line">│      └─ postgresql.yaml</span><br><span class="line">└── my_app.py</span><br></pre></td></tr></table></figure><p>在mysql.yaml中，我们可以这样配置:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">user:</span> <span class="string">omry</span></span><br><span class="line"><span class="attr">password:</span> <span class="string">secret</span></span><br></pre></td></tr></table></figure><p>在postgresql.yaml中，我们可以这样配置:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver:</span> <span class="string">postgresql</span></span><br><span class="line"><span class="attr">user:</span> <span class="string">postgres_user</span></span><br><span class="line"><span class="attr">password:</span> <span class="string">drowssap</span></span><br><span class="line"><span class="attr">timeout:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><p>由于我们已将所有配置文件移至conf目录，因此需要通过config_path参数告知Hydra如何定位这些配置。config_path是相对于my_app.py的目录。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> omegaconf <span class="keyword">import</span> DictConfig, OmegaConf</span><br><span class="line"><span class="keyword">import</span> hydra</span><br><span class="line"></span><br><span class="line"><span class="meta">@hydra.main(<span class="params">version_base=<span class="literal">None</span>, config_path=<span class="string">&quot;conf&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_app</span>(<span class="params">cfg: DictConfig</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(OmegaConf.to_yaml(cfg))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    my_app()</span><br></pre></td></tr></table></figure><p>运行my_app.py而<strong>不请求配置</strong>将打印空的配置。</p><blockquote><p>运行my_app.py而<strong>不请求配置</strong>将打印空的配置。这是因为我们没有在命令行中指定任何配置，也没有在配置文件中定义默认值。我们虽然在配置文件中定义了配置项，但是并没有说是使用<code>db.mysql</code>还是<code>db.postgresql</code>，所以打印为空。</p></blockquote><p>从配置组中选择一个项，其<code>+GROUP=OPTION</code>，例如：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ python my_app.py +db=postgresql</span><br><span class="line"><span class="function">db:</span></span><br><span class="line"><span class="function">  <span class="title">driver</span>: <span class="title">postgresql</span></span></span><br><span class="line"><span class="function">  <span class="title">password</span>: <span class="title">drowssap</span></span></span><br><span class="line"><span class="function">  <span class="title">timeout</span>: 10</span></span><br><span class="line"><span class="function">  <span class="title">user</span>: <span class="title">postgres_user</span></span></span><br></pre></td></tr></table></figure><blockquote><p>上面这个示例就是通过<code>+db=postgresql</code>来选择<code>db.postgresql</code>这个配置组。因此得到的就是<code>postgresql.yaml</code>文件中的配置项。反之同理，通过<code>+db=mysql</code>来选择<code>db.mysql</code>这个配置组。因此得到的就是<code>mysql.yaml</code>文件中的配置项。</p></blockquote><p>可以在生成的配置中覆盖单个值，也就是带<code>+</code>和不带<code>+</code>的组合使用！！</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ python my_app.py +db=postgresql db.user=postgres</span><br><span class="line"><span class="function">db:</span></span><br><span class="line"><span class="function">  <span class="title">driver</span>: <span class="title">postgresql</span></span></span><br><span class="line"><span class="function">  <span class="title">password</span>: <span class="title">drowssap</span></span></span><br><span class="line"><span class="function">  <span class="title">timeout</span>: 10</span></span><br><span class="line"><span class="function">  <span class="title">user</span>: <span class="title">postgres</span></span></span><br></pre></td></tr></table></figure><blockquote><p>上面这个示例就是先选择<code>db.postgresql</code>这个配置组，然后在这个配置组中覆盖<code>db.user</code>这个配置项的值为<code>postgres</code>。因此得到的就是<code>postgresql.yaml</code>文件中的配置项，但是<code>user</code>的值被覆盖为<code>postgres</code>。</p></blockquote><h4 id="5-选择默认的配置"><a href="#5-选择默认的配置" class="headerlink" title="5.选择默认的配置"></a>5.选择默认的配置</h4><p>通过上述配置组文件的案例我们可以知道，我们需要通过<code>+db=mysql</code>来选择<code>db.mysql</code>这个配置组，不选择的时候返回的是空的。但是<code>hydra</code>可以在<code>config.yaml</code>中定义默认值，这样就可以在不指定<code>+db</code>的情况下，默认选择<code>db.mysql</code>这个配置组。</p><p>我们只需要创建一个<code>config.yaml</code>文件，在这个文件中定义默认值，例如：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">defaults:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">db:</span> <span class="string">mysql</span></span><br></pre></td></tr></table></figure><p>请记住要指定config_name：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> omegaconf <span class="keyword">import</span> DictConfig, OmegaConf</span><br><span class="line"><span class="keyword">import</span> hydra</span><br><span class="line"></span><br><span class="line"><span class="meta">@hydra.main(<span class="params">version_base=<span class="literal">None</span>, config_path=<span class="string">&quot;conf&quot;</span>, config_name=<span class="string">&quot;config&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_app</span>(<span class="params">cfg: DictConfig</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(OmegaConf.to_yaml(cfg))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    my_app()</span><br></pre></td></tr></table></figure><p>运行更新后的应用程序时，默认情况下将加载MySQL。</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ python my_app.py</span><br><span class="line"><span class="function">db:</span></span><br><span class="line"><span class="function">  <span class="title">driver</span>: <span class="title">mysql</span></span></span><br><span class="line"><span class="function">  <span class="title">password</span>: <span class="title">secret</span></span></span><br><span class="line"><span class="function">  <span class="title">user</span>: <span class="title">omry</span></span></span><br></pre></td></tr></table></figure><p>默认值列表中可以包含多个项目，例如：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">defaults:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">db:</span> <span class="string">mysql</span></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">db/mysql/engine:</span> <span class="string">innodb</span></span><br></pre></td></tr></table></figure><p>如果存在多个默认值，那么默认值按以下顺序排列：</p><ul><li>当多个配置中定义了相同的配置项时，按配置加载顺序，最后加载的配置项值会覆盖之前加载的配置项值。</li><li>当多个配置文件对同一个字典进行配置时，按配置文件加载顺序，最后加载的配置文件中的字典值会覆盖之前配置文件中的字典值。</li></ul><p>可以通过在默认值列表中条目的前缀添加~来<strong>删除</strong>该条目：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python my_app.py ~db</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Hydra作为一款强大的配置管理框架，为复杂应用程序和科研项目提供了优雅的配置解决方案。其核心优势在于支持层次化、多源组合的配置管理，同时提供灵活的命令行参数覆盖和智能补全功能，极大提升了开发效率和配置灵活性。Hydra通过其强大而灵活的配置管理能力，帮助开发者从繁琐的配置工作中解放出来，更专注于核心业务逻辑和算法创新，是现代复杂应用开发和科研实验管理的得力工具。</p><blockquote><p>其实我发现这个模块也是因为看了<code>Time-R1</code>这个项目的源码才知道的，这个项目中使用了<code>hydra</code>来管理配置文件，所以我才去学习了一下<code>hydra</code>的使用🌈。所以学习源码还是有用的，能从中发现一些很有趣且有用的模块，帮助提升自己的开发和研发能力，提高效率！！</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux定时任务使用(cron)</title>
      <link href="/2025/09/02/Linux%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E4%BD%BF%E7%94%A8-cron/"/>
      <url>/2025/09/02/Linux%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E4%BD%BF%E7%94%A8-cron/</url>
      
        <content type="html"><![CDATA[<h2 id="一、为什么需要定时任务？"><a href="#一、为什么需要定时任务？" class="headerlink" title="一、为什么需要定时任务？"></a>一、为什么需要定时任务？</h2><p>这个其实是我在工作当中遇到的一个问题，我需要在非工作时间，比如晚上0点，自动执行一个脚本，来重启算法服务。这其实也是卡在一个其他客户不用上班的时间，工作时间点肯定就不能进行算法服务的重启操作了，这对于客户的损失是比较大的。因此，借此场景来学习Linux定时任务的设置。</p><p>Linux设置定时任务的好处如下：</p><ul><li>设置自动化重复工作，解放双手</li><li>保障系统维护在非工作时间执行</li><li>确保关键任务按时完成，避免人为遗忘</li></ul><h2 id="二、核心工具：cron与at"><a href="#二、核心工具：cron与at" class="headerlink" title="二、核心工具：cron与at"></a>二、核心工具：cron与at</h2><p>Linux系统提供了多种定时任务工具，其中最常用的有cron和at，此外还有batch、systemd-timer等工具。不过目前主要使用的是cron和at。因此，下面主要介绍这两个工具的使用。</p><h3 id="2-1-cron：最常用的周期性定时任务系统"><a href="#2-1-cron：最常用的周期性定时任务系统" class="headerlink" title="2.1 cron：最常用的周期性定时任务系统"></a>2.1 cron：最常用的周期性定时任务系统</h3><p><strong>什么是cron？</strong></p><p>cron是Linux系统中最经典、最常用的定时任务调度器，用于周期性执行命令或脚本。它通过crontab文件定义任务，由cron守护进程（crond）在后台持续运行并检查任务执行时间，其中系统级任务存储在&#x2F;etc&#x2F;crontab和&#x2F;etc&#x2F;cron.d&#x2F;目录下，用户级任务通过crontab命令管理。</p><p><strong>工作原理：</strong></p><ol><li><strong>用户创建或编辑任务</strong>：用户通过 <code>crontab</code> 命令创建或编辑定时任务。执行 <code>crontab -e</code> 命令时，系统会调用默认的文本编辑器打开一个临时文件，用户可以在其中按照 <code>cron</code> 的语法格式添加、修改或删除定时任务。编辑完成并保存退出后，该文件内容会被处理成合法的定时任务信息。</li><li><strong>任务存储</strong>：经过处理的定时任务信息会被保存到 <code>/var/spool/cron/</code> 目录下以用户名命名的专属文件中。每个用户的定时任务都独立存储在该目录下对应的文件里，保证了不同用户任务的隔离性。</li><li><strong>守护进程检查</strong>：<code>crond</code> 守护进程在系统后台持续运行，每分钟会对 <code>/var/spool/cron/</code> 目录下的所有用户专属文件，以及 <code>/etc/crontab</code> 和 <code>/etc/cron.d/</code> 目录下的系统级任务文件进行一次全面检查。它会解析每个任务的时间表达式，判断是否有任务到达执行时间。</li><li><strong>任务执行</strong>：当 <code>crond</code> 守护进程检查到某个任务到达指定的执行时间时，会 <code>fork</code> 一个子进程来执行该任务。之所以创建子进程，是为了保证 <code>crond</code> 守护进程本身可以继续正常运行，不受任务执行的影响。任务执行完成后，子进程会自动结束。</li></ol><p><strong>优点：</strong></p><ul><li>支持复杂的时间表达式，可<strong>精确到分钟级别</strong></li><li>任务执行结果可通过邮件通知（默认配置）</li><li>支持系统级和用户级任务分离</li><li>几乎所有Linux发行版都预装并默认启用</li></ul><p><strong>缺点：</strong></p><ul><li>配置相对复杂，需要记忆特殊字符的含义</li><li>不支持任务依赖关系</li><li>当系统关机或重启时，错过的任务不会自动执行（需配合anacron解决）</li></ul><p><strong>适用场景：</strong></p><ul><li>需要定期执行的系统维护任务（如日志清理、备份）</li><li>周期性的数据处理或报表生成</li><li>定时启动&#x2F;关闭服务或应用程序</li></ul><p><strong>crontab命令：管理定时任务的入口</strong></p><ul><li><code>crontab -e</code>：编辑当前用户的定时任务</li><li><code>crontab -l</code>：列出当前用户的定时任务</li><li><code>crontab -r</code>：删除当前用户的所有定时任务</li><li><code>crontab -u username -e</code>：编辑指定用户的定时任务（需要root权限）</li></ul><h3 id="2-2-at：一次性定时任务工具"><a href="#2-2-at：一次性定时任务工具" class="headerlink" title="2.2 at：一次性定时任务工具"></a>2.2 at：一次性定时任务工具</h3><p><strong>什么是at？</strong></p><p>at 是用于执行<strong>一次性定时任务的工具</strong>，可在指定时间点执行一次命令或脚本。与 cron 不同，at 任务执行完毕后会自动删除，由 atd 守护进程负责管理和执行。</p><p><strong>工作原理：</strong></p><ol><li><strong>用户创建任务</strong>：用户使用 <code>at</code> 命令指定任务的执行时间和要执行的命令。<code>at</code> 命令支持多种时间指定方式，如绝对时间（例如 <code>at 23:00 tomorrow</code>）和相对时间（例如 <code>at now + 30 minutes</code>）。执行命令后，用户需要输入要执行的具体命令，输入完成后按 <code>Ctrl + D</code> 结束输入。</li><li><strong>任务存储</strong>：输入完成后，系统会对任务信息进行处理，将任务保存到 <code>/var/spool/at/</code> 目录下。任务会被存储为一个文件，文件名包含任务的唯一标识，确保每个任务都能被准确识别和管理。</li><li><strong>守护进程检查</strong>：<code>atd</code> 守护进程在系统后台持续运行，每分钟会检查 <code>/var/spool/at/</code> 目录下的任务文件。它会解析每个任务文件中的时间信息，判断是否有任务到达执行时间。</li><li><strong>任务执行与清理</strong>：当 <code>atd</code> 守护进程检查到某个任务到达指定的执行时间时，会 <code>fork</code> 一个子进程来执行该任务。这样可以保证 <code>atd</code> 守护进程本身能够继续正常运行，不受任务执行的影响。任务执行完成后，<code>atd</code> 会自动删除对应的任务文件，清理任务记录。</li></ol><p>这里给个一个简单的 <code>at</code> 命令使用示例，该示例会在明天 10 点执行关机命令（使用<code>at</code>要确保Linux已经安装了这个命令）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">at 10:00 tomorrow <span class="comment"># 先执行命令</span></span><br><span class="line">shutdown -h now <span class="comment"># 然后输入到时间点要执行的命令</span></span><br></pre></td></tr></table></figure><p><strong>优点：</strong></p><ul><li>语法简单直观，容易学习和使用</li><li>适合<strong>临时的、一次性</strong>的任务调度</li><li>支持多种时间指定方式（如绝对时间、相对时间）</li></ul><p><strong>缺点：</strong></p><ul><li>不支持周期性任务</li><li>任务执行结果默认通过邮件发送，可能被忽略</li><li>当系统关机或重启时，错过的任务不会自动执行</li></ul><p><strong>适用场景：</strong></p><ul><li>延迟执行某个命令（如30分钟后关闭系统）</li><li>在特定时间点执行一次性数据处理</li><li>安排在非工作时间执行的临时任务</li></ul><p><strong>与cron的主要区别：</strong></p><ul><li>cron用于周期性任务，at用于一次性任务</li><li>cron任务会被保存并重复执行，at任务执行后自动删除</li><li>cron配置相对复杂，at语法更简单直观</li></ul><h3 id="2-3-其他定时任务工具"><a href="#2-3-其他定时任务工具" class="headerlink" title="2.3 其他定时任务工具"></a>2.3 其他定时任务工具</h3><p><strong>batch</strong> 是一个用于在系统负载较低时执行一次性任务的工具。它与 <code>at</code> 类似，但不指定具体执行时间，而是在系统负载低于某个阈值时才执行，适合用于执行资源密集型任务，以此避免影响系统正常运行。</p><p><strong>systemd-timer：新时代的定时任务方案</strong>：随着systemd的普及，systemd-timer逐渐成为替代cron的新选择。它支持更精确的时间控制、任务依赖关系和事件触发，配置灵活，但学习曲线较陡峭。</p><h2 id="三、cron基础使用教程"><a href="#三、cron基础使用教程" class="headerlink" title="三、cron基础使用教程"></a>三、cron基础使用教程</h2><p>目前我在工作中所使用的也是cron居多，基本上都是要在服务器上执行一些定时任务，这个<code>cron</code>使用起来较为简单，很快就可以把一个定时任务给编写出来。下面具体介绍一下<code>cron</code>的基础使用方式。</p><h3 id="3-1-基本语法与格式"><a href="#3-1-基本语法与格式" class="headerlink" title="3.1 基本语法与格式"></a>3.1 基本语法与格式</h3><p><code>cron</code>的配置文件遵循严格的语法格式，每行代表一个定时任务，格式如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">分 时 日 月 周 要执行的命令</span><br></pre></td></tr></table></figure><h4 id="时间字段详细解析"><a href="#时间字段详细解析" class="headerlink" title="时间字段详细解析"></a>时间字段详细解析</h4><ul><li><strong>分</strong>：取值范围 0-59，表示分钟</li><li><strong>时</strong>：取值范围 0-23，表示小时</li><li><strong>日</strong>：取值范围 1-31，表示日期</li><li><strong>月</strong>：取值范围 1-12，表示月份</li><li><strong>周</strong>：取值范围 0-7（0和7都代表星期日），表示星期几</li></ul><h4 id="特殊字符含义及示例"><a href="#特殊字符含义及示例" class="headerlink" title="特殊字符含义及示例"></a>特殊字符含义及示例</h4><ul><li><code>*</code>：表示所有可能的值，例如在”分”字段使用<code>*</code>，表示每分钟执行一次</li><li><code>/</code>：表示间隔，例如在”分”字段使用<code>*/5</code>，表示每5分钟执行一次</li><li><code>-</code>：表示范围，例如在”时”字段使用<code>9-17</code>，表示9点到17点之间每个小时执行一次</li><li><code>,</code>：表示多个值，例如在”周”字段使用<code>1,3,5</code>，表示周一、周三、周五执行</li></ul><blockquote><p>通过上面时间字段+特殊字符，我们可以组合出各种不同的定时任务。具体怎么组合就要看实际的业务场景了，同时也需要大家发挥自己的创意和经验🌈。下面给出一些组合的示例。</p></blockquote><p><strong>示例效果说明</strong>：</p><ul><li><code>0 8 * * * command</code>：每天早上8点整执行命令</li><li><code>*/15 * * * * command</code>：每15分钟执行一次命令</li><li><code>0 12 * * 1-5 command</code>：周一至周五中午12点执行命令</li><li><code>30 2 1,15 * * command</code>：每月1日和15日凌晨2点30分执行命令</li></ul><h3 id="3-2-常用命令速查"><a href="#3-2-常用命令速查" class="headerlink" title="3.2 常用命令速查"></a>3.2 常用命令速查</h3><h4 id="crontab-e：编辑定时任务"><a href="#crontab-e：编辑定时任务" class="headerlink" title="crontab -e：编辑定时任务"></a><code>crontab -e</code>：编辑定时任务</h4><p><strong>使用步骤</strong>：</p><ol><li>执行命令后，系统会打开默认文本编辑器（通常是vi或nano）</li><li>在编辑器中按照cron语法添加或修改任务</li><li>保存并退出编辑器，任务会自动生效</li></ol><p><strong>效果</strong>：添加或更新用户的定时任务列表</p><h4 id="crontab-l：查看当前任务"><a href="#crontab-l：查看当前任务" class="headerlink" title="crontab -l：查看当前任务"></a><code>crontab -l</code>：查看当前任务</h4><p><strong>使用步骤</strong>：直接在终端执行命令</p><p><strong>效果</strong>：以文本形式显示当前用户的所有定时任务</p><h4 id="crontab-r：删除所有任务"><a href="#crontab-r：删除所有任务" class="headerlink" title="crontab -r：删除所有任务"></a><code>crontab -r</code>：删除所有任务</h4><p><strong>使用步骤</strong>：直接在终端执行命令（注意：此操作不可逆）</p><p><strong>效果</strong>：删除当前用户的所有定时任务</p><p><strong>警告</strong>：使用此命令前请务必先用<code>crontab -l</code>备份任务列表</p><h4 id="crontab-u-username-e：管理其他用户的任务"><a href="#crontab-u-username-e：管理其他用户的任务" class="headerlink" title="crontab -u username -e：管理其他用户的任务"></a><code>crontab -u username -e</code>：管理其他用户的任务</h4><p><strong>使用步骤</strong>：</p><ol><li>以root用户身份执行命令</li><li>编辑指定用户的定时任务</li><li>保存并退出编辑器</li></ol><p><strong>效果</strong>：添加或更新指定用户的定时任务列表</p><p><strong>权限要求</strong>：需要root权限才能管理其他用户的任务</p><h2 id="四、实用示例：服务场景配置"><a href="#四、实用示例：服务场景配置" class="headerlink" title="四、实用示例：服务场景配置"></a>四、实用示例：服务场景配置</h2><p>下面以”每日凌晨2点自动备份数据库”为例，详细演示从<code>crontab -e</code>开始到任务设置完成的完整流程。</p><h3 id="4-1-场景需求"><a href="#4-1-场景需求" class="headerlink" title="4.1 场景需求"></a>4.1 场景需求</h3><p>每天凌晨2点自动备份MySQL数据库，并将备份文件压缩存储到指定目录。</p><h3 id="4-2-实现步骤"><a href="#4-2-实现步骤" class="headerlink" title="4.2 实现步骤"></a>4.2 实现步骤</h3><h4 id="步骤1：创建备份脚本"><a href="#步骤1：创建备份脚本" class="headerlink" title="步骤1：创建备份脚本"></a>步骤1：创建备份脚本</h4><p>首先，我们需要创建一个数据库备份脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建备份脚本文件</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /backup/scripts</span><br><span class="line">vi /backup/scripts/mysql_backup.sh</span><br></pre></td></tr></table></figure><p>在脚本中添加以下内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># MySQL数据库备份脚本</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置信息</span></span><br><span class="line">DB_USER=<span class="string">&quot;root&quot;</span></span><br><span class="line">DB_PASS=<span class="string">&quot;your_password&quot;</span></span><br><span class="line">DB_NAME=<span class="string">&quot;your_database&quot;</span></span><br><span class="line">BKP_DIR=<span class="string">&quot;/backup/mysql&quot;</span></span><br><span class="line">BKP_TIME=$(<span class="built_in">date</span> +%Y%m%d_%H%M%S)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建备份目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$BKP_DIR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行备份</span></span><br><span class="line">mysqldump -u<span class="variable">$DB_USER</span> -p<span class="variable">$DB_PASS</span> <span class="variable">$DB_NAME</span> | gzip &gt; <span class="variable">$BKP_DIR</span>/<span class="variable">$&#123;DB_NAME&#125;</span>_<span class="variable">$&#123;BKP_TIME&#125;</span>.sql.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理7天前的备份文件</span></span><br><span class="line">find <span class="variable">$BKP_DIR</span> -name <span class="string">&quot;<span class="variable">$&#123;DB_NAME&#125;</span>_*.sql.gz&quot;</span> -mtime +7 -delete</span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录日志</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;备份完成: <span class="variable">$BKP_DIR</span>/<span class="variable">$&#123;DB_NAME&#125;</span>_<span class="variable">$&#123;BKP_TIME&#125;</span>.sql.gz&quot;</span> &gt;&gt; /var/log/mysql_backup.log</span><br></pre></td></tr></table></figure><p>保存并退出编辑器，然后为脚本添加执行权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x /backup/scripts/mysql_backup.sh</span><br></pre></td></tr></table></figure><blockquote><p>上面的脚本可以是任何任务，比如我实际业务遇到的算法服务，需要定时调用接口，或者定时调用脚本。下面的步骤是通用的，只需要把要执行的命令替换为实际的命令即可。</p></blockquote><h4 id="步骤2：使用crontab-e添加定时任务"><a href="#步骤2：使用crontab-e添加定时任务" class="headerlink" title="步骤2：使用crontab -e添加定时任务"></a>步骤2：使用<code>crontab -e</code>添加定时任务</h4><p>执行以下命令编辑定时任务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure><p>系统会打开默认文本编辑器（通常会是vim，当然我的Linux默认是vim啦）。在编辑器中添加以下行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 2 * * * /backup/scripts/mysql_backup.sh</span><br></pre></td></tr></table></figure><p>这表示每天凌晨2点（0分2时）执行备份脚本。</p><blockquote><p>这里面的命令是要执行的命令，比如我上面的脚本，就是要执行的命令。也就是说你Linux怎么启动或者重启脚本，这里就怎么写！！本质上就是让Linux帮你在两点钟执行后面那个命令🤖</p></blockquote><h4 id="步骤3：保存并退出编辑器"><a href="#步骤3：保存并退出编辑器" class="headerlink" title="步骤3：保存并退出编辑器"></a>步骤3：保存并退出编辑器</h4><ul><li>如果使用vi编辑器：按<code>Esc</code>键，然后输入<code>:wq</code>并按<code>Enter</code>键保存退出</li><li>如果使用nano编辑器：按<code>Ctrl+O</code>保存，按<code>Ctrl+X</code>退出</li><li>如果使用vim编辑器：按<code>:wq</code>并按<code>Enter</code>键保存退出</li></ul><h4 id="步骤4：验证定时任务是否添加成功"><a href="#步骤4：验证定时任务是否添加成功" class="headerlink" title="步骤4：验证定时任务是否添加成功"></a>步骤4：验证定时任务是否添加成功</h4><p>执行以下命令查看当前用户的定时任务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -l</span><br></pre></td></tr></table></figure><p>如果成功添加，会看到类似以下输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 2 * * * /backup/scripts/mysql_backup.sh</span><br></pre></td></tr></table></figure><p>给大家看一下Linux实际的输出会是什么样子的？这是我自己设置的重启<code>systemctl</code>服务，重启脚本的时间是0点。</p><p><img src="/../../pictures/cron.png" alt="crontab -l 输出"></p><h2 id="五、避坑指南：常见问题排查"><a href="#五、避坑指南：常见问题排查" class="headerlink" title="五、避坑指南：常见问题排查"></a>五、避坑指南：常见问题排查</h2><ul><li>定时任务不执行？检查这几点<ol><li>命令路径是否正确</li><li>环境变量是否配置</li><li>文件权限是否足够</li></ol></li></ul><blockquote><p>这里要补充一下，命令路径最好写绝对路径，不要写相对路径。因为定时任务是在系统后台执行的，所以相对路径是相对于系统的根目录，而不是相对于当前用户的目录。其次，要注意文件权限的设置，不同的用户有不同的权限，所以要根据实际情况来设置⌨</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2025/09/02/hello-world/"/>
      <url>/2025/09/02/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
